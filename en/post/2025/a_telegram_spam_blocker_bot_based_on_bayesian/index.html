<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A Telegram Spam Blocker Bot Based On Bayesian Algorithm | In Pursuit of Simplicity</title>
<meta name=keywords content="telegram,design,programming,rails,rust"><meta name=description content="中文版本
1 Preface
I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot). The project is open-sourced at: https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram
Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.
It supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I&rsquo;ve ever seen."><meta name=author content="Ramsay Leung"><link rel=canonical href=https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.756d16b9d1a19b0d7274ca93e0428bf24ca10b144104611c6875be78291ca07b.css integrity="sha256-dW0WudGhmw1ydMqT4EKL8kyhCxRBBGEcaHW+eCkcoHs=" rel="preload stylesheet" as=style><link rel=icon href=https://ramsayleung.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ramsayleung.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ramsayleung.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ramsayleung.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ramsayleung.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MG65HQHEL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MG65HQHEL")}</script><meta property="og:url" content="https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/"><meta property="og:site_name" content="In Pursuit of Simplicity"><meta property="og:title" content="A Telegram Spam Blocker Bot Based On Bayesian Algorithm"><meta property="og:description" content="中文版本
1 Preface I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot). The project is open-sourced at: https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.
It supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I’ve ever seen."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-08-30T10:34:00-07:00"><meta property="article:modified_time" content="2025-09-27T17:42:56-07:00"><meta property="article:tag" content="Telegram"><meta property="article:tag" content="Design"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Rails"><meta property="article:tag" content="Rust"><meta property="og:image" content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="A Telegram Spam Blocker Bot Based On Bayesian Algorithm"><meta name=twitter:description content="中文版本
1 Preface
I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot). The project is open-sourced at: https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram
Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.
It supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I&rsquo;ve ever seen."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ramsayleung.github.io/en/post/"},{"@type":"ListItem","position":2,"name":"A Telegram Spam Blocker Bot Based On Bayesian Algorithm","item":"https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A Telegram Spam Blocker Bot Based On Bayesian Algorithm","name":"A Telegram Spam Blocker Bot Based On Bayesian Algorithm","description":"中文版本\n1 Preface I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot). The project is open-sourced at: https://github.com/ramsayleung/bayes_spam_sniper\n1.1 Telegram Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.\nIt supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I\u0026rsquo;ve ever seen.\n","keywords":["telegram","design","programming","rails","rust"],"articleBody":"中文版本\n1 Preface I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot). The project is open-sourced at: https://github.com/ramsayleung/bayes_spam_sniper\n1.1 Telegram Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.\nIt supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I’ve ever seen.\n2 Origin I usually listen to podcasts while running and cooking. 《软件那些事儿(A podcast in Chinese about history and story behind software)》1 is one of my favorites, hosted by 栋哥 2. Because I enjoyed 栋哥’s show, I took the chance to join his Telegram channel.\n栋哥’s Telegram channel 汗牛充栋 3 is primarily used for releasing podcast information. He once enabled the comment for channel, but it unexpectedly attracted a flood of crypto-related users posting spam, leading him to disable comments:\nAnother channel I subscribe, Ray Tracing 4, also complained about the crypto spam:\n3 Hackers \u0026 Painters Most common Telegram spam blocker bots are keyword-based, blocking messages by matching keywords, which can be easily bypassed by spammers.\nIf the messages get bypassed, it could only be deleted manually by administrator.\nThis reminded me of the situation Paul Graham described in his 2002 essay within “Hackers \u0026 Painters”:\nWhen email became popular, there was also a lot of spam. Common spam blockers were keyword matching + email address blacklists, but these were inefficient and easily circumvented.\nPaul Graham creatively used Bayesian Theorem to implement a spam blocker 5, and the results were surprisingly effective.\nIsn’t this a similar problem for Telegram spam?\nCouldn’t I use a similar solution to tackle Telegram spam?\n3.1 Bayes’ Theorem When it comes to probabilistic algorithms, the most classic example is the “coin toss” – a case of classical probability where each toss is an independent event, and the previous outcome doesn’t affect the next probability.\nHowever, many real-world scenarios aren’t infinitely repeatable like coin tosses, and events are often not independent.\nThis is where Bayes Theorem shows its unique value.\nIt used to update our degree of belief in a hypothesis given certain evidence.\nIn other words, the Bayes algorithm can dynamically adjust the estimated probability of an event occurring based on continuously emerging new evidence.\nSimply put, it’s like the human brain’s learning process: we start with a preliminary understanding, then revise our original view based on new information, thereby adjusting our next actions.\nPaul Graham used Bayes theorem to continuously classify new emails as spam or not based on emails already identified as spam or non-spam (ham).\nTo understand Bayes Theorem more intuitively, I recommend this clear and easy-to-understand videos:\n《Bayes theorem, the geometry of changing beliefs》6 4 Architecture Design Telegram Bot supports two modes of interacting with Telegram servers:\nWebhook: Telegram servers actively callback a URL previously registered by the Bot whenever the Bot receives a new message. The Bot Server only needs to handle the callback messages.\nLong Polling: The Bot Server continuously polls the Telegram servers to check for new messages and processes them if any. This bot uses this mode.\n4.0.1 Message Analysis After the Bot Server receives a message, it dispatches it to a separate telegram_bot_worker for processing. Based on the pre-trained model, it judges whether it’s a spam. If it is, it calls the Bot API to delete the message.\n4.0.2 Ban and Train After the Bot Server receives a message, it dispatches it to a separate telegram_bot_worker for processing. The telegram_bot_worker calls the bot API to delete the message and ban the user, and inserts a training data record marked as spam.\nSaving the training data triggers a hook, creating a training message delivered to the training message queue. Another worker, classifier_trainer, subscribes to training messages and uses the new messages to retrain and update the model.\nUsing a queue and a background process (classifier_trainer) for training tasks, instead of directly using the telegram_bot_worker, primarily decouples the Bot request handling from model training. Otherwise, as the model size increases, training time would get longer and longer, leading to increasingly long response times.\nDecoupling makes it easy to scale.\n5 Why Rails whoever have seen my project source code might wonder, why was it implemented using Ruby on Rails?\nBecause I work with JVM languages (Java/Kotlin/Scala) and Rust, I’m quite familiar with Java/Rust. Initially, thinking model training might require high performance, my first prototype 7 was implemented in Rust, taking about half an hour.\nBut when I wanted to expand the prototype into a Telegram bot, I found I needed to handle a lot of logic related to bot interaction, mainly involving API and database operations, most of which were unrelated to the model. So, I thought of Ruby on Rails again.\nFor a single engineer building a product prototype, in my personal opinion, there’s really no framework more efficient than Ruby on Rails, so I switched to Ruby on Rails.\nNew features in Rails 8 move it further towards being a so-called “one-person full-stack framework,” with built-in support for Solid Queue via the relational database.\nThe queue and background process from the architecture design were implemented with just a few lines of code, without even needing extra configuration. If the queue doesn’t exist, the framework creates it automatically:\n1 2 3 4 5 6 7 8 class ClassifierTrainerJob \u003c ApplicationJob # Job to train classifier asynchronously queue_as :training def perform(group_id, group_name) SpamClassifierService.rebuild_for_group(group_id, group_name) end end Thanks to Rails’ powerful ORM framework and its built-in lifecycle hooks, the code to trigger the background process for retraining the model after inserting new training data is also just a few lines:\n1 2 3 4 5 6 7 8 9 10 class TrainedMessage \u003c ApplicationRecord # Automatically train classifier after creating/updating a message after_create :retrain_classifier after_destroy :retrain_classifier def retrain_classifier # For efficiency, we could queue this as a background job ClassifierTrainerJob.perform_later(group_id, group_name) end end Empowered by Rails’ various built-in powerful tools, I implemented the entire bot’s functionality in just one day.\nSeeing this, some friends might worry about performance, thinking Ruby’s performance isn’t great, and it’s a dynamic language, making it hard to maintain.\nMy view remains the same as in my previous blog post 《Thoughts on a Decade of Programming(In Chinese)》8:\nGet it running first.\nBuild a prototype and get it running. See if users are willing to use your product first.\nWhen running speed becomes a bottleneck, your business must be very successful, and you’ll surely have enough resources to hire a team of programmers to optimize the project into Rust/C++, or even assembly.\nWithout users, discussing performance is a pseudo-proposition.\nAs for the saying “dynamic languages are fast in the moment, but maintaining the code is a nightmare” I quite agree with that too.\nTherefore, I won’t consider dynamic languages when choosing a tech stack for a team; I would only use compiled languages, even strong-typed ones like Rust.\nBut right now, it’s just me building a prototype, so I use whatever I’m most proficient with.\n5.1 Vibe Coding? Concepts like Vibe Coding and AI programming are everywhere, overwhelming the discourse. You might naturally wonder if this project was generated by Vibe Coding.\nThe answer is, I tried for a few hours and then gave up entirely. I tried both Claude 4 and Gemini 2.5 Pro.\nI started with a Rust + Cloudflare Worker tech stack. Rust + Cloudflare Worker is a relatively niche field with limited training data. The code generated by Vibe Coding failed to compile.\nLater, I switched to Ruby on Rails, and the problems became even worse. Ruby is a dynamic language; its syntax is almost like English, and Rails has many “black magic” metaprogramming features.\nSo errors only appeared at runtime. The development time saved by code generation was entirely consumed by the debugging process.\nAnother issue is that code generated by Vibe Coding often lacks design. For example, it tightly coupled the Classifier and TrainedMessage classes, having the Classifier persist TrainedMessage instances.\nIt also directly performed synchronous model training within the telegram_bot_worker process upon receiving training data, waiting for training to finish before returning the command result, completely neglecting to decouple receiving training data from model training.\nOne can only say that Vibe Coding is quite suitable for strongly-typed, compiled languages like Rust – at least the generated code has to compile.\nAs for those claims of “making an APP without writing/changing a single line of code,” I can’t help but wonder:\nIs the code so good that it doesn’t need a single change? Or can the developer not identify the crux of the problem, and thus doesn’t change anything?\n6 Design Philosophy After developing the prototype and making the bot’s core functionality usable, many ideas popped into my head.\nI immediately rushed to add them to the bot, resulting in support for nearly ten commands, plus different modes for private chats and group chats.\nBut I felt something was off. Adding so many features felt like those all-in-one super apps common in China. I began to question:\nWould users really use all these features? Would any users use these features? Don’t too many features also create extra cognitive burden?\nMy favorite ad blocker, Ublock Origin 9, is powerful and extremely effective at blocking, yet very simple and easy to use.\nRecalling the design philosophy mentioned in 《A Philosophy of Software Design(My thought about the book in Chinese)》10, the interface should be simple and easy to use, even if the functionality underneath is complex and rich.\nSo, I first removed all commands I considered unrelated to the core functionality.\nFurthermore, considering that most users might not have a technical background and might not know how to use commands, I optimized the interface to use buttons as much as possible, allowing users to click directly, improving usability:\nI also wanted to support multiple languages (e.g., automatically switching to Chinese or English based on the user’s system language). This required decent Internationalization support.\nOver 60% of the code in the core service class telegram_botter.rb was introduced for such usability improvements.\nSimplicity for the user, complexity for the developer.\n6.1 How to Use Just two steps, and the bot works automatically.\nAdd the bot (@BayesSpamSniperBot) to your group Grant the bot admin permissions (Delete messages, Ban users) After these two steps, the bot will not only start working automatically, identifying spam within the group, deleting text messages, and banning users who send spam more than 3 times;\nIt will also become smarter with community usage (via /markspam and /feedspam).\nThe design philosophy of this bot is to minimize disruption to admins and users, provide simple operation commands, and maximize automation. Therefore, this bot only offers the following three commands (supporting auto-completion with “/”):\n6.1.1 /markspam Delete spam messages and ban the user. Requires admin permissions.\nReply /markspam to the message you want to ban, and the bot will automatically delete that message and ban the user.\n(Message has also been deleted) Unlike common group management bots, this command not only deletes the spam and bans the user but also, because this message is marked as spam by an admin with very high confidence, uses this spam ad as training data to update the model in real-time.\nSimilar messages will not only be identified next time, but all groups using this bot will benefit, as similar texts will also be marked as spam.\n6.1.2 /listspam View the list of spam messages. Requires admin permissions.\nView the list of spam messages and proactively mark false positive spam as normal.\n6.1.3 /listbanuser View the list of banned accounts. Requires admin permissions.\nView the list of banned users and proactively unban them.\n6.1.4 /feedspam Feed spam messages for training. No permissions required. Can be used in private chat or in-group.\nFeeding in private chat:\nFeeding in-group:\n7 Eating your own dog food In the software development field, there’s a saying: “Eating your own dog food,” which means you should use the things you develop yourself.\nSo I created my own channel for testing: 菠萝油与天光墟 11. Unfortunately, it has very few subscribers, which fails to attract many spammers. So everyone is welcome to subscribe or come in to post spam, to attract more spammers.\nIn my channel, everyone has the right to speak freely :-) (the only slight drawback is a limit on frequency ).\nSince no one was posting spam in my channel, and suffering from a lack of training data, I had to do it in the hard way: to join various crypto groups, NSFW groups, and actively seek out spam:\nThe screenshots are Chinese Telegram group contains a lot of spammers and spam:\nSince developing this bot, my perspective on spam has changed. I used to find spam annoying in other groups, but now I’m happy to see them in other groups, as they are valuable training data that I need to record quickly before they get deleted.\n7.1 The Ingenuity of Spam The algorithm’s effectiveness in other people’s stories is always surprisingly good, but when I run it myself, I always find various uncovered cases and unexpected surprises, just like life.\nAlthough keyword blocker is inefficient, the spam we actually see are those that have already bypassed keyword filters.\nFor example:\n在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略 (Want to make money in the crypto circle? It’s a real pity if you don’t follow this ace community. Sincerely recommended, free strategies every day)\nOr\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666 (The contract reporting group linked in this person’s bio is pretty awesome. ETH to $500, BTC to $5200! + @BTCETHl6666)\nThe former uses spaces to bypass keywords, the latter uses punctuation.\nUnlike languages based on the Latin alphabet which naturally use spaces for word separation, Chinese requires word segmentation before statistical analysis with Bayes’ theorem.\nthe fox jumped over the lazy dog\n我们的中文就不一样了(Our Chinese is different)\n“我们的中文就不一样了” (Our Chinese is different) would be segmented into “我们 | 的 | 中文 | 就 | 不 | 一样 | 了” before word frequency can be counted.\nBut for the spam 在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略, the spaces not only affect keyword matching but also affect segmentation. The segmentation result for this sentence becomes(incorrect):\n在 | | 币圈 | | 想 | | 赚 | | 钱 | ， | 那 | | 你 | | 不 | 关 | | 注 | | 这 | | 个 | | 王 | | 牌 | | 社 | | 区 | ， | 真的 | 太 | 可惜 | 了 | ， | 真 | | 心 | | 推 | | 荐 | ， | 每 | | 天 | | 都 | | 有 | | 免 | | 费 | | 策 | | 略\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666 would be segmented into:\n这人简 | - | 介挂 | 的 | | 合 | - | 约 | - | 报单 | 群组 | 挺 | 牛 | 的 | ETH500 | 点 | ， | 大饼 | 5200 | 点 | ！ | | + | | @ | BTCETHl6666\nUnsanitized training data would affect the model’s results, showing the importance of training data quality. Therefore, I performed corresponding preprocessing on the training data:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # Step 1: Handle anti-spam separators # This still handles the cases like \"合-约\" -\u003e \"合约\" previous = \"\" while previous != cleaned previous = cleaned.dup cleaned = cleaned.gsub(/([一-龯A-Za-z0-9])[^一-龯A-Za-z0-9]+([一-龯A-Za-z0-9])/, '\\1\\2') end # Step 2: Handle anti-spam SPACES between Chinese characters # This specifically targets the \"想 赚 钱\" -\u003e \"想赚钱\" case. # We run it in a loop to handle multiple spaces, e.g., \"社 区\" -\u003e \"社区\" previous = \"\" while previous != cleaned previous = cleaned.dup # Find a Chinese char, followed by one or more spaces, then another Chinese char cleaned = cleaned.gsub(/([一-龯])(\\s+)([一-龯])/, '\\1\\3') end # Step 3: Add strategic spaces # This helps jieba segment properly, e.g., \"社区ETH\" -\u003e \"社区 ETH\" cleaned = cleaned.gsub(/([一-龯])([A-Za-z0-9])/, '\\1 \\2') cleaned = cleaned.gsub(/([A-Za-z0-9])([一-龯])/, '\\1 \\2') # Step 4: Remove excessive space cleaned = cleaned.gsub(/\\s+/, ' ').strip After preprocessing, 在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略 becomes 在币圈想赚钱那你不关注这个王牌社区真的太可惜了真心推荐每天都有免费策略 (Note: legitimate commas are also removed here. I find the segmentation result acceptable compared to the impact of excessive punctuation). Its segmentation is:\n在 | 币圈 | 想 | 赚钱 | 那 | 你 | 不 | 关注 | 这个 | 王牌 | 社区 | 真的 | 太 | 可惜 | 了 | 真心 | 推荐 | 每天 | 都 | 有 | 免费 | 策略\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666 becomes 这人简介挂的合约报单群组挺牛的 ETH500 点大饼 5200 点！ + @BTCETHl6666. Its segmentation is:\n这 | 人 | 简介 | 挂 | 的 | 合约 | 报单 | 群组 | 挺 | 牛 | 的 | | ETH500 | | 点 | 大饼 | | 5200 | | 点 | ！ | | + | | @ | BTCETHl6666\n7.1.1 Genius New Tricks Seeing many spam, I has to admire the creativity of spammers.\nBecause sending spam in messages gets caught by blockers, they innovatively came up with new tricks:\nThe messages contain normal text, but the profile picture and username are spam. This way, the spam blocker can’t work. Truly ingenious.\nFaced with such creative opponents, I adapted by building a training model for usernames. During detection, both the message text model and the username model are checked. If either one considers it spam, it gets blocked.\nOne could go further by doing OCR on profile pictures to extract text and add another model for profile pictures, but OCR is quite costly, so I’ll hold off for now.\n7.2 Optimization Without users, any optimization is unnecessary, as premature optimization is the root of all evil. Therefore, I focus on building the prototype first. But this doesn’t mean the prototype has no room for optimization.\nI have several optimization ideas in mind:\njieba’s segmentation might not be the best; other NLP algorithms could be used later for optimization. Retraining on every single training message is inefficient. A batching mechanism could be added, waiting for 5 minutes or accumulating 100 messages before processing. Currently, the entire model is computed in memory and persisted to the DB after calculation. A cache layer between memory and the database could optimize performance. The Bayesian algorithm might not be effective enough; a more complex machine learning model could be used. But these optimization points are all Good to have, not Must have. I’ll optimize them when actual problems arise later.\n8 Does it capture spam? Sending a message using transformed spam words:\nSuccessfully detected and automatically deleted:\nSome you might say this is just a demo showcase. Why are spam posted by others in my group still not being detected?\nBecause the Bayesian algorithm is fundamentally a probability-based algorithm. If it hasn’t encountered similar spam before, it cannot determine whether they are spam :(\nBe patient. All you need to do is use the /markspam command to delete the message and ban the user. This helps train the bot, and all users of this bot will benefit.\n9 Conclusion I thoroughly enjoyed this creative process: discovering a problem, having a spark of inspiration, building a prototype, and finally polishing it into a complete project.\nAlthough this is purely powered by passion – the code is open source, and I have to pay for the server out of my own pocket, with no material return.\nBut every time I see the bot successfully block an spam, that joy of creation and see it’s working is the best reward.\nProject repository: https://github.com/ramsayleung/bayes_spam_sniper Try it now: https://t.me/BayesSpamSniperBot https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605 ↩︎\nhttps://liuyandong.com/sample-page ↩︎\nhttps://t.me/huruanhuying ↩︎\nhttps://t.me/kaedeharakazuha17 ↩︎\nhttps://paulgraham.com/spam.html ↩︎\nhttps://www.youtube.com/watch?v=HZGCoVF3YvM ↩︎\nhttps://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d ↩︎\nhttps://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/ ↩︎\nhttps://ublockorigin.com/ ↩︎\nhttps://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/ ↩︎\nhttps://t.me/pipeapplebun ↩︎\n","wordCount":"3973","inLanguage":"en","image":"https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-08-30T10:34:00-07:00","dateModified":"2025-09-27T17:42:56-07:00","author":{"@type":"Person","name":"Ramsay Leung"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/"},"publisher":{"@type":"Organization","name":"In Pursuit of Simplicity","logo":{"@type":"ImageObject","url":"https://ramsayleung.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ramsayleung.github.io/en/ accesskey=h title="Home (Alt + H)"><img src=https://ramsayleung.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ramsayleung.github.io/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://ramsayleung.github.io/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://ramsayleung.github.io/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ramsayleung.github.io/en/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ramsayleung.github.io/en/about_me title=About><span>About</span></a></li><li><a href=https://ramsayleung.github.io/en/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ramsayleung.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://ramsayleung.github.io/en/post/>Posts</a></div><h1 class="post-title entry-hint-parent">A Telegram Spam Blocker Bot Based On Bayesian Algorithm</h1><div class=post-meta><span title='2025-08-30 10:34:00 -0700 -0700'>August 30, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;3973 words&nbsp;|&nbsp;<a href=https://github.com/ramsayleung/ramsayleung.github.io/blob/master/content/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#preface><span class=section-num>1</span> Preface</a><ul><li><a href=#telegram><span class=section-num>1.1</span> Telegram</a></li></ul></li><li><a href=#origin><span class=section-num>2</span> Origin</a></li><li><a href=#hackers-and-painters><span class=section-num>3</span> Hackers & Painters</a><ul><li><a href=#bayes-theorem><span class=section-num>3.1</span> Bayes&rsquo; Theorem</a></li></ul></li><li><a href=#architecture-design><span class=section-num>4</span> Architecture Design</a><ul><li></li></ul></li><li><a href=#why-rails><span class=section-num>5</span> Why Rails</a><ul><li><a href=#vibe-coding><span class=section-num>5.1</span> Vibe Coding?</a></li></ul></li><li><a href=#design-philosophy><span class=section-num>6</span> Design Philosophy</a><ul><li><a href=#how-to-use><span class=section-num>6.1</span> How to Use</a></li></ul></li><li><a href=#eating-your-own-dog-food><span class=section-num>7</span> Eating your own dog food</a><ul><li><a href=#the-ingenuity-of-spam><span class=section-num>7.1</span> The Ingenuity of Spam</a></li><li><a href=#optimization><span class=section-num>7.2</span> Optimization</a></li></ul></li><li><a href=#does-it-capture-spam><span class=section-num>8</span> Does it capture spam?</a></li><li><a href=#conclusion><span class=section-num>9</span> Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p><a href=https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/>中文版本</a></p><h2 id=preface><span class=section-num>1</span> Preface<a hidden class=anchor aria-hidden=true href=#preface>#</a></h2><p>I spent a weekend building a Telegram spam blocker bot based on Bayesian Algorithm <code>@BayesSpamSniperBot</code> (<a href=https://t.me/BayesSpamSniperBot>https://t.me/BayesSpamSniperBot</a>). The project is open-sourced at: <a href=https://github.com/ramsayleung/bayes_spam_sniper>https://github.com/ramsayleung/bayes_spam_sniper</a></p><h3 id=telegram><span class=section-num>1.1</span> Telegram<a hidden class=anchor aria-hidden=true href=#telegram>#</a></h3><p>Telegram is a popular instant messaging application, similar to Snapchat and WhatsApp, with over 1 billion users.</p><p>It supports many powerful features like cloud chat history storage, clients for Linux, Mac, Windows, Android, IOS, and Web (all open-source), Channel, and arguably the most powerful bot system I&rsquo;ve ever seen.</p><h2 id=origin><span class=section-num>2</span> Origin<a hidden class=anchor aria-hidden=true href=#origin>#</a></h2><p>I usually listen to podcasts while running and cooking. 《<a href=https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605>软件那些事儿(A podcast in Chinese about history and story behind software)</a>》<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> is one of my favorites, hosted by <a href=https://liuyandong.com/sample-page>栋哥</a> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Because I enjoyed 栋哥&rsquo;s show, I took the chance to join his Telegram channel.</p><p>栋哥&rsquo;s Telegram channel <a href=https://t.me/huruanhuying>汗牛充栋</a> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> is primarily used for releasing podcast information.
He once enabled the comment for channel, but it unexpectedly attracted a flood of crypto-related users posting spam, leading him to disable comments:</p><figure><input type=checkbox id=zoomCheck-be4f5 hidden>
<label for=zoomCheck-be4f5><img class=zoomCheck loading=lazy src=/ox-hugo/spam_concert.jpg></label></figure><p>Another channel I subscribe, <a href=https://t.me/kaedeharakazuha17>Ray Tracing</a> <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>, also complained about the crypto spam:</p><figure><input type=checkbox id=zoomCheck-d541b hidden>
<label for=zoomCheck-d541b><img class=zoomCheck loading=lazy src=/ox-hugo/ray_tracing_spam.jpg></label></figure><h2 id=hackers-and-painters><span class=section-num>3</span> Hackers & Painters<a hidden class=anchor aria-hidden=true href=#hackers-and-painters>#</a></h2><p>Most common Telegram spam blocker bots are keyword-based, blocking messages by matching keywords, which can be easily bypassed by spammers.</p><figure><input type=checkbox id=zoomCheck-1401f hidden>
<label for=zoomCheck-1401f><img class=zoomCheck loading=lazy src=/ox-hugo/keyword_based_blocker.jpg></label></figure><p>If the messages get bypassed, it could only be deleted manually by administrator.</p><p>This reminded me of the situation Paul Graham described in his 2002 essay within &ldquo;Hackers & Painters&rdquo;:</p><p>When email became popular, there was also a lot of spam. Common spam blockers were keyword matching + email address blacklists, but these were inefficient and easily circumvented.</p><p>Paul Graham creatively used Bayesian Theorem to implement a <a href=https://paulgraham.com/spam.html>spam blocker</a> <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, and the results were surprisingly effective.</p><p>Isn&rsquo;t this a similar problem for Telegram spam?</p><p>Couldn&rsquo;t I use a similar solution to tackle Telegram spam?</p><h3 id=bayes-theorem><span class=section-num>3.1</span> Bayes&rsquo; Theorem<a hidden class=anchor aria-hidden=true href=#bayes-theorem>#</a></h3><p>When it comes to probabilistic algorithms, the most classic example is the &ldquo;coin toss&rdquo; – a case of classical probability where each toss is an independent event, and the previous outcome doesn&rsquo;t affect the next probability.</p><p>However, many real-world scenarios aren&rsquo;t infinitely repeatable like coin tosses, and events are often not independent.</p><p>This is where Bayes Theorem shows its unique value.</p><p>It used to update our degree of belief in a hypothesis given certain evidence.</p><p>In other words, the Bayes algorithm can dynamically adjust the estimated probability of an event occurring based on continuously emerging new evidence.</p><p>Simply put, it&rsquo;s like the human brain&rsquo;s learning process: we start with a preliminary understanding, then revise our original view based on new information, thereby adjusting our next actions.</p><p>Paul Graham used Bayes theorem to continuously classify new emails as spam or not based on emails already identified as spam or non-spam (ham).</p><p>To understand Bayes Theorem more intuitively, I recommend this clear and easy-to-understand videos:</p><ul><li>《<a href="https://www.youtube.com/watch?v=HZGCoVF3YvM">Bayes theorem, the geometry of changing beliefs</a>》<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></li></ul><h2 id=architecture-design><span class=section-num>4</span> Architecture Design<a hidden class=anchor aria-hidden=true href=#architecture-design>#</a></h2><p>Telegram Bot supports two modes of interacting with Telegram servers:</p><ol><li><p>Webhook: Telegram servers actively callback a URL previously registered by the Bot whenever the Bot receives a new message. The Bot Server only needs to handle the callback messages.</p></li><li><p>Long Polling: The Bot Server continuously polls the Telegram servers to check for new messages and processes them if any. This bot uses this mode.</p><figure><input type=checkbox id=zoomCheck-ca97a hidden>
<label for=zoomCheck-ca97a><img class=zoomCheck loading=lazy src=/ox-hugo/webhook_vs_long_polling.jpg></label></figure></li></ol><h4 id=message-analysis><span class=section-num>4.0.1</span> Message Analysis<a hidden class=anchor aria-hidden=true href=#message-analysis>#</a></h4><figure><input type=checkbox id=zoomCheck-e2518 hidden>
<label for=zoomCheck-e2518><img class=zoomCheck loading=lazy src=/ox-hugo/spam_analyze.jpg></label></figure><p>After the Bot Server receives a message, it dispatches it to a separate <code>telegram_bot_worker</code> for processing. Based on the pre-trained model, it judges whether it&rsquo;s a spam. If it is, it calls the Bot API to delete the message.</p><h4 id=ban-and-train><span class=section-num>4.0.2</span> Ban and Train<a hidden class=anchor aria-hidden=true href=#ban-and-train>#</a></h4><figure><input type=checkbox id=zoomCheck-04d7c hidden>
<label for=zoomCheck-04d7c><img class=zoomCheck loading=lazy src=/ox-hugo/mark_spam_and_ban_user.jpg></label></figure><p>After the Bot Server receives a message, it dispatches it to a separate <code>telegram_bot_worker</code> for processing. The <code>telegram_bot_worker</code> calls the bot API to delete the message and ban the user, and inserts a training data record marked as spam.</p><p>Saving the training data triggers a hook, creating a training message delivered to the <code>training</code> message queue. Another worker, <code>classifier_trainer</code>, subscribes to <code>training</code> messages and uses the new messages to retrain and update the model.</p><p>Using a queue and a background process (<code>classifier_trainer</code>) for training tasks, instead of directly using the <code>telegram_bot_worker</code>, primarily decouples the Bot request handling from model training. Otherwise, as the model size increases, training time would get longer and longer, leading to increasingly long response times.</p><p>Decoupling makes it easy to scale.</p><h2 id=why-rails><span class=section-num>5</span> Why Rails<a hidden class=anchor aria-hidden=true href=#why-rails>#</a></h2><p>whoever have seen my project source code might wonder, why was it implemented using Ruby on Rails?</p><p>Because I work with JVM languages (Java/Kotlin/Scala) and Rust, I&rsquo;m quite familiar with Java/Rust. Initially, thinking model training might require high performance, my first <a href=https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d>prototype</a> <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> was implemented in Rust, taking about half an hour.</p><p>But when I wanted to expand the prototype into a Telegram bot, I found I needed to handle a lot of logic related to bot interaction, mainly involving API and database operations, most of which were unrelated to the model. So, I thought of Ruby on Rails again.</p><p>For a single engineer building a product prototype, in my personal opinion, there&rsquo;s really no framework more efficient than <code>Ruby on Rails</code>, so I switched to Ruby on Rails.</p><p>New features in Rails 8 move it further towards being a so-called &ldquo;one-person full-stack framework,&rdquo; with built-in support for <code>Solid Queue</code> via the relational database.</p><p>The queue and background process from the architecture design were implemented with just a few lines of code, without even needing extra configuration. If the queue doesn&rsquo;t exist, the framework creates it automatically:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>ClassifierTrainerJob</span> <span class=o>&lt;</span> <span class=no>ApplicationJob</span>
</span></span><span class=line><span class=cl>  <span class=c1># Job to train classifier asynchronously</span>
</span></span><span class=line><span class=cl>  <span class=n>queue_as</span> <span class=ss>:training</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>perform</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=no>SpamClassifierService</span><span class=o>.</span><span class=n>rebuild_for_group</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Thanks to Rails&rsquo; powerful ORM framework and its built-in lifecycle hooks, the code to trigger the background process for retraining the model after inserting new training data is also just a few lines:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>TrainedMessage</span> <span class=o>&lt;</span> <span class=no>ApplicationRecord</span>
</span></span><span class=line><span class=cl>  <span class=c1># Automatically train classifier after creating/updating a message</span>
</span></span><span class=line><span class=cl>  <span class=n>after_create</span> <span class=ss>:retrain_classifier</span>
</span></span><span class=line><span class=cl>  <span class=n>after_destroy</span> <span class=ss>:retrain_classifier</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>retrain_classifier</span>
</span></span><span class=line><span class=cl>    <span class=c1># For efficiency, we could queue this as a background job</span>
</span></span><span class=line><span class=cl>    <span class=no>ClassifierTrainerJob</span><span class=o>.</span><span class=n>perform_later</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Empowered by Rails&rsquo; various built-in powerful tools, I implemented the entire bot&rsquo;s functionality in just one day.</p><p>Seeing this, some friends might worry about performance, thinking Ruby&rsquo;s performance isn&rsquo;t great, and it&rsquo;s a dynamic language, making it hard to maintain.</p><p>My view remains the same as in my previous blog post 《<a href=https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/>Thoughts on a Decade of Programming(In Chinese)</a>》<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>:</p><p><strong><strong>Get it running first</strong></strong>.</p><p>Build a prototype and get it running. See if users are willing to use your product first.</p><p>When running speed becomes a bottleneck, your business must be very successful, and you&rsquo;ll surely have enough resources to hire a team of programmers to optimize the project into Rust/C++, or even assembly.</p><p>Without users, discussing performance is a pseudo-proposition.</p><p>As for the saying &ldquo;dynamic languages are fast in the moment, but maintaining the code is a nightmare&rdquo; I quite agree with that too.</p><p>Therefore, I won&rsquo;t consider dynamic languages when choosing a tech stack for a team; I would only use compiled languages, even strong-typed ones like Rust.</p><p>But right now, it&rsquo;s just me building a prototype, so I use whatever I&rsquo;m most proficient with.</p><h3 id=vibe-coding><span class=section-num>5.1</span> Vibe Coding?<a hidden class=anchor aria-hidden=true href=#vibe-coding>#</a></h3><p>Concepts like Vibe Coding and AI programming are everywhere, overwhelming the discourse. You might naturally wonder if this project was generated by Vibe Coding.</p><p>The answer is, I tried for a few hours and then gave up entirely. I tried both Claude 4 and Gemini 2.5 Pro.</p><p>I started with a Rust + Cloudflare Worker tech stack. Rust + Cloudflare Worker is a relatively niche field with limited training data. The code generated by Vibe Coding failed to compile.</p><p>Later, I switched to Ruby on Rails, and the problems became even worse. Ruby is a dynamic language; its syntax is almost like English, and Rails has many &ldquo;black magic&rdquo; metaprogramming features.</p><p>So errors only appeared at runtime. The development time saved by code generation was entirely consumed by the debugging process.</p><p>Another issue is that code generated by Vibe Coding often lacks design. For example, it tightly coupled the <code>Classifier</code> and <code>TrainedMessage</code> classes, having the <code>Classifier</code> persist <code>TrainedMessage</code> instances.</p><p>It also directly performed synchronous model training within the <code>telegram_bot_worker</code> process upon receiving training data, waiting for training to finish before returning the command result, completely neglecting to decouple receiving training data from model training.</p><p>One can only say that Vibe Coding is quite suitable for strongly-typed, compiled languages like Rust – at least the generated code has to compile.</p><p>As for those claims of &ldquo;making an APP without writing/changing a single line of code,&rdquo; I can&rsquo;t help but wonder:</p><p>Is the code so good that it doesn&rsquo;t need a single change? Or can the developer not identify the crux of the problem, and thus doesn&rsquo;t change anything?</p><h2 id=design-philosophy><span class=section-num>6</span> Design Philosophy<a hidden class=anchor aria-hidden=true href=#design-philosophy>#</a></h2><p>After developing the prototype and making the bot&rsquo;s core functionality usable, many ideas popped into my head.</p><p>I immediately rushed to add them to the bot,
resulting in support for nearly ten commands, plus different modes for private chats and group chats.</p><p>But I felt something was off. Adding so many features felt like those all-in-one super apps common in China. I began to question:</p><p>Would users really use all these features? Would <strong>any</strong> users use these features? Don&rsquo;t too many features also create extra cognitive burden?</p><p>My favorite ad blocker, <a href=https://ublockorigin.com/>Ublock Origin</a> <sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>, is powerful and extremely effective at blocking, yet very simple and easy to use.</p><p>Recalling the design philosophy mentioned in 《<a href=https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/>A Philosophy of Software Design(My thought about the book in Chinese)</a>》<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>, the interface should be simple and easy to use, even if the functionality underneath is complex and rich.</p><p>So, I first removed all commands I considered unrelated to the core functionality.</p><p>Furthermore, considering that most users might not have a technical background and might not know how to use commands, I optimized the interface to use buttons as much as possible, allowing users to click directly, improving usability:</p><figure><input type=checkbox id=zoomCheck-5f8d5 hidden>
<label for=zoomCheck-5f8d5><img class=zoomCheck loading=lazy src=/ox-hugo/start_en.jpg></label></figure><figure><input type=checkbox id=zoomCheck-bc48d hidden>
<label for=zoomCheck-bc48d><img class=zoomCheck loading=lazy src=/ox-hugo/help_en.jpg></label></figure><p>I also wanted to support multiple languages (e.g., automatically switching to Chinese or English based on the user&rsquo;s system language). This required decent Internationalization support.</p><figure><input type=checkbox id=zoomCheck-e207f hidden>
<label for=zoomCheck-e207f><img class=zoomCheck loading=lazy src=/ox-hugo/start_zh.jpg></label></figure><figure><input type=checkbox id=zoomCheck-ca4b6 hidden>
<label for=zoomCheck-ca4b6><img class=zoomCheck loading=lazy src=/ox-hugo/help_page_zh.jpg></label></figure><p>Over 60% of the code in the core service class <a href=https://github.com/ramsayleung/bayes_spam_sniper/blob/master/app/services/telegram_botter.rb>telegram_botter.rb</a> was introduced for such usability improvements.</p><p>Simplicity for the user, complexity for the developer.</p><h3 id=how-to-use><span class=section-num>6.1</span> How to Use<a hidden class=anchor aria-hidden=true href=#how-to-use>#</a></h3><p>Just two steps, and the bot works automatically.</p><ul><li><a href="https://t.me/BayesSpamSniperBot?startgroup=true">Add the bot (@BayesSpamSniperBot) to your group</a></li><li>Grant the bot admin permissions (Delete messages, Ban users)</li></ul><p>After these two steps, the bot will not only start working automatically, identifying spam within the group, deleting text messages, and banning users who send spam more than 3 times;</p><p>It will also become smarter with community usage (via <code>/markspam</code> and <code>/feedspam</code>).</p><figure><input type=checkbox id=zoomCheck-28a2c hidden>
<label for=zoomCheck-28a2c><img class=zoomCheck loading=lazy src=/ox-hugo/detect_spam_and_ban_user.jpg></label></figure><p>The design philosophy of this bot is to minimize disruption to admins and users, provide simple operation commands, and maximize automation.
Therefore, this bot only offers the following three commands (supporting auto-completion with &ldquo;/&rdquo;):</p><figure><input type=checkbox id=zoomCheck-ecf1f hidden>
<label for=zoomCheck-ecf1f><img class=zoomCheck loading=lazy src=/ox-hugo/command_auto_completion.jpg></label></figure><h4 id=markspam><span class=section-num>6.1.1</span> <code>/markspam</code><a hidden class=anchor aria-hidden=true href=#markspam>#</a></h4><p>Delete spam messages and ban the user. Requires admin permissions.</p><p>Reply <code>/markspam</code> to the message you want to ban, and the bot will automatically delete that message and ban the user.</p><figure><input type=checkbox id=zoomCheck-14d59 hidden>
<label for=zoomCheck-14d59><img class=zoomCheck loading=lazy src=/ox-hugo/markspam_2.jpg></label></figure><p>(Message has also been deleted)
<img loading=lazy src=/ox-hugo/markspam.jpg></p><p>Unlike common group management bots, this command not only deletes the spam and bans the user but also, because this message is marked as spam by an admin with very high confidence, uses this spam ad as training data to update the model in real-time.</p><p>Similar messages will not only be identified next time, but all groups using this bot will benefit, as similar texts will also be marked as spam.</p><h4 id=listspam><span class=section-num>6.1.2</span> <code>/listspam</code><a hidden class=anchor aria-hidden=true href=#listspam>#</a></h4><p>View the list of spam messages. Requires admin permissions.</p><figure><input type=checkbox id=zoomCheck-d0038 hidden>
<label for=zoomCheck-d0038><img class=zoomCheck loading=lazy src=/ox-hugo/listspam.jpg></label></figure><p>View the list of spam messages and proactively mark false positive spam as normal.</p><h4 id=listbanuser><span class=section-num>6.1.3</span> <code>/listbanuser</code><a hidden class=anchor aria-hidden=true href=#listbanuser>#</a></h4><p>View the list of banned accounts. Requires admin permissions.</p><figure><input type=checkbox id=zoomCheck-7751e hidden>
<label for=zoomCheck-7751e><img class=zoomCheck loading=lazy src=/ox-hugo/listbanuser.jpg></label></figure><p>View the list of banned users and proactively unban them.</p><h4 id=feedspam><span class=section-num>6.1.4</span> <code>/feedspam</code><a hidden class=anchor aria-hidden=true href=#feedspam>#</a></h4><p>Feed spam messages for training. No permissions required. Can be used in private chat or in-group.</p><p>Feeding in private chat:</p><figure><input type=checkbox id=zoomCheck-2a139 hidden>
<label for=zoomCheck-2a139><img class=zoomCheck loading=lazy src=/ox-hugo/feedspam.jpg></label></figure><p>Feeding in-group:</p><figure><input type=checkbox id=zoomCheck-1fc12 hidden>
<label for=zoomCheck-1fc12><img class=zoomCheck loading=lazy src=/ox-hugo/feedspam2.jpg></label></figure><h2 id=eating-your-own-dog-food><span class=section-num>7</span> Eating your own dog food<a hidden class=anchor aria-hidden=true href=#eating-your-own-dog-food>#</a></h2><p>In the software development field, there&rsquo;s a saying: &ldquo;Eating your own dog food,&rdquo; which means you should use the things you develop yourself.</p><p>So I created my own channel for testing: <a href=https://t.me/pipeapplebun>菠萝油与天光墟</a> <sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>. Unfortunately, it has very few subscribers,
which fails to attract many spammers. So everyone is welcome to subscribe or come in to post spam, to attract more spammers.</p><p>In my channel, everyone has the right to speak freely :-) (the only slight drawback is a limit on frequency ).</p><p>Since no one was posting spam in my channel, and suffering from a lack of training data, I had to do it in the hard way: to join various crypto groups, NSFW groups, and actively seek out spam:</p><p>The screenshots are Chinese Telegram group contains a lot of spammers and spam:</p><figure><input type=checkbox id=zoomCheck-3779e hidden>
<label for=zoomCheck-3779e><img class=zoomCheck loading=lazy src=/ox-hugo/telegram_group1.jpg></label></figure><figure><input type=checkbox id=zoomCheck-35262 hidden>
<label for=zoomCheck-35262><img class=zoomCheck loading=lazy src=/ox-hugo/telegram_group2.jpg></label></figure><figure><input type=checkbox id=zoomCheck-b0b9b hidden>
<label for=zoomCheck-b0b9b><img class=zoomCheck loading=lazy src=/ox-hugo/spam_sample.jpg></label></figure><p>Since developing this bot, my perspective on spam has changed. I used to find spam annoying in other groups, but now I&rsquo;m happy to see them in other groups,
as they are valuable training data that I need to record quickly before they get deleted.</p><h3 id=the-ingenuity-of-spam><span class=section-num>7.1</span> The Ingenuity of Spam<a hidden class=anchor aria-hidden=true href=#the-ingenuity-of-spam>#</a></h3><p>The algorithm&rsquo;s effectiveness in other people&rsquo;s stories is always surprisingly good, but when I run it myself, I always find various uncovered cases and unexpected surprises, just like life.</p><p>Although keyword blocker is inefficient, the spam we actually see are those that have already bypassed keyword filters.</p><p>For example:</p><blockquote><p>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略
(Want to make money in the crypto circle? It&rsquo;s a real pity if you don&rsquo;t follow this ace community. Sincerely recommended, free strategies every day)</p></blockquote><p>Or</p><blockquote><p>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666
(The contract reporting group linked in this person&rsquo;s bio is pretty awesome. ETH to $500, BTC to $5200! + @BTCETHl6666)</p></blockquote><p>The former uses spaces to bypass keywords, the latter uses punctuation.</p><p>Unlike languages based on the Latin alphabet which naturally use spaces for word separation, Chinese requires word segmentation before statistical analysis with Bayes&rsquo; theorem.</p><blockquote><p>the fox jumped over the lazy dog</p><p>我们的中文就不一样了(Our Chinese is different)</p></blockquote><p>&ldquo;我们的中文就不一样了&rdquo; (Our Chinese is different) would be segmented into &ldquo;我们 | 的 | 中文 | 就 | 不 | 一样 | 了&rdquo; before word frequency can be counted.</p><p>But for the spam <code>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略</code>, the spaces not only affect keyword matching but also affect segmentation. The segmentation result for this sentence becomes(incorrect):</p><p><code>在 | | 币圈 | | 想 | | 赚 | | 钱 | ， | 那 | | 你 | | 不 | 关 | | 注 | | 这 | | 个 | | 王 | | 牌 | | 社 | | 区 | ， | 真的 | 太 | 可惜 | 了 | ， | 真 | | 心 | | 推 | | 荐 | ， | 每 | | 天 | | 都 | | 有 | | 免 | | 费 | | 策 | | 略</code></p><p><code>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666</code> would be segmented into:</p><p><code>这人简 | - | 介挂 | 的 | | 合 | - | 约 | - | 报单 | 群组 | 挺 | 牛 | 的 | ETH500 | 点 | ， | 大饼 | 5200 | 点 | ！ | | + | | @ | BTCETHl6666</code></p><p>Unsanitized training data would affect the model&rsquo;s results, showing the importance of training data quality. Therefore, I performed corresponding preprocessing on the training data:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=c1># Step 1: Handle anti-spam separators</span>
</span></span><span class=line><span class=cl><span class=c1># This still handles the cases like &#34;合-约&#34; -&gt; &#34;合约&#34;</span>
</span></span><span class=line><span class=cl><span class=n>previous</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>previous</span> <span class=o>!=</span> <span class=n>cleaned</span>
</span></span><span class=line><span class=cl>  <span class=n>previous</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>dup</span>
</span></span><span class=line><span class=cl>  <span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯A-Za-z0-9])[^一-龯A-Za-z0-9]+([一-龯A-Za-z0-9])/</span><span class=p>,</span> <span class=s1>&#39;\1\2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 2: Handle anti-spam SPACES between Chinese characters</span>
</span></span><span class=line><span class=cl><span class=c1># This specifically targets the &#34;想 赚 钱&#34; -&gt; &#34;想赚钱&#34; case.</span>
</span></span><span class=line><span class=cl><span class=c1># We run it in a loop to handle multiple spaces, e.g., &#34;社 区&#34; -&gt; &#34;社区&#34;</span>
</span></span><span class=line><span class=cl><span class=n>previous</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>previous</span> <span class=o>!=</span> <span class=n>cleaned</span>
</span></span><span class=line><span class=cl>  <span class=n>previous</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>dup</span>
</span></span><span class=line><span class=cl>  <span class=c1># Find a Chinese char, followed by one or more spaces, then another Chinese char</span>
</span></span><span class=line><span class=cl>  <span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯])(\s+)([一-龯])/</span><span class=p>,</span> <span class=s1>&#39;\1\3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 3: Add strategic spaces</span>
</span></span><span class=line><span class=cl><span class=c1># This helps jieba segment properly, e.g., &#34;社区ETH&#34; -&gt; &#34;社区 ETH&#34;</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯])([A-Za-z0-9])/</span><span class=p>,</span> <span class=s1>&#39;\1 \2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([A-Za-z0-9])([一-龯])/</span><span class=p>,</span> <span class=s1>&#39;\1 \2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 4: Remove excessive space</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/\s+/</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span>
</span></span></code></pre></td></tr></table></div></div><p>After preprocessing, <code>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略</code> becomes <code>在币圈想赚钱那你不关注这个王牌社区真的太可惜了真心推荐每天都有免费策略</code> (Note: legitimate commas are also removed here. I find the segmentation result acceptable compared to the impact of excessive punctuation). Its segmentation is:</p><p><code>在 | 币圈 | 想 | 赚钱 | 那 | 你 | 不 | 关注 | 这个 | 王牌 | 社区 | 真的 | 太 | 可惜 | 了 | 真心 | 推荐 | 每天 | 都 | 有 | 免费 | 策略</code></p><p><code>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666</code> becomes <code>这人简介挂的合约报单群组挺牛的 ETH500 点大饼 5200 点！ + @BTCETHl6666</code>. Its segmentation is:</p><p><code>这 | 人 | 简介 | 挂 | 的 | 合约 | 报单 | 群组 | 挺 | 牛 | 的 | | ETH500 | | 点 | 大饼 | | 5200 | | 点 | ！ | | + | | @ | BTCETHl6666</code></p><h4 id=genius-new-tricks><span class=section-num>7.1.1</span> Genius New Tricks<a hidden class=anchor aria-hidden=true href=#genius-new-tricks>#</a></h4><p>Seeing many spam, I has to admire the creativity of spammers.</p><p>Because sending spam in messages gets caught by blockers, they innovatively came up with new tricks:</p><figure><input type=checkbox id=zoomCheck-fe0e1 hidden>
<label for=zoomCheck-fe0e1><img class=zoomCheck loading=lazy src=/ox-hugo/spam_by_username.jpg></label></figure><p>The messages contain normal text, but the profile picture and username are spam. This way, the spam blocker can&rsquo;t work. Truly ingenious.</p><p>Faced with such creative opponents, I adapted by building a training model for usernames. During detection, both the message text model and the username model are checked.
If either one considers it spam, it gets blocked.</p><p>One could go further by doing OCR on profile pictures to extract text and add another model for profile pictures, but OCR is quite costly, so I&rsquo;ll hold off for now.</p><h3 id=optimization><span class=section-num>7.2</span> Optimization<a hidden class=anchor aria-hidden=true href=#optimization>#</a></h3><p>Without users, any optimization is unnecessary, as premature optimization is the root of all evil.
Therefore, I focus on building the prototype first. But this doesn&rsquo;t mean the prototype has no room for optimization.</p><p>I have several optimization ideas in mind:</p><ol><li>jieba&rsquo;s segmentation might not be the best; other NLP algorithms could be used later for optimization.</li><li>Retraining on every single training message is inefficient. A batching mechanism could be added, waiting for 5 minutes or accumulating 100 messages before processing.</li><li>Currently, the entire model is computed in memory and persisted to the DB after calculation. A cache layer between memory and the database could optimize performance.</li><li>The Bayesian algorithm might not be effective enough; a more complex machine learning model could be used.</li></ol><p>But these optimization points are all Good to have, not Must have. I&rsquo;ll optimize them when actual problems arise later.</p><h2 id=does-it-capture-spam><span class=section-num>8</span> Does it capture spam?<a hidden class=anchor aria-hidden=true href=#does-it-capture-spam>#</a></h2><p>Sending a message using transformed spam words:</p><figure><input type=checkbox id=zoomCheck-cdd9f hidden>
<label for=zoomCheck-cdd9f><img class=zoomCheck loading=lazy src=/ox-hugo/spam_messge_2.jpg></label></figure><p>Successfully detected and automatically deleted:</p><figure><input type=checkbox id=zoomCheck-78c5f hidden>
<label for=zoomCheck-78c5f><img class=zoomCheck loading=lazy src=/ox-hugo/deleted_spam.jpg></label></figure><p>Some you might say this is just a demo showcase. Why are spam posted by others in my group still not being detected?</p><p>Because the Bayesian algorithm is fundamentally a probability-based algorithm. If it hasn&rsquo;t encountered similar spam before, it cannot determine whether they are spam :(</p><p>Be patient. All you need to do is use the <code>/markspam</code> command to delete the message and ban the user. This helps train the bot, and all users of this bot will benefit.</p><h2 id=conclusion><span class=section-num>9</span> Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>I thoroughly enjoyed this creative process: discovering a problem, having a spark of inspiration, building a prototype, and finally polishing it into a complete project.</p><p>Although this is purely powered by passion – the code is open source, and I have to pay for the server out of my own pocket, with no material return.</p><p>But every time I see the bot successfully block an spam, that joy of creation and see it&rsquo;s working is the best reward.</p><ul><li>Project repository: <a href=https://github.com/ramsayleung/bayes_spam_sniper>https://github.com/ramsayleung/bayes_spam_sniper</a></li><li>Try it now: <a href=https://t.me/BayesSpamSniperBot>https://t.me/BayesSpamSniperBot</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605>https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://liuyandong.com/sample-page>https://liuyandong.com/sample-page</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://t.me/huruanhuying>https://t.me/huruanhuying</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://t.me/kaedeharakazuha17>https://t.me/kaedeharakazuha17</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://paulgraham.com/spam.html>https://paulgraham.com/spam.html</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href="https://www.youtube.com/watch?v=HZGCoVF3YvM">https://www.youtube.com/watch?v=HZGCoVF3YvM</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d>https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/>https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=https://ublockorigin.com/>https://ublockorigin.com/</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/>https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://t.me/pipeapplebun>https://t.me/pipeapplebun</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ramsayleung.github.io/en/tags/telegram/>Telegram</a></li><li><a href=https://ramsayleung.github.io/en/tags/design/>Design</a></li><li><a href=https://ramsayleung.github.io/en/tags/programming/>Programming</a></li><li><a href=https://ramsayleung.github.io/en/tags/rails/>Rails</a></li><li><a href=https://ramsayleung.github.io/en/tags/rust/>Rust</a></li></ul><nav class=paginav><a class=prev href=https://ramsayleung.github.io/en/post/2025/a_story_about_bypassing_air_canadas_in-flight_network_restrictions/><span class=title>« Prev</span><br><span>A Story About Bypassing Air Canada's In-flight Network Restrictions</span>
</a><a class=next href=https://ramsayleung.github.io/en/post/2024/reflection_on_ten_years_of_programming/><span class=title>Next »</span><br><span>Reflections on Ten Years of Programming</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on x" href="https://x.com/intent/tweet/?text=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm&amp;url=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f&amp;hashtags=telegram%2cdesign%2cprogramming%2crails%2crust"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f&amp;title=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm&amp;summary=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm&amp;source=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on reddit" href="https://reddit.com/submit?url=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f&title=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on whatsapp" href="https://api.whatsapp.com/send?text=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm%20-%20https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on telegram" href="https://telegram.me/share/url?text=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm&amp;url=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Telegram Spam Blocker Bot Based On Bayesian Algorithm on ycombinator" href="https://news.ycombinator.com/submitlink?t=A%20Telegram%20Spam%20Blocker%20Bot%20Based%20On%20Bayesian%20Algorithm&u=https%3a%2f%2framsayleung.github.io%2fen%2fpost%2f2025%2fa_telegram_spam_blocker_bot_based_on_bayesian%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><section><h2>Comments</h2><div id=comments-giscus></div></section><script type=text/javascript>function getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||document.body.classList.contains("dark")?"dark":"light"}function setGiscusTheme(e=!1){const s=e?"dark":"light";var n,t=document.querySelector(".giscus-frame");t&&(n=new URL(t.src),n.searchParams.set("theme",s),t.src=n.toString())}function loadComment(e=!1){const n="en"=="zh",t=document.getElementById("comments-giscus");if(t!==null&&!t.hasAttribute("data-giscus-loaded")){console.log("Initial giscus load");const s=document.createElement("script");s.setAttribute("src","https://giscus.app/client.js"),s.setAttribute("data-repo","ramsayleung/comment"),s.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkzMDk2NjQ1NDk="),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOEnUbJc4Cltnz"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",e?"dark":"light"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("data-lang",n?"zh-CN":"en"),s.setAttribute("async","true"),t.appendChild(s),t.setAttribute("data-giscus-loaded","true")}}let currentTheme=getCurrentTheme();loadComment(currentTheme==="dark");const themeObserver=new MutationObserver(e=>{e.forEach(e=>{if(e.type==="attributes"&&e.attributeName==="class"){const e=getCurrentTheme();e!==currentTheme&&(currentTheme=e,setGiscusTheme(currentTheme==="dark"))}})});themeObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/ramsayleung/ramsayleung.github.io>here</a>, licensed under GPLv3 ·</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>