<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing | è èæ²¹ä¸å¤©å…‰å¢Ÿ</title>
<meta name=keywords content="testing,rust"><meta name=description content="1 å‰è¨€
1.1 test caseçš„å±€é™
æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚
ç”¨ä¹‹å‰ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š"><meta name=author content="Ramsay Leung"><link rel=canonical href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.756d16b9d1a19b0d7274ca93e0428bf24ca10b144104611c6875be78291ca07b.css integrity="sha256-dW0WudGhmw1ydMqT4EKL8kyhCxRBBGEcaHW+eCkcoHs=" rel="preload stylesheet" as=style><link rel=icon href=https://ramsayleung.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ramsayleung.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ramsayleung.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ramsayleung.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ramsayleung.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MG65HQHEL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MG65HQHEL")}</script><meta property="og:url" content="https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/"><meta property="og:site_name" content="è èæ²¹ä¸å¤©å…‰å¢Ÿ"><meta property="og:title" content="æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing"><meta property="og:description" content="1 å‰è¨€ 1.1 test caseçš„å±€é™ æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚
ç”¨ä¹‹å‰ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-14T09:37:00-07:00"><meta property="article:modified_time" content="2025-01-09T01:14:46-08:00"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Rust"><meta property="og:image" content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing"><meta name=twitter:description content="1 å‰è¨€
1.1 test caseçš„å±€é™
æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚
ç”¨ä¹‹å‰ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ramsayleung.github.io/zh/post/"},{"@type":"ListItem","position":2,"name":"æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing","item":"https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing","name":"æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing","description":"1 å‰è¨€ 1.1 test caseçš„å±€é™ æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚\nç”¨ä¹‹å‰ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š\n","keywords":["testing","rust"],"articleBody":"1 å‰è¨€ 1.1 test caseçš„å±€é™ æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚\nç”¨ä¹‹å‰ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 def calculate_discount(price, discount_percentage): if price \u003c 0: raise ValueError(f\"Price must be greater than zero: {price}\") if discount_percentage \u003c 0: raise ValueError(f\"Discount_percentage must be greater than zero: {discount_percentage}\") if price \u003e 50000: return price - (price * (discount_percentage * 1.15) / 100) elif price \u003e 100000: return price - (price * (discount_percentage * 1.18) / 100) else: return price - (price * discount_percentage / 100) å³ä½¿æˆ‘ä»¬ä½¿ç”¨äº† Parameterized Test, æŠŠæµ‹è¯•é€»è¾‘å’Œæµ‹è¯•æ•°æ®é›†ä½œäº†åˆ†ç¦»ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š\næˆ‘ä»¬çš„æµ‹è¯•æ•°æ®é›†è¿˜æ˜¯è¦æ‰‹å·¥æ„é€ ï¼Œå³ä½¿ç°åœ¨ä¸éœ€è¦å†™æ–°çš„ test case, æ‰‹å·¥æ„é€ æ•°æ®é›†è¿˜æ˜¯å¾ˆéº»çƒ¦ ç¬¬äºŒä¸ªé—®é¢˜æ›´ä¸¥é‡ï¼Œå°±æ˜¯æˆ‘ä»¬çš„æ„å»ºçš„æ•°æ®é›†å¯èƒ½ä¸æ˜¯å®Œå¤‡çš„ï¼Œå¦‚æœæ•°æ®é›†æ²¡æœ‰åŠæ³•è¦†ç›–æ‰€æœ‰çš„æ¡ä»¶åˆ†æ”¯ï¼Œé‚£æˆ‘ä»¬ä»ç„¶å¯èƒ½å‘ç°ä¸äº†ä»£ç ä¸­çš„Bug 2 Property Based Testing è€Œ Property Based Testing å°±æ˜¯æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¸Œæœ›å¯ä»¥ç»“åˆäººè„‘å¯¹ç‰¹å®šé—®é¢˜åŸŸçš„ç†è§£å’Œæœºå™¨çš„è¿ç®—èƒ½åŠ›ï¼Œä½¿ç”¨æ›´å°‘çš„æ—¶é—´æ¥ç”Ÿæˆæ›´ä¼˜çš„æµ‹è¯•case.\nProperty Based Testing è¿™ä¸ªæ¦‚å¿µæ˜¯ç”± Haskell é¡¹ç›® QuickCheckÂ 1åœ¨1999å¹´å¼•å…¥çš„ï¼Œå®ƒçš„ç†å¿µæ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥åªå®šä¹‰æŸä¸ªæµ‹è¯•case, å‚æ•°éœ€è¦æ»¡è¶³çš„æ ‡å‡†(specification), ç„¶åç¨‹åºå°±ä¼šè‡ªåŠ¨ç”Ÿæˆå¤§é‡æ»¡è¶³è¿™ä¸ªæ ‡å‡†çš„éšæœºæ•°ï¼Œç”¨è¿™äº›éšæœºæ•°æ¥æµ‹è¯•è¿™ä¸ª test caseã€‚\nè€Œå› ä¸ºæµ‹è¯•æ•°æ®æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä½ æ„æ–™ä¹‹å†…çš„æ•°æ®ï¼Œæˆ–è€…æ„æ–™ä¹‹å¤–çš„æ•°æ®éƒ½ä¼šè¢«ç”¨æ¥æµ‹è¯•ï¼Œ æ—¢çœå»äº†è´¹æ—¶è´¹åŠ›æ„é€ ä¸åŒæ•°æ®ä½œæ•°æ®é›†æ¥æµ‹è¯•çš„çƒ¦æ¼ï¼Œåˆèƒ½ä¿è¯æ•°æ®é›†çš„å®Œå¤‡æ€§, ç»å¸¸å¯ä»¥å¸®åŠ©ä½ å‘ç°æ„æƒ³ä¸åˆ°çš„bug.\nè¿™å°±æ˜¯å£°æ˜å¼å®šä¹‰çš„ä¸€ç§ï¼Œä½ åªéœ€è¦å£°æ˜ä½ æƒ³å¹²ä»€ä¹ˆ(ç”¨ä»€ä¹ˆæ ·çš„æ•°æ®æµ‹è¯•ä»€ä¹ˆå‡½æ•°)ï¼Œè€Œéå‘½ä»¤å¼å®šä¹‰ï¼ˆä½ éœ€è¦å®šä¹‰ä½ è¦æ€ä¹ˆåšï¼‰.\näººåŠ›åº”è¯¥æ˜¯å¾ˆçè´µï¼Œè€Œæœºå™¨çš„è®¡ç®—èµ„æºå´æ˜¯å¾ˆä¾¿å®œï¼Œåº”è¯¥è®©æœºå™¨ä»£æ›¿äººå»åšç”Ÿæˆæ•°æ®çš„äº‹ã€‚\nä¸¾ä¾‹æ¥è¯´, ä»¥ä¸Šé¢çš„ calculate_discount å‡½æ•°ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬å‘Šè¯‰ç¨‹åº, price å’Œ discount_percentage åº”è¯¥æ˜¯æ•´æ•°ï¼ˆspecificationï¼‰, é‚£ä¹ˆ Quickcheck å°±ä¼šç”Ÿæˆå„ç§æ•´æ•°, ä» Integer.Min åˆ° Integer.Max ä¸ç­‰ï¼Œç”¨æ¥æµ‹è¯•æˆ‘ä»¬çš„ç¨‹åº.\nå¦‚æœè¿˜æ˜¯è§‰å¾—è¿™ä¸ªæ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œå¯ä»¥æ¥çœ‹ä¸‹å…·ä½“çš„ä¾‹å­ï¼š\n3 Hypothesis Python Property Based Testingçš„æµ‹è¯•æ¡†æ¶å« Hypothesis 2(å‡æƒ³)ï¼Œè¿™ä¸ªé¡¹ç›®åå­—ä¹Ÿæ˜¯èµ·å¾—éå¸¸æœ‰æ°´å¹³ï¼Œç»“åˆProperty Based Testingçš„å“²å­¦ï¼Œå¯è°“ä¿¡é›…è¾¾.\nå‡è®¾æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®å‹ç¼©çš„ç®—æ³•ï¼š Run-length EncodingÂ 3(RLE)ï¼Œé€šå¸¸ç”¨äºå‹ç¼©åŒ…å«è¿ç»­é‡å¤æ•°æ®çš„åºåˆ—, è¿™ç§ç¼–ç æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºé‚£äº›æœ‰å¤§é‡é‡å¤å­—ç¬¦æˆ–å€¼çš„æ•°æ®.\nå®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼š\nç»Ÿè®¡è¿ç»­é‡å¤çš„æ•°æ®å…ƒç´ çš„æ•°é‡ã€‚ ç”¨ä¸€ä¸ªè®¡æ•°å€¼å’Œæ•°æ®å€¼çš„ç»„åˆæ¥æ›¿ä»£è¿™äº›é‡å¤çš„æ•°æ®ã€‚ æ¯”å¦‚å­—ç¬¦ä¸²: AABBBCCCC, RLE ç¼–ç å: 2A3B4C. 2A è¡¨ç¤ºä¸¤ä¸ªè¿ç»­çš„ A, 3B è¡¨ç¤ºä¸‰ä¸ªè¿ç»­çš„ B, 4C è¡¨ç¤ºå››ä¸ªè¿ç»­çš„ C ã€‚\nPythonå®ç°å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 def encode(input_string): count = 1 prev = \"\" lst = [] for character in input_string: if character != prev: if prev: entry = (prev, count) lst.append(entry) count = 1 prev = character else: count += 1 entry = (character, count) lst.append(entry) return lst def decode(lst): q = \"\" for character, count in lst: q += character * count return q å¦‚æœæˆ‘ä»¬çš„ä»£ç å®ç°æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå¯¹äºä»»æ„çš„å­—ç¬¦ä¸²ï¼Œç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œè§£ç åçš„ç»“æœåº”è¯¥å’ŒåŸæ¥çš„å­—ç¬¦ä¸²ä¸€è‡´çš„ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„æµ‹è¯•é€»è¾‘:\n1 2 3 4 5 6 7 from hypothesis import given from hypothesis.strategies import text @given(text()) # å…¥å‚çš„æ ‡å‡†æ˜¯ï¼šä»»æ„çš„å­—ç¬¦ä¸²ï¼Œhypothesis æ¡†æ¶å°±ä¼šè‡ªåŠ¨ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶è°ƒç”¨test_decode_inverts_encode def test_decode_inverts_encode(s): assert decode(encode(s)) == s ä½¿ç”¨ pytest è¿è¡Œä¸Šé¢çš„ç”¨ä¾‹ï¼Œç»“æœå¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 \u003e pytest property_based_testing.py =================================== test session starts ==================================== platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0 rootdir: /Users/ramsayleung/code/python/test_technique plugins: hypothesis-6.115.0 collected 1 item property_based_testing.py F [100%] ========================================= FAILURES ========================================= ________________________________ test_decode_inverts_encode ________________________________ @given(text()) \u003e def test_decode_inverts_encode(s): property_based_testing.py:29: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ property_based_testing.py:30: in test_decode_inverts_encode assert decode(encode(s)) == s _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ input_string = '' def encode(input_string): count = 1 prev = \"\" lst = [] for character in input_string: if character != prev: if prev: entry = (prev, count) lst.append(entry) count = 1 prev = character else: count += 1 \u003e entry = (character, count) E UnboundLocalError: cannot access local variable 'character' where it is not associated with a value E Falsifying example: test_decode_inverts_encode( E s='', E ) property_based_testing.py:17: UnboundLocalError ================================= short test summary info ================================== FAILED property_based_testing.py::test_decode_inverts_encode - UnboundLocalError: cannot access local variable 'character' where it is not associated ... ==================================== 1 failed in 0.14s ===================================== å¯ä»¥çœ‹åˆ°ï¼Œå½“ input_string ='' æ˜¯ç©ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ encode å‡½æ•°æŠ›å‡ºå¼‚å¸¸äº†ï¼Œè¯´ character å˜é‡æœªå®šä¹‰ã€‚åŸæ¥æ˜¯ encode å‡½æ•°æ²¡æœ‰å¯¹ç©ºå­—ç¬¦ä¸²è¿™ä¸ª corner case ä½œå¤„ç†ï¼Œé‚£ä¹ˆå°±åŠ ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œä¿®å¤ä¸€ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 def encode(input_string): if not input_string: return [] count = 1 prev = \"\" lst = [] for character in input_string: if character != prev: if prev: entry = (prev, count) lst.append(entry) count = 1 prev = character else: count += 1 entry = (character, count) lst.append(entry) return lst æ—¢ç„¶æˆ‘ä»¬çŸ¥é“ç©ºå­—ç¬¦ä¸²æ˜¯ä¸ªç‰¹æ®Šçš„ case, å› ä¸º hypothesis ç”Ÿæˆçš„éƒ½æ˜¯ä»»æ„çš„éšæœºæ•°ï¼Œä¸ä¸€å®šæ¯æ¬¡éƒ½ä¼šæµ‹åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œé‚£æˆ‘ä»¬å°±è‡ªå·±æŒ‡å®šä¸€ä¸ª case:\n1 2 3 4 5 6 7 from hypothesis import example, given, strategies as st @given(st.text()) @example(\"\") # æ‰‹å·¥æŒ‡å®šç©ºå­—ç¬¦ä¸²è¿™ä¸ª corner case def test_decode_inverts_encode(s): assert decode(encode(s)) == s pytest é‡æ–°è¿è¡Œï¼Œæµ‹è¯•å°±é€šè¿‡äº†ã€‚ä½†æ˜¯ï¼Œå¯¹ hypothesis æ¡†æ¶è¿˜æ²¡æœ‰å»ºç«‹ä¿¡å¿ƒçš„ä½ æˆ‘å°±ä¸ç¡®å®šï¼Œå®ƒæ˜¯å¦çœŸçš„ç”Ÿæˆå¾ˆå¤šéšæœºæ¥è¿è¡Œè¿™ä¸ª test case å‘¢ï¼Ÿ\næœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥éªŒè¯ï¼š\næ–¹æ³•ä¸€ï¼šæœ€ç®€å•ç²—æš´çš„æ–¹å¼ï¼ŒæŠŠ s å˜é‡ç»™æ‰“å°å‡ºæ¥ï¼Œæ¯•ç«Ÿçœ¼è§ä¸ºå®:\n1 2 3 4 5 @given(st.text()) @example(\"\") def test_decode_inverts_encode(s): print(s) assert decode(encode(s)) == s ç„¶åé€šè¿‡ pytest -s å‚æ•°è¦æ±‚ pytest å°†å†™å…¥åˆ° stdout çš„å†…å®¹ç»™æ‰“å°å‡ºæ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 \u003e pytest property_based_testing.py -s ======================================= test session starts ======================================= platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0 rootdir: /Users/ramsayleung/code/python/test_technique plugins: hypothesis-6.115.0 collected 1 item property_based_testing.py O Â¶ \\Ã¥ñ¢„Â« ğ¥›—ÃbÃ³ ğœ†®Ã¥ ñ°˜°9 gahó­¾”ğ›§ iò¼¯œ+Ã³Â»ò®©¸bñ•¨ S!Ã•TÃ¥\u0026ğ°µ©Ã­Â¤Ã½Ã¤Ã³Ã·F Ã¸Ã´yÂµ Ã„Âª sLz$Ã¯ _ğ µˆ Ãœ A Róƒ·{Â©Â¾ Ã¬Ãµ Ã¦ô‚›BÃ1*ô…„¢Ã«Ã³gğ®ˆÂ¼ ?ğ©“ Ã’Ã¶r @PPô¾‚Ã¶ñ³±ŠÃ»ÃÂ½Â¬HÃˆ6# ağ£½—Â¶ó¿…Œğ§‘x~ó—œ¬éŸ¹Ã»Ã°ó´¯®#Zó…–«\\Â©ğ³–…Ã»f\u003e i .... ======================================== 1 passed in 0.15s ======================================== è¿™ä¸€å †éƒ½æ˜¯ä»€ä¹ˆå­—ç¬¦å‘¢, éƒ½ä¹±ç äº†ã€‚\næ¯•ç«Ÿæˆ‘ä»¬å‘Šè¯‰ hypothesis æ¡†æ¶çš„æ˜¯ï¼Œæˆ‘ä»¬å‚æ•°æ¥å—çš„æ ‡å‡†æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œ hypothesis å°±éå¸¸å°½èŒåœ°å¸®æˆ‘ä»¬ç”Ÿæˆäº†å„ç§å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæµ‹è¯•æ•°æ®é›†å¯æ¯”æˆ‘ä»¬è‡ªå·±æ‰‹å·¥æ„å»ºçš„èŒƒå›´å¤§å¾—å¤šï¼Œè¿™å°±æ˜¯ property based testing çš„ä¼˜åŠ¿æ‰€åœ¨.\nç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ hypothesis æ¡†æ¶æä¾›çš„å‘½ä»¤è¡Œå‚æ•° =â€“hypothesis-show-statistics=ï¼Œç”¨äºæ‰“å°ç»Ÿè®¡ä¿¡æ¯:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u003e pytest property_based_testing.py --hypothesis-show-statistics ======================================= test session starts ======================================= platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0 rootdir: /Users/ramsayleung/code/python/test_technique plugins: hypothesis-6.115.0 collected 1 item property_based_testing.py . [100%] ====================================== Hypothesis Statistics ====================================== property_based_testing.py::test_decode_inverts_encode: - during generate phase (0.03 seconds): - Typical runtimes: \u003c 1ms, of which \u003c 1ms in data generation - 100 passing examples, 0 failing examples, 0 invalid examples - Stopped because settings.max_examples=100 ======================================== 1 passed in 0.05s ======================================== ä¸Šé¢è¿è¡Œäº† 100 æ¡æ•°æ®ï¼Œå¦‚æœä½ è§‰å¾—è¿˜æƒ³è·‘æ›´å¤šï¼Œå¯ä»¥é€šè¿‡ settings è£…é¥°å™¨æŒ‡å®šæ›´å¤š:\n1 @settings(max_examples=500) 4 Quickcheck \u0026 Proptest è€Œåœ¨Rustç”Ÿæ€ï¼Œå°±æœ‰ä¸¤ä¸ª Property Based Testing çš„åº“ï¼Œä¸€ä¸ªæ˜¯ç”±Rustç¤¾åŒºçŸ¥åå¼€å‘è€…ï¼ŒripgrepÂ 4å’Œ regex åº“ä½œè€…ç§»æ¤è‡ª Haskell Quickcheck åº“çš„ quickcheckÂ 5(åå­—ä¹Ÿä¸€å¹¶ç§»æ¤äº†), å¦å¤–ä¸€ä¸ªæ˜¯æ€è·¯ç»§æ‰¿è‡ª Python Hypothesis çš„ ProptestÂ 6(è¿™ä½ç›´æ¥ç”¨property based testingæŠ€æœ¯æ¥å‘½åäº†ï¼Œä¸å¾—ä¸è¯´ï¼Œå‘½åçœŸçš„æ˜¯é—¨è‰ºæœ¯)\nä¸¤è€…çš„ç¤¾åŒºæ¥å—åº¦éƒ½ç›¸å·®æ— å‡ (star, ä½¿ç”¨è€…æ•°é‡), è€Œåœ¨å…¬å¸å†…éƒ¨ï¼Œæˆ‘ä¹Ÿå‘ç° quickcheck å’Œ proptest éƒ½æœ‰äººç”¨ï¼Œåæˆ‘æ—è¾¹çš„Principle Engineer ç”¨çš„æ˜¯ proptest, è€Œå¦å¤–ä¸€ä¸ªç°åœ¨å’Œæˆ‘å…±äº‹çš„åŒäº‹ï¼Œå¥¹çš„ä¹‹å‰å›¢é˜Ÿç”¨çš„å°±æ˜¯ quickcheckï¼Œçœ‹åˆ°éƒ½åŠ¿å‡åŠ›æ•Œå˜›ã€‚\nç¿»å¼€ quickcheck å’Œ proptest çš„API æ–‡æ¡£ä¹‹åï¼Œæˆ‘å‘ç°æˆ‘æ›´å–œæ¬¢ quickcheck çš„æ¥å£é£æ ¼ï¼Œè™½è¯´å®ƒçš„æ´»è·ƒåº¦æ›´ä½ä¸€äº›ï¼Œæˆ‘æœ€åè¿˜æ˜¯é€‰æ‹©äº†ä½¿ç”¨ quickcheck.\nä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹æˆ‘åœ¨Rustä¸Šä½¿ç”¨ quickcheck çš„å¿ƒå¾—:\nå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¯ä»¥åè½¬åˆ—è¡¨çš„å‡½æ•° reverse:\n1 2 3 4 5 6 7 fn reverse\u003cT: Clone\u003e(xs: \u0026[T]) -\u003e Vec\u003cT\u003e { let mut rev = vec!(); for x in xs { rev.insert(0, x.clone()) } rev } å¯¹äºä»»æ„ç±»å‹çš„åˆ—è¡¨ï¼Œåè½¬ä¹‹åå†åè½¬çš„ç»“æœï¼Œè‚¯å®šæ˜¯å’ŒåŸç»“æœä¸€æ ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å£°æ˜æˆ‘ä»¬çš„æ ‡å‡†(specification), é‚£å°±æ˜¯ä»»æ„çš„åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ•´å‹åˆ—è¡¨æˆ–è€…æ˜¯å…¶ä»–çš„ç»“æ„ä½“åˆ—è¡¨:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #[cfg(test)] mod tests{ use quickcheck_macros::quickcheck; use crate::reverse; #[quickcheck] fn double_reversal_is_identity_isize(xs: Vec\u003cisize\u003e) -\u003e bool { xs == reverse(\u0026reverse(\u0026xs)) } #[quickcheck] fn double_reversal_is_identity_string(xs: Vec\u003cString\u003e) -\u003e bool { xs == reverse(\u0026reverse(\u0026xs)) } } Rust çš„unit test æ˜¯ä¸æ”¯æŒå¸¦å‚æ•°çš„ï¼Œ=#[quickcheck]= è¿™ä¸ªå®å°±ä¼šè‡ªåŠ¨å°† double_reversal_is_identity_isize è½¬æ¢æˆ property based test case, è€Œå¾—ç›ŠäºRustçš„ç±»å‹ç³»ç»Ÿ, quickcheck å°±èƒ½æ¨æ–­å‡ºå…¥å‚å°±æ˜¯æˆ‘ä»¬å£°æ˜çš„æ ‡å‡† Vec, ä»»æ„ isize ç±»å‹çš„æ•°ç»„.\n4.1 Struct with quickcheck å¦‚æœä¸Šé¢çš„ä¾‹å­è§‰å¾—è¿‡äºç®€å•çš„è¯ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬çœ‹ä¸ªå¤æ‚ä¸€ç‚¹çš„ä¾‹å­, ä¸€ä¸ªç®€å•çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒä¼šå‘˜ï¼Œå€Ÿä¹¦ï¼Œè¿˜ä¹¦åŠŸèƒ½ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 use chrono::{Duration, NaiveDate}; use std::collections::HashMap; #[derive(Debug, Clone, PartialEq)] struct Book { isbn: String, title: String, author: String, publication_year: u16, } #[derive(Debug, Clone, PartialEq)] struct Member { id: u32, name: String, email: String, } #[derive(Debug, Clone)] struct Loan { book_isbn: String, member_id: u32, due_date: NaiveDate, } #[derive(Debug, Clone)] struct Library { books: HashMap\u003cString, Book\u003e, members: HashMap\u003cu32, Member\u003e, loans: Vec\u003cLoan\u003e, current_date: NaiveDate, } impl Library { fn new(current_date: NaiveDate) -\u003e Self { Library { books: HashMap::new(), members: HashMap::new(), loans: Vec::new(), current_date, } } fn add_book(\u0026mut self, book: Book) -\u003e Result\u003c(), String\u003e { if self.books.contains_key(\u0026book.isbn) { Err(\"Book with this ISBN already exists\".to_string()) } else { self.books.insert(book.isbn.clone(), book); Ok(()) } } fn add_member(\u0026mut self, member: Member) -\u003e Result\u003c(), String\u003e { if self.members.contains_key(\u0026member.id) { Err(\"Member with this ID already exists\".to_string()) } else { self.members.insert(member.id, member); Ok(()) } } fn loan_book(\u0026mut self, book_isbn: \u0026str, member_id: u32) -\u003e Result\u003c(), String\u003e { if !self.books.contains_key(book_isbn) { return Err(\"Book not found\".to_string()); } if !self.members.contains_key(\u0026member_id) { return Err(\"Member not found\".to_string()); } if self.loans.iter().any(|loan| loan.book_isbn == book_isbn) { return Err(\"Book is already on loan\".to_string()); } let due_date = self.current_date + Duration::days(14); self.loans.push(Loan { book_isbn: book_isbn.to_string(), member_id, due_date, }); Ok(()) } fn return_book(\u0026mut self, book_isbn: \u0026str) -\u003e Result\u003c(), String\u003e { if let Some(index) = self .loans .iter() .position(|loan| loan.book_isbn == book_isbn) { self.loans.remove(index); Ok(()) } else { Err(\"Book is not currently on loan\".to_string()) } } } é€šè¿‡ä¸Šé¢çš„ç®€å•ä»£ç ï¼Œå°±å®ç°äº†æ–°å¢å›¾ä¹¦ï¼Œæ–°å¢ä¼šå‘˜ï¼Œå€Ÿä¹¦ï¼Œå’Œè¿˜ä¹¦åŠŸèƒ½ã€‚ç°åœ¨å°±è®©æˆ‘ä»¬æ¥ç»“åˆ quickcheck çš„ Arbitrary æ¥å£ï¼Œå®ç°ç”Ÿæˆä»»æ„çš„å›¾ä¹¦å’Œä¼šå‘˜ï¼Œä»¥ä¾¿ç”¨äºæµ‹è¯•:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use quickcheck::{Arbitrary, Gen}; impl Arbitrary for Book { fn arbitrary(g: \u0026mut Gen) -\u003e Self { Book { // isbnå¿…é¡»ä»¥`ISBN` å¼€å¤´ï¼Œåæ¥ä»»æ„çš„å¤§äºç­‰äº0ï¼Œå°äºuint32.max_value // çš„æ•´å‹ isbn: format!(\"ISBN-{}\", u32::arbitrary(g)), title: String::arbitrary(g), // ä»»æ„çš„å­—ç¬¦ä¸² author: String::arbitrary(g), // ä»»æ„çš„å­—ç¬¦ä¸² publication_year: *g.choose(\u0026[2014_u16, 2022_u16, 2025_u16]).unwrap(), // 2014,2022æˆ–2025å¹´å‡ºç‰ˆçš„ä¹¦ } } } impl Arbitrary for Member { fn arbitrary(g: \u0026mut Gen) -\u003e Self { Member { id: u32::arbitrary(g), // ä»»æ„å¤§äº0ï¼Œå°äºuint32.max_valueçš„æ•´å‹ name: String::arbitrary(g), // ä»»æ„å­—ç¬¦ä¸² // ä»»æ„å­—ç¬¦å¼€å¤´, ä»¥@example.com ç»“å°¾çš„å­—ç¬¦ email: format!(\"{}@example.com\", String::arbitrary(g)), } } } ç°åœ¨å°±è®©æˆ‘ä»¬æ¥çœ‹ä¸‹å€ŸåŠ© quickcheck ç¼–å†™çš„ test case, æ³¨æ„å‚æ•°ä¸º Book å’Œ Member ç±»å‹çš„ case, quickcheck å°±ä¼šä»¥æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„æ ‡å‡†ï¼Œè‡ªåŠ¨ç»™æˆ‘ä»¬ç”Ÿæˆç¬¦åˆè§„å®šçš„ Book å’Œ Member å‚æ•°.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #[cfg(test)] mod tests { use chrono::NaiveDate; use quickcheck_macros::quickcheck; use crate::book::Member; use super::{Book, Library}; #[quickcheck] fn adding_book_increases_book_count(book: Book) -\u003e bool { let mut library = Library::new(NaiveDate::from_ymd_opt(2024, 10, 14).unwrap()); let initial_count = library.books.len(); library.add_book(book.clone()).unwrap(); library.books.len() == initial_count + 1 \u0026\u0026 library.books.contains_key(\u0026book.isbn) } #[quickcheck] fn cannot_loan_nonexistent_book(book_isbn: String, member_id: u32) -\u003e bool { let mut library = Library::new(NaiveDate::from_ymd_opt(2024, 10, 14).unwrap()); library.loan_book(\u0026book_isbn, member_id).is_err() } #[quickcheck] fn can_return_loaned_book(book: Book, member: Member) -\u003e bool { let mut library = Library::new(NaiveDate::from_ymd_opt(2024, 10, 14).unwrap()); library.add_book(book.clone()).unwrap(); library.add_member(member.clone()).unwrap(); library.loan_book(\u0026book.isbn, member.id).unwrap(); library.return_book(\u0026book.isbn).is_ok() } } é€šè¿‡ quickcheck æˆ‘ä»¬å°±å¯ä»¥åªä¸“æ³¨æµ‹è¯•é€»è¾‘ï¼Œå¯ä»¥å‡å®šæµ‹è¯•æ•°æ®é›†æ˜¯å®Œå¤‡çš„äº†ã€‚å¯èƒ½çœ‹åˆ° Book å’Œ Member, ä½ ä¼šè§‰å¾— quickcheck å¹¶æ²¡æœ‰åšå¤ªå¤šäº‹æƒ…ï¼Œä½ æ‰‹å·¥ä¹Ÿå¯ä»¥æ„é€ ã€‚\nä½†æ˜¯æˆ‘åœ¨çš„å®é™…å·¥ä½œä¸­ï¼Œæˆ‘å°±éœ€è¦æ„é€ ä¸€ä¸ªè¶…è¿‡23ä¸ªæˆå‘˜å˜é‡çš„ struct, å¤§éƒ¨åˆ†è¿˜æ˜¯ optional, ç„¶åéœ€è¦å°†è¿™ä¸ª struct å†™å…¥åˆ° parquet æ–‡ä»¶ï¼Œç„¶åå†æµ‹è¯•è¯»å–é€»è¾‘ã€‚ ä¸åŒæˆå‘˜å˜é‡çš„å€¼å¯å–çš„èŒƒå›´å®åœ¨å¤ªå¤šäº†ï¼Œå†å åŠ ä¸Š optional çš„å¯èƒ½æ€§ï¼Œæ„é€ æ•°æ®çš„ä»£ç å†™å¾—ç›¸å½“æ¶å¿ƒ.\næ‰€ä»¥æœ‰äº† quickcheck ä¹‹åï¼Œæˆ‘åªéœ€è¦ä¸ºè¿™ä¸ª struct å®ç° Arbitrary æ¥å£ï¼Œå‰©ä¸‹çš„å°±ç”± quickcheck æ›¿æˆ‘ç”Ÿæˆï¼Œæ‰€ä»¥æˆ‘ç›´æ¥å’ŒPEå¤§ä½¬è¯´:\nproperty test saves me life, now I couldnâ€™t live without it.\n5 æ€»ç»“ æœ¬æ¥æƒ³æŠ’å‘æ„Ÿæƒ³å†™ç‚¹ç»“è¯­ï¼Œä½†æ˜¯çœ‹åˆ° Hypothesis ä½œè€…å†™çš„ The purpose of Hypothesis7 æ¥è¯´æ˜ä»–å¼€å‘çš„ Hypothesis çš„åŠ¨æœºï¼Œä»–çš„æ–‡ç« ç”šè‡³ç”¨æ¥ç»™è¿™ä¸ªã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶ã€‹ç³»åˆ—æ€»ç»“éƒ½ç›¸å½“å¦¥å½“ã€‚\næˆ‘å°±è¯•ç¿»è¯‘ä¸‹ä»–æ–‡ç« çš„éƒ¨åˆ†æ®µè½, æ›´æ¨èé˜…è¯»åŸæ–‡ï¼Œå¯è°“æ˜¯ç”¨å¿ƒè‰¯è‹¦ï¼Œå­—å­—ç ç‘:\nè¯·å®¹æˆ‘ç‹‚å¦„ä¸€ä¸‹ï¼ŒHypothesis çš„ç›®æ ‡æ˜¯å¸Œæœ›å¯ä»¥è®©è¿™ä¸ªä¸–ç•Œè¿ˆè¿›åˆ°ä¸€ä¸ªå…¨æ–°ï¼Œç”±é«˜è´¨é‡è½¯ä»¶æ‰“é€ çš„æ–°ä¸–ä»£ã€‚\næ­£å¦‚äººä»¬æ‰€è¯´ï¼Œè½¯ä»¶æ­£åœ¨åå™¬æ•´ä¸ªä¸–ç•Œã€‚ä½†è½¯ä»¶æœ¬èº«å´å¾ˆçƒ‚ï¼Œå®ƒå……æ»¡bugï¼Œåˆä¸å®‰å…¨ï¼Œè¿˜ç»å¸¸è¢«è®¾è®¡å¾—å¾ˆçƒ‚ï¼Œè¿™æ ·çš„è½¯ä»¶å¯è°“æ˜¯ä¸‡æ¶ä¹‹æº.\nè€Œè½¯ä»¶æµ‹è¯•çš„çŠ¶å†µç”šè‡³æ›´ç³Ÿç³•ï¼Œè™½ç„¶å¤§å®¶éƒ½è®¤åŒåº”è¯¥å¯¹ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯ä½ èƒ½é—®å¿ƒæ— æ„§åœ°è¯´ï¼Œä½ ç»æ‰‹è¿‡çš„ä»£ç éƒ½æœ‰è¢«å……åˆ†æµ‹è¯•ä¹ˆï¼Ÿ\né—®é¢˜åœ¨äºï¼Œå®åœ¨æ˜¯å¤ªéš¾å†™å‡ºå¥½çš„æµ‹è¯•äº†ï¼Œ ä½ å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œé€šå¸¸æŒæœ‰å’Œä½ å†™ä»£ç æ—¶ä¸€æ ·çš„å‡è®¾ä¸è¯¯åŒºï¼Œä½ å†™çš„æµ‹è¯•ç”¨ä¾‹è‡ªç„¶æ— æ³•å‘ç°ä½ å½“åˆåŸ‹ä¸‹çš„bug (ç²¾è¾Ÿ)\nä¸æ­¤åŒæ—¶ï¼Œæœ‰å„ç§å„æ ·è®©æµ‹è¯•å˜æˆæ›´å¥½çš„å·¥å…·å´åŸºæœ¬æ— äººä½¿ç”¨ï¼Œæœ€åˆçš„ Quickcheck æ˜¯1999å¹´æ¨å‡ºçš„ï¼Œä½†æ˜¯å¤§å¤šæ•°å¼€å‘è€…ç”šè‡³ä»æœªå¬è¯´è¿‡å®ƒï¼Œæ›´åˆ«æä½¿ç”¨äº†ï¼ˆå¼€å±±å§‹ç¥–çš„Quickcheckåœ¨GitHubåªæœ‰700å¤šä¸ªStarï¼Œå°±çŸ¥é“ä½œè€…æ‰€è¨€ä¸è™šï¼‰ã€‚ è™½ç„¶å…¶ä»–è¯­è¨€æœ‰äº›åŠæˆå“çš„å®ç°ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†éƒ½ä¸å€¼å¾—ä¸€è¯•ã€‚\nè€Œ Hypothesis çš„ç›®æ ‡æ­£æ˜¯æ­£æœ¬æ¸…æºï¼ŒæŠŠå…ˆè¿›çš„æµ‹è¯•æŠ€æœ¯ä¼ é€’ç»™å¤§ä¼—ï¼Œå¹¶æä¾›ä¸€ä¸ªé«˜è´¨é‡çš„å®ç°ï¼Œè®©äººä»¬å¯ä»¥æ¥çº³å®ƒã€‚\nå¸Œæœ›å¯ä»¥é›†ç™¾å®¶ä¹‹æ‰€é•¿ï¼Œé™„ä»¥ä¸ªäººå¾®è–„ä¹‹åŠ›ï¼Œè®©è½¯ä»¶æµ‹è¯•å˜å¾—æ›´å¥½ã€‚\nç³»åˆ—æ–‡ç« :\næµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸€): è½¯ä»¶è´¨é‡è®¤çŸ¥ æµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Tests æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘» https://en.wikipedia.org/wiki/QuickCheckÂ â†©ï¸\nhttps://hypothesis.works/Â â†©ï¸\nhttps://en.wikipedia.org/wiki/Run-length_encodingÂ â†©ï¸\nhttps://github.com/BurntSushi/ripgrepÂ â†©ï¸\nhttps://github.com/BurntSushi/quickcheckÂ â†©ï¸\nhttps://github.com/proptest-rs/proptestÂ â†©ï¸\nhttps://hypothesis.readthedocs.io/en/latest/manifesto.htmlÂ â†©ï¸\n","wordCount":"4671","inLanguage":"zh","image":"https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-14T09:37:00-07:00","dateModified":"2025-01-09T01:14:46-08:00","author":{"@type":"Person","name":"Ramsay Leung"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/"},"publisher":{"@type":"Organization","name":"è èæ²¹ä¸å¤©å…‰å¢Ÿ","logo":{"@type":"ImageObject","url":"https://ramsayleung.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ramsayleung.github.io/zh/ accesskey=h title="Home (Alt + H)"><img src=https://ramsayleung.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ramsayleung.github.io/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li class=dropdown><a href=https://ramsayleung.github.io/zh/categories/ title="ç³»åˆ— "><span>ç³»åˆ— â–¾</span></a><div class="menu-more-content dropdown-content"><a href=https://ramsayleung.github.io/zh/categories/%E5%BE%97%E5%A4%B1%E6%84%9F%E6%82%9F/ title=å¾—å¤±æ„Ÿæ‚Ÿ><span>å¾—å¤±æ„Ÿæ‚Ÿ
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%97%85%E5%8A%A0%E7%BB%8F%E5%8E%86 title=æ—…åŠ ç»å†><span>æ—…åŠ ç»å†
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/ title=æˆ‘çš„å·¥ä½œæµ><span>æˆ‘çš„å·¥ä½œæµ
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6/ title=æµ‹è¯•æŠ€èƒ½è¿›é˜¶><span>æµ‹è¯•æŠ€èƒ½è¿›é˜¶
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E8%BD%AF%E6%8A%80%E8%83%BD%E6%8C%87%E5%8C%97/ title=è½¯ä»¶å·¥ç¨‹å¸ˆçš„è½¯æŠ€èƒ½æŒ‡åŒ—><span>è½¯ä»¶å·¥ç¨‹å¸ˆçš„è½¯æŠ€èƒ½æŒ‡åŒ—
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%AE%97%E6%B3%95%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/ title=åŸºäºè´å¶æ–¯ç®—æ³•çš„Telegramå¹¿å‘Šæ‹¦æˆªæœºå™¨äºº><span>åŸºäºè´å¶æ–¯ç®—æ³•çš„Telegramå¹¿å‘Šæ‹¦æˆªæœºå™¨äºº</span></a></div></li><li><a href=https://ramsayleung.github.io/zh/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://ramsayleung.github.io/zh/search/ title=æœç´¢><span>æœç´¢</span></a></li><li><a href=https://ramsayleung.github.io/zh/tags/ title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://ramsayleung.github.io/zh/about_me_zh/ title=å…³äº><span>å…³äº</span></a></li><li><a href=https://ramsayleung.github.io/zh/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ramsayleung.github.io/zh/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://ramsayleung.github.io/zh/post/>Posts</a></div><h1 class="post-title entry-hint-parent">æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing</h1><div class=post-quote><blockquote><p>å¯¹çŸ¥è¯†åˆ†å­è€Œè¨€, æˆä¸ºæ€ç»´çš„ç²¾è‹±æ¯”æˆä¸ºé“å¾·çš„ç²¾è‹±æ›´é‡è¦ã€‚</p><cite>â€” ç‹å°æ³¢ (ä½œå®¶)</cite></blockquote></div><hr class=post-separator><div class=post-meta><span title='2024-10-14 09:37:00 -0700 -0700'>åæœˆ 14, 2024</span>&nbsp;Â·&nbsp;10 åˆ†é’Ÿ&nbsp;Â·&nbsp;4671 å­—&nbsp;|&nbsp;<a href=https://github.com/ramsayleung/ramsayleung.github.io/blob/master/content/post/2024/%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%e4%b8%89_property_based_testing.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#å‰è¨€><span class=section-num>1</span> å‰è¨€</a><ul><li><a href=#test-caseçš„å±€é™><span class=section-num>1.1</span> test caseçš„å±€é™</a></li></ul></li><li><a href=#property-based-testing><span class=section-num>2</span> Property Based Testing</a></li><li><a href=#hypothesis><span class=section-num>3</span> Hypothesis</a></li><li><a href=#quickcheck-and-proptest><span class=section-num>4</span> Quickcheck & Proptest</a><ul><li><a href=#struct-with-quickcheck><span class=section-num>4.1</span> Struct with quickcheck</a></li></ul></li><li><a href=#æ€»ç»“><span class=section-num>5</span> æ€»ç»“</a></li></ul></nav></div></details></div><div class=post-content><h2 id=å‰è¨€><span class=section-num>1</span> å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><h3 id=test-caseçš„å±€é™><span class=section-num>1.1</span> test caseçš„å±€é™<a hidden class=anchor aria-hidden=true href=#test-caseçš„å±€é™>#</a></h3><p>æƒ³è¦æ›´å¥½åœ°ç†è§£ä»€ä¹ˆæ˜¯ Property based testing, å°±æ¥å…ˆçœ‹ä¸‹å·²æœ‰ test case çš„å±€é™ï¼Œå†æ¥è§‚å¯Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p><p>ç”¨ä¹‹å‰<a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/>ã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Testsã€‹</a>ä¸­è®¡ç®—æŠ˜æ‰£çš„å‡½æ•°ä¸ºä¾‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount_percentage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>price</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Price must be greater than zero: </span><span class=si>{</span><span class=n>price</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>discount_percentage</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Discount_percentage must be greater than zero: </span><span class=si>{</span><span class=n>discount_percentage</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>price</span> <span class=o>&gt;</span> <span class=mi>50000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=p>(</span><span class=n>discount_percentage</span> <span class=o>*</span> <span class=mf>1.15</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>price</span> <span class=o>&gt;</span> <span class=mi>100000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=p>(</span><span class=n>discount_percentage</span> <span class=o>*</span> <span class=mf>1.18</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=n>discount_percentage</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>å³ä½¿æˆ‘ä»¬ä½¿ç”¨äº† Parameterized Test, æŠŠæµ‹è¯•é€»è¾‘å’Œæµ‹è¯•æ•°æ®é›†ä½œäº†åˆ†ç¦»ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š</p><ol><li>æˆ‘ä»¬çš„æµ‹è¯•æ•°æ®é›†è¿˜æ˜¯è¦æ‰‹å·¥æ„é€ ï¼Œå³ä½¿ç°åœ¨ä¸éœ€è¦å†™æ–°çš„ test case, æ‰‹å·¥æ„é€ æ•°æ®é›†è¿˜æ˜¯å¾ˆéº»çƒ¦</li><li>ç¬¬äºŒä¸ªé—®é¢˜æ›´ä¸¥é‡ï¼Œå°±æ˜¯æˆ‘ä»¬çš„æ„å»ºçš„æ•°æ®é›†å¯èƒ½ä¸æ˜¯å®Œå¤‡çš„ï¼Œå¦‚æœæ•°æ®é›†æ²¡æœ‰åŠæ³•è¦†ç›–æ‰€æœ‰çš„æ¡ä»¶åˆ†æ”¯ï¼Œé‚£æˆ‘ä»¬ä»ç„¶å¯èƒ½å‘ç°ä¸äº†ä»£ç ä¸­çš„Bug</li></ol><h2 id=property-based-testing><span class=section-num>2</span> Property Based Testing<a hidden class=anchor aria-hidden=true href=#property-based-testing>#</a></h2><p>è€Œ Property Based Testing å°±æ˜¯æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¸Œæœ›å¯ä»¥ç»“åˆäººè„‘å¯¹ç‰¹å®šé—®é¢˜åŸŸçš„ç†è§£å’Œæœºå™¨çš„è¿ç®—èƒ½åŠ›ï¼Œä½¿ç”¨æ›´å°‘çš„æ—¶é—´æ¥ç”Ÿæˆæ›´ä¼˜çš„æµ‹è¯•case.</p><p>Property Based Testing è¿™ä¸ªæ¦‚å¿µæ˜¯ç”± Haskell é¡¹ç›® <a href=https://en.wikipedia.org/wiki/QuickCheck>QuickCheck</a>Â <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>åœ¨1999å¹´å¼•å…¥çš„ï¼Œå®ƒçš„ç†å¿µæ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥åªå®šä¹‰æŸä¸ªæµ‹è¯•case, å‚æ•°éœ€è¦æ»¡è¶³çš„æ ‡å‡†(specification), ç„¶åç¨‹åºå°±ä¼šè‡ªåŠ¨ç”Ÿæˆå¤§é‡æ»¡è¶³è¿™ä¸ªæ ‡å‡†çš„éšæœºæ•°ï¼Œç”¨è¿™äº›éšæœºæ•°æ¥æµ‹è¯•è¿™ä¸ª test caseã€‚</p><p>è€Œå› ä¸ºæµ‹è¯•æ•°æ®æ˜¯éšæœºç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä½ æ„æ–™ä¹‹å†…çš„æ•°æ®ï¼Œæˆ–è€…æ„æ–™ä¹‹å¤–çš„æ•°æ®éƒ½ä¼šè¢«ç”¨æ¥æµ‹è¯•ï¼Œ
æ—¢çœå»äº†è´¹æ—¶è´¹åŠ›æ„é€ ä¸åŒæ•°æ®ä½œæ•°æ®é›†æ¥æµ‹è¯•çš„çƒ¦æ¼ï¼Œåˆèƒ½ä¿è¯æ•°æ®é›†çš„å®Œå¤‡æ€§, ç»å¸¸å¯ä»¥å¸®åŠ©ä½ å‘ç°æ„æƒ³ä¸åˆ°çš„bug.</p><p>è¿™å°±æ˜¯å£°æ˜å¼å®šä¹‰çš„ä¸€ç§ï¼Œä½ åªéœ€è¦å£°æ˜ä½ æƒ³å¹²ä»€ä¹ˆ(ç”¨ä»€ä¹ˆæ ·çš„æ•°æ®æµ‹è¯•ä»€ä¹ˆå‡½æ•°)ï¼Œè€Œéå‘½ä»¤å¼å®šä¹‰ï¼ˆä½ éœ€è¦å®šä¹‰ä½ è¦æ€ä¹ˆåšï¼‰.</p><p>äººåŠ›åº”è¯¥æ˜¯å¾ˆçè´µï¼Œè€Œæœºå™¨çš„è®¡ç®—èµ„æºå´æ˜¯å¾ˆä¾¿å®œï¼Œåº”è¯¥è®©æœºå™¨ä»£æ›¿äººå»åšç”Ÿæˆæ•°æ®çš„äº‹ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´, ä»¥ä¸Šé¢çš„ <code>calculate_discount</code> å‡½æ•°ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬å‘Šè¯‰ç¨‹åº, <code>price</code> å’Œ <code>discount_percentage</code> åº”è¯¥æ˜¯æ•´æ•°ï¼ˆspecificationï¼‰, é‚£ä¹ˆ Quickcheck å°±ä¼šç”Ÿæˆå„ç§æ•´æ•°, ä» Integer.Min åˆ° Integer.Max ä¸ç­‰ï¼Œç”¨æ¥æµ‹è¯•æˆ‘ä»¬çš„ç¨‹åº.</p><p>å¦‚æœè¿˜æ˜¯è§‰å¾—è¿™ä¸ªæ¦‚å¿µæ¯”è¾ƒæŠ½è±¡ï¼Œå¯ä»¥æ¥çœ‹ä¸‹å…·ä½“çš„ä¾‹å­ï¼š</p><h2 id=hypothesis><span class=section-num>3</span> Hypothesis<a hidden class=anchor aria-hidden=true href=#hypothesis>#</a></h2><p>Python Property Based Testingçš„æµ‹è¯•æ¡†æ¶å« <a href=https://hypothesis.works/>Hypothesis </a><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>(å‡æƒ³)ï¼Œè¿™ä¸ªé¡¹ç›®åå­—ä¹Ÿæ˜¯èµ·å¾—éå¸¸æœ‰æ°´å¹³ï¼Œç»“åˆProperty Based Testingçš„å“²å­¦ï¼Œå¯è°“ä¿¡é›…è¾¾.</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªç®€å•çš„æ•°æ®å‹ç¼©çš„ç®—æ³•ï¼š <a href=https://en.wikipedia.org/wiki/Run-length_encoding>Run-length Encoding</a>Â <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>(RLE)ï¼Œé€šå¸¸ç”¨äºå‹ç¼©åŒ…å«è¿ç»­é‡å¤æ•°æ®çš„åºåˆ—, è¿™ç§ç¼–ç æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºé‚£äº›æœ‰å¤§é‡é‡å¤å­—ç¬¦æˆ–å€¼çš„æ•°æ®.</p><p>å®ƒçš„åŸºæœ¬åŸç†æ˜¯ï¼š</p><ol><li>ç»Ÿè®¡è¿ç»­é‡å¤çš„æ•°æ®å…ƒç´ çš„æ•°é‡ã€‚</li><li>ç”¨ä¸€ä¸ªè®¡æ•°å€¼å’Œæ•°æ®å€¼çš„ç»„åˆæ¥æ›¿ä»£è¿™äº›é‡å¤çš„æ•°æ®ã€‚</li></ol><p>æ¯”å¦‚å­—ç¬¦ä¸²: <code>AABBBCCCC</code>, RLE ç¼–ç å: <code>2A3B4C</code>. <code>2A</code> è¡¨ç¤ºä¸¤ä¸ªè¿ç»­çš„ <code>A</code>, <code>3B</code> è¡¨ç¤ºä¸‰ä¸ªè¿ç»­çš„ <code>B</code>, <code>4C</code> è¡¨ç¤ºå››ä¸ªè¿ç»­çš„ <code>C</code> ã€‚</p><p>Pythonå®ç°å¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode</span><span class=p>(</span><span class=n>input_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>count</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>prev</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>lst</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>character</span> <span class=ow>in</span> <span class=n>input_string</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>character</span> <span class=o>!=</span> <span class=n>prev</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>prev</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>entry</span> <span class=o>=</span> <span class=p>(</span><span class=n>prev</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>prev</span> <span class=o>=</span> <span class=n>character</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>entry</span> <span class=o>=</span> <span class=p>(</span><span class=n>character</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lst</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decode</span><span class=p>(</span><span class=n>lst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>q</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>character</span><span class=p>,</span> <span class=n>count</span> <span class=ow>in</span> <span class=n>lst</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span> <span class=o>+=</span> <span class=n>character</span> <span class=o>*</span> <span class=n>count</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>q</span>
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæˆ‘ä»¬çš„ä»£ç å®ç°æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œå¯¹äºä»»æ„çš„å­—ç¬¦ä¸²ï¼Œç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œè§£ç åçš„ç»“æœåº”è¯¥å’ŒåŸæ¥çš„å­—ç¬¦ä¸²ä¸€è‡´çš„ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„æµ‹è¯•é€»è¾‘:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hypothesis</span> <span class=kn>import</span> <span class=n>given</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hypothesis.strategies</span> <span class=kn>import</span> <span class=n>text</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@given</span><span class=p>(</span><span class=n>text</span><span class=p>())</span> <span class=c1># å…¥å‚çš„æ ‡å‡†æ˜¯ï¼šä»»æ„çš„å­—ç¬¦ä¸²ï¼Œhypothesis æ¡†æ¶å°±ä¼šè‡ªåŠ¨ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶è°ƒç”¨test_decode_inverts_encode</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_decode_inverts_encode</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decode</span><span class=p>(</span><span class=n>encode</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ <code>pytest</code> è¿è¡Œä¸Šé¢çš„ç”¨ä¾‹ï¼Œç»“æœå¦‚ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; pytest property_based_testing.py
</span></span><span class=line><span class=cl><span class=o>===================================</span> <span class=nb>test</span> session <span class=nv>starts</span> <span class=o>====================================</span>
</span></span><span class=line><span class=cl>platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0
</span></span><span class=line><span class=cl>rootdir: /Users/ramsayleung/code/python/test_technique
</span></span><span class=line><span class=cl>plugins: hypothesis-6.115.0
</span></span><span class=line><span class=cl>collected <span class=m>1</span> item
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>property_based_testing.py F                                                          <span class=o>[</span>100%<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>=========================================</span> <span class=nv>FAILURES</span> <span class=o>=========================================</span>
</span></span><span class=line><span class=cl>________________________________ test_decode_inverts_encode ________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>@given<span class=o>(</span>text<span class=o>())</span>
</span></span><span class=line><span class=cl>&gt;   def test_decode_inverts_encode<span class=o>(</span>s<span class=o>)</span>:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>property_based_testing.py:29:
</span></span><span class=line><span class=cl>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
</span></span><span class=line><span class=cl>property_based_testing.py:30: in test_decode_inverts_encode
</span></span><span class=line><span class=cl>assert decode<span class=o>(</span>encode<span class=o>(</span>s<span class=o>))</span> <span class=o>==</span> s
</span></span><span class=line><span class=cl>_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>input_string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def encode<span class=o>(</span>input_string<span class=o>)</span>:
</span></span><span class=line><span class=cl><span class=nv>count</span> <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>prev</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>lst</span> <span class=o>=</span> <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> character in input_string:
</span></span><span class=line><span class=cl>                 <span class=k>if</span> character !<span class=o>=</span> prev:
</span></span><span class=line><span class=cl>                    <span class=k>if</span> prev:
</span></span><span class=line><span class=cl>                       <span class=nv>entry</span> <span class=o>=</span> <span class=o>(</span>prev, count<span class=o>)</span>
</span></span><span class=line><span class=cl>                       lst.append<span class=o>(</span>entry<span class=o>)</span>
</span></span><span class=line><span class=cl>                       <span class=nv>count</span> <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>                       <span class=nv>prev</span> <span class=o>=</span> character
</span></span><span class=line><span class=cl>                       <span class=k>else</span>:
</span></span><span class=line><span class=cl>                       <span class=nv>count</span> <span class=o>+=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>                       &gt;       <span class=nv>entry</span> <span class=o>=</span> <span class=o>(</span>character, count<span class=o>)</span>
</span></span><span class=line><span class=cl>                       E       UnboundLocalError: cannot access <span class=nb>local</span> variable <span class=s1>&#39;character&#39;</span> where it is not associated with a value
</span></span><span class=line><span class=cl>                       E       Falsifying example: test_decode_inverts_encode<span class=o>(</span>
</span></span><span class=line><span class=cl>                           E           <span class=nv>s</span><span class=o>=</span><span class=s1>&#39;&#39;</span>,
</span></span><span class=line><span class=cl>                           E       <span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                       property_based_testing.py:17: <span class=nv>UnboundLocalError</span>
</span></span><span class=line><span class=cl>                       <span class=o>=================================</span> short <span class=nb>test</span> summary <span class=nv>info</span> <span class=o>==================================</span>
</span></span><span class=line><span class=cl>                       FAILED property_based_testing.py::test_decode_inverts_encode - UnboundLocalError: cannot access <span class=nb>local</span> variable <span class=s1>&#39;character&#39;</span> where it is not associated ...
</span></span><span class=line><span class=cl>                       <span class=o>====================================</span> <span class=m>1</span> failed in 0.14s <span class=o>=====================================</span>
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ <code>input_string =''</code> æ˜¯ç©ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ <code>encode</code> å‡½æ•°æŠ›å‡ºå¼‚å¸¸äº†ï¼Œè¯´ <code>character</code> å˜é‡æœªå®šä¹‰ã€‚åŸæ¥æ˜¯ <code>encode</code> å‡½æ•°æ²¡æœ‰å¯¹ç©ºå­—ç¬¦ä¸²è¿™ä¸ª corner case ä½œå¤„ç†ï¼Œé‚£ä¹ˆå°±åŠ ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œä¿®å¤ä¸€ä¸‹:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode</span><span class=p>(</span><span class=n>input_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>input_string</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>count</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>prev</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>lst</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>character</span> <span class=ow>in</span> <span class=n>input_string</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>character</span> <span class=o>!=</span> <span class=n>prev</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>prev</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>entry</span> <span class=o>=</span> <span class=p>(</span><span class=n>prev</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=n>prev</span> <span class=o>=</span> <span class=n>character</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>entry</span> <span class=o>=</span> <span class=p>(</span><span class=n>character</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lst</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lst</span>
</span></span></code></pre></td></tr></table></div></div><p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“ç©ºå­—ç¬¦ä¸²æ˜¯ä¸ªç‰¹æ®Šçš„ case, å› ä¸º hypothesis ç”Ÿæˆçš„éƒ½æ˜¯ä»»æ„çš„éšæœºæ•°ï¼Œä¸ä¸€å®šæ¯æ¬¡éƒ½ä¼šæµ‹åˆ°ç©ºå­—ç¬¦ä¸²ï¼Œé‚£æˆ‘ä»¬å°±è‡ªå·±æŒ‡å®šä¸€ä¸ª case:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hypothesis</span> <span class=kn>import</span> <span class=n>example</span><span class=p>,</span> <span class=n>given</span><span class=p>,</span> <span class=n>strategies</span> <span class=k>as</span> <span class=n>st</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@given</span><span class=p>(</span><span class=n>st</span><span class=o>.</span><span class=n>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nd>@example</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=c1># æ‰‹å·¥æŒ‡å®šç©ºå­—ç¬¦ä¸²è¿™ä¸ª corner case</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_decode_inverts_encode</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decode</span><span class=p>(</span><span class=n>encode</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div><p><code>pytest</code> é‡æ–°è¿è¡Œï¼Œæµ‹è¯•å°±é€šè¿‡äº†ã€‚ä½†æ˜¯ï¼Œå¯¹ <code>hypothesis</code> æ¡†æ¶è¿˜æ²¡æœ‰å»ºç«‹ä¿¡å¿ƒçš„ä½ æˆ‘å°±ä¸ç¡®å®šï¼Œå®ƒæ˜¯å¦çœŸçš„ç”Ÿæˆå¾ˆå¤šéšæœºæ¥è¿è¡Œè¿™ä¸ª test case å‘¢ï¼Ÿ</p><p>æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥éªŒè¯ï¼š</p><p>æ–¹æ³•ä¸€ï¼šæœ€ç®€å•ç²—æš´çš„æ–¹å¼ï¼ŒæŠŠ <code>s</code> å˜é‡ç»™æ‰“å°å‡ºæ¥ï¼Œæ¯•ç«Ÿçœ¼è§ä¸ºå®:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@given</span><span class=p>(</span><span class=n>st</span><span class=o>.</span><span class=n>text</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nd>@example</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_decode_inverts_encode</span><span class=p>(</span><span class=n>s</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decode</span><span class=p>(</span><span class=n>encode</span><span class=p>(</span><span class=n>s</span><span class=p>))</span> <span class=o>==</span> <span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åé€šè¿‡ <code>pytest -s</code> å‚æ•°è¦æ±‚ <code>pytest</code> å°†å†™å…¥åˆ° <code>stdout</code> çš„å†…å®¹ç»™æ‰“å°å‡ºæ¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; pytest property_based_testing.py -s
</span></span><span class=line><span class=cl><span class=o>=======================================</span> <span class=nb>test</span> session <span class=nv>starts</span> <span class=o>=======================================</span>
</span></span><span class=line><span class=cl>platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0
</span></span><span class=line><span class=cl>rootdir: /Users/ramsayleung/code/python/test_technique
</span></span><span class=line><span class=cl>plugins: hypothesis-6.115.0
</span></span><span class=line><span class=cl>collected <span class=m>1</span> item
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>property_based_testing.py
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>O
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Â¶
</span></span><span class=line><span class=cl><span class=se>\Ã¥</span>ñ¢„Â«
</span></span><span class=line><span class=cl>ğ¥›—ÃbÃ³
</span></span><span class=line><span class=cl>ğœ†®Ã¥
</span></span><span class=line><span class=cl>ñ°˜°9
</span></span><span class=line><span class=cl>gahó­¾”ğ›§
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>iò¼¯œ+Ã³Â»ò®©¸bñ•¨
</span></span><span class=line><span class=cl>S!Ã•TÃ¥<span class=p>&amp;</span>ğ°µ©Ã­Â¤Ã½Ã¤Ã³Ã·F
</span></span><span class=line><span class=cl>Ã¸Ã´yÂµ
</span></span><span class=line><span class=cl>Ã„Âª
</span></span><span class=line><span class=cl>sLz$Ã¯
</span></span><span class=line><span class=cl>_ğ µˆ
</span></span><span class=line><span class=cl>Ãœ
</span></span><span class=line><span class=cl>A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Róƒ·<span class=o>{</span>Â©Â¾
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Ã¬Ãµ
</span></span><span class=line><span class=cl>   Ã¦ô‚›BÃ1*ô…„¢Ã«Ã³gğ®ˆÂ¼ ?ğ©“
</span></span><span class=line><span class=cl>   Ã’Ã¶r @PPô¾‚Ã¶ñ³±ŠÃ»ÃÂ½Â¬HÃˆ6#
</span></span><span class=line><span class=cl>   ağ£½—Â¶ó¿…Œğ§‘x~ó—œ¬éŸ¹Ã»Ã°ó´¯®#Zó…–«<span class=se>\Â©</span>ğ³–…Ã»f&gt;
</span></span><span class=line><span class=cl>   i
</span></span><span class=line><span class=cl>   ....
</span></span><span class=line><span class=cl>   <span class=o>========================================</span> <span class=m>1</span> passed in 0.15s <span class=o>========================================</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸€å †éƒ½æ˜¯ä»€ä¹ˆå­—ç¬¦å‘¢, éƒ½ä¹±ç äº†ã€‚</p><p>æ¯•ç«Ÿæˆ‘ä»¬å‘Šè¯‰ <code>hypothesis</code> æ¡†æ¶çš„æ˜¯ï¼Œæˆ‘ä»¬å‚æ•°æ¥å—çš„æ ‡å‡†æ˜¯ä»»æ„çš„å­—ç¬¦ä¸²ï¼Œ <code>hypothesis</code> å°±éå¸¸å°½èŒåœ°å¸®æˆ‘ä»¬ç”Ÿæˆäº†å„ç§å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæµ‹è¯•æ•°æ®é›†å¯æ¯”æˆ‘ä»¬è‡ªå·±æ‰‹å·¥æ„å»ºçš„èŒƒå›´å¤§å¾—å¤šï¼Œè¿™å°±æ˜¯ property based testing çš„ä¼˜åŠ¿æ‰€åœ¨.</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>hypothesis</code> æ¡†æ¶æä¾›çš„å‘½ä»¤è¡Œå‚æ•° =&ndash;hypothesis-show-statistics=ï¼Œç”¨äºæ‰“å°ç»Ÿè®¡ä¿¡æ¯:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>&gt; pytest property_based_testing.py --hypothesis-show-statistics
</span></span><span class=line><span class=cl><span class=o>=======================================</span> <span class=nb>test</span> session <span class=nv>starts</span> <span class=o>=======================================</span>
</span></span><span class=line><span class=cl>platform darwin -- Python 3.12.6, pytest-8.3.3, pluggy-1.5.0
</span></span><span class=line><span class=cl>rootdir: /Users/ramsayleung/code/python/test_technique
</span></span><span class=line><span class=cl>plugins: hypothesis-6.115.0
</span></span><span class=line><span class=cl>collected <span class=m>1</span> item
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>property_based_testing.py .                                                                 <span class=o>[</span>100%<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>======================================</span> Hypothesis <span class=nv>Statistics</span> <span class=o>======================================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>property_based_testing.py::test_decode_inverts_encode:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- during generate phase <span class=o>(</span>0.03 seconds<span class=o>)</span>:
</span></span><span class=line><span class=cl>- Typical runtimes: &lt; 1ms, of which &lt; 1ms in data generation
</span></span><span class=line><span class=cl>- <span class=m>100</span> passing examples, <span class=m>0</span> failing examples, <span class=m>0</span> invalid examples
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- Stopped because settings.max_examples<span class=o>=</span><span class=nv>100</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>========================================</span> <span class=m>1</span> passed in 0.05s <span class=o>========================================</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢è¿è¡Œäº† 100 æ¡æ•°æ®ï¼Œå¦‚æœä½ è§‰å¾—è¿˜æƒ³è·‘æ›´å¤šï¼Œå¯ä»¥é€šè¿‡ <code>settings</code> è£…é¥°å™¨æŒ‡å®šæ›´å¤š:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@settings</span><span class=p>(</span><span class=n>max_examples</span><span class=o>=</span><span class=mi>500</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=quickcheck-and-proptest><span class=section-num>4</span> Quickcheck & Proptest<a hidden class=anchor aria-hidden=true href=#quickcheck-and-proptest>#</a></h2><p>è€Œåœ¨Rustç”Ÿæ€ï¼Œå°±æœ‰ä¸¤ä¸ª Property Based Testing çš„åº“ï¼Œä¸€ä¸ªæ˜¯ç”±Rustç¤¾åŒºçŸ¥åå¼€å‘è€…ï¼Œ<a href=https://github.com/BurntSushi/ripgrep>ripgrep</a>Â <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>å’Œ regex åº“ä½œè€…ç§»æ¤è‡ª Haskell Quickcheck åº“çš„ <a href=https://github.com/BurntSushi/quickcheck>quickcheck</a>Â <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>(åå­—ä¹Ÿä¸€å¹¶ç§»æ¤äº†), å¦å¤–ä¸€ä¸ªæ˜¯æ€è·¯ç»§æ‰¿è‡ª Python Hypothesis çš„ <a href=https://github.com/proptest-rs/proptest>Proptest</a>Â <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>(è¿™ä½ç›´æ¥ç”¨property based testingæŠ€æœ¯æ¥å‘½åäº†ï¼Œä¸å¾—ä¸è¯´ï¼Œå‘½åçœŸçš„æ˜¯é—¨è‰ºæœ¯)</p><p>ä¸¤è€…çš„ç¤¾åŒºæ¥å—åº¦éƒ½ç›¸å·®æ— å‡ (star, ä½¿ç”¨è€…æ•°é‡), è€Œåœ¨å…¬å¸å†…éƒ¨ï¼Œæˆ‘ä¹Ÿå‘ç° quickcheck å’Œ proptest éƒ½æœ‰äººç”¨ï¼Œåæˆ‘æ—è¾¹çš„Principle Engineer ç”¨çš„æ˜¯ proptest, è€Œå¦å¤–ä¸€ä¸ªç°åœ¨å’Œæˆ‘å…±äº‹çš„åŒäº‹ï¼Œå¥¹çš„ä¹‹å‰å›¢é˜Ÿç”¨çš„å°±æ˜¯ quickcheckï¼Œçœ‹åˆ°éƒ½åŠ¿å‡åŠ›æ•Œå˜›ã€‚</p><p>ç¿»å¼€ quickcheck å’Œ proptest çš„API æ–‡æ¡£ä¹‹åï¼Œæˆ‘å‘ç°æˆ‘æ›´å–œæ¬¢ quickcheck çš„æ¥å£é£æ ¼ï¼Œè™½è¯´å®ƒçš„æ´»è·ƒåº¦æ›´ä½ä¸€äº›ï¼Œæˆ‘æœ€åè¿˜æ˜¯é€‰æ‹©äº†ä½¿ç”¨ quickcheck.</p><p>ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹æˆ‘åœ¨Rustä¸Šä½¿ç”¨ quickcheck çš„å¿ƒå¾—:</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¯ä»¥åè½¬åˆ—è¡¨çš„å‡½æ•° <code>reverse</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>reverse</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nb>Clone</span><span class=o>&gt;</span><span class=p>(</span><span class=n>xs</span>: <span class=kp>&amp;</span><span class=p>[</span><span class=n>T</span><span class=p>])</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>rev</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>vec!</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>rev</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>clone</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>rev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯¹äºä»»æ„ç±»å‹çš„åˆ—è¡¨ï¼Œåè½¬ä¹‹åå†åè½¬çš„ç»“æœï¼Œè‚¯å®šæ˜¯å’ŒåŸç»“æœä¸€æ ·çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å£°æ˜æˆ‘ä»¬çš„æ ‡å‡†(specification), é‚£å°±æ˜¯ä»»æ„çš„åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ•´å‹åˆ—è¡¨æˆ–è€…æ˜¯å…¶ä»–çš„ç»“æ„ä½“åˆ—è¡¨:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[cfg(test)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>quickcheck_macros</span>::<span class=n>quickcheck</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>crate</span>::<span class=n>reverse</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[quickcheck]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>double_reversal_is_identity_isize</span><span class=p>(</span><span class=n>xs</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>isize</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>xs</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>reverse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>reverse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>xs</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[quickcheck]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>double_reversal_is_identity_string</span><span class=p>(</span><span class=n>xs</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>xs</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>reverse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>reverse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>xs</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Rust çš„unit test æ˜¯ä¸æ”¯æŒå¸¦å‚æ•°çš„ï¼Œ=#[quickcheck]= è¿™ä¸ªå®å°±ä¼šè‡ªåŠ¨å°† <code>double_reversal_is_identity_isize</code> è½¬æ¢æˆ property based test case, è€Œå¾—ç›ŠäºRustçš„ç±»å‹ç³»ç»Ÿ, <code>quickcheck</code> å°±èƒ½æ¨æ–­å‡ºå…¥å‚å°±æ˜¯æˆ‘ä»¬å£°æ˜çš„æ ‡å‡† <code>Vec&lt;isze></code>, ä»»æ„ <code>isize</code> ç±»å‹çš„æ•°ç»„.</p><h3 id=struct-with-quickcheck><span class=section-num>4.1</span> Struct with quickcheck<a hidden class=anchor aria-hidden=true href=#struct-with-quickcheck>#</a></h3><p>å¦‚æœä¸Šé¢çš„ä¾‹å­è§‰å¾—è¿‡äºç®€å•çš„è¯ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬çœ‹ä¸ªå¤æ‚ä¸€ç‚¹çš„ä¾‹å­, ä¸€ä¸ªç®€å•çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒä¼šå‘˜ï¼Œå€Ÿä¹¦ï¼Œè¿˜ä¹¦åŠŸèƒ½ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>chrono</span>::<span class=p>{</span><span class=n>Duration</span><span class=p>,</span><span class=w> </span><span class=n>NaiveDate</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Clone, PartialEq)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Book</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>isbn</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>title</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>author</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>publication_year</span>: <span class=kt>u16</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Clone, PartialEq)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Member</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>email</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Clone)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Loan</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>book_isbn</span>: <span class=nb>String</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>member_id</span>: <span class=kt>u32</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>due_date</span>: <span class=nc>NaiveDate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Clone)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Library</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>books</span>: <span class=nc>HashMap</span><span class=o>&lt;</span><span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>Book</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>members</span>: <span class=nc>HashMap</span><span class=o>&lt;</span><span class=kt>u32</span><span class=p>,</span><span class=w> </span><span class=n>Member</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>loans</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Loan</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>current_date</span>: <span class=nc>NaiveDate</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Library</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>new</span><span class=p>(</span><span class=n>current_date</span>: <span class=nc>NaiveDate</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Library</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>books</span>: <span class=nc>HashMap</span>::<span class=n>new</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>members</span>: <span class=nc>HashMap</span>::<span class=n>new</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>loans</span>: <span class=nb>Vec</span>::<span class=n>new</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>current_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>add_book</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>book</span>: <span class=nc>Book</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=o>&amp;</span><span class=n>book</span><span class=p>.</span><span class=n>isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Book with this ISBN already exists&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>book</span><span class=p>.</span><span class=n>isbn</span><span class=p>.</span><span class=n>clone</span><span class=p>(),</span><span class=w> </span><span class=n>book</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>add_member</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>member</span>: <span class=nc>Member</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>members</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=o>&amp;</span><span class=n>member</span><span class=p>.</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Member with this ID already exists&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>members</span><span class=p>.</span><span class=n>insert</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>member</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>loan_book</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>book_isbn</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>member_id</span>: <span class=kt>u32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=bp>self</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=n>book_isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Book not found&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=bp>self</span><span class=p>.</span><span class=n>members</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=o>&amp;</span><span class=n>member_id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Member not found&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>loans</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>any</span><span class=p>(</span><span class=o>|</span><span class=n>loan</span><span class=o>|</span><span class=w> </span><span class=n>loan</span><span class=p>.</span><span class=n>book_isbn</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>book_isbn</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Book is already on loan&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>due_date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>current_date</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Duration</span>::<span class=n>days</span><span class=p>(</span><span class=mi>14</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>loans</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>Loan</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>book_isbn</span>: <span class=nc>book_isbn</span><span class=p>.</span><span class=n>to_string</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>member_id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>due_date</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>return_book</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>book_isbn</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>index</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>loans</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>iter</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>position</span><span class=p>(</span><span class=o>|</span><span class=n>loan</span><span class=o>|</span><span class=w> </span><span class=n>loan</span><span class=p>.</span><span class=n>book_isbn</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>book_isbn</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>loans</span><span class=p>.</span><span class=n>remove</span><span class=p>(</span><span class=n>index</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Ok</span><span class=p>(())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;Book is not currently on loan&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ä¸Šé¢çš„ç®€å•ä»£ç ï¼Œå°±å®ç°äº†æ–°å¢å›¾ä¹¦ï¼Œæ–°å¢ä¼šå‘˜ï¼Œå€Ÿä¹¦ï¼Œå’Œè¿˜ä¹¦åŠŸèƒ½ã€‚ç°åœ¨å°±è®©æˆ‘ä»¬æ¥ç»“åˆ <code>quickcheck</code> çš„ <code>Arbitrary</code> æ¥å£ï¼Œå®ç°ç”Ÿæˆä»»æ„çš„å›¾ä¹¦å’Œä¼šå‘˜ï¼Œä»¥ä¾¿ç”¨äºæµ‹è¯•:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>quickcheck</span>::<span class=p>{</span><span class=n>Arbitrary</span><span class=p>,</span><span class=w> </span><span class=n>Gen</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Arbitrary</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Book</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>arbitrary</span><span class=p>(</span><span class=n>g</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Gen</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Book</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// isbnå¿…é¡»ä»¥`ISBN` å¼€å¤´ï¼Œåæ¥ä»»æ„çš„å¤§äºç­‰äº0ï¼Œå°äºuint32.max_value
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=c1>// çš„æ•´å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>isbn</span>: <span class=nc>format</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;ISBN-{}&#34;</span><span class=p>,</span><span class=w> </span><span class=kt>u32</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>title</span>: <span class=nb>String</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>),</span><span class=w> </span><span class=c1>// ä»»æ„çš„å­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>author</span>: <span class=nb>String</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>),</span><span class=w> </span><span class=c1>// ä»»æ„çš„å­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>publication_year</span>: <span class=o>*</span><span class=n>g</span><span class=p>.</span><span class=n>choose</span><span class=p>(</span><span class=o>&amp;</span><span class=p>[</span><span class=mi>2014_</span><span class=k>u16</span><span class=p>,</span><span class=w> </span><span class=mi>2022_</span><span class=k>u16</span><span class=p>,</span><span class=w> </span><span class=mi>2025_</span><span class=k>u16</span><span class=p>]).</span><span class=n>unwrap</span><span class=p>(),</span><span class=w> </span><span class=c1>// 2014,2022æˆ–2025å¹´å‡ºç‰ˆçš„ä¹¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Arbitrary</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Member</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>arbitrary</span><span class=p>(</span><span class=n>g</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Gen</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>Self</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Member</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>id</span>: <span class=kt>u32</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>),</span><span class=w> </span><span class=c1>// ä»»æ„å¤§äº0ï¼Œå°äºuint32.max_valueçš„æ•´å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>name</span>: <span class=nb>String</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>),</span><span class=w> </span><span class=c1>// ä»»æ„å­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=c1>// ä»»æ„å­—ç¬¦å¼€å¤´, ä»¥@example.com ç»“å°¾çš„å­—ç¬¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=n>email</span>: <span class=nc>format</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{}@example.com&#34;</span><span class=p>,</span><span class=w> </span><span class=nb>String</span>::<span class=n>arbitrary</span><span class=p>(</span><span class=n>g</span><span class=p>)),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨å°±è®©æˆ‘ä»¬æ¥çœ‹ä¸‹å€ŸåŠ© quickcheck ç¼–å†™çš„ test case, æ³¨æ„å‚æ•°ä¸º <code>Book</code> å’Œ <code>Member</code> ç±»å‹çš„ case, quickcheck å°±ä¼šä»¥æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„æ ‡å‡†ï¼Œè‡ªåŠ¨ç»™æˆ‘ä»¬ç”Ÿæˆç¬¦åˆè§„å®šçš„ <code>Book</code> å’Œ <code>Member</code> å‚æ•°.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[cfg(test)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>mod</span> <span class=nn>tests</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>chrono</span>::<span class=n>NaiveDate</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>quickcheck_macros</span>::<span class=n>quickcheck</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>crate</span>::<span class=n>book</span>::<span class=n>Member</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span>::<span class=p>{</span><span class=n>Book</span><span class=p>,</span><span class=w> </span><span class=n>Library</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[quickcheck]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>adding_book_increases_book_count</span><span class=p>(</span><span class=n>book</span>: <span class=nc>Book</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>library</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Library</span>::<span class=n>new</span><span class=p>(</span><span class=n>NaiveDate</span>::<span class=n>from_ymd_opt</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>).</span><span class=n>unwrap</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>initial_count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>library</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>len</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>add_book</span><span class=p>(</span><span class=n>book</span><span class=p>.</span><span class=n>clone</span><span class=p>()).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>len</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>initial_count</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>library</span><span class=p>.</span><span class=n>books</span><span class=p>.</span><span class=n>contains_key</span><span class=p>(</span><span class=o>&amp;</span><span class=n>book</span><span class=p>.</span><span class=n>isbn</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[quickcheck]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>cannot_loan_nonexistent_book</span><span class=p>(</span><span class=n>book_isbn</span>: <span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>member_id</span>: <span class=kt>u32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>library</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Library</span>::<span class=n>new</span><span class=p>(</span><span class=n>NaiveDate</span>::<span class=n>from_ymd_opt</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>).</span><span class=n>unwrap</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>loan_book</span><span class=p>(</span><span class=o>&amp;</span><span class=n>book_isbn</span><span class=p>,</span><span class=w> </span><span class=n>member_id</span><span class=p>).</span><span class=n>is_err</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cp>#[quickcheck]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>can_return_loaned_book</span><span class=p>(</span><span class=n>book</span>: <span class=nc>Book</span><span class=p>,</span><span class=w> </span><span class=n>member</span>: <span class=nc>Member</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kt>bool</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>library</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Library</span>::<span class=n>new</span><span class=p>(</span><span class=n>NaiveDate</span>::<span class=n>from_ymd_opt</span><span class=p>(</span><span class=mi>2024</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>14</span><span class=p>).</span><span class=n>unwrap</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>add_book</span><span class=p>(</span><span class=n>book</span><span class=p>.</span><span class=n>clone</span><span class=p>()).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>add_member</span><span class=p>(</span><span class=n>member</span><span class=p>.</span><span class=n>clone</span><span class=p>()).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>loan_book</span><span class=p>(</span><span class=o>&amp;</span><span class=n>book</span><span class=p>.</span><span class=n>isbn</span><span class=p>,</span><span class=w> </span><span class=n>member</span><span class=p>.</span><span class=n>id</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>library</span><span class=p>.</span><span class=n>return_book</span><span class=p>(</span><span class=o>&amp;</span><span class=n>book</span><span class=p>.</span><span class=n>isbn</span><span class=p>).</span><span class=n>is_ok</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é€šè¿‡ <code>quickcheck</code> æˆ‘ä»¬å°±å¯ä»¥åªä¸“æ³¨æµ‹è¯•é€»è¾‘ï¼Œå¯ä»¥å‡å®šæµ‹è¯•æ•°æ®é›†æ˜¯å®Œå¤‡çš„äº†ã€‚å¯èƒ½çœ‹åˆ° <code>Book</code> å’Œ <code>Member</code>, ä½ ä¼šè§‰å¾— quickcheck å¹¶æ²¡æœ‰åšå¤ªå¤šäº‹æƒ…ï¼Œä½ æ‰‹å·¥ä¹Ÿå¯ä»¥æ„é€ ã€‚</p><p>ä½†æ˜¯æˆ‘åœ¨çš„å®é™…å·¥ä½œä¸­ï¼Œæˆ‘å°±éœ€è¦æ„é€ ä¸€ä¸ªè¶…è¿‡23ä¸ªæˆå‘˜å˜é‡çš„ struct, å¤§éƒ¨åˆ†è¿˜æ˜¯ optional, ç„¶åéœ€è¦å°†è¿™ä¸ª struct å†™å…¥åˆ° parquet æ–‡ä»¶ï¼Œç„¶åå†æµ‹è¯•è¯»å–é€»è¾‘ã€‚
ä¸åŒæˆå‘˜å˜é‡çš„å€¼å¯å–çš„èŒƒå›´å®åœ¨å¤ªå¤šäº†ï¼Œå†å åŠ ä¸Š optional çš„å¯èƒ½æ€§ï¼Œæ„é€ æ•°æ®çš„ä»£ç å†™å¾—ç›¸å½“æ¶å¿ƒ.</p><p>æ‰€ä»¥æœ‰äº† quickcheck ä¹‹åï¼Œæˆ‘åªéœ€è¦ä¸ºè¿™ä¸ª struct å®ç° <code>Arbitrary</code> æ¥å£ï¼Œå‰©ä¸‹çš„å°±ç”± <code>quickcheck</code> æ›¿æˆ‘ç”Ÿæˆï¼Œæ‰€ä»¥æˆ‘ç›´æ¥å’ŒPEå¤§ä½¬è¯´:</p><blockquote><p>property test saves me life, now I couldn&rsquo;t live without it.</p></blockquote><h2 id=æ€»ç»“><span class=section-num>5</span> æ€»ç»“<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h2><p>æœ¬æ¥æƒ³æŠ’å‘æ„Ÿæƒ³å†™ç‚¹ç»“è¯­ï¼Œä½†æ˜¯çœ‹åˆ° Hypothesis ä½œè€…å†™çš„ <a href=https://hypothesis.readthedocs.io/en/latest/manifesto.html>The purpose of Hypothesis</a><sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup> æ¥è¯´æ˜ä»–å¼€å‘çš„ Hypothesis çš„åŠ¨æœºï¼Œä»–çš„æ–‡ç« ç”šè‡³ç”¨æ¥ç»™è¿™ä¸ªã€Šæµ‹è¯•æŠ€èƒ½è¿›é˜¶ã€‹ç³»åˆ—æ€»ç»“éƒ½ç›¸å½“å¦¥å½“ã€‚</p><p>æˆ‘å°±è¯•ç¿»è¯‘ä¸‹ä»–æ–‡ç« çš„éƒ¨åˆ†æ®µè½, æ›´æ¨èé˜…è¯»åŸæ–‡ï¼Œå¯è°“æ˜¯ç”¨å¿ƒè‰¯è‹¦ï¼Œå­—å­—ç ç‘:</p><blockquote><p>è¯·å®¹æˆ‘ç‹‚å¦„ä¸€ä¸‹ï¼ŒHypothesis çš„ç›®æ ‡æ˜¯å¸Œæœ›å¯ä»¥è®©è¿™ä¸ªä¸–ç•Œè¿ˆè¿›åˆ°ä¸€ä¸ªå…¨æ–°ï¼Œç”±é«˜è´¨é‡è½¯ä»¶æ‰“é€ çš„æ–°ä¸–ä»£ã€‚</p><p>æ­£å¦‚äººä»¬æ‰€è¯´ï¼Œè½¯ä»¶æ­£åœ¨åå™¬æ•´ä¸ªä¸–ç•Œã€‚ä½†è½¯ä»¶æœ¬èº«å´å¾ˆçƒ‚ï¼Œå®ƒå……æ»¡bugï¼Œåˆä¸å®‰å…¨ï¼Œè¿˜ç»å¸¸è¢«è®¾è®¡å¾—å¾ˆçƒ‚ï¼Œè¿™æ ·çš„è½¯ä»¶å¯è°“æ˜¯ä¸‡æ¶ä¹‹æº.</p><p>è€Œè½¯ä»¶æµ‹è¯•çš„çŠ¶å†µç”šè‡³æ›´ç³Ÿç³•ï¼Œè™½ç„¶å¤§å®¶éƒ½è®¤åŒåº”è¯¥å¯¹ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯ä½ èƒ½é—®å¿ƒæ— æ„§åœ°è¯´ï¼Œä½ ç»æ‰‹è¿‡çš„ä»£ç éƒ½æœ‰è¢«å……åˆ†æµ‹è¯•ä¹ˆï¼Ÿ</p><p>é—®é¢˜åœ¨äºï¼Œå®åœ¨æ˜¯å¤ªéš¾å†™å‡ºå¥½çš„æµ‹è¯•äº†ï¼Œ
<strong><strong>ä½ å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œé€šå¸¸æŒæœ‰å’Œä½ å†™ä»£ç æ—¶ä¸€æ ·çš„å‡è®¾ä¸è¯¯åŒºï¼Œä½ å†™çš„æµ‹è¯•ç”¨ä¾‹è‡ªç„¶æ— æ³•å‘ç°ä½ å½“åˆåŸ‹ä¸‹çš„bug</strong></strong> (ç²¾è¾Ÿ)</p><p>ä¸æ­¤åŒæ—¶ï¼Œæœ‰å„ç§å„æ ·è®©æµ‹è¯•å˜æˆæ›´å¥½çš„å·¥å…·å´åŸºæœ¬æ— äººä½¿ç”¨ï¼Œæœ€åˆçš„ Quickcheck æ˜¯1999å¹´æ¨å‡ºçš„ï¼Œä½†æ˜¯å¤§å¤šæ•°å¼€å‘è€…ç”šè‡³ä»æœªå¬è¯´è¿‡å®ƒï¼Œæ›´åˆ«æä½¿ç”¨äº†ï¼ˆå¼€å±±å§‹ç¥–çš„Quickcheckåœ¨GitHubåªæœ‰700å¤šä¸ªStarï¼Œå°±çŸ¥é“ä½œè€…æ‰€è¨€ä¸è™šï¼‰ã€‚
è™½ç„¶å…¶ä»–è¯­è¨€æœ‰äº›åŠæˆå“çš„å®ç°ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†éƒ½ä¸å€¼å¾—ä¸€è¯•ã€‚</p><p>è€Œ Hypothesis çš„ç›®æ ‡æ­£æ˜¯æ­£æœ¬æ¸…æºï¼ŒæŠŠå…ˆè¿›çš„æµ‹è¯•æŠ€æœ¯ä¼ é€’ç»™å¤§ä¼—ï¼Œå¹¶æä¾›ä¸€ä¸ªé«˜è´¨é‡çš„å®ç°ï¼Œè®©äººä»¬å¯ä»¥æ¥çº³å®ƒã€‚</p><p>å¸Œæœ›å¯ä»¥é›†ç™¾å®¶ä¹‹æ‰€é•¿ï¼Œé™„ä»¥ä¸ªäººå¾®è–„ä¹‹åŠ›ï¼Œè®©è½¯ä»¶æµ‹è¯•å˜å¾—æ›´å¥½ã€‚</p></blockquote><p>ç³»åˆ—æ–‡ç« :</p><ul><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%80_%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F%E8%AE%A4%E7%9F%A5/>æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸€): è½¯ä»¶è´¨é‡è®¤çŸ¥</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/>æµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Tests</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/>æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing</a></li></ul><div center class=qr-container><img src=/ox-hugo/qrcode_gh_e06d750e626f_1.jpg alt=qrcode_gh_e06d750e626f_1.jpg width=160px height=160px center=t class=qr-container>
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»</div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://en.wikipedia.org/wiki/QuickCheck>https://en.wikipedia.org/wiki/QuickCheck</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://hypothesis.works/>https://hypothesis.works/</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://en.wikipedia.org/wiki/Run-length_encoding>https://en.wikipedia.org/wiki/Run-length_encoding</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://github.com/BurntSushi/ripgrep>https://github.com/BurntSushi/ripgrep</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://github.com/BurntSushi/quickcheck>https://github.com/BurntSushi/quickcheck</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://github.com/proptest-rs/proptest>https://github.com/proptest-rs/proptest</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://hypothesis.readthedocs.io/en/latest/manifesto.html>https://hypothesis.readthedocs.io/en/latest/manifesto.html</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ramsayleung.github.io/zh/tags/testing/>Testing</a></li><li><a href=https://ramsayleung.github.io/zh/tags/rust/>Rust</a></li></ul><nav class=paginav><a class=prev href=https://ramsayleung.github.io/zh/post/2024/%E6%97%81%E8%A7%82%E8%80%85%E7%9C%BC%E4%B8%AD%E7%9A%84%E5%8A%A0%E6%8B%BF%E5%A4%A7%E7%9C%81%E8%AE%AE%E4%BC%9A%E9%80%89%E4%B8%BE/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>æ—è§‚è€…çœ¼ä¸­çš„åŠ æ‹¿å¤§çœè®®ä¼šé€‰ä¸¾</span>
</a><a class=next href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>æµ‹è¯•æŠ€èƒ½è¿›é˜¶(äºŒ): Parameterized Tests</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on x" href="https://x.com/intent/tweet/?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f&amp;hashtags=testing%2crust"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f&amp;title=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing&amp;summary=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing&amp;source=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on reddit" href="https://reddit.com/submit?url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f&title=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on whatsapp" href="https://api.whatsapp.com/send?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing%20-%20https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on telegram" href="https://telegram.me/share/url?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share æµ‹è¯•æŠ€èƒ½è¿›é˜¶(ä¸‰): Property Based Testing on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%b8%89%29%3a%20Property%20Based%20Testing&u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25B8%2589_property_based_testing%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><section><h2>Comments</h2><div id=comments-giscus></div></section><script type=text/javascript>function getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||document.body.classList.contains("dark")?"dark":"light"}function setGiscusTheme(e=!1){const s=e?"dark":"light";var n,t=document.querySelector(".giscus-frame");t&&(n=new URL(t.src),n.searchParams.set("theme",s),t.src=n.toString())}function loadComment(e=!1){const n="zh"=="zh",t=document.getElementById("comments-giscus");if(t!==null&&!t.hasAttribute("data-giscus-loaded")){console.log("Initial giscus load");const s=document.createElement("script");s.setAttribute("src","https://giscus.app/client.js"),s.setAttribute("data-repo","ramsayleung/comment"),s.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkzMDk2NjQ1NDk="),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOEnUbJc4Cltnz"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",e?"dark":"light"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("data-lang",n?"zh-CN":"en"),s.setAttribute("async","true"),t.appendChild(s),t.setAttribute("data-giscus-loaded","true")}}let currentTheme=getCurrentTheme();loadComment(currentTheme==="dark");const themeObserver=new MutationObserver(e=>{e.forEach(e=>{if(e.type==="attributes"&&e.attributeName==="class"){const e=getCurrentTheme();e!==currentTheme&&(currentTheme=e,setGiscusTheme(currentTheme==="dark"))}})});themeObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/ramsayleung/ramsayleung.github.io>here</a>, licensed under GPLv3 Â·</span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>