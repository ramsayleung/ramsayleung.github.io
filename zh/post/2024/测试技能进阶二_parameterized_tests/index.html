<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>测试技能进阶(二): Parameterized Tests | 菠萝油与天光墟</title>
<meta name=keywords content="testing,rust,python"><meta name=description content="1 前言
测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样，
比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。"><meta name=author content="Ramsay Leung"><link rel=canonical href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.756d16b9d1a19b0d7274ca93e0428bf24ca10b144104611c6875be78291ca07b.css integrity="sha256-dW0WudGhmw1ydMqT4EKL8kyhCxRBBGEcaHW+eCkcoHs=" rel="preload stylesheet" as=style><link rel=icon href=https://ramsayleung.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ramsayleung.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ramsayleung.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ramsayleung.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ramsayleung.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MG65HQHEL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MG65HQHEL")}</script><meta property="og:url" content="https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/"><meta property="og:site_name" content="菠萝油与天光墟"><meta property="og:title" content="测试技能进阶(二): Parameterized Tests"><meta property="og:description" content="1 前言 测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样， 比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-13T09:35:00-07:00"><meta property="article:modified_time" content="2025-01-09T01:14:26-08:00"><meta property="article:tag" content="Testing"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Python"><meta property="og:image" content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="测试技能进阶(二): Parameterized Tests"><meta name=twitter:description content="1 前言
测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样，
比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ramsayleung.github.io/zh/post/"},{"@type":"ListItem","position":2,"name":"测试技能进阶(二): Parameterized Tests","item":"https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"测试技能进阶(二): Parameterized Tests","name":"测试技能进阶(二): Parameterized Tests","description":"1 前言 测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样， 比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。\n","keywords":["testing","rust","python"],"articleBody":"1 前言 测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样， 比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。\n因为Python比较适合写POC(proof of concept), 而我日常工作的语言是Java+Rust，所以我会穿插着引用这三种语言。\n2 Parameterized Test 在介绍 Parameterized Test 之前，让我们先来看个简单的计算价格与折扣的函数（实际的生产代码肯定会更复杂，但是背后的思路是相通的）：\n1 2 def calculate_discount(price, discount_percentage): return price - (price * discount_percentage / 100) 针对这个函数，我们可能会编写多个 test case, 比如价格是 100, 给10%的折扣; 价格是200, 给20%的折扣; 价格是50, 给0的折扣；还有异常case，比如价格为负数的时候，或者折扣为负数的时候.\n2.1 单个 test case 对于这么多的 case, 一个简单粗暴的方式就是把所有的 case 都写在一个 test case 里：\n1 2 3 4 5 6 7 8 9 import pytest def test_calculate_discount(): # happy path assert calculate_discount(100, 10) == 90 assert calculate_discount(200, 20) == 160 assert calculate_discount(50, 0) == 50 # unhappy path # assert calculate_discount(-2, 10) # assert calculate_discount(10, -2) 但是这样的做法一般是不推荐的，Best Practice是一个 test case 只测一种情况，因为如果一个 test case 包含多个测试条件，如果 test case fail 了，那么不看源码或者堆栈，一般还看不出是什么 case 失败了，不好排查。\n2.2 多个 test case 推荐做法就是每个测试条件一个单独的 test case。\n另外我们通过test case发现上面的代码没有处理异常情况，我们现在要优化下我们的代码，增加异常处理逻辑(这个就是TDD所推崇的开发哲学, test case 先行，通过test case发现问题，让test case fail掉，然后修正业务逻辑，test case再运行通过).\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 import pytest def calculate_discount(price, discount_percentage): if price \u003c 0: raise ValueError(f\"Price must be greater than zero: {price}\") if discount_percentage \u003c 0: raise ValueError(f\"Discount_percentage must be greater than zero: {discount_percentage}\") return price - (price * discount_percentage / 100) class TestClassCalculateDiscount: # happy path def test_calculate_discount_with_10_discount_percentage(self): assert calculate_discount(100, 10) == 90 def test_calculate_discount_with_20_discount_percentage(self): assert calculate_discount(200, 20) == 160 def test_calculate_discount_with_0_discount_percentage(self): assert calculate_discount(50, 0) == 50 # unhappy path def test_calculate_discount_with_negative_price(self): with pytest.raises(ValueError): assert calculate_discount(-2, 10) def test_calculate_discount_with_negative_discount(self): with pytest.raises(ValueError): assert calculate_discount(10, -2) 代码的确是整洁易读了，但话虽如此，我们要多写了很多的 test case.\n如果 calculate_discount 变得更复杂，我们要写的 test case 肯定是更多更复杂，总不能都 copy-paste test case吧。\n2.3 Parameterized Test 话题就回到 Parameterized Test 了, 它就是用来解决这个问题的，它可以让你用不同的测试数据集会运行相同的测试逻辑. 还是以上面的代码为例子，你会发现 test_calculate_discount_with_10_discount_percentage 和 test_calculate_discount_with_20_discount_percentage 的测试逻辑是完全一样的，但只是数据集不同，所以我们就可以使用 Parameterized Test 来优化：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import pytest class TestClassCalculateDiscount: # Parameterized test for valid cases (happy path) @pytest.mark.parametrize(\"price, discount, expected\", [ (100, 10, 90), (200, 20, 160), (50, 0, 50) ]) def test_calculate_discount(self, price, discount, expected): assert calculate_discount(price, discount) == expected # Parameterized test for invalid cases (unhappy path) @pytest.mark.parametrize(\"price, discount\", [ (-2, 10), # Invalid price (10, -2) # Invalid discount percentage ]) def test_calculate_discount_invalid_cases(self, price, discount): with pytest.raises(ValueError): calculate_discount(price, discount) 其实就是把测试逻辑和数据进行了分离，后面需要测试新的数据集，只需要向数据集里面添加数据即可。\n由此可见，使用 Parameterized Test 有几个显而易见的好处：\n首先是减少代码冗余，不需要类似的代码 copy-paste 很多次；其次是方便提到测试覆盖率，这个在上面的例子可能不明显，我们可以再修改一下 calculate_discount 函数，增加两个分支：\n1 2 3 4 5 6 7 8 9 10 11 def calculate_discount(price, discount_percentage): if price \u003c 0: raise ValueError(f\"Price must be greater than zero: {price}\") if discount_percentage \u003c 0: raise ValueError(f\"Discount_percentage must be greater than zero: {discount_percentage}\") if price \u003e 50000: return price - (price * (discount_percentage * 1.15) / 100) elif price \u003e 100000: return price - (price * (discount_percentage * 1.18) / 100) else: return price - (price * discount_percentage / 100) 价格超过50000, 在已有折扣基础上，再额外给折扣的15%作为折扣；价格超过100000，在已有折扣的基础上，再额外给折扣的18%作为折扣. 如果要覆盖这两个新的分支，只需要在数据集上添加大于50000 和大于100000的数据集，就可以直接覆盖到了.\n1 2 3 4 5 6 7 8 9 @pytest.mark.parametrize(\"price, discount, expected\", [ (100, 10, 90), (200, 20, 160), (50, 0, 50), (50001, 10, 44250.885), (100001, 10, 88500.885) ]) def test_calculate_discount(self, price, discount, expected): assert calculate_discount(price, discount) == expected 然后测试这段代码的时候，我又发现一个新的问题，这里的价格变成浮点数后，没有作小数点后几位的取整。\n（对于这样简单的函数，也能不断地通过写 test case 发现新问题，这无疑就是 test case 最大的价值所在了）\n使用 Parameterized Test 还可以提高测试代码的可读性和可维护性，这部分内容还是显而易见的，就不展开了。\n2.4 Junit 在Java的测试生态中，Junit是毫无疑问的龙头大哥，而在Junit5 ，Junit也引入了对 Parameterized Test 的支持，通过 @ParameterizedTest 这个枚举就可以将某个 test case 标注成 Parameterized Test, 通过 @ValueSource 传入待测试数据集：\n1 2 3 4 5 6 7 8 9 10 11 public class Numbers { public static boolean isOdd(int number) { return number % 2 != 0; } } @ParameterizedTest @ValueSource(ints = {1, 3, 5, -3, 15, Integer.MAX_VALUE}) // six numbers void isOdd_ShouldReturnTrueForOddNumbers(int number) { assertTrue(Numbers.isOdd(number)); } 这只是最基本的用法，Junit还支持通过函数，枚举，CSV格式甚至文件来传入待测试数据集，可谓是包罗万有，具体的用法可以参考这篇文章：Guide to JUnit 5 Parameterized Tests1 和 Junit官方文档 2\n2.5 rstest \u0026 test_case Rust 也有对Parameterized Test支持的库，一个就是 rstest3, 另外一个就是 test_case 4, 两者都对 Parameterized Test 有较好的支持，在公司的代码库中，两者我都见过有项目在使用，而我在工作中使用的是 rstest, 因为它的功能更加强大，维护者也更加活跃.\n3 总结 在了解 Parameterized Test 之前，我的每个CR基本都有 test case 覆盖，但是坐我旁边 Principle Engineer 巨佬 review 我代码的时候，总会说我的 test case 太 verbose 和 heavy, 我在想test case多还不好嘛，我的 code coverage 都超过80%了.\n然而他的意思是，不是说我的 test case 没有覆盖到代码，我100行的变更，附上200行的 test case 也没有问题，只不过我的test case大多只是数据不一样，测试逻辑基本相同，能否抽象下，减少下code redundancy, 然后就强烈建议我去看下 Parameterized Test 以及 Property Based Test.\n大佬的确一针见血，我的 test case 大多是复制已有的 test case, 修改下函数名，再加加减减改下数据集。\n经他指点，在了解 Parameterized Test 之后，我的确再也没有复制 test case，每次CR的test case也更精简了，CR也更容易通过了.\n而他提到的 Property Based Test 则是一项更强大的测试技术，下回再分解了。\n系列文章:\n测试技能进阶(一): 软件质量认知 测试技能进阶(二): Parameterized Tests 测试技能进阶(三): Property Based Testing 公号同步更新，欢迎关注👻 https://www.baeldung.com/parameterized-tests-junit-5 ↩︎\nhttps://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests ↩︎\nhttps://github.com/la10736/rstest ↩︎\nhttps://github.com/frondeus/test-case ↩︎\n","wordCount":"2230","inLanguage":"zh","image":"https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-10-13T09:35:00-07:00","dateModified":"2025-01-09T01:14:26-08:00","author":{"@type":"Person","name":"Ramsay Leung"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/"},"publisher":{"@type":"Organization","name":"菠萝油与天光墟","logo":{"@type":"ImageObject","url":"https://ramsayleung.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ramsayleung.github.io/zh/ accesskey=h title="Home (Alt + H)"><img src=https://ramsayleung.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ramsayleung.github.io/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li class=dropdown><a href=https://ramsayleung.github.io/zh/categories/ title="系列 "><span>系列 ▾</span></a><div class="menu-more-content dropdown-content"><a href=https://ramsayleung.github.io/zh/categories/%E5%BE%97%E5%A4%B1%E6%84%9F%E6%82%9F/ title=得失感悟><span>得失感悟
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%97%85%E5%8A%A0%E7%BB%8F%E5%8E%86 title=旅加经历><span>旅加经历
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/ title=我的工作流><span>我的工作流
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6/ title=测试技能进阶><span>测试技能进阶
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E8%BD%AF%E6%8A%80%E8%83%BD%E6%8C%87%E5%8C%97/ title=软件工程师的软技能指北><span>软件工程师的软技能指北
</span></a><a href=https://ramsayleung.github.io/zh/categories/reinvent-%E9%87%8D%E6%96%B0%E9%80%A0%E8%BD%AE%E5%AD%90%E7%B3%BB%E5%88%97 title=Reinvent-重新造轮子系列><span>Reinvent-重新造轮子系列</span></a></div></li><li><a href=https://ramsayleung.github.io/zh/archives/ title=归档><span>归档</span></a></li><li><a href=https://ramsayleung.github.io/zh/search/ title=搜索><span>搜索</span></a></li><li><a href=https://ramsayleung.github.io/zh/tags/ title=标签><span>标签</span></a></li><li><a href=https://ramsayleung.github.io/zh/about_me_zh/ title=关于><span>关于</span></a></li><li><a href=https://ramsayleung.github.io/zh/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ramsayleung.github.io/zh/>主页</a>&nbsp;»&nbsp;<a href=https://ramsayleung.github.io/zh/post/>Posts</a></div><h1 class="post-title entry-hint-parent">测试技能进阶(二): Parameterized Tests</h1><div class=post-quote><blockquote><p>你想雇用的人必须具备3种品质: 正直诚实、聪明能干和精力充沛。如果缺少第一种, 后两种品质会要你命!</p><cite>— 巴菲特</cite></blockquote></div><hr class=post-separator><div class=post-meta><span title='2024-10-13 09:35:00 -0700 -0700'>十月 13, 2024</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;2230 字&nbsp;|&nbsp;<a href=https://github.com/ramsayleung/ramsayleung.github.io/blob/master/content/post/2024/%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%e4%ba%8c_parameterized_tests.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#前言><span class=section-num>1</span> 前言</a></li><li><a href=#parameterized-test><span class=section-num>2</span> Parameterized Test</a><ul><li><a href=#单个-test-case><span class=section-num>2.1</span> 单个 test case</a></li><li><a href=#多个-test-case><span class=section-num>2.2</span> 多个 test case</a></li><li><a href=#parameterized-test><span class=section-num>2.3</span> Parameterized Test</a></li><li><a href=#junit><span class=section-num>2.4</span> Junit</a></li><li><a href=#rstest-and-test-case><span class=section-num>2.5</span> rstest & test_case</a></li></ul></li><li><a href=#总结><span class=section-num>3</span> 总结</a></li></ul></nav></div></details></div><div class=post-content><h2 id=前言><span class=section-num>1</span> 前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>测试技巧具有普适性，大多是与语言无关的，只是不同语言的生态可能对测试技术的支持各不一样，
比如Python和Java，基本什么库都有，而像C++，有顺手的单元测试和Mock库能用就很不错了。</p><p>因为Python比较适合写POC(proof of concept), 而我日常工作的语言是Java+Rust，所以我会穿插着引用这三种语言。</p><h2 id=parameterized-test><span class=section-num>2</span> Parameterized Test<a hidden class=anchor aria-hidden=true href=#parameterized-test>#</a></h2><p>在介绍 Parameterized Test 之前，让我们先来看个简单的计算价格与折扣的函数（实际的生产代码肯定会更复杂，但是背后的思路是相通的）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount_percentage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=n>discount_percentage</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>针对这个函数，我们可能会编写多个 test case, 比如价格是 100, 给10%的折扣; 价格是200, 给20%的折扣; 价格是50, 给0的折扣；还有异常case，比如价格为负数的时候，或者折扣为负数的时候.</p><h3 id=单个-test-case><span class=section-num>2.1</span> 单个 test case<a hidden class=anchor aria-hidden=true href=#单个-test-case>#</a></h3><p>对于这么多的 case, 一个简单粗暴的方式就是把所有的 case 都写在一个 test case 里：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_calculate_discount</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># happy path</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>==</span> <span class=mi>90</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span> <span class=o>==</span> <span class=mi>160</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl>    <span class=c1># unhappy path</span>
</span></span><span class=line><span class=cl>    <span class=c1># assert calculate_discount(-2, 10)</span>
</span></span><span class=line><span class=cl>    <span class=c1># assert calculate_discount(10, -2)</span>
</span></span></code></pre></td></tr></table></div></div><p>但是这样的做法一般是不推荐的，Best Practice是一个 test case 只测一种情况，因为如果一个 test case 包含多个测试条件，如果 test case fail 了，那么不看源码或者堆栈，一般还看不出是什么 case 失败了，不好排查。</p><h3 id=多个-test-case><span class=section-num>2.2</span> 多个 test case<a hidden class=anchor aria-hidden=true href=#多个-test-case>#</a></h3><p>推荐做法就是每个测试条件一个单独的 test case。</p><p>另外我们通过test case发现上面的代码没有处理异常情况，我们现在要优化下我们的代码，增加异常处理逻辑(这个就是TDD所推崇的开发哲学, test case 先行，通过test case发现问题，让test case fail掉，然后修正业务逻辑，test case再运行通过).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount_percentage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>price</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Price must be greater than zero: </span><span class=si>{</span><span class=n>price</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>discount_percentage</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Discount_percentage must be greater than zero: </span><span class=si>{</span><span class=n>discount_percentage</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=n>discount_percentage</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestClassCalculateDiscount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># happy path</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_with_10_discount_percentage</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>==</span> <span class=mi>90</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_with_20_discount_percentage</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span> <span class=o>==</span> <span class=mi>160</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_with_0_discount_percentage</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span> <span class=o>==</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># unhappy path</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_with_negative_price</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>ValueError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_with_negative_discount</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>ValueError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>代码的确是整洁易读了，但话虽如此，我们要多写了很多的 test case.</p><p>如果 <code>calculate_discount</code> 变得更复杂，我们要写的 test case 肯定是更多更复杂，总不能都 copy-paste test case吧。</p><h3 id=parameterized-test><span class=section-num>2.3</span> Parameterized Test<a hidden class=anchor aria-hidden=true href=#parameterized-test>#</a></h3><p>话题就回到 Parameterized Test 了, 它就是用来解决这个问题的，它可以让你用不同的测试数据集会运行相同的测试逻辑.
还是以上面的代码为例子，你会发现 <code>test_calculate_discount_with_10_discount_percentage</code> 和 <code>test_calculate_discount_with_20_discount_percentage</code> 的测试逻辑是完全一样的，但只是数据集不同，所以我们就可以使用 Parameterized Test 来优化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestClassCalculateDiscount</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameterized test for valid cases (happy path)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@pytest.mark.parametrize</span><span class=p>(</span><span class=s2>&#34;price, discount, expected&#34;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>90</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>160</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>,</span> <span class=n>expected</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>)</span> <span class=o>==</span> <span class=n>expected</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Parameterized test for invalid cases (unhappy path)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@pytest.mark.parametrize</span><span class=p>(</span><span class=s2>&#34;price, discount&#34;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=o>-</span><span class=mi>2</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>   <span class=c1># Invalid price</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>)</span>    <span class=c1># Invalid discount percentage</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_calculate_discount_invalid_cases</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>ValueError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>其实就是把测试逻辑和数据进行了分离，后面需要测试新的数据集，只需要向数据集里面添加数据即可。</p><p>由此可见，使用 Parameterized Test 有几个显而易见的好处：</p><p>首先是减少代码冗余，不需要类似的代码 copy-paste 很多次；其次是方便提到测试覆盖率，这个在上面的例子可能不明显，我们可以再修改一下 <code>calculate_discount</code> 函数，增加两个分支：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount_percentage</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>price</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Price must be greater than zero: </span><span class=si>{</span><span class=n>price</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>discount_percentage</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Discount_percentage must be greater than zero: </span><span class=si>{</span><span class=n>discount_percentage</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>price</span> <span class=o>&gt;</span> <span class=mi>50000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=p>(</span><span class=n>discount_percentage</span> <span class=o>*</span> <span class=mf>1.15</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>price</span> <span class=o>&gt;</span> <span class=mi>100000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=p>(</span><span class=n>discount_percentage</span> <span class=o>*</span> <span class=mf>1.18</span><span class=p>)</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>price</span> <span class=o>-</span> <span class=p>(</span><span class=n>price</span> <span class=o>*</span> <span class=n>discount_percentage</span> <span class=o>/</span> <span class=mi>100</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>价格超过50000, 在已有折扣基础上，再额外给折扣的15%作为折扣；价格超过100000，在已有折扣的基础上，再额外给折扣的18%作为折扣. 如果要覆盖这两个新的分支，只需要在数据集上添加大于50000 和大于100000的数据集，就可以直接覆盖到了.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest.mark.parametrize</span><span class=p>(</span><span class=s2>&#34;price, discount, expected&#34;</span><span class=p>,</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>90</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>160</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>50</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>50001</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mf>44250.885</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>100001</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mf>88500.885</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_calculate_discount</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>,</span> <span class=n>expected</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>calculate_discount</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>discount</span><span class=p>)</span> <span class=o>==</span> <span class=n>expected</span>
</span></span></code></pre></td></tr></table></div></div><p>然后测试这段代码的时候，我又发现一个新的问题，这里的价格变成浮点数后，没有作小数点后几位的取整。</p><p>（对于这样简单的函数，也能不断地通过写 test case 发现新问题，这无疑就是 test case 最大的价值所在了）</p><p>使用 Parameterized Test 还可以提高测试代码的可读性和可维护性，这部分内容还是显而易见的，就不展开了。</p><h3 id=junit><span class=section-num>2.4</span> Junit<a hidden class=anchor aria-hidden=true href=#junit>#</a></h3><p>在Java的测试生态中，Junit是毫无疑问的龙头大哥，而在Junit5 ，Junit也引入了对 Parameterized Test 的支持，通过 <code>@ParameterizedTest</code> 这个枚举就可以将某个 test case 标注成 Parameterized Test, 通过 <code>@ValueSource</code> 传入待测试数据集：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Numbers</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isOdd</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>number</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>number</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ParameterizedTest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ValueSource</span><span class=p>(</span><span class=n>ints</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=n>3</span><span class=p>,</span><span class=w> </span><span class=n>15</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=p>.</span><span class=na>MAX_VALUE</span><span class=p>})</span><span class=w> </span><span class=c1>// six numbers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>void</span><span class=w> </span><span class=nf>isOdd_ShouldReturnTrueForOddNumbers</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>number</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>assertTrue</span><span class=p>(</span><span class=n>Numbers</span><span class=p>.</span><span class=na>isOdd</span><span class=p>(</span><span class=n>number</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这只是最基本的用法，Junit还支持通过函数，枚举，CSV格式甚至文件来传入待测试数据集，可谓是包罗万有，具体的用法可以参考这篇文章：<a href=https://www.baeldung.com/parameterized-tests-junit-5>Guide to JUnit 5 Parameterized Tests</a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 和 <a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests>Junit官方文档</a> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h3 id=rstest-and-test-case><span class=section-num>2.5</span> rstest & test_case<a hidden class=anchor aria-hidden=true href=#rstest-and-test-case>#</a></h3><p>Rust 也有对Parameterized Test支持的库，一个就是 <a href=https://github.com/la10736/rstest><code>rstest</code></a><sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>, 另外一个就是 <a href=https://github.com/frondeus/test-case><code>test_case</code></a> <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>, 两者都对 Parameterized Test 有较好的支持，在公司的代码库中，两者我都见过有项目在使用，而我在工作中使用的是 <code>rstest</code>, 因为它的功能更加强大，维护者也更加活跃.</p><h2 id=总结><span class=section-num>3</span> 总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>在了解 Parameterized Test 之前，我的每个CR基本都有 test case 覆盖，但是坐我旁边 Principle Engineer 巨佬 review 我代码的时候，总会说我的 test case 太 verbose 和 heavy, 我在想test case多还不好嘛，我的 code coverage 都超过80%了.</p><p>然而他的意思是，不是说我的 test case 没有覆盖到代码，我100行的变更，附上200行的 test case 也没有问题，只不过我的test case大多只是数据不一样，测试逻辑基本相同，能否抽象下，减少下code redundancy, 然后就强烈建议我去看下 <code>Parameterized Test</code> 以及 <code>Property Based Test</code>.</p><p>大佬的确一针见血，我的 test case 大多是复制已有的 test case, 修改下函数名，再加加减减改下数据集。</p><p>经他指点，在了解 <code>Parameterized Test</code> 之后，我的确再也没有复制 test case，每次CR的test case也更精简了，CR也更容易通过了.</p><p>而他提到的 <code>Property Based Test</code> 则是一项更强大的测试技术，下回再分解了。</p><p>系列文章:</p><ul><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%80_%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F%E8%AE%A4%E7%9F%A5/>测试技能进阶(一): 软件质量认知</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/>测试技能进阶(二): Parameterized Tests</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/>测试技能进阶(三): Property Based Testing</a></li></ul><div center class=qr-container><img src=/ox-hugo/qrcode_gh_e06d750e626f_1.jpg alt=qrcode_gh_e06d750e626f_1.jpg width=160px height=160px center=t class=qr-container>
公号同步更新，欢迎关注👻</div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.baeldung.com/parameterized-tests-junit-5>https://www.baeldung.com/parameterized-tests-junit-5</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests>https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://github.com/la10736/rstest>https://github.com/la10736/rstest</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://github.com/frondeus/test-case>https://github.com/frondeus/test-case</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ramsayleung.github.io/zh/tags/testing/>Testing</a></li><li><a href=https://ramsayleung.github.io/zh/tags/rust/>Rust</a></li><li><a href=https://ramsayleung.github.io/zh/tags/python/>Python</a></li></ul><nav class=paginav><a class=prev href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/><span class=title>« 上一页</span><br><span>测试技能进阶(三): Property Based Testing</span>
</a><a class=next href=https://ramsayleung.github.io/zh/post/2024/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C%E6%96%B9%E6%A1%88_merkle_tree/><span class=title>下一页 »</span><br><span>区块链的完整性校验方案: Merkle Tree</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on x" href="https://x.com/intent/tweet/?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f&amp;hashtags=testing%2crust%2cpython"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f&amp;title=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests&amp;summary=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests&amp;source=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on reddit" href="https://reddit.com/submit?url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f&title=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on whatsapp" href="https://api.whatsapp.com/send?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests%20-%20https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on telegram" href="https://telegram.me/share/url?text=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 测试技能进阶(二): Parameterized Tests on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e6%b5%8b%e8%af%95%e6%8a%80%e8%83%bd%e8%bf%9b%e9%98%b6%28%e4%ba%8c%29%3a%20Parameterized%20Tests&u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2024%2f%25E6%25B5%258B%25E8%25AF%2595%25E6%258A%2580%25E8%2583%25BD%25E8%25BF%259B%25E9%2598%25B6%25E4%25BA%258C_parameterized_tests%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><section><h2>Comments</h2><div id=comments-giscus></div></section><script type=text/javascript>function getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||document.body.classList.contains("dark")?"dark":"light"}function setGiscusTheme(e=!1){const s=e?"dark":"light";var n,t=document.querySelector(".giscus-frame");t&&(n=new URL(t.src),n.searchParams.set("theme",s),t.src=n.toString())}function loadComment(e=!1){const n="zh"=="zh",t=document.getElementById("comments-giscus");if(t!==null&&!t.hasAttribute("data-giscus-loaded")){console.log("Initial giscus load");const s=document.createElement("script");s.setAttribute("src","https://giscus.app/client.js"),s.setAttribute("data-repo","ramsayleung/comment"),s.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkzMDk2NjQ1NDk="),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOEnUbJc4Cltnz"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",e?"dark":"light"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("data-lang",n?"zh-CN":"en"),s.setAttribute("async","true"),t.appendChild(s),t.setAttribute("data-giscus-loaded","true")}}let currentTheme=getCurrentTheme();loadComment(currentTheme==="dark");const themeObserver=new MutationObserver(e=>{e.forEach(e=>{if(e.type==="attributes"&&e.attributeName==="class"){const e=getCurrentTheme();e!==currentTheme&&(currentTheme=e,setGiscusTheme(currentTheme==="dark"))}})});themeObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/ramsayleung/ramsayleung.github.io>here</a>, licensed under GPLv3 ·</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>