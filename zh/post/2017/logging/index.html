<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>你所不可或缺的 – logging | 自由庄园</title><meta name=keywords content="python,log"><meta name=description content="an introduction about logging"><meta name=author content="Ramsay Leung"><link rel=canonical href=https://ramsayleung.github.io/zh/post/2017/logging/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ramsayleung.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ramsayleung.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ramsayleung.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ramsayleung.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ramsayleung.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://ramsayleung.github.io/zh/post/2017/logging/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MG65HQHEL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MG65HQHEL",{anonymize_ip:!1})}</script><meta property="og:title" content="你所不可或缺的 – logging"><meta property="og:description" content="an introduction about logging"><meta property="og:type" content="article"><meta property="og:url" content="https://ramsayleung.github.io/zh/post/2017/logging/"><meta property="og:image" content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-04-09T00:00:00+08:00"><meta property="article:modified_time" content="2022-02-23T21:48:13+08:00"><meta property="og:site_name" content="自由庄园"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="你所不可或缺的 – logging"><meta name=twitter:description content="an introduction about logging"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"你所不可或缺的 – logging","item":"https://ramsayleung.github.io/zh/post/2017/logging/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"你所不可或缺的 – logging","name":"你所不可或缺的 – logging","description":"an introduction about logging","keywords":["python","log"],"articleBody":"1 重要性 笔者最近都在负责项目中关于日志的部分，因为跟日志打交道比较多，所以有一些关于日 志感受和技巧想要分享一下。\n笔者认为对于各种程序和应用，日志都是非常重要的，因为程序在部属到服务器之后，开发者是没办法像在本地开发那样可以充分了解程序发生的状况，而使用日志可以让开发者了解运行中的程序的状态，即使出现了错误，或者是系统挂了，也可以从日志中分析原因。\n所以换句话说，日志的重要程度甚至可以称得上是不可或缺。接下来，笔者将会以 Python 中的 logging 模块为例阐述日志。\n2 关于日志 2.1 使用 print 函数输出？ 日志是为了输出程序的运行状态，那么可否使用 print 函数进行 logging 的工作呢？\n我并不建议把 print() 函数当作日志使用 (当然，如果你一定要这么用，我也拦不住)；不建议使用 print 进行logging 原因有：\n无法在不修改源代码的情况下，控制日志的输出 日志信息可能跟程序输出的有用数据混杂，导致输出的数据不可读或者非常难读 print 无法将日志信息输出到除标准输出以外的目标 (例如文件，socket,SMTP 服务器等) 无法根据错误信息的等级进行动态输出，因为 print 函数的作用只是输出信息 可能对于非常简单的小程序，开发者可以使用 print 进行日志输出，但是对于比较大型的程序，系统内置的 logging 类库或许是更好的选择\n2.2 日志需要记录的是什么 Python 的日志类库 logging 可以让开发者根据不同场景使用不同的日志等级以输出 不同的日志信息。\n而日志需要记录的最基本的信息又是什么呢？要想回答这个问题，先和我一起回顾一下日志的功能：记录程序的状态，为程序的开发和调试提供便利！\n所谓方便调试，需要记录的必然包括可以帮助更快定位到错误的有用信息：\nLogger 的名字 (比较常用的做法都是 __name__,即当前文件的信息) 具体日期 (这个可以帮助确定出错的具体场景) 方法名 源代码行数 异常的 traceback 信息 这只是最基本的信息，具体还要根据场景添加其它有用信息；比如对于分布式的程序，肯定还要记录其它节点的名字，IP 等有用信息。\n3 Logging 的正确姿势 3.1 使用 Python 的 logging 模块 我认为，使用 Python 的标准日志库是比较好的实践，因为标准库已经提供了开箱即用的特性，无需重复造轮子。Python 的 logging 模块也很容易上手，举个小例子：\nimport logging logging.basicConfig(level=logging.DEBUG) # define a logger logger = logging.getLogger(__name__) #Info level msg logger.info('Info level message') #Debug level msg logger.debug('Debug level message') #Warning level msg logger.info('Warning level message') 日志输出如下：\nINFO:__main__: Info level message DEBUG:__main__: Debug level message WARN:__main__: Warning level message 3.2 记录异常信息 日志一个非常重要的作用就是调试，所以记录出现异常的地方是有必要，并且需要记录栈的调用信息。例如：\ntry: open('file_not_exist.txt', 'wt') except Exception, e: logger.error('Failed to write a file',exc_info=True) 通过将 exc_info 设置成 True, 栈的调用信息就会记录到日志里面。而也可以使用 logger.exception(message,*args) 方法，它等同于 logger.error(msg,exc_info=True,*args) 方法。\n3.3 使用日志文件轮转控制器 (rotating file handler) 如果使用日志文件控制器 (FileHandler), 不断地运行程序，就会产生越来越多的日志 信息或者是日志文件。\n为了控制日志文件的数量，可以使用 RotatingFileHandler 自 动新建新的日志文件，并且保留旧的日志文件，当产生一定数量的日志文件之后，就会 自动删除掉最旧的日志文件。例如：\nhandler = logging.handlers.RotatingFileHandler( LOG_FILENAME, maxBytes=20, backupCount=5, ) my_logger.addHandler(handler) 就是日志文件大小超过20个字节 (当然，真实情况不会那么小的阀值)，就创建一个新的日志文件，把原来的日志文件，例如叫 example.log 重命名为 example.log.1,然后新建的日志文件就会被命名为_example.log_, 一直到产生了6个日志文件，即 example.log.5, 继续记录日志，最开始的第一个日志就会被删除。\n3.4 使用日志服务器 对于那些分布式的应用，或者部署多台服务器上有不同日志的程序而言，逐个服务器或者节点查看日志实在太可怕了. 这个时候，就可以设置一个日志服务器，把重要的日志信息发送到日志服务器，你就在日志服务器上监控各个节点的日志状态了。\nlogging-cookbook 的例子：\n客户端或者节点：\nimport logging import logging.handlers rootLogger = logging.getLogger('') rootLogger.setLevel(logging.DEBUG) socketHandler = logging.handlers.SocketHandler('localhost', logging.handlers.DEFAULT_TCP_LOGGING_PORT) # don't bother with a formatter, since a socket handler sends the event as # an unformatted pickle rootLogger.addHandler(socketHandler) # Now, we can log to the root logger, or any other logger. First the root... logging.info('Jackdaws love my big sphinx of quartz.') # Now, define a couple of other loggers which might represent areas in your # application: logger1 = logging.getLogger('myapp.area1') logger2 = logging.getLogger('myapp.area2') logger1.debug('Quick zephyrs blow, vexing daft Jim.') logger1.info('How quickly daft jumping zebras vex.') logger2.warning('Jail zesty vixen who grabbed pay from quack.') logger2.error('The five boxing wizards jump quickly.') 日志服务器：\nimport logging import logging.handlers import pickle import socketserver import struct class LogRecordStreamHandler(socketserver.StreamRequestHandler): \"\"\"Handler for a streaming logging request. This basically logs the record using whatever logging policy is configured locally. \"\"\" def handle(self): \"\"\" Handle multiple requests - each expected to be a 4-byte length, followed by the LogRecord in pickle format. Logs the record according to whatever policy is configured locally. \"\"\" while True: chunk = self.connection.recv(4) if len(chunk) \u003c 4: break slen = struct.unpack('\u003eL', chunk)[0] chunk = self.connection.recv(slen) while len(chunk) \u003c slen: chunk = chunk + self.connection.recv(slen - len(chunk)) obj = self.unPickle(chunk) record = logging.makeLogRecord(obj) self.handleLogRecord(record) def unPickle(self, data): return pickle.loads(data) def handleLogRecord(self, record): # if a name is specified, we use the named logger rather than the one # implied by the record. if self.server.logname is not None: name = self.server.logname else: name = record.name logger = logging.getLogger(name) # N.B. EVERY record gets logged. This is because Logger.handle # is normally called AFTER logger-level filtering. If you want # to do filtering, do it at the client end to save wasting # cycles and network bandwidth! logger.handle(record) class LogRecordSocketReceiver(socketserver.ThreadingTCPServer): \"\"\" Simple TCP socket-based logging receiver suitable for testing. \"\"\" allow_reuse_address = True def __init__(self, host='localhost', port=logging.handlers.DEFAULT_TCP_LOGGING_PORT, handler=LogRecordStreamHandler): socketserver.ThreadingTCPServer.__init__(self, (host, port), handler) self.abort = 0 self.timeout = 1 self.logname = None def serve_until_stopped(self): import select abort = 0 while not abort: rd, wr, ex = select.select([self.socket.fileno()], [], [], self.timeout) if rd: self.handle_request() abort = self.abort def main(): logging.basicConfig( format='%(relativeCreated)5d %(name)-15s %(levelname)-8s %(message)s') tcpserver = LogRecordSocketReceiver() print('About to start TCP server...') tcpserver.serve_until_stopped() if __name__ == '__main__': main() 通过给 logger 添加一个SocketHandler 就可以把日志事件发送到服务器端\n3.5 使用配置文件 虽然开发者可以使用 Python 代码来配置日志系统，但是这样是很不灵活的，每次修改日志等级还需要去改动代码。\n而使用配置文件无疑是一个更好的选择，例如 json 或者是 yaml 文件，这样就可以在 json/yaml 文件中加载日志配置了。以 Django 项目的配置文件为例，我改成了 json 格式：\n{ \"version\": 1, \"disable_existing_loggers\": True, \"formatters\": { \"verbose\": { \"format\": \"%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s\" }, \"simple\": { \"format\": \"%(levelname)s %(message)s\" }, }, \"filters\": { \"special\": { \"()\": \"project.logging.SpecialFilter\", \"foo\": \"bar\", } }, \"handlers\": { \"null\": { \"level\": \"DEBUG\", \"class\": \"django.utils.log.NullHandler\", }, \"console\": { \"level\": \"DEBUG\", \"class\": \"logging.StreamHandler\", \"formatter\": \"simple\" }, \"mail_admins\": { \"level\": \"ERROR\", \"class\": \"django.utils.log.AdminEmailHandler\", \"filters\": \"special\" } }, \"loggers\": { \"django\": { \"handlers\": \"null\", \"propagate\": true, \"level\": \"INFO\", }, \"django.request\": { \"handlers\": [\"mail_admins\"], \"level\": \"ERROR\", \"propagate\": false, }, \"myproject.custom\": { \"handlers\": [\"console\", \"mail_admins\"], \"level\": \"INFO\", \"filters\": [\"special\"] } } } 以及加载 json 文件到日志配置中：\nimport json import logging.config def setup_logging(): \"\"\" Setup logging configuration \"\"\" with open('logging_configuration.json', 'rt') as f: config = json.load(f) logging.config.dictConfig(config) 使用 json 还有一个好处是标准库已经内置了 json 模块，无需像 yaml 那样需要安装额外的模块，不过我更推崇 yaml, 因为清晰之余，还可以少打很多字 :)\n3.6 对于不同的代码，使用不同的日志等级 因为一个项目不同代码要求不一样，也无需把每一个实现细节都记录在日志，只需要根 据不同的实现，使用不同的日志等级，例如使用 Debug 记录系统启动，处理业务逻辑 请求的信息，使用 Error, 记录系统的出错信息，可以结合堆栈分析原因，等等。\n此外，Logger 实例可以被配置成基于名字的树状结构。 每一个部件都定义了一个基础的名字，对应的模块被设置成子节点。而 root logger 没有名字。如图：\n就配置 logging 而言，我认为树状结构是非常有用的，因为无需为每一个 logger 都设置handler. 如果一个 logger 没有 handler 的话，它就会让父节点来处理。所以 对于对于大部份的应用而言，只需配置 root logger, 而所有的信息都会发送到同一个 地方\n而树状结构可以对应用的不同部分使用不同的日志等级，不同的 handler, 不同的formatter, 以更好地控制日志信息\n3.7 使用结构化日志 虽然大部份的日志信息对于人类都是可读的，但是对于程序而言，就很难进行解析了。\n这个时候，为了方便程序进行解析，我建议使用结构化格式的日志，这样就不再需要各种复杂的正则表达式来解析日志了。得益于内置的 json 模块，使用 json 就可以很简单地生成的利于程序解析结构化日志，以 logging cookbook 中的例子说明：\nimport json import logging class StructuredMessage(object): def __init__(self, message, **kwargs): self.message = message self.kwargs = kwargs def __str__(self): return '%s \u003e\u003e\u003e %s' % (self.message, json.dumps(self.kwargs)) _ = StructuredMessage # optional, to improve readability logging.basicConfig(level=logging.INFO, format='%(message)s') logging.info(_('message 1', foo='bar', bar='baz', num=123, fnum=123.456)) 日志输出结果如下：\nmessage 1 \u003e\u003e\u003e {\"fnum\": 123.456, \"num\": 123, \"bar\": \"baz\", \"foo\": \"bar\"} 3.8 参考 https://logmatic.io/blog/python-logging-with-json-steroids/ https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/ https://docs.python.org/3/howto/logging-cookbook.html https://pymotw.com/3/logging/index.html 3.9 小结 虽然这次的日志阐述是以 Python 的日志模块举例，但是绝大部分的语言都内置或者是有第三方的日志支持，所以我分享的技巧还是可以应用到其他的语言的。\n这些都是我在日常项目中的一点体会，与诸君共赏罢。Enjoy :)\n","wordCount":"2804","inLanguage":"zh","datePublished":"2017-04-09T00:00:00+08:00","dateModified":"2022-02-23T21:48:13+08:00","author":{"@type":"Person","name":"Ramsay Leung"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ramsayleung.github.io/zh/post/2017/logging/"},"publisher":{"@type":"Organization","name":"自由庄园","logo":{"@type":"ImageObject","url":"https://ramsayleung.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ramsayleung.github.io/zh/ accesskey=h title="Home (Alt + H)"><img src=https://ramsayleung.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ramsayleung.github.io/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://ramsayleung.github.io/zh/archives/ title=归档><span>归档</span></a></li><li><a href=https://ramsayleung.github.io/zh/search/ title=搜索><span>搜索</span></a></li><li><a href=https://ramsayleung.github.io/zh/categories/ title=目录><span>目录</span></a></li><li><a href=https://ramsayleung.github.io/zh/tags/ title=标签><span>标签</span></a></li><li><a href=https://ramsayleung.github.io/zh/about_me_zh/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ramsayleung.github.io/zh/>主页</a></div><h1 class=post-title>你所不可或缺的 – logging</h1><div class=post-description>an introduction about logging</div><div class=post-meta><span title='2017-04-09 00:00:00 +0800 +0800'>四月 9, 2017</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;2804 字&nbsp;·&nbsp;Ramsay Leung&nbsp;|&nbsp;<a href=https://github.com/ramsayleung/ramsayleung.github.io/blob/master/content/post/2017/logging.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#重要性>1 重要性</a></li><li><a href=#关于日志>2 关于日志</a><ul><li><a href=#使用-print-函数输出>2.1 使用 print 函数输出？</a></li><li><a href=#日志需要记录的是什么>2.2 日志需要记录的是什么</a></li></ul></li><li><a href=#logging-的正确姿势>3 Logging 的正确姿势</a><ul><li><a href=#使用-python-的-logging-模块>3.1 使用 Python 的 logging 模块</a></li><li><a href=#记录异常信息>3.2 记录异常信息</a></li><li><a href=#使用日志文件轮转控制器--rotating-file-handler>3.3 使用日志文件轮转控制器 (rotating file handler)</a></li><li><a href=#使用日志服务器>3.4 使用日志服务器</a></li><li><a href=#使用配置文件>3.5 使用配置文件</a></li><li><a href=#对于不同的代码-使用不同的日志等级>3.6 对于不同的代码，使用不同的日志等级</a></li><li><a href=#使用结构化日志>3.7 使用结构化日志</a></li><li><a href=#参考>3.8 参考</a></li><li><a href=#小结>3.9 小结</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=重要性>1 重要性<a hidden class=anchor aria-hidden=true href=#重要性>#</a></h2><p>笔者最近都在负责项目中关于日志的部分，因为跟日志打交道比较多，所以有一些关于日 志感受和技巧想要分享一下。</p><p>笔者认为对于各种程序和应用，日志都是非常重要的，因为程序在部属到服务器之后，开发者是没办法像在本地开发那样可以充分了解程序发生的状况，而使用日志可以让开发者了解运行中的程序的状态，即使出现了错误，或者是系统挂了，也可以从日志中分析原因。</p><p>所以换句话说，日志的重要程度甚至可以称得上是不可或缺。接下来，笔者将会以 Python 中的 <em>logging</em> 模块为例阐述日志。</p><h2 id=关于日志>2 关于日志<a hidden class=anchor aria-hidden=true href=#关于日志>#</a></h2><h3 id=使用-print-函数输出>2.1 使用 print 函数输出？<a hidden class=anchor aria-hidden=true href=#使用-print-函数输出>#</a></h3><p>日志是为了输出程序的运行状态，那么可否使用 <code>print</code> 函数进行 logging 的工作呢？</p><p>我并不建议把 <code>print()</code> 函数当作日志使用 (当然，如果你一定要这么用，我也拦不住)；不建议使用 <strong>print</strong> 进行logging 原因有：</p><ol><li>无法在不修改源代码的情况下，控制日志的输出</li><li>日志信息可能跟程序输出的有用数据混杂，导致输出的数据不可读或者非常难读</li><li>print 无法将日志信息输出到除标准输出以外的目标 (例如文件，socket,SMTP 服务器等)</li><li>无法根据错误信息的等级进行动态输出，因为 <strong>print</strong> 函数的作用只是输出信息</li></ol><p>可能对于非常简单的小程序，开发者可以使用 print 进行日志输出，但是对于比较大型的程序，系统内置的 logging 类库或许是更好的选择</p><h3 id=日志需要记录的是什么>2.2 日志需要记录的是什么<a hidden class=anchor aria-hidden=true href=#日志需要记录的是什么>#</a></h3><p>Python 的日志类库 <code>logging</code> 可以让开发者根据不同场景使用不同的日志等级以输出 不同的日志信息。</p><p>而日志需要记录的最基本的信息又是什么呢？要想回答这个问题，先和我一起回顾一下日志的功能：记录程序的状态，为程序的开发和调试提供便利！</p><p>所谓方便调试，需要记录的必然包括可以帮助更快定位到错误的有用信息：</p><ol><li>Logger 的名字 (比较常用的做法都是 <strong>__name__</strong>,即当前文件的信息)</li><li>具体日期 (这个可以帮助确定出错的具体场景)</li><li>方法名</li><li>源代码行数</li><li>异常的 traceback 信息</li></ol><p>这只是最基本的信息，具体还要根据场景添加其它有用信息；比如对于分布式的程序，肯定还要记录其它节点的名字，IP 等有用信息。</p><h2 id=logging-的正确姿势>3 Logging 的正确姿势<a hidden class=anchor aria-hidden=true href=#logging-的正确姿势>#</a></h2><h3 id=使用-python-的-logging-模块>3.1 使用 Python 的 logging 模块<a hidden class=anchor aria-hidden=true href=#使用-python-的-logging-模块>#</a></h3><p>我认为，使用 Python 的标准日志库是比较好的实践，因为标准库已经提供了开箱即用的特性，无需重复造轮子。Python 的 logging 模块也很容易上手，举个小例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># define a logger</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Info level msg</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Info level message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#Debug level msg</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Debug level message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#Warning level msg</span>
</span></span><span class=line><span class=cl><span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Warning level message&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>日志输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>INFO:__main__: Info level message
</span></span><span class=line><span class=cl>DEBUG:__main__: Debug level message
</span></span><span class=line><span class=cl>WARN:__main__: Warning level message
</span></span></code></pre></div><h3 id=记录异常信息>3.2 记录异常信息<a hidden class=anchor aria-hidden=true href=#记录异常信息>#</a></h3><p>日志一个非常重要的作用就是调试，所以记录出现异常的地方是有必要，并且需要记录栈的调用信息。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;file_not_exist.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;wt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>Exception</span><span class=p>,</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s1>&#39;Failed to write a file&#39;</span><span class=p>,</span><span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><p>通过将 <code>exc_info</code> 设置成 True, 栈的调用信息就会记录到日志里面。而也可以使用 <code>logger.exception(message,*args)</code> 方法，它等同于 <code>logger.error(msg,exc_info=True,*args)</code> 方法。</p><h3 id=使用日志文件轮转控制器--rotating-file-handler>3.3 使用日志文件轮转控制器 (rotating file handler)<a hidden class=anchor aria-hidden=true href=#使用日志文件轮转控制器--rotating-file-handler>#</a></h3><p>如果使用日志文件控制器 (FileHandler), 不断地运行程序，就会产生越来越多的日志 信息或者是日志文件。</p><p>为了控制日志文件的数量，可以使用 <code>RotatingFileHandler</code> 自 动新建新的日志文件，并且保留旧的日志文件，当产生一定数量的日志文件之后，就会 自动删除掉最旧的日志文件。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>handlers</span><span class=o>.</span><span class=n>RotatingFileHandler</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>LOG_FILENAME</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>maxBytes</span><span class=o>=</span><span class=mi>20</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>backupCount</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>my_logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>handler</span><span class=p>)</span>
</span></span></code></pre></div><p>就是日志文件大小超过20个字节 (当然，真实情况不会那么小的阀值)，就创建一个新的日志文件，把原来的日志文件，例如叫 <em>example.log</em> 重命名为 <em>example.log.1</em>,然后新建的日志文件就会被命名为_example.log_, 一直到产生了6个日志文件，即 <em>example.log.5</em>, 继续记录日志，最开始的第一个日志就会被删除。</p><h3 id=使用日志服务器>3.4 使用日志服务器<a hidden class=anchor aria-hidden=true href=#使用日志服务器>#</a></h3><p>对于那些分布式的应用，或者部署多台服务器上有不同日志的程序而言，逐个服务器或者节点查看日志实在太可怕了. 这个时候，就可以设置一个日志服务器，把重要的日志信息发送到日志服务器，你就在日志服务器上监控各个节点的日志状态了。</p><p><a href=https://docs.python.org/3/howto/logging-cookbook.html>logging-cookbook</a> 的例子：</p><p>客户端或者节点：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging.handlers</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rootLogger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rootLogger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>socketHandler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>handlers</span><span class=o>.</span><span class=n>SocketHandler</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>						    <span class=n>logging</span><span class=o>.</span><span class=n>handlers</span><span class=o>.</span><span class=n>DEFAULT_TCP_LOGGING_PORT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># don&#39;t bother with a formatter, since a socket handler sends the event as</span>
</span></span><span class=line><span class=cl><span class=c1># an unformatted pickle</span>
</span></span><span class=line><span class=cl><span class=n>rootLogger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>socketHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Now, we can log to the root logger, or any other logger. First the root...</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Jackdaws love my big sphinx of quartz.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Now, define a couple of other loggers which might represent areas in your</span>
</span></span><span class=line><span class=cl><span class=c1># application:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger1</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;myapp.area1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger2</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;myapp.area2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logger1</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s1>&#39;Quick zephyrs blow, vexing daft Jim.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger1</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;How quickly daft jumping zebras vex.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger2</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s1>&#39;Jail zesty vixen who grabbed pay from quack.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger2</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s1>&#39;The five boxing wizards jump quickly.&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>日志服务器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging.handlers</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pickle</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socketserver</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>struct</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LogRecordStreamHandler</span><span class=p>(</span><span class=n>socketserver</span><span class=o>.</span><span class=n>StreamRequestHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Handler for a streaming logging request.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    This basically logs the record using whatever logging policy is
</span></span></span><span class=line><span class=cl><span class=s2>    configured locally.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>	Handle multiple requests - each expected to be a 4-byte length,
</span></span></span><span class=line><span class=cl><span class=s2>	followed by the LogRecord in pickle format. Logs the record
</span></span></span><span class=line><span class=cl><span class=s2>	according to whatever policy is configured locally.
</span></span></span><span class=line><span class=cl><span class=s2>	&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	    <span class=n>chunk</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span>
</span></span><span class=line><span class=cl>	    <span class=n>slen</span> <span class=o>=</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s1>&#39;&gt;L&#39;</span><span class=p>,</span> <span class=n>chunk</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	    <span class=n>chunk</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>slen</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>slen</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>chunk</span> <span class=o>=</span> <span class=n>chunk</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>connection</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>slen</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>chunk</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=n>obj</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>unPickle</span><span class=p>(</span><span class=n>chunk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>record</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>makeLogRecord</span><span class=p>(</span><span class=n>obj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>handleLogRecord</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>unPickle</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handleLogRecord</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>record</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=c1># if a name is specified, we use the named logger rather than the one</span>
</span></span><span class=line><span class=cl>	<span class=c1># implied by the record.</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>logname</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	    <span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>server</span><span class=o>.</span><span class=n>logname</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	    <span class=n>name</span> <span class=o>=</span> <span class=n>record</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>	    <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	    <span class=c1># N.B. EVERY record gets logged. This is because Logger.handle</span>
</span></span><span class=line><span class=cl>	    <span class=c1># is normally called AFTER logger-level filtering. If you want</span>
</span></span><span class=line><span class=cl>	    <span class=c1># to do filtering, do it at the client end to save wasting</span>
</span></span><span class=line><span class=cl>	    <span class=c1># cycles and network bandwidth!</span>
</span></span><span class=line><span class=cl>	<span class=n>logger</span><span class=o>.</span><span class=n>handle</span><span class=p>(</span><span class=n>record</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>LogRecordSocketReceiver</span><span class=p>(</span><span class=n>socketserver</span><span class=o>.</span><span class=n>ThreadingTCPServer</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Simple TCP socket-based logging receiver suitable for testing.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>allow_reuse_address</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		 <span class=n>port</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>handlers</span><span class=o>.</span><span class=n>DEFAULT_TCP_LOGGING_PORT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		 <span class=n>handler</span><span class=o>=</span><span class=n>LogRecordStreamHandler</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>socketserver</span><span class=o>.</span><span class=n>ThreadingTCPServer</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=p>(</span><span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>),</span> <span class=n>handler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>abort</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>timeout</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>logname</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>serve_until_stopped</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=kn>import</span> <span class=nn>select</span>
</span></span><span class=line><span class=cl>	<span class=n>abort</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=ow>not</span> <span class=n>abort</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	    <span class=n>rd</span><span class=p>,</span> <span class=n>wr</span><span class=p>,</span> <span class=n>ex</span> <span class=o>=</span> <span class=n>select</span><span class=o>.</span><span class=n>select</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>socket</span><span class=o>.</span><span class=n>fileno</span><span class=p>()],</span>
</span></span><span class=line><span class=cl>					    <span class=p>[],</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>					    <span class=bp>self</span><span class=o>.</span><span class=n>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	    <span class=k>if</span> <span class=n>rd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=bp>self</span><span class=o>.</span><span class=n>handle_request</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=n>abort</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>abort</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nb>format</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%(relativeCreated)5d</span><span class=s1> </span><span class=si>%(name)-15s</span><span class=s1> </span><span class=si>%(levelname)-8s</span><span class=s1> </span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tcpserver</span> <span class=o>=</span> <span class=n>LogRecordSocketReceiver</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;About to start TCP server...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tcpserver</span><span class=o>.</span><span class=n>serve_until_stopped</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>通过给 logger 添加一个SocketHandler 就可以把日志事件发送到服务器端</p><h3 id=使用配置文件>3.5 使用配置文件<a hidden class=anchor aria-hidden=true href=#使用配置文件>#</a></h3><p>虽然开发者可以使用 Python 代码来配置日志系统，但是这样是很不灵活的，每次修改日志等级还需要去改动代码。</p><p>而使用配置文件无疑是一个更好的选择，例如 json 或者是 yaml 文件，这样就可以在 json/yaml 文件中加载日志配置了。以 <a href=https://docs.djangoproject.com/en/1.9/topics/logging/#configuring-logging>Django</a> 项目的配置文件为例，我改成了 json 格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;disable_existing_loggers&#34;</span><span class=p>:</span> <span class=err>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;formatters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;verbose&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;simple&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;%(levelname)s %(message)s&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;filters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;special&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;()&#34;</span><span class=p>:</span> <span class=s2>&#34;project.logging.SpecialFilter&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;foo&#34;</span><span class=p>:</span> <span class=s2>&#34;bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;handlers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;null&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;class&#34;</span><span class=p>:</span> <span class=s2>&#34;django.utils.log.NullHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;console&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;DEBUG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;class&#34;</span><span class=p>:</span> <span class=s2>&#34;logging.StreamHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;formatter&#34;</span><span class=p>:</span> <span class=s2>&#34;simple&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;mail_admins&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;class&#34;</span><span class=p>:</span> <span class=s2>&#34;django.utils.log.AdminEmailHandler&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;filters&#34;</span><span class=p>:</span> <span class=s2>&#34;special&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;loggers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;django&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;handlers&#34;</span><span class=p>:</span> <span class=s2>&#34;null&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;propagate&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;django.request&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;handlers&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;mail_admins&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;ERROR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;propagate&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;myproject.custom&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;handlers&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;console&#34;</span><span class=p>,</span> <span class=s2>&#34;mail_admins&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;level&#34;</span><span class=p>:</span> <span class=s2>&#34;INFO&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	    <span class=nt>&#34;filters&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;special&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>以及加载 json 文件到日志配置中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging.config</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup_logging</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Setup logging configuration
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;logging_configuration.json&#39;</span><span class=p>,</span> <span class=s1>&#39;rt&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>	<span class=n>config</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>logging</span><span class=o>.</span><span class=n>config</span><span class=o>.</span><span class=n>dictConfig</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span></span></code></pre></div><p>使用 json 还有一个好处是标准库已经内置了 json 模块，无需像 yaml 那样需要安装额外的模块，不过我更推崇 yaml, 因为清晰之余，还可以少打很多字 :)</p><h3 id=对于不同的代码-使用不同的日志等级>3.6 对于不同的代码，使用不同的日志等级<a hidden class=anchor aria-hidden=true href=#对于不同的代码-使用不同的日志等级>#</a></h3><p>因为一个项目不同代码要求不一样，也无需把每一个实现细节都记录在日志，只需要根 据不同的实现，使用不同的日志等级，例如使用 <code>Debug</code> 记录系统启动，处理业务逻辑 请求的信息，使用 <code>Error</code>, 记录系统的出错信息，可以结合堆栈分析原因，等等。</p><p>此外，Logger 实例可以被配置成基于名字的树状结构。 每一个部件都定义了一个基础的名字，对应的模块被设置成子节点。而 root logger 没有名字。如图：</p><figure><a href=/ox-hugo/example_logger_tree.png><img loading=lazy src=/ox-hugo/example_logger_tree.png></a></figure><p>就配置 <code>logging</code> 而言，我认为树状结构是非常有用的，因为无需为每一个 logger 都设置handler. 如果一个 logger 没有 handler 的话，它就会让父节点来处理。所以 对于对于大部份的应用而言，只需配置 root logger, 而所有的信息都会发送到同一个 地方</p><figure><a href=/ox-hugo/one_logger_handler.png><img loading=lazy src=/ox-hugo/one_logger_handler.png></a></figure><p>而树状结构可以对应用的不同部分使用不同的日志等级，不同的 handler, 不同的formatter, 以更好地控制日志信息</p><h3 id=使用结构化日志>3.7 使用结构化日志<a hidden class=anchor aria-hidden=true href=#使用结构化日志>#</a></h3><p>虽然大部份的日志信息对于人类都是可读的，但是对于程序而言，就很难进行解析了。</p><p>这个时候，为了方便程序进行解析，我建议使用结构化格式的日志，这样就不再需要各种复杂的正则表达式来解析日志了。得益于内置的 json 模块，使用 json 就可以很简单地生成的利于程序解析结构化日志，以 <a href=https://docs.python.org/3/howto/logging-cookbook.html>logging cookbook</a> 中的例子说明：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>StructuredMessage</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>message</span> <span class=o>=</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>	<span class=bp>self</span><span class=o>.</span><span class=n>kwargs</span> <span class=o>=</span> <span class=n>kwargs</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1> &gt;&gt;&gt; </span><span class=si>%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>message</span><span class=p>,</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>kwargs</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>_</span> <span class=o>=</span> <span class=n>StructuredMessage</span>   <span class=c1># optional, to improve readability</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=n>_</span><span class=p>(</span><span class=s1>&#39;message 1&#39;</span><span class=p>,</span> <span class=n>foo</span><span class=o>=</span><span class=s1>&#39;bar&#39;</span><span class=p>,</span> <span class=n>bar</span><span class=o>=</span><span class=s1>&#39;baz&#39;</span><span class=p>,</span> <span class=n>num</span><span class=o>=</span><span class=mi>123</span><span class=p>,</span> <span class=n>fnum</span><span class=o>=</span><span class=mf>123.456</span><span class=p>))</span>
</span></span></code></pre></div><p>日志输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=err>message</span> <span class=mi>1</span> <span class=err>&gt;&gt;&gt;</span> <span class=p>{</span><span class=nt>&#34;fnum&#34;</span><span class=p>:</span> <span class=mf>123.456</span><span class=p>,</span> <span class=nt>&#34;num&#34;</span><span class=p>:</span> <span class=mi>123</span><span class=p>,</span> <span class=nt>&#34;bar&#34;</span><span class=p>:</span> <span class=s2>&#34;baz&#34;</span><span class=p>,</span> <span class=nt>&#34;foo&#34;</span><span class=p>:</span> <span class=s2>&#34;bar&#34;</span><span class=p>}</span>
</span></span></code></pre></div><h3 id=参考>3.8 参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h3><ul><li><a href=https://logmatic.io/blog/python-logging-with-json-steroids/>https://logmatic.io/blog/python-logging-with-json-steroids/</a></li><li><a href=https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/>https://fangpenlin.com/posts/2012/08/26/good-logging-practice-in-python/</a></li><li><a href=https://docs.python.org/3/howto/logging-cookbook.html>https://docs.python.org/3/howto/logging-cookbook.html</a></li><li><a href=https://pymotw.com/3/logging/index.html>https://pymotw.com/3/logging/index.html</a></li></ul><h3 id=小结>3.9 小结<a hidden class=anchor aria-hidden=true href=#小结>#</a></h3><p>虽然这次的日志阐述是以 Python 的日志模块举例，但是绝大部分的语言都内置或者是有第三方的日志支持，所以我分享的技巧还是可以应用到其他的语言的。</p><p>这些都是我在日常项目中的一点体会，与诸君共赏罢。Enjoy :)</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ramsayleung.github.io/zh/tags/python/>python</a></li><li><a href=https://ramsayleung.github.io/zh/tags/log/>log</a></li></ul><nav class=paginav><a class=prev href=https://ramsayleung.github.io/zh/post/2017/spock/><span class=title>« 上一页</span><br><span>Spock 一个优雅的Groovy/Java测试框架</span></a>
<a class=next href=https://ramsayleung.github.io/zh/post/2017/bloom_filter/><span class=title>下一页 »</span><br><span>爬虫高效去重之布隆过滤器</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on twitter" href="https://twitter.com/intent/tweet/?text=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging&url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f&hashtags=python%2clog"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f&title=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging&summary=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging&source=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on reddit" href="https://reddit.com/submit?url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f&title=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on whatsapp" href="https://api.whatsapp.com/send?text=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging%20-%20https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 你所不可或缺的 – logging on telegram" href="https://telegram.me/share/url?text=%e4%bd%a0%e6%89%80%e4%b8%8d%e5%8f%af%e6%88%96%e7%bc%ba%e7%9a%84%20%e2%80%93%20logging&url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2017%2flogging%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=ramsayleung/comment issue-term=title theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/ramsayleung/ramsayleung.github.io>here</a>, licensed under GPLv3 ·</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>