<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 | 菠萝油与天光墟</title>
<meta name=keywords content="telegram,design,programming,rails,rust"><meta name=description content="English Version
系列文章：

基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路

1 序言
我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot)，项目开源在：https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram
Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。"><meta name=author content="Ramsay Leung"><link rel=canonical href=https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.756d16b9d1a19b0d7274ca93e0428bf24ca10b144104611c6875be78291ca07b.css integrity="sha256-dW0WudGhmw1ydMqT4EKL8kyhCxRBBGEcaHW+eCkcoHs=" rel="preload stylesheet" as=style><link rel=icon href=https://ramsayleung.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ramsayleung.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ramsayleung.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ramsayleung.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ramsayleung.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css integrity=sha384-5TcZemv2l/9On385z///+d7MSYlvIEw9FuZTIdZ14vJLqWphw7e7ZPuOiCHJcFCP crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js integrity=sha384-cMkvdD8LoxVzGF/RPUKAcvmm49FQ0oxwDF3BGKtDXcEc+T1b2N+teh/OJfpU0jr6 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js integrity=sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MG65HQHEL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9MG65HQHEL")}</script><meta property="og:url" content="https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/"><meta property="og:site_name" content="菠萝油与天光墟"><meta property="og:title" content="基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品"><meta property="og:description" content="English Version
系列文章：
基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路 1 序言 我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot)，项目开源在：https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-08-28T23:45:00-07:00"><meta property="article:modified_time" content="2025-09-27T17:44:09-07:00"><meta property="article:tag" content="Telegram"><meta property="article:tag" content="Design"><meta property="article:tag" content="Programming"><meta property="article:tag" content="Rails"><meta property="article:tag" content="Rust"><meta property="og:image" content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品"><meta name=twitter:description content="English Version
系列文章：

基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路

1 序言
我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot)，项目开源在：https://github.com/ramsayleung/bayes_spam_sniper
1.1 Telegram
Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ramsayleung.github.io/zh/post/"},{"@type":"ListItem","position":2,"name":"基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品","item":"https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品","name":"基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品","description":"English Version\n系列文章：\n基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路 1 序言 我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot)，项目开源在：https://github.com/ramsayleung/bayes_spam_sniper\n1.1 Telegram Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。\n","keywords":["telegram","design","programming","rails","rust"],"articleBody":"English Version\n系列文章：\n基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路 1 序言 我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 @BayesSpamSniperBot (https://t.me/BayesSpamSniperBot)，项目开源在：https://github.com/ramsayleung/bayes_spam_sniper\n1.1 Telegram Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。\n2 缘起 平时我跑步和做饭都习惯会听播客，而《软件那些事儿》1是我最喜欢的播客之一，主持人是栋哥 2, 我也因为喜欢栋哥的节目，趁机加了栋哥的电报频道。\n栋哥的电报频道汗牛充栋 3主要是用来发布播客信息， 之前打开过一段时间的留言功能，没有想到引来了一堆的币圈的用户来发广告，因此将评论功能就关了：\n另外一个我关注的频道 Ray Tracing 4也在吐槽币圈的广告，不堪其忧:\n3 黑客与画家 常见的 Telegram 广告机器人是大多是基于关键字的，通过匹配关键字进行文本拦截，非常容易被发垃圾广告的人绕过。\n被绕过的话主要是靠管理员人工删除。\n这不禁让我想起了保罗.格雷厄姆在《黑客与画家》一书在2002年介绍的情况：\n当时电子邮件兴起，也有非常多的垃圾邮件，常见的垃圾广告拦截方式是关键字匹配+邮件地址黑名单，但是既低效也容易被绕过。\n保罗.格雷厄姆就创造性地使用贝叶斯算法(Bayesian Theorem)实现了一个广告拦截器 5, 效果竟然出奇地好。\n对于 Telegram 的垃圾广告而言，这不是类似的问题嘛？\n那我岂不是可以用类似的解决方案来解决 Telegram 广告的问题嘛\n3.1 贝叶斯定理 提起概率算法，最经典的例子莫过于「抛硬币」这一古典概率——每次抛掷都是独立事件，前一次的结果不会影响下一次的概率。\n然而，现实中的很多场景并不能像抛硬币那样无限重复，事件之间也往往并非相互独立。\n这时候，贝叶斯定理就显示出其独特的价值。\n它是一种「由果溯因」的概率方法，用于在已知某些证据的条件下，更新我们对某一假设的置信程度。\n换句话说，贝叶斯算法能够根据不断出现的新证据，动态调整对某个事件发生概率的估计。\n简单来说，就像人脑的学习过程：我们原本有一个初步认知，在获得新信息之后，会据此修正原有的看法，进而调整下一步的行动。\n保罗·格雷厄姆就是通过贝叶斯定理，不断地根据已被标记为垃圾广告或者非垃圾广告的邮件，对新出现的邮件进行分类，判断其是否为垃圾广告。\n如果想更直观地理解贝叶斯定理，推荐两个讲解清晰、生动易懂的视频：\n《Bayes’ Theorem 贝叶斯定理》6(中文) 《Bayes theorem, the geometry of changing beliefs》7(英文) 4 架构设计 Telegram Bot 支持两种与 Telegram 服务器交互的模式，分别是：\nWebhook: Telegram 服务器会在 Bot 收到新消息时主动回调此前 Bot 注册的地址，Bot Server 只需要处理回调的消息\nLong Polling: Bot Server 一直轮询 Telegram 服务器，看是否有新消息，有就处理，本机器人使用的是此模式\n4.0.1 消息分析 Bot Server 收到消息之后，会派发到单独的 telegram_bot_worker 处理，然后根据预训练的模型判断是否是垃圾广告，如果是，调用 Bot API 删除消息。\n4.0.2 封禁并训练 Bot Server 收到消息之后，会派发到单独的 telegram_bot_worker 处理， telegram_bot_worker 会调用 bot API 删除消息并封禁用户，并插入一条训练数据，标记为垃圾广告(spam)\n保存训练数据会触发 hook, 创建一个训练消息，投递到消息队列 training, 会有另外的 worker classifier_trainer 订阅 training 消息，并使用新消息重新训练和更新模型\n使用队列和后台进程 classifier_trainer 来训练任务而非直接使用 telegram_bot_worker 主要是为了返回 Bot请求与训练模型解耦，否则随着模型规模的增大，训练时间会越来越长，响应时间会越来越长。\n解耦后就易于水平扩展了，在设计上为后续性能优化和扩展预留空间。\n5 Why Rails 看了我项目源代码的朋友，难免会浮起疑问，为什么使用 Ruby on Rails 实现的?\n因为我工作中会有用到JVM系的编程语言(Java/Kotlin/Scala)和 Rust, 所以我对 Java/Rust 相当熟悉，又觉得模型训练可能对性能要求很高，所以最开始的原型 8我是用 Rust 实现的，大概就花了半个多小时。\n但是当我想把原型扩展成 Telegram 机器人时，就发现需要处理相当多与机器人交互的逻辑，主要涉及到 API 与数据库操作，其中大部分都是和模型无关的，因此我又想到了 Ruby on Rails。\n论单个工程师做产品原型，就我个人而言，实在是没有比 Ruby on Rails 更高效的框架了，因此我就切换到 Ruby on Rails 去。\nRails 8 的新特性，把 Rails 向所谓的「一人全栈框架」又推进了不少，通过关系型数据库内置对消息队列 Solid Queue 的支持，甚至不再需要类似 Redis 这样的存储来支持队列实现。\n架构设计中的队列和后台进程，只需要几行代码就实现了，甚至不需要额外的配置，如果队列不存在，框架会自动创建：\n1 2 3 4 5 6 7 8 class ClassifierTrainerJob \u003c ApplicationJob # Job to train classifier asynchronously queue_as :training def perform(group_id, group_name) SpamClassifierService.rebuild_for_group(group_id, group_name) end end 得益于 Rails 强大的 ORM 框架，内置各种生命周期的 hook, 对新插入训练数据后触发后台进程重新训练模型的代码也只有寥寥几行：\n1 2 3 4 5 6 7 8 9 10 class TrainedMessage \u003c ApplicationRecord # Automatically train classifier after creating/updating a message after_create :retrain_classifier after_destroy :retrain_classifier def retrain_classifier # For efficiency, we could queue this as a background job ClassifierTrainerJob.perform_later(group_id, group_name) end end 在 Rails 各种内置强大工具的加持下，我只用了一天时间就把整个机器人的功能给实现出来了。\n看到这里，有朋友可能会担心性能，觉得 Ruby 性能不行，并且还是动态语言，不好维护。\n我持有的观点还是和之前的博文《编程十年的感悟》9一样：\n先跑起来再说，先做个原型跑起来，有用户愿意用你的产品再说， 当运行速度成为瓶颈时，你的业务肯定非常大了，肯定有足够的资源招一打程序员把项目优化成 Rust/C++, 甚至是汇编。\n没有用户，谈性能只是个伪命题。\n至于动态语言一时爽，代码维护火葬场，我也是相当认同的。\n因此我在为团队选型时我绝对不会考虑动态语言，只会上编译型的语言， 甚至是Rust这种强类型，但是现在只有我一个人来做原型，我自己是什么顺手就用什么的。\n5.1 Vibe Coding? Vibe Coding等AI编程概念可谓是铺天盖地，甚嚣尘上，难免会有朋友好奇我这个项目是否 Vibe Coding生成的。\n答案是，我尝试了几个小时之后，直接放弃了， Claude 4 和 Gemini 2.5 Pro 都试过了。\n开始是使用 Rust + Cloudflare Worker 的技术栈，Rust + Cloudflare Worker 是个相当小众的领域，训练语料少，Vibe Coding 出来的代码编译无法通过\n后面换成 Ruby on Rails, 问题还更严重了，Ruby 是弱类型的动态语言，语法写起来和英语一样，Rails 又还有很多黑魔法，所以到运行时才报错，代码生成省下来的开发时间，debug过程全补回来了。\n另外一个是 Vibe Coding 生成的代码很多都是没有设计的，比如把 Classifier 和 TrainedMessage 的类耦合在一起，在 Classifier 里面持久化 TrainedMessage\n又直接在 telegram_bot_worker 进程里面，接收到训练信息马上同步训练新模型，训练完再返回调用命令的结果，完全没考虑解耦接收训练语料和模型训练。\n只能说 Vibe Coding 非常适合 Rust 这样的强类型编译型语言，生成的出来的代码起码要编译通过，保证质量的下限。\n而对于那些说「一行代码都不用写/改，就能做出一个APP」的言论，此时我脑海不禁升起疑问？\n究竟是代码好到一行都不用改？还是开发者看不出症结所在，所以一行都不改？\n6 设计理念 开发完原型，在机器人整体功能可用之后，脑中又有不少的想法冒出来，当时就马不停蹄地给机器人加上， 因此机器人就支持快十个命令，还支持私聊和群聊的不同模式。\n加着加着，连我自己都疑惑起来：这么多的功能，有点像国内的各种大而全的App了，我不禁对此产生疑问：\n真的会有用户用这么多功能么？真的有用户会用这些功能嘛？太多功能不是也会有额外的心智负担嘛?\n我最喜欢的广告拦截器 Ublock Origin 10拦截效果非常好，但是使用起来却非常简单，易上手。\n想起《软件设计的哲学》11里面提到的设计理念，接口应该是简单易用的，但是功能可以是复杂丰富的。\n因此我只能忍痛把此前新增的，但与核心功能无关的命令都删掉；\n此外考虑到可能绝大多数的用户都没有技术背景，也可能不知道命令怎么用，因此将命令尽可能地优化成按钮，用户可以直接点击，改善易用性:\n我还希望可以支持多语言，比如根据用户的系统语言，自动切换到中文或者英文，这个就需要不同语言的文案。\ntelegram_botter.rb 这个核心服务类里面有超过60%的代码都是为了此类易用性改进而引入的。\n简单留给用户，复杂留给开发\n6.1 如何使用 只需两步，机器人就可以自动工作。\n将机器人（@BayesSpamSniperBot）添加到您的群组 给予机器人管理员权限（删除消息(delete message )，封禁用户权限(ban user )） 完成这两步后，机器人不仅会自动开始工作，自动识别群内广告，然后删除文本消息，如果发送垃圾广告超过3次，将会被封禁；\n还会随着社区的使用（通过 /markspam 和 /feedspam ），变得越来越智能\n此机器人的设计理念就是最小化打扰管理员与用户，提供简单的操作命令，并最大可能地自动化， 所以本机器人只提供以下三个命令（支持\"/“开头自动补全）:\n6.1.1 /markspam 删除垃圾消息并封禁用户, 需要管理员权限。\n在某条你想封禁的信息下回复 /markspam, 机器人就会自动把该条消息删除被封禁用户.\n(消息也被删除) 与常见的群管理机器人不同，这条命令不仅会删除垃圾消息并封禁用户, 因为这条消息还被管理员标记成垃圾广告，有非常高的置信度，所以系统就会以这条垃圾广告为训练数据，对模型进行实时更新。\n下次类似的发言不仅会被识别，所有使用本机器人的群组都会受益，也会把类似的文本标记成垃圾广告\n6.1.2 /listbanuser 查看封禁账户列表, 需要管理员权限。\n查看已封禁的用户列表，并主动解封。\n6.1.3 /listspam 查看广告消息列表, 需要管理员权限。\n查看被标记为广告的消息列表，并可标记为正常。\n6.1.4 /feedspam 投喂垃圾信息来训练，无任何权限要求，可私聊投喂或在群组内投喂.\n7 Eating your own dog food 在软件开发领域，有这么一句俗话，Eating your own dog food(吃你自己的狗粮)，大意是你自己的开发的东西，要自己先用起来。\n因此我建了一个自己的频道：菠萝油与天光墟 12用于测试，可惜订阅者寥寥， 就吸引不来太多的发垃圾广告的用户，所以欢迎大家订阅或者进来发广告，以吸引更多的发垃圾广告的用户。\n在我这个频道，每个人都有自由发言的权利(美中不足只是次数受限)\n既然没有人来我的频道发广告，苦于没有训练数据，我只能主动出击，赤膊上阵，割肉喂鹰去加了各种币圈群，黄色群，主动去看各种广告了：\n自从开发了这个机器人之后，我对广告的看法就变了，以前在别的群看到广告就烦，现在在别的群看到广告就很开心， 这都是宝贵的训练数据，要趁着还没被删，赶紧记录下来。\n7.1 八仙过海的垃圾广告 别人故事里的算法效果总是出奇的好，到自己实际运行的时候，总是发现会有这样那样的 case 没有覆盖，总有各种意外惊喜\n许多在 Telegram 发广告的用户都是久经考验的反拦截器斗士了。\n虽然关键词封禁效率不高，但是那些能让我们见到的广告说明已经是绕过关键词拦截的。\n比如:\n在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略\n又或者\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666\n前者通过空格分隔来绕过关键词，后者通过添加标点符号来绕过关键词。\n与英文等基于拉丁字母的语言天然通过空格分词不同，中文使用贝叶斯算法进行统计时，需要先进行分词\nthe fox jumped over the lazy dog\n我们的中文就不一样了\n「我们的中文就不一样了」就会被分词成「我们 | 的 | 中文 | 就 | 不 | 一样 | 了」, 然后才能对词频进行统计。\n但是像广告 在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略 , 空格除了会影响关键字匹配，也会影响分词，这句话的分词结果就会变成:\n在 | | 币圈 | | 想 | | 赚 | | 钱 | ， | 那 | | 你 | | 不 | 关 | | 注 | | 这 | | 个 | | 王 | | 牌 | | 社 | | 区 | ， | 真的 | 太 | 可惜 | 了 | ， | 真 | | 心 | | 推 | | 荐 | ， | 每 | | 天 | | 都 | | 有 | | 免 | | 费 | | 策 | | 略\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666 也会被分词成：\n这人简 | - | 介挂 | 的 | | 合 | - | 约 | - | 报单 | 群组 | 挺 | 牛 | 的 | ETH500 | 点 | ， | 大饼 | 5200 | 点 | ！ | | + | | @ | BTCETHl6666\n未经处理的训练数据就会影响模型的结果，可见训练数据的质量也非常重要，因此我就对训练语料做了相应的预处理：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # Step 1: 处理 anti-spam 分隔符 # 把中英文之间的非中英文及数字去掉，即 \"合-约\" -\u003e \"合约\" previous = \"\" while previous != cleaned previous = cleaned.dup cleaned = cleaned.gsub(/([一-龯A-Za-z0-9])[^一-龯A-Za-z0-9\\s]+([一-龯A-Za-z0-9])/, '\\1\\2') end # Step 2: 处理中文字符 anti-spam 空格 # 处理 \"想 赚 钱\" -\u003e \"想赚钱\" case previous = \"\" while previous != cleaned previous = cleaned.dup # 匹配中文汉字之间的一个或多个空格，然后删除掉 cleaned = cleaned.gsub(/([一-龯])(\\s+)([一-龯])/, '\\1\\3') end # Step 3: 增加汉字与英文之间的空格 # 以及帮助分词算法如(jieba)更好地分词, e.g., \"社区ETH\" -\u003e \"社区 ETH\" cleaned = cleaned.gsub(/([一-龯])([A-Za-z0-9])/, '\\1 \\2') cleaned = cleaned.gsub(/([A-Za-z0-9])([一-龯])/, '\\1 \\2') # Step 4: 删除多余的空格(多个空格缩减个一个) cleaned = cleaned.gsub(/\\s+/, ' ').strip 预处理之后， 在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略 就会变成 在币圈想赚钱那你不关注这个王牌社区真的太可惜了真心推荐每天都有免费策略 (这里把合法的逗号也去掉了，我觉得相较过多标点符号对分词的影响，把标点去掉分词结果反而是能接受的), 分词结果是:\n在 | 币圈 | 想 | 赚钱 | 那 | 你 | 不 | 关注 | 这个 | 王牌 | 社区 | 真的 | 太 | 可惜 | 了 | 真心 | 推荐 | 每天 | 都 | 有 | 免费 | 策略\n这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666 就会变成 这人简介挂的合约报单群组挺牛的 ETH500 点大饼 5200 点！ + @BTCETHl6666 ,分词结果是：\n这 | 人 | 简介 | 挂 | 的 | 合约 | 报单 | 群组 | 挺 | 牛 | 的 | | ETH500 | | 点 | 大饼 | | 5200 | | 点 | ！ | | + | | @ | BTCETHl6666\n7.1.1 广告新花样 广告看多了，不得不感慨发广告的人的创造力。\n因为在消息发垃圾广告会被广告拦截器拦截，他们创新性地玩出了新花样：\n消息发的都是正常的文本，但是头像和用户名都是广告，这样广告拦截器就无法工作了，真的是太有创意了。\n对手这么有创意，我也因地制宜地建立对用户名的训练模型，检测的时候消息文本的模型和用户名的模型都过一次， 只要有任何一个认为是垃圾广告，那就禁掉。\n更进一步的可以对头像做OCR提取文本，再增加一个对头像的训练模型，不过OCR成本挺高的，就先不搞了。\n7.2 优化 没有用户的话，做啥优化也没有必要，毕竟过早的优化是万恶之源， 因此我就把想法先做成原型，搞出来再说，但这不意味着这个原型没有优化的空间。\n脑海中还是有不少优化的点的：\njieba 分词的效果可能不是最好的，后续可以使用效果更好的分词器进行优化；或者是添加自己的词库。 每次有训练消息都进行重新训练，效率稍低，可以增加 batching 机制：有新消息时，等待5分钟或者等到100条消息再处理 现在整个模型都是在内存中计算，计算完就持久化成 DB, 可以在内存和数据库之间增加一层缓存来优化性能 贝叶斯算法可能效果不够好，换个复杂的机器学习模型 但是这些优化点都算是 Good to have, 不是 Must have, 后面遇到实际问题再进行优化好了。\n8 实战效果 使用变换之后的垃圾广告词进行发送:\n成功被检测出来，自动删除了:\n有朋友可能会说，这只是卖家秀，为什么别人在我群里发的广告还是没有被识别？\n因为贝叶斯算法本质是个概率算法，如果它没有见过类似的广告，那么它就没法判断是否垃圾广告 :(\n稍安勿躁，你需要做只是使用 /markspam 删除消息并封禁用户，就可以帮助训练这个bot, 所有使用这个 bot 的用户都会因此受益\n9 结语 我相当享受这种从发现问题、灵光一现，到构建原型，再到最终打磨出一个完整项目的创造过程。\n虽然这完全是「用爱发电」——代码开源，还得自掏腰包租服务器，物质上毫无回报。\n但每当看到机器人成功拦截广告的那一刻，那种创造的喜悦，就足以令我回味无穷。\n开源地址：https://github.com/ramsayleung/bayes_spam_sniper 立即体验：https://t.me/BayesSpamSniperBot 我的频道（菠萝油与天光墟）: https://t.me/pipeapplebun 推荐阅读 旅加经历 这些年走过的路：从广州到温哥华 加拿大之初体验 登陆加拿大一年后的体会 工具流分享 简明写作指南 我的写作流 我的画图流：画图工具与技巧分享 我的搜索流：高效搜索经验分享 最好的学习方式：费曼学习法(Feynman Technique) 系统思考：既见树木，又见森林 思考感悟 编程十年的感悟 那些年，我从微信支付学到的东西 杂谈ai取代程序员 为什么梦想买不起，故乡回不去 软件工程 软件设计的哲学 一本读了八年还没读完的书 测试技能进阶(一): 软件质量认知 测试技能进阶(二): Parameterized Tests 测试技能进阶(三): Property Based Testing 公号同步更新，欢迎关注👻 https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605 ↩︎\nhttps://liuyandong.com/sample-page ↩︎\nhttps://t.me/huruanhuying ↩︎\nhttps://t.me/kaedeharakazuha17 ↩︎\nhttps://paulgraham.com/spam.html ↩︎\nhttps://www.youtube.com/watch?v=Pu675cHJ7bg ↩︎\nhttps://www.youtube.com/watch?v=HZGCoVF3YvM ↩︎\nhttps://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d ↩︎\nhttps://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/ ↩︎\nhttps://ublockorigin.com/ ↩︎\nhttps://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/ ↩︎\nhttps://t.me/pipeapplebun ↩︎\n","wordCount":"6721","inLanguage":"zh","image":"https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-08-28T23:45:00-07:00","dateModified":"2025-09-27T17:44:09-07:00","author":{"@type":"Person","name":"Ramsay Leung"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ramsayleung.github.io/zh/post/2025/%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AD%A6%E4%B9%A0%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/"},"publisher":{"@type":"Organization","name":"菠萝油与天光墟","logo":{"@type":"ImageObject","url":"https://ramsayleung.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ramsayleung.github.io/zh/ accesskey=h title="Home (Alt + H)"><img src=https://ramsayleung.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://ramsayleung.github.io/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li class=dropdown><a href=https://ramsayleung.github.io/zh/categories/ title="系列 "><span>系列 ▾</span></a><div class="menu-more-content dropdown-content"><a href=https://ramsayleung.github.io/zh/categories/%E5%BE%97%E5%A4%B1%E6%84%9F%E6%82%9F/ title=得失感悟><span>得失感悟
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%97%85%E5%8A%A0%E7%BB%8F%E5%8E%86 title=旅加经历><span>旅加经历
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/ title=我的工作流><span>我的工作流
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6/ title=测试技能进阶><span>测试技能进阶
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%E5%B8%88%E7%9A%84%E8%BD%AF%E6%8A%80%E8%83%BD%E6%8C%87%E5%8C%97/ title=软件工程师的软技能指北><span>软件工程师的软技能指北
</span></a><a href=https://ramsayleung.github.io/zh/categories/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%AE%97%E6%B3%95%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA/ title=基于贝叶斯算法的Telegram广告拦截机器人><span>基于贝叶斯算法的Telegram广告拦截机器人</span></a></div></li><li><a href=https://ramsayleung.github.io/zh/archives/ title=归档><span>归档</span></a></li><li><a href=https://ramsayleung.github.io/zh/search/ title=搜索><span>搜索</span></a></li><li><a href=https://ramsayleung.github.io/zh/tags/ title=标签><span>标签</span></a></li><li><a href=https://ramsayleung.github.io/zh/about_me_zh/ title=关于><span>关于</span></a></li><li><a href=https://ramsayleung.github.io/zh/index.xml title=RSS><span>RSS</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ramsayleung.github.io/zh/>主页</a>&nbsp;»&nbsp;<a href=https://ramsayleung.github.io/zh/post/>Posts</a></div><h1 class="post-title entry-hint-parent">基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品</h1><div class=post-quote><blockquote><p>只有两样东西可能是无限的: 宇宙的大小和人类的愚蠢。不过, 对于前者我不太确定 :)</p><cite>— 爱因斯坦</cite></blockquote></div><hr class=post-separator><div class=post-meta><span title='2025-08-28 23:45:00 -0700 -0700'>八月 28, 2025</span>&nbsp;·&nbsp;14 分钟&nbsp;·&nbsp;6721 字&nbsp;|&nbsp;<a href=https://github.com/ramsayleung/ramsayleung.github.io/blob/master/content/post/2025/%e4%b8%80%e4%b8%aa%e8%87%aa%e5%ad%a6%e4%b9%a0%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#序言><span class=section-num>1</span> 序言</a><ul><li><a href=#telegram><span class=section-num>1.1</span> Telegram</a></li></ul></li><li><a href=#缘起><span class=section-num>2</span> 缘起</a></li><li><a href=#黑客与画家><span class=section-num>3</span> 黑客与画家</a><ul><li><a href=#贝叶斯定理><span class=section-num>3.1</span> 贝叶斯定理</a></li></ul></li><li><a href=#架构设计><span class=section-num>4</span> 架构设计</a><ul><li></li></ul></li><li><a href=#why-rails><span class=section-num>5</span> Why Rails</a><ul><li><a href=#vibe-coding><span class=section-num>5.1</span> Vibe Coding?</a></li></ul></li><li><a href=#设计理念><span class=section-num>6</span> 设计理念</a><ul><li><a href=#如何使用><span class=section-num>6.1</span> 如何使用</a></li></ul></li><li><a href=#eating-your-own-dog-food><span class=section-num>7</span> Eating your own dog food</a><ul><li><a href=#八仙过海的垃圾广告><span class=section-num>7.1</span> 八仙过海的垃圾广告</a></li><li><a href=#优化><span class=section-num>7.2</span> 优化</a></li></ul></li><li><a href=#实战效果><span class=section-num>8</span> 实战效果</a></li><li><a href=#结语><span class=section-num>9</span> 结语</a><ul><li><a href=#推荐阅读>推荐阅读</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p><a href=https://ramsayleung.github.io/en/post/2025/a_telegram_spam_blocker_bot_based_on_bayesian/>English Version</a></p><p>系列文章：</p><ul><li><a href=/zh/post/2025/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%AE%97%E6%B3%95%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA%E4%BA%8C/>基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路</a></li></ul><h2 id=序言><span class=section-num>1</span> 序言<a hidden class=anchor aria-hidden=true href=#序言>#</a></h2><p>我花了一周末时间，写了一个自学习的 Telegram 广告拦截机器人 <code>@BayesSpamSniperBot</code> (<a href=https://t.me/BayesSpamSniperBot>https://t.me/BayesSpamSniperBot</a>)，项目开源在：<a href=https://github.com/ramsayleung/bayes_spam_sniper>https://github.com/ramsayleung/bayes_spam_sniper</a></p><h3 id=telegram><span class=section-num>1.1</span> Telegram<a hidden class=anchor aria-hidden=true href=#telegram>#</a></h3><p>Telegram 是一个流行的即时通讯软件，类似微信，Whatsapp，已有超过10亿用户，支持许多强大的功能，如聊天记录云存储，支持Linux, Mac, Windows, Android, IOS, Web 多个平台，客户端都是开源，类似微信公众号的频道功能(Channel)，还有我见过的最强大的机器人系统。</p><h2 id=缘起><span class=section-num>2</span> 缘起<a hidden class=anchor aria-hidden=true href=#缘起>#</a></h2><p>平时我跑步和做饭都习惯会听播客，而《<a href=https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605>软件那些事儿</a>》<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>是我最喜欢的播客之一，主持人是<a href=https://liuyandong.com/sample-page>栋哥</a> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, 我也因为喜欢栋哥的节目，趁机加了栋哥的电报频道。</p><p>栋哥的电报频道<a href=https://t.me/huruanhuying>汗牛充栋</a> <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>主要是用来发布播客信息，
之前打开过一段时间的留言功能，没有想到引来了一堆的币圈的用户来发广告，因此将评论功能就关了：</p><figure><input type=checkbox id=zoomCheck-be4f5 hidden>
<label for=zoomCheck-be4f5><img class=zoomCheck loading=lazy src=/ox-hugo/spam_concert.jpg></label></figure><p>另外一个我关注的频道 <a href=https://t.me/kaedeharakazuha17>Ray Tracing</a> <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>也在吐槽币圈的广告，不堪其忧:</p><figure><input type=checkbox id=zoomCheck-d541b hidden>
<label for=zoomCheck-d541b><img class=zoomCheck loading=lazy src=/ox-hugo/ray_tracing_spam.jpg></label></figure><h2 id=黑客与画家><span class=section-num>3</span> 黑客与画家<a hidden class=anchor aria-hidden=true href=#黑客与画家>#</a></h2><p>常见的 Telegram 广告机器人是大多是基于关键字的，通过匹配关键字进行文本拦截，非常容易被发垃圾广告的人绕过。</p><figure><input type=checkbox id=zoomCheck-1401f hidden>
<label for=zoomCheck-1401f><img class=zoomCheck loading=lazy src=/ox-hugo/keyword_based_blocker.jpg></label></figure><p>被绕过的话主要是靠管理员人工删除。</p><p>这不禁让我想起了保罗.格雷厄姆在《黑客与画家》一书在2002年介绍的情况：</p><p>当时电子邮件兴起，也有非常多的垃圾邮件，常见的垃圾广告拦截方式是关键字匹配+邮件地址黑名单，但是既低效也容易被绕过。</p><p>保罗.格雷厄姆就创造性地使用贝叶斯算法(Bayesian Theorem)实现了一个<a href=https://paulgraham.com/spam.html>广告拦截器</a> <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, 效果竟然出奇地好。</p><p>对于 Telegram 的垃圾广告而言，这不是类似的问题嘛？</p><p>那我岂不是可以用类似的解决方案来解决 Telegram 广告的问题嘛</p><h3 id=贝叶斯定理><span class=section-num>3.1</span> 贝叶斯定理<a hidden class=anchor aria-hidden=true href=#贝叶斯定理>#</a></h3><p>提起概率算法，最经典的例子莫过于「抛硬币」这一古典概率——每次抛掷都是独立事件，前一次的结果不会影响下一次的概率。</p><p>然而，现实中的很多场景并不能像抛硬币那样无限重复，事件之间也往往并非相互独立。</p><p>这时候，贝叶斯定理就显示出其独特的价值。</p><p>它是一种「由果溯因」的概率方法，用于在已知某些证据的条件下，更新我们对某一假设的置信程度。</p><p>换句话说，贝叶斯算法能够根据不断出现的新证据，动态调整对某个事件发生概率的估计。</p><p>简单来说，就像人脑的学习过程：我们原本有一个初步认知，在获得新信息之后，会据此修正原有的看法，进而调整下一步的行动。</p><p>保罗·格雷厄姆就是通过贝叶斯定理，不断地根据已被标记为垃圾广告或者非垃圾广告的邮件，对新出现的邮件进行分类，判断其是否为垃圾广告。</p><p>如果想更直观地理解贝叶斯定理，推荐两个讲解清晰、生动易懂的视频：</p><ul><li>《<a href="https://www.youtube.com/watch?v=Pu675cHJ7bg">Bayes&rsquo; Theorem 贝叶斯定理</a>》<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>(中文)</li><li>《<a href="https://www.youtube.com/watch?v=HZGCoVF3YvM">Bayes theorem, the geometry of changing beliefs</a>》<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>(英文)</li></ul><h2 id=架构设计><span class=section-num>4</span> 架构设计<a hidden class=anchor aria-hidden=true href=#架构设计>#</a></h2><p>Telegram Bot 支持两种与 Telegram 服务器交互的模式，分别是：</p><ol><li><p>Webhook: Telegram 服务器会在 Bot 收到新消息时主动回调此前 Bot 注册的地址，Bot Server 只需要处理回调的消息</p></li><li><p>Long Polling: Bot Server 一直轮询 Telegram 服务器，看是否有新消息，有就处理，本机器人使用的是此模式</p><figure><input type=checkbox id=zoomCheck-ca97a hidden>
<label for=zoomCheck-ca97a><img class=zoomCheck loading=lazy src=/ox-hugo/webhook_vs_long_polling.jpg></label></figure></li></ol><h4 id=消息分析><span class=section-num>4.0.1</span> 消息分析<a hidden class=anchor aria-hidden=true href=#消息分析>#</a></h4><figure><input type=checkbox id=zoomCheck-e2518 hidden>
<label for=zoomCheck-e2518><img class=zoomCheck loading=lazy src=/ox-hugo/spam_analyze.jpg></label></figure><p>Bot Server 收到消息之后，会派发到单独的 <code>telegram_bot_worker</code> 处理，然后根据预训练的模型判断是否是垃圾广告，如果是，调用 Bot API 删除消息。</p><h4 id=封禁并训练><span class=section-num>4.0.2</span> 封禁并训练<a hidden class=anchor aria-hidden=true href=#封禁并训练>#</a></h4><figure><input type=checkbox id=zoomCheck-04d7c hidden>
<label for=zoomCheck-04d7c><img class=zoomCheck loading=lazy src=/ox-hugo/mark_spam_and_ban_user.jpg></label></figure><p>Bot Server 收到消息之后，会派发到单独的 <code>telegram_bot_worker</code> 处理， <code>telegram_bot_worker</code> 会调用 bot API 删除消息并封禁用户，并插入一条训练数据，标记为垃圾广告(spam)</p><p>保存训练数据会触发 hook, 创建一个训练消息，投递到消息队列 <code>training</code>, 会有另外的 worker <code>classifier_trainer</code> 订阅 <code>training</code> 消息，并使用新消息重新训练和更新模型</p><p>使用队列和后台进程 <code>classifier_trainer</code> 来训练任务而非直接使用 <code>telegram_bot_worker</code> 主要是为了返回 Bot请求与训练模型解耦，否则随着模型规模的增大，训练时间会越来越长，响应时间会越来越长。</p><p>解耦后就易于水平扩展了，在设计上为后续性能优化和扩展预留空间。</p><h2 id=why-rails><span class=section-num>5</span> Why Rails<a hidden class=anchor aria-hidden=true href=#why-rails>#</a></h2><p>看了我项目源代码的朋友，难免会浮起疑问，为什么使用 Ruby on Rails 实现的?</p><p>因为我工作中会有用到JVM系的编程语言(Java/Kotlin/Scala)和 Rust, 所以我对 Java/Rust 相当熟悉，又觉得模型训练可能对性能要求很高，所以最开始的<a href=https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d>原型</a> <sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>我是用 Rust 实现的，大概就花了半个多小时。</p><p>但是当我想把原型扩展成 Telegram 机器人时，就发现需要处理相当多与机器人交互的逻辑，主要涉及到 API 与数据库操作，其中大部分都是和模型无关的，因此我又想到了 Ruby on Rails。</p><p>论单个工程师做产品原型，就我个人而言，实在是没有比 <code>Ruby on Rails</code> 更高效的框架了，因此我就切换到 Ruby on Rails 去。</p><p>Rails 8 的新特性，把 Rails 向所谓的「一人全栈框架」又推进了不少，通过关系型数据库内置对消息队列 <code>Solid Queue</code> 的支持，甚至不再需要类似 Redis 这样的存储来支持队列实现。</p><p>架构设计中的队列和后台进程，只需要几行代码就实现了，甚至不需要额外的配置，如果队列不存在，框架会自动创建：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>ClassifierTrainerJob</span> <span class=o>&lt;</span> <span class=no>ApplicationJob</span>
</span></span><span class=line><span class=cl>  <span class=c1># Job to train classifier asynchronously</span>
</span></span><span class=line><span class=cl>  <span class=n>queue_as</span> <span class=ss>:training</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>perform</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=no>SpamClassifierService</span><span class=o>.</span><span class=n>rebuild_for_group</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>得益于 Rails 强大的 ORM 框架，内置各种生命周期的 hook, 对新插入训练数据后触发后台进程重新训练模型的代码也只有寥寥几行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=k>class</span> <span class=nc>TrainedMessage</span> <span class=o>&lt;</span> <span class=no>ApplicationRecord</span>
</span></span><span class=line><span class=cl>  <span class=c1># Automatically train classifier after creating/updating a message</span>
</span></span><span class=line><span class=cl>  <span class=n>after_create</span> <span class=ss>:retrain_classifier</span>
</span></span><span class=line><span class=cl>  <span class=n>after_destroy</span> <span class=ss>:retrain_classifier</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>retrain_classifier</span>
</span></span><span class=line><span class=cl>    <span class=c1># For efficiency, we could queue this as a background job</span>
</span></span><span class=line><span class=cl>    <span class=no>ClassifierTrainerJob</span><span class=o>.</span><span class=n>perform_later</span><span class=p>(</span><span class=n>group_id</span><span class=p>,</span> <span class=n>group_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>在 Rails 各种内置强大工具的加持下，我只用了一天时间就把整个机器人的功能给实现出来了。</p><p>看到这里，有朋友可能会担心性能，觉得 Ruby 性能不行，并且还是动态语言，不好维护。</p><p>我持有的观点还是和之前的博文《<a href=https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/>编程十年的感悟</a>》<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>一样：</p><p>先跑起来再说，先做个原型跑起来，有用户愿意用你的产品再说，
当运行速度成为瓶颈时，你的业务肯定非常大了，肯定有足够的资源招一打程序员把项目优化成 Rust/C++, 甚至是汇编。</p><p>没有用户，谈性能只是个伪命题。</p><p>至于动态语言一时爽，代码维护火葬场，我也是相当认同的。</p><p>因此我在为团队选型时我绝对不会考虑动态语言，只会上编译型的语言，
甚至是Rust这种强类型，但是现在只有我一个人来做原型，我自己是什么顺手就用什么的。</p><h3 id=vibe-coding><span class=section-num>5.1</span> Vibe Coding?<a hidden class=anchor aria-hidden=true href=#vibe-coding>#</a></h3><p>Vibe Coding等AI编程概念可谓是铺天盖地，甚嚣尘上，难免会有朋友好奇我这个项目是否 Vibe Coding生成的。</p><p>答案是，我尝试了几个小时之后，直接放弃了， Claude 4 和 Gemini 2.5 Pro 都试过了。</p><p>开始是使用 Rust + Cloudflare Worker 的技术栈，Rust + Cloudflare Worker 是个相当小众的领域，训练语料少，Vibe Coding 出来的代码编译无法通过</p><p>后面换成 Ruby on Rails, 问题还更严重了，Ruby 是弱类型的动态语言，语法写起来和英语一样，Rails 又还有很多黑魔法，所以到运行时才报错，代码生成省下来的开发时间，debug过程全补回来了。</p><p>另外一个是 Vibe Coding 生成的代码很多都是没有设计的，比如把 <code>Classifier</code> 和 <code>TrainedMessage</code> 的类耦合在一起，在 <code>Classifier</code> 里面持久化 <code>TrainedMessage</code></p><p>又直接在 <code>telegram_bot_worker</code> 进程里面，接收到训练信息马上同步训练新模型，训练完再返回调用命令的结果，完全没考虑解耦接收训练语料和模型训练。</p><p>只能说 Vibe Coding 非常适合 Rust 这样的强类型编译型语言，生成的出来的代码起码要编译通过，保证质量的下限。</p><p>而对于那些说「一行代码都不用写/改，就能做出一个APP」的言论，此时我脑海不禁升起疑问？</p><p>究竟是代码好到一行都不用改？还是开发者看不出症结所在，所以一行都不改？</p><h2 id=设计理念><span class=section-num>6</span> 设计理念<a hidden class=anchor aria-hidden=true href=#设计理念>#</a></h2><p>开发完原型，在机器人整体功能可用之后，脑中又有不少的想法冒出来，当时就马不停蹄地给机器人加上，
因此机器人就支持快十个命令，还支持私聊和群聊的不同模式。</p><p>加着加着，连我自己都疑惑起来：这么多的功能，有点像国内的各种大而全的App了，我不禁对此产生疑问：</p><p>真的会有用户用这么多功能么？真的有用户会用这些功能嘛？太多功能不是也会有额外的心智负担嘛?</p><p>我最喜欢的广告拦截器 <a href=https://ublockorigin.com/>Ublock Origin</a> <sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>拦截效果非常好，但是使用起来却非常简单，易上手。</p><p>想起《<a href=https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/>软件设计的哲学</a>》<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>里面提到的设计理念，接口应该是简单易用的，但是功能可以是复杂丰富的。</p><p>因此我只能忍痛把此前新增的，但与核心功能无关的命令都删掉；</p><p>此外考虑到可能绝大多数的用户都没有技术背景，也可能不知道命令怎么用，因此将命令尽可能地优化成按钮，用户可以直接点击，改善易用性:</p><figure><input type=checkbox id=zoomCheck-e207f hidden>
<label for=zoomCheck-e207f><img class=zoomCheck loading=lazy src=/ox-hugo/start_zh.jpg></label></figure><figure><input type=checkbox id=zoomCheck-ca4b6 hidden>
<label for=zoomCheck-ca4b6><img class=zoomCheck loading=lazy src=/ox-hugo/help_page_zh.jpg></label></figure><p>我还希望可以支持多语言，比如根据用户的系统语言，自动切换到中文或者英文，这个就需要不同语言的文案。</p><figure><input type=checkbox id=zoomCheck-5f8d5 hidden>
<label for=zoomCheck-5f8d5><img class=zoomCheck loading=lazy src=/ox-hugo/start_en.jpg></label></figure><figure><input type=checkbox id=zoomCheck-bc48d hidden>
<label for=zoomCheck-bc48d><img class=zoomCheck loading=lazy src=/ox-hugo/help_en.jpg></label></figure><p><a href=https://github.com/ramsayleung/bayes_spam_sniper/blob/master/app/services/telegram_botter.rb>telegram_botter.rb</a> 这个核心服务类里面有超过60%的代码都是为了此类易用性改进而引入的。</p><p>简单留给用户，复杂留给开发</p><h3 id=如何使用><span class=section-num>6.1</span> 如何使用<a hidden class=anchor aria-hidden=true href=#如何使用>#</a></h3><p>只需两步，机器人就可以自动工作。</p><ul><li>将机器人（@BayesSpamSniperBot）<a href="https://t.me/BayesSpamSniperBot?startgroup=true">添加到您的群组</a></li><li>给予机器人管理员权限（删除消息(delete message )，封禁用户权限(ban user )）</li></ul><p>完成这两步后，机器人不仅会自动开始工作，自动识别群内广告，然后删除文本消息，如果发送垃圾广告超过3次，将会被封禁；</p><p>还会随着社区的使用（通过 <code>/markspam</code> 和 <code>/feedspam</code> ），变得越来越智能</p><figure><input type=checkbox id=zoomCheck-28a2c hidden>
<label for=zoomCheck-28a2c><img class=zoomCheck loading=lazy src=/ox-hugo/detect_spam_and_ban_user.jpg></label></figure><p>此机器人的设计理念就是最小化打扰管理员与用户，提供简单的操作命令，并最大可能地自动化，
所以本机器人只提供以下三个命令（支持"/&ldquo;开头自动补全）:</p><figure><input type=checkbox id=zoomCheck-ecf1f hidden>
<label for=zoomCheck-ecf1f><img class=zoomCheck loading=lazy src=/ox-hugo/command_auto_completion.jpg></label></figure><h4 id=markspam><span class=section-num>6.1.1</span> <code>/markspam</code><a hidden class=anchor aria-hidden=true href=#markspam>#</a></h4><p>删除垃圾消息并封禁用户, 需要管理员权限。</p><p>在某条你想封禁的信息下回复 <code>/markspam</code>, 机器人就会自动把该条消息删除被封禁用户.</p><figure><input type=checkbox id=zoomCheck-14d59 hidden>
<label for=zoomCheck-14d59><img class=zoomCheck loading=lazy src=/ox-hugo/markspam_2.jpg></label></figure><p>(消息也被删除)
<img loading=lazy src=/ox-hugo/markspam.jpg></p><p>与常见的群管理机器人不同，这条命令不仅会删除垃圾消息并封禁用户, 因为这条消息还被管理员标记成垃圾广告，有非常高的置信度，所以系统就会以这条垃圾广告为训练数据，对模型进行实时更新。</p><p>下次类似的发言不仅会被识别，所有使用本机器人的群组都会受益，也会把类似的文本标记成垃圾广告</p><h4 id=listbanuser><span class=section-num>6.1.2</span> <code>/listbanuser</code><a hidden class=anchor aria-hidden=true href=#listbanuser>#</a></h4><p>查看封禁账户列表, 需要管理员权限。</p><figure><input type=checkbox id=zoomCheck-7751e hidden>
<label for=zoomCheck-7751e><img class=zoomCheck loading=lazy src=/ox-hugo/listbanuser.jpg></label></figure><p>查看已封禁的用户列表，并主动解封。</p><h4 id=listspam><span class=section-num>6.1.3</span> <code>/listspam</code><a hidden class=anchor aria-hidden=true href=#listspam>#</a></h4><p>查看广告消息列表, 需要管理员权限。</p><figure><input type=checkbox id=zoomCheck-d0038 hidden>
<label for=zoomCheck-d0038><img class=zoomCheck loading=lazy src=/ox-hugo/listspam.jpg></label></figure><p>查看被标记为广告的消息列表，并可标记为正常。</p><h4 id=feedspam><span class=section-num>6.1.4</span> <code>/feedspam</code><a hidden class=anchor aria-hidden=true href=#feedspam>#</a></h4><p>投喂垃圾信息来训练，无任何权限要求，可私聊投喂或在群组内投喂.</p><figure><input type=checkbox id=zoomCheck-2a139 hidden>
<label for=zoomCheck-2a139><img class=zoomCheck loading=lazy src=/ox-hugo/feedspam.jpg></label></figure><figure><input type=checkbox id=zoomCheck-1fc12 hidden>
<label for=zoomCheck-1fc12><img class=zoomCheck loading=lazy src=/ox-hugo/feedspam2.jpg></label></figure><h2 id=eating-your-own-dog-food><span class=section-num>7</span> Eating your own dog food<a hidden class=anchor aria-hidden=true href=#eating-your-own-dog-food>#</a></h2><p>在软件开发领域，有这么一句俗话，Eating your own dog food(吃你自己的狗粮)，大意是你自己的开发的东西，要自己先用起来。</p><p>因此我建了一个自己的频道：<a href=https://t.me/pipeapplebun>菠萝油与天光墟</a> <sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup>用于测试，可惜订阅者寥寥，
就吸引不来太多的发垃圾广告的用户，所以欢迎大家订阅或者进来发广告，以吸引更多的发垃圾广告的用户。</p><p>在我这个频道，每个人都有自由发言的权利(美中不足只是次数受限)</p><p>既然没有人来我的频道发广告，苦于没有训练数据，我只能主动出击，赤膊上阵，割肉喂鹰去加了各种币圈群，黄色群，主动去看各种广告了：</p><figure><input type=checkbox id=zoomCheck-3779e hidden>
<label for=zoomCheck-3779e><img class=zoomCheck loading=lazy src=/ox-hugo/telegram_group1.jpg></label></figure><figure><input type=checkbox id=zoomCheck-35262 hidden>
<label for=zoomCheck-35262><img class=zoomCheck loading=lazy src=/ox-hugo/telegram_group2.jpg></label></figure><figure><input type=checkbox id=zoomCheck-b0b9b hidden>
<label for=zoomCheck-b0b9b><img class=zoomCheck loading=lazy src=/ox-hugo/spam_sample.jpg></label></figure><p>自从开发了这个机器人之后，我对广告的看法就变了，以前在别的群看到广告就烦，现在在别的群看到广告就很开心，
这都是宝贵的训练数据，要趁着还没被删，赶紧记录下来。</p><figure><input type=checkbox id=zoomCheck-511dc hidden>
<label for=zoomCheck-511dc><img class=zoomCheck loading=lazy src=/ox-hugo/feedspam3.jpg></label></figure><h3 id=八仙过海的垃圾广告><span class=section-num>7.1</span> 八仙过海的垃圾广告<a hidden class=anchor aria-hidden=true href=#八仙过海的垃圾广告>#</a></h3><p>别人故事里的算法效果总是出奇的好，到自己实际运行的时候，总是发现会有这样那样的 case 没有覆盖，总有各种意外惊喜</p><p>许多在 Telegram 发广告的用户都是久经考验的反拦截器斗士了。</p><p>虽然关键词封禁效率不高，但是那些能让我们见到的广告说明已经是绕过关键词拦截的。</p><p>比如:</p><blockquote><p>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略</p></blockquote><p>又或者</p><blockquote><p>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666</p></blockquote><p>前者通过空格分隔来绕过关键词，后者通过添加标点符号来绕过关键词。</p><p>与英文等基于拉丁字母的语言天然通过空格分词不同，中文使用贝叶斯算法进行统计时，需要先进行分词</p><blockquote><p>the fox jumped over the lazy dog</p><p>我们的中文就不一样了</p></blockquote><p>「我们的中文就不一样了」就会被分词成「我们 | 的 | 中文 | 就 | 不 | 一样 | 了」, 然后才能对词频进行统计。</p><p>但是像广告 <code>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略</code> , 空格除了会影响关键字匹配，也会影响分词，这句话的分词结果就会变成:</p><p><code>在 | | 币圈 | | 想 | | 赚 | | 钱 | ， | 那 | | 你 | | 不 | 关 | | 注 | | 这 | | 个 | | 王 | | 牌 | | 社 | | 区 | ， | 真的 | 太 | 可惜 | 了 | ， | 真 | | 心 | | 推 | | 荐 | ， | 每 | | 天 | | 都 | | 有 | | 免 | | 费 | | 策 | | 略</code></p><p><code>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666</code> 也会被分词成：</p><p><code>这人简 | - | 介挂 | 的 | | 合 | - | 约 | - | 报单 | 群组 | 挺 | 牛 | 的 | ETH500 | 点 | ， | 大饼 | 5200 | 点 | ！ | | + | | @ | BTCETHl6666</code></p><p>未经处理的训练数据就会影响模型的结果，可见训练数据的质量也非常重要，因此我就对训练语料做了相应的预处理：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=c1># Step 1: 处理 anti-spam 分隔符</span>
</span></span><span class=line><span class=cl><span class=c1># 把中英文之间的非中英文及数字去掉，即 &#34;合-约&#34; -&gt; &#34;合约&#34;</span>
</span></span><span class=line><span class=cl><span class=n>previous</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>previous</span> <span class=o>!=</span> <span class=n>cleaned</span>
</span></span><span class=line><span class=cl>  <span class=n>previous</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>dup</span>
</span></span><span class=line><span class=cl>  <span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯A-Za-z0-9])[^一-龯A-Za-z0-9\s]+([一-龯A-Za-z0-9])/</span><span class=p>,</span> <span class=s1>&#39;\1\2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 2: 处理中文字符 anti-spam 空格</span>
</span></span><span class=line><span class=cl><span class=c1># 处理 &#34;想 赚 钱&#34; -&gt; &#34;想赚钱&#34; case</span>
</span></span><span class=line><span class=cl><span class=n>previous</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>previous</span> <span class=o>!=</span> <span class=n>cleaned</span>
</span></span><span class=line><span class=cl>  <span class=n>previous</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>dup</span>
</span></span><span class=line><span class=cl>  <span class=c1># 匹配中文汉字之间的一个或多个空格，然后删除掉</span>
</span></span><span class=line><span class=cl>  <span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯])(\s+)([一-龯])/</span><span class=p>,</span> <span class=s1>&#39;\1\3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 3: 增加汉字与英文之间的空格</span>
</span></span><span class=line><span class=cl><span class=c1># 以及帮助分词算法如(jieba)更好地分词, e.g., &#34;社区ETH&#34; -&gt; &#34;社区 ETH&#34;</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([一-龯])([A-Za-z0-9])/</span><span class=p>,</span> <span class=s1>&#39;\1 \2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/([A-Za-z0-9])([一-龯])/</span><span class=p>,</span> <span class=s1>&#39;\1 \2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Step 4: 删除多余的空格(多个空格缩减个一个)</span>
</span></span><span class=line><span class=cl><span class=n>cleaned</span> <span class=o>=</span> <span class=n>cleaned</span><span class=o>.</span><span class=n>gsub</span><span class=p>(</span><span class=sr>/\s+/</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span>
</span></span></code></pre></td></tr></table></div></div><p>预处理之后， <code>在 币圈 想 赚 钱，那 你 不关 注 这 个 王 牌 社 区，真的太可惜了，真 心 推 荐，每 天 都 有 免 费 策 略</code> 就会变成 <code>在币圈想赚钱那你不关注这个王牌社区真的太可惜了真心推荐每天都有免费策略</code> (这里把合法的逗号也去掉了，我觉得相较过多标点符号对分词的影响，把标点去掉分词结果反而是能接受的), 分词结果是:</p><p><code>在 | 币圈 | 想 | 赚钱 | 那 | 你 | 不 | 关注 | 这个 | 王牌 | 社区 | 真的 | 太 | 可惜 | 了 | 真心 | 推荐 | 每天 | 都 | 有 | 免费 | 策略</code></p><p><code>这人简-介挂的 合-约-报单群组挺牛的ETH500点，大饼5200点！ + @BTCETHl6666</code> 就会变成 <code>这人简介挂的合约报单群组挺牛的 ETH500 点大饼 5200 点！ + @BTCETHl6666</code> ,分词结果是：</p><p><code>这 | 人 | 简介 | 挂 | 的 | 合约 | 报单 | 群组 | 挺 | 牛 | 的 | | ETH500 | | 点 | 大饼 | | 5200 | | 点 | ！ | | + | | @ | BTCETHl6666</code></p><h4 id=广告新花样><span class=section-num>7.1.1</span> 广告新花样<a hidden class=anchor aria-hidden=true href=#广告新花样>#</a></h4><p>广告看多了，不得不感慨发广告的人的创造力。</p><p>因为在消息发垃圾广告会被广告拦截器拦截，他们创新性地玩出了新花样：</p><figure><input type=checkbox id=zoomCheck-fe0e1 hidden>
<label for=zoomCheck-fe0e1><img class=zoomCheck loading=lazy src=/ox-hugo/spam_by_username.jpg></label></figure><p>消息发的都是正常的文本，但是头像和用户名都是广告，这样广告拦截器就无法工作了，真的是太有创意了。</p><p>对手这么有创意，我也因地制宜地建立对用户名的训练模型，检测的时候消息文本的模型和用户名的模型都过一次，
只要有任何一个认为是垃圾广告，那就禁掉。</p><p>更进一步的可以对头像做OCR提取文本，再增加一个对头像的训练模型，不过OCR成本挺高的，就先不搞了。</p><h3 id=优化><span class=section-num>7.2</span> 优化<a hidden class=anchor aria-hidden=true href=#优化>#</a></h3><p>没有用户的话，做啥优化也没有必要，毕竟过早的优化是万恶之源，
因此我就把想法先做成原型，搞出来再说，但这不意味着这个原型没有优化的空间。</p><p>脑海中还是有不少优化的点的：</p><ol><li>jieba 分词的效果可能不是最好的，后续可以使用效果更好的分词器进行优化；或者是添加自己的词库。</li><li>每次有训练消息都进行重新训练，效率稍低，可以增加 batching 机制：有新消息时，等待5分钟或者等到100条消息再处理</li><li>现在整个模型都是在内存中计算，计算完就持久化成 DB, 可以在内存和数据库之间增加一层缓存来优化性能</li><li>贝叶斯算法可能效果不够好，换个复杂的机器学习模型</li></ol><p>但是这些优化点都算是 Good to have, 不是 Must have, 后面遇到实际问题再进行优化好了。</p><h2 id=实战效果><span class=section-num>8</span> 实战效果<a hidden class=anchor aria-hidden=true href=#实战效果>#</a></h2><p>使用变换之后的垃圾广告词进行发送:</p><figure><input type=checkbox id=zoomCheck-cdd9f hidden>
<label for=zoomCheck-cdd9f><img class=zoomCheck loading=lazy src=/ox-hugo/spam_messge_2.jpg></label></figure><p>成功被检测出来，自动删除了:</p><figure><input type=checkbox id=zoomCheck-78c5f hidden>
<label for=zoomCheck-78c5f><img class=zoomCheck loading=lazy src=/ox-hugo/deleted_spam.jpg></label></figure><p>有朋友可能会说，这只是卖家秀，为什么别人在我群里发的广告还是没有被识别？</p><p>因为贝叶斯算法本质是个概率算法，如果它没有见过类似的广告，那么它就没法判断是否垃圾广告 :(</p><p>稍安勿躁，你需要做只是使用 <code>/markspam</code> 删除消息并封禁用户，就可以帮助训练这个bot, 所有使用这个 bot 的用户都会因此受益</p><h2 id=结语><span class=section-num>9</span> 结语<a hidden class=anchor aria-hidden=true href=#结语>#</a></h2><p>我相当享受这种从发现问题、灵光一现，到构建原型，再到最终打磨出一个完整项目的创造过程。</p><p>虽然这完全是「用爱发电」——代码开源，还得自掏腰包租服务器，物质上毫无回报。</p><p>但每当看到机器人成功拦截广告的那一刻，那种创造的喜悦，就足以令我回味无穷。</p><ul><li>开源地址：<a href=https://github.com/ramsayleung/bayes_spam_sniper>https://github.com/ramsayleung/bayes_spam_sniper</a></li><li>立即体验：<a href=https://t.me/BayesSpamSniperBot>https://t.me/BayesSpamSniperBot</a></li><li>我的频道（菠萝油与天光墟）: <a href=https://t.me/pipeapplebun>https://t.me/pipeapplebun</a></li></ul><h3 id=推荐阅读>推荐阅读<a hidden class=anchor aria-hidden=true href=#推荐阅读>#</a></h3><ul><li>旅加经历<ul><li><a href=https://ramsayleung.github.io/zh/post/2023/%E8%BF%99%E4%BA%9B%E5%B9%B4%E8%B5%B0%E8%BF%87%E7%9A%84%E8%B7%AF_%E4%BB%8E%E5%B9%BF%E5%B7%9E%E5%88%B0%E6%B8%A9%E5%93%A5%E5%8D%8E/>这些年走过的路：从广州到温哥华</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E5%8A%A0%E6%8B%BF%E5%A4%A7%E4%B9%8B%E5%88%9D%E4%BD%93%E9%AA%8C/>加拿大之初体验</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E7%99%BB%E9%99%86%E5%8A%A0%E6%8B%BF%E5%A4%A7%E4%B8%80%E5%B9%B4%E7%9A%84%E4%BD%93%E4%BC%9A/>登陆加拿大一年后的体会</a></li></ul></li><li>工具流分享<ul><li><a href=https://ramsayleung.github.io/zh/post/2024/%E7%AE%80%E6%98%8E%E5%86%99%E4%BD%9C%E6%8C%87%E5%8D%97/>简明写作指南</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E6%88%91%E7%9A%84%E5%86%99%E4%BD%9C%E6%B5%81/>我的写作流</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E6%88%91%E7%9A%84%E7%94%BB%E5%9B%BE%E6%B5%81/>我的画图流：画图工具与技巧分享</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E6%88%91%E7%9A%84%E6%90%9C%E7%B4%A2%E6%B5%81/>我的搜索流：高效搜索经验分享</a></li><li><a href=https://ramsayleung.github.io/zh/post/2022/feynman_technique/>最好的学习方式：费曼学习法(Feynman Technique)</a></li><li><a href=https://ramsayleung.github.io/zh/post/2021/%E7%B3%BB%E7%BB%9F%E6%80%9D%E8%80%83/>系统思考：既见树木，又见森林</a></li></ul></li><li>思考感悟<ul><li><a href=https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/>编程十年的感悟</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E4%BB%8E%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%A6%BB%E7%BA%BF_%E6%88%91%E5%B8%A6%E8%B5%B0%E4%BA%86%E4%BB%80%E4%B9%88/>那些年，我从微信支付学到的东西</a></li><li><a href=https://ramsayleung.github.io/zh/post/2025/%E6%9D%82%E8%B0%88ai%E5%8F%96%E4%BB%A3%E7%A8%8B%E5%BA%8F%E5%91%98/>杂谈ai取代程序员</a></li><li><a href=https://ramsayleung.github.io/zh/post/2023/%E7%BD%AE%E8%BA%AB%E4%BA%8B%E5%86%85/>为什么梦想买不起，故乡回不去</a></li></ul></li><li>软件工程<ul><li><a href=https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/>软件设计的哲学</a></li><li><a href=https://ramsayleung.github.io/zh/post/2025/structure_and_interpretation_of_computer_programs/>一本读了八年还没读完的书</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%80_%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F%E8%AE%A4%E7%9F%A5/>测试技能进阶(一): 软件质量认知</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%BA%8C_parameterized_tests/>测试技能进阶(二): Parameterized Tests</a></li><li><a href=https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%89_property_based_testing/>测试技能进阶(三): Property Based Testing</a></li></ul></li></ul><div class=qr-container center><img src=/ox-hugo/qrcode_gh_e06d750e626f_1.jpg alt=qrcode_gh_e06d750e626f_1.jpg class=qr-container width=160px height=160px center=t>
公号同步更新，欢迎关注👻</div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605>https://podcasts.apple.com/us/podcast/%E8%BD%AF%E4%BB%B6%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/id1147186605</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://liuyandong.com/sample-page>https://liuyandong.com/sample-page</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://t.me/huruanhuying>https://t.me/huruanhuying</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://t.me/kaedeharakazuha17>https://t.me/kaedeharakazuha17</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://paulgraham.com/spam.html>https://paulgraham.com/spam.html</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href="https://www.youtube.com/watch?v=Pu675cHJ7bg">https://www.youtube.com/watch?v=Pu675cHJ7bg</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href="https://www.youtube.com/watch?v=HZGCoVF3YvM">https://www.youtube.com/watch?v=HZGCoVF3YvM</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d>https://gist.github.com/ramsayleung/5848af0177a70a01d41f624e361b1b5d</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/>https://ramsayleung.github.io/zh/post/2024/%E7%BC%96%E7%A8%8B%E5%8D%81%E5%B9%B4%E7%9A%84%E6%84%9F%E6%82%9F/</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=https://ublockorigin.com/>https://ublockorigin.com/</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/>https://ramsayleung.github.io/zh/post/2025/a_philosophy_of_software_design/</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p><a href=https://t.me/pipeapplebun>https://t.me/pipeapplebun</a>&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ramsayleung.github.io/zh/tags/telegram/>Telegram</a></li><li><a href=https://ramsayleung.github.io/zh/tags/design/>Design</a></li><li><a href=https://ramsayleung.github.io/zh/tags/programming/>Programming</a></li><li><a href=https://ramsayleung.github.io/zh/tags/rails/>Rails</a></li><li><a href=https://ramsayleung.github.io/zh/tags/rust/>Rust</a></li></ul><nav class=paginav><a class=prev href=https://ramsayleung.github.io/zh/post/2025/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%AE%97%E6%B3%95%E7%9A%84telegram%E5%B9%BF%E5%91%8A%E6%8B%A6%E6%88%AA%E6%9C%BA%E5%99%A8%E4%BA%BA%E4%BA%8C/><span class=title>« 上一页</span><br><span>基于贝叶斯算法的Telegram广告拦截机器人（二）：上线半月的故障、挑战与优化之路</span>
</a><a class=next href=https://ramsayleung.github.io/zh/post/2025/structure_and_interpretation_of_computer_programs/><span class=title>下一页 »</span><br><span>一本读了八年还没读完的书</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on x" href="https://x.com/intent/tweet/?text=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f&amp;hashtags=telegram%2cdesign%2cprogramming%2crails%2crust"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f&amp;title=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81&amp;summary=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81&amp;source=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f&title=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81%20-%20https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on telegram" href="https://telegram.me/share/url?text=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81&amp;url=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 基于贝叶斯算法的Telegram广告拦截机器人（一）：从问题到产品 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e5%9f%ba%e4%ba%8e%e8%b4%9d%e5%8f%b6%e6%96%af%e7%ae%97%e6%b3%95%e7%9a%84Telegram%e5%b9%bf%e5%91%8a%e6%8b%a6%e6%88%aa%e6%9c%ba%e5%99%a8%e4%ba%ba%ef%bc%88%e4%b8%80%ef%bc%89%ef%bc%9a%e4%bb%8e%e9%97%ae%e9%a2%98%e5%88%b0%e4%ba%a7%e5%93%81&u=https%3a%2f%2framsayleung.github.io%2fzh%2fpost%2f2025%2f%25E4%25B8%2580%25E4%25B8%25AA%25E8%2587%25AA%25E5%25AD%25A6%25E4%25B9%25A0%25E7%259A%2584telegram%25E5%25B9%25BF%25E5%2591%258A%25E6%258B%25A6%25E6%2588%25AA%25E6%259C%25BA%25E5%2599%25A8%25E4%25BA%25BA%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><section><h2>Comments</h2><div id=comments-giscus></div></section><script type=text/javascript>function getCurrentTheme(){return document.documentElement.getAttribute("data-theme")||document.body.classList.contains("dark")?"dark":"light"}function setGiscusTheme(e=!1){const s=e?"dark":"light";var n,t=document.querySelector(".giscus-frame");t&&(n=new URL(t.src),n.searchParams.set("theme",s),t.src=n.toString())}function loadComment(e=!1){const n="zh"=="zh",t=document.getElementById("comments-giscus");if(t!==null&&!t.hasAttribute("data-giscus-loaded")){console.log("Initial giscus load");const s=document.createElement("script");s.setAttribute("src","https://giscus.app/client.js"),s.setAttribute("data-repo","ramsayleung/comment"),s.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkzMDk2NjQ1NDk="),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOEnUbJc4Cltnz"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",e?"dark":"light"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("data-lang",n?"zh-CN":"en"),s.setAttribute("async","true"),t.appendChild(s),t.setAttribute("data-giscus-loaded","true")}}let currentTheme=getCurrentTheme();loadComment(currentTheme==="dark");const themeObserver=new MutationObserver(e=>{e.forEach(e=>{if(e.type==="attributes"&&e.attributeName==="class"){const e=getCurrentTheme();e!==currentTheme&&(currentTheme=e,setGiscusTheme(currentTheme==="dark"))}})});themeObserver.observe(document.body,{attributes:!0,attributeFilter:["class"]})</script></article></main><footer class=footer><span>See this site&rsquo;s source code <a href=https://github.com/ramsayleung/ramsayleung.github.io>here</a>, licensed under GPLv3 ·</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>