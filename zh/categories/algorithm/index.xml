<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>algorithm on è¿‡æ²³å’</title>
    <link>https://ramsayleung.github.io/zh/categories/algorithm/</link>
    <description>Recent content in algorithm on è¿‡æ²³å’</description>
    <image>
      <title>è¿‡æ²³å’</title>
      <url>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.120.4</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 Â·</copyright>
    <lastBuildDate>Mon, 30 Dec 2024 22:34:05 -0800</lastBuildDate>
    <atom:link href="https://ramsayleung.github.io/zh/categories/algorithm/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Topological Sort</title>
      <link>https://ramsayleung.github.io/zh/post/2022/topological_sorting/</link>
      <pubDate>Sun, 22 May 2022 10:34:00 +0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2022/topological_sorting/</guid>
      <description>1 Definition In computer science, a topological sort or topological ordering of a directed graph is a linear ordering of its vertices such that for every directed edge uv from vertex u to vertx v, u comes before v in the ordering. It sounds pretty academic, but I am sure you are using topological sort unconsciously every single day. 2 Application Many real world situations can be modeled as a</description>
      <content:encoded><![CDATA[<h2 id="definition"><span class="section-num">1</span> Definition</h2>
<p>In computer science, a topological sort or topological ordering of a directed graph is a linear ordering of its vertices such that for every directed edge <code>uv</code> from vertex <code>u</code> to vertx <code>v</code>, <code>u</code> comes before <code>v</code> in the ordering.</p>
<p>It sounds pretty academic, but I am sure you are using topological sort unconsciously every single day.</p>
<h2 id="application"><span class="section-num">2</span> Application</h2>
<p>Many real world situations can be modeled as a graph with directed edges where some events must occur before others. Then a topological sort gives an order in which to perform these events, for instance:</p>
<h3 id="college-class-prerequisites"><span class="section-num">2.1</span> College class prerequisites</h3>
<p>You must take course <code>b</code> first if you want to take course <code>a</code>. For example, in your alma mater, the student must complete <code>PHYS:1511(College Physics)</code> or <code>PHYS:1611(Introductory Physics I)</code> before taking <code>College Physics II</code>.</p>
<p>The courses can be represented by vertices, and there is an edge from <code>College Physics</code> to <code>College Physics II</code> since <code>PHYS:1511</code> must be finished before <code>College Physics II</code> can be enrolled.</p>
<figure><a href="/ox-hugo/course_prerequsites.png">
    <img loading="lazy" src="/ox-hugo/course_prerequsites.png"/> </a>
</figure>

<h3 id="job-scheduling"><span class="section-num">2.2</span> Job scheduling</h3>
<p>scheduling a sequence of jobs or tasks based on their dependencies. The jobs are represented by vertices, and there is an edge from <code>x</code> to <code>y</code> if job <code>x</code> must be completed before job <code>y</code> can be started.</p>
<figure><a href="/ox-hugo/job_scheduling.png">
    <img loading="lazy" src="/ox-hugo/job_scheduling.png"/> </a>
</figure>

<p>In the context of a CI/CD pipeline, the relationships between jobs can be represented by directed graph(specifically speaking, by directed acyclic graph). For example, in a CI pipeline, <code>build</code> job should be finished before start <code>test</code> job and <code>lint</code> job.</p>
<h3 id="program-build-dependencies"><span class="section-num">2.3</span> Program build dependencies</h3>
<p>You want to figure out in which order you should compile all the program&rsquo;s dependencies so that you will never try and compile a dependency for which you haven&rsquo;t first built all of its dependencies.</p>
<p>A typical example is <code>GNU Make</code>: you specific your targets in a <code>makefile</code>, <code>Make</code> will parse <code>makefile</code>, and figure out which target should be built firstly. Supposing you have a <code>makefile</code> like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="c"># Makefile for analysis report
</span></span></span><span class="line"><span class="cl"><span class="c"></span>
</span></span><span class="line"><span class="cl"><span class="nf">output/figure_1.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>1.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="err">python</span> <span class="err">scripts/generate_histogram.py</span> <span class="err">-i</span> <span class="err">data/input_file_1.csv</span> <span class="err">-o</span> <span class="err">output/figure_1.png</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">output/figure_2.png</span><span class="o">:</span> <span class="n">data</span>/<span class="n">input_file_</span>2.<span class="n">csv</span> <span class="n">scripts</span>/<span class="n">generate_histogram</span>.<span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="err">python</span> <span class="err">scripts/generate_histogram.py</span> <span class="err">-i</span> <span class="err">data/input_file_2.csv</span> <span class="err">-o</span> <span class="err">output/figure_2.png</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">output/report.pdf</span><span class="o">:</span> <span class="n">report</span>/<span class="n">report</span>.<span class="n">tex</span> <span class="n">output</span>/<span class="n">figure_</span>1.<span class="n">png</span> <span class="n">output</span>/<span class="n">figure_</span>2.<span class="n">png</span>
</span></span><span class="line"><span class="cl"><span class="err">cd</span> <span class="err">report/</span> <span class="err">&amp;&amp;</span> <span class="err">pdflatex</span> <span class="err">report.tex</span> <span class="err">&amp;&amp;</span> <span class="err">mv</span> <span class="err">report.pdf</span> <span class="err">../output/report.pdf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Make</code> will generate a DAG internally to figure out which target should be executed firstly with typological sort:</p>
<figure><a href="/ox-hugo/build_dependencies.png">
    <img loading="lazy" src="/ox-hugo/build_dependencies.png"/> </a>
</figure>

<h2 id="directed-acyclic-graph"><span class="section-num">3</span> Directed Acyclic Graph</h2>
<p>Back to the definition, we say that a topological ordering of a directed graph is a linear ordering of its vertices, but not all directed graphs have a topological ordering.</p>
<p>A topological ordering is possible if and only if the graph has no directed cycles, that is, if it&rsquo;s a directed acyclic graph(DAG).</p>
<p>Let us see some examples:</p>
<figure><a href="/ox-hugo/directed_acyclic_graph.png">
    <img loading="lazy" src="/ox-hugo/directed_acyclic_graph.png"/> </a>
</figure>

<p>The definition requires that only the directed acyclic graph has a topological ordering, but why? What happens if we are trying to find a topological ordering of a directed graph? Let&rsquo;s take the <code>figure 3</code> for an example.</p>
<figure><a href="/ox-hugo/dag_issue.png">
    <img loading="lazy" src="/ox-hugo/dag_issue.png"/> </a>
</figure>

<p>The directed graph problem has no solution, this is the reason why directed cycle is forbidden</p>
<h2 id="kahn-s-algorithm"><span class="section-num">4</span> Kahn&rsquo;s Algorithm</h2>
<p>There are several <a href="https://en.wikipedia.org/wiki/Topological_sorting#Algorithms">algorithms</a> for topological sorting, Kahn&rsquo;s algorithm is one of them, based on breadth first search.</p>
<p>The intuition behind Kahn&rsquo;s algorithm is pretty straightforward:</p>
<p><strong><strong>To repeatedly remove nodes without any dependencies from the graph and add them to the topological ordering</strong></strong></p>
<p>As nodes without dependencies are removed from the graph, the original nodes depend on the removed node should be free now.</p>
<p>We keep removing nodes without dependencies from the graph until all nodes are processed, or a cycle is detected.</p>
<p>The dependencies of one node are represented as in-degree of this node.</p>
<p>Let&rsquo;s take a quick example of how to find out a topological ordering of a given graph with Kahn&rsquo;s algorithm.</p>
<figure><a href="/ox-hugo/kahn%27s_algorithm_1.png">
    <img loading="lazy" src="/ox-hugo/kahn%27s_algorithm_1.png"/> </a>
</figure>

<figure><a href="/ox-hugo/kahn%27s_algorithm_2.png">
    <img loading="lazy" src="/ox-hugo/kahn%27s_algorithm_2.png"/> </a>
</figure>

<figure><a href="/ox-hugo/kahn%27s_algorithm_3.png">
    <img loading="lazy" src="/ox-hugo/kahn%27s_algorithm_3.png"/> </a>
</figure>

<figure><a href="/ox-hugo/kahn%27s_algorithm_4.png">
    <img loading="lazy" src="/ox-hugo/kahn%27s_algorithm_4.png"/> </a>
</figure>

<p>Now we should understand how Kahn&rsquo;s algorithm works. Let&rsquo;s have a look at a C++ implementation of Kahn&rsquo;s algorithm:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;deque&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// Kahn&#39;s algorithm
</span></span></span><span class="line"><span class="cl"><span class="c1">// `adj` is a directed acyclic graph represented as an adjacency list.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">findTopologicalOrder</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="o">&amp;</span><span class="n">adj</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">adj</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">in_degree</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">to_vertex</span> <span class="p">:</span> <span class="n">adj</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">in_degree</span><span class="p">[</span><span class="n">to_vertex</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// queue contains nodes with no incoming edges
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">queue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">in_degree</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">queue</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">order</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="n">queue</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">cur</span> <span class="o">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">queue</span><span class="p">.</span><span class="n">pop_front</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">order</span><span class="p">[</span><span class="n">index</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">next</span> <span class="p">:</span> <span class="n">adj</span><span class="p">[</span><span class="n">cur</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">in_degree</span><span class="p">[</span><span class="n">next</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">queue</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// there is no cycle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">order</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// return an empty list if there is a cycle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="bonus"><span class="section-num">5</span> Bonus</h2>
<p>When a pregnant woman takes calcium pills, she must make sure also that her diet is rich in vitamin D, since this vitamin makes the absorption of calcium possible.</p>
<p>After reading the demonstration of topological ordering, you (and I) too should take a certain vitamin, metaphorically speaking, to help you absorb. The vitamin D I pick for you (and myself) is two leetcode problems, which involve with the most typical use case of topological ordering &ndash; college class prerequisites:</p>
<ul>
<li><a href="https://leetcode.com/problems/course-schedule/">Course Schedule</a></li>
<li><a href="https://leetcode.com/problems/course-schedule-ii/">Course Schedule II</a></li>
</ul>
<h2 id="reference"><span class="section-num">6</span> Reference</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=cIBFEhD77b4">Topological Sort | Kahn&rsquo;s Algorithm | Graph Theory</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/directed_acyclic_graph/">Directed Acyclic Graph</a></li>
<li><a href="https://gertjanvandenburg.com/files/talk/make.html">Hands-on Tutorial on Make</a></li>
<li><a href="https://en.wikipedia.org/wiki/Topological_sorting">Topological sorting</a></li>
</ul>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
    <item>
      <title>å…³äºåˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€IDçš„æ¢ç©¶</title>
      <link>https://ramsayleung.github.io/zh/post/2017/distributed_system_unique_id/</link>
      <pubDate>Tue, 23 May 2017 00:00:00 -0700</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2017/distributed_system_unique_id/</guid>
      <description>An discussion about unique id in distributed system</description>
      <content:encoded><![CDATA[<p>æœ€è¿‘æˆ‘éœ€è¦ä¸ºè¿è¡Œçš„åˆ†å¸ƒå¼ç³»ç»ŸæŸéƒ¨åˆ†æ¨¡å—æ„é€ ç³»ç»Ÿå”¯ä¸€çš„ID, è€Œ ID éœ€è¦æ˜¯æ•°å­—çš„å½¢å¼ï¼Œå¹¶åº”è¯¥å°½é‡çš„çŸ­ã€‚ä¸å¾—ä¸è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜</p>
<h2 id="è‹¥å¹²å®ç°ç­–ç•¥"><span class="section-num">1</span> è‹¥å¹²å®ç°ç­–ç•¥</h2>
<p>æŸ¥é˜…å®Œç›¸å…³çš„èµ„æ–™ï¼Œå‘ç°ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿç”Ÿæˆå”¯ä¸€ ID æ–¹æ³•æŒºå¤šçš„ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>UUID</li>
<li>ä½¿ç”¨ä¸€ä¸ª ticket server, å³ä¸­å¤®çš„æœåŠ¡å™¨ï¼Œå„ä¸ªèŠ‚ç‚¹éƒ½ä»ä¸­å¤®æœåŠ¡å™¨å– ID</li>
<li>Twitter çš„ Snowflake ç®—æ³•</li>
<li>Boundary çš„ flake ç®—æ³•</li>
</ul>
<p>å…¶ä¸­ UUID ç”Ÿæˆçš„ ID æ˜¯å­—ç¬¦ä¸²ï¼‹æ•°å­—ï¼Œä¸é€‚ç”¨ï¼› ticket server çš„åšæ³•ç•¥éº»çƒ¦ï¼Œæˆ‘
å¹¶ä¸æƒ³ä¸ºäº†ä¸ª ID è¿˜è¦å»è®¿é—®ä¸­å¤®æœåŠ¡å™¨ï¼›å‰©ä¸‹å°±æ˜¯ Snowflake å’Œ flake ç®—æ³•ï¼Œ
flake ç®—æ³•ç”Ÿæˆçš„æ˜¯ 128 ä½çš„ ID, ç•¥é•¿ï¼›æ‰€ä»¥æœ€åæˆ‘é€‰æ‹©äº† Snowflake ç®—æ³•ã€‚</p>
<h2 id="snowflake-ç®—æ³•å®ç°"><span class="section-num">2</span> Snowflake ç®—æ³•å®ç°</h2>
<p>æœ¬æ¥ Twitter çš„ç®—æ³•æ˜¯æœ‰ç›¸åº”å®ç°çš„ï¼Œä¸è¿‡åæ¥åˆ é™¤äº†ï¼›æˆ‘å°±åªå¥½è‡ªå·±å·èµ·è¢–å­è‡ªå·± å®ç°äº†:(</p>
<p>è™½è¯´ Twitter æ²¡æœ‰äº†ç›¸åº”çš„å®ç°ï¼Œä½†æ˜¯ Snowflake ç®—æ³•åŸç†å¾ˆç®€å•ï¼Œå®ç°èµ·æ¥å¹¶ä¸éš¾.</p>
<h3 id="snowflake-ç®—æ³•"><span class="section-num">2.1</span> Snowflake ç®—æ³•</h3>
<p>Snowflake ç®—æ³•ç”Ÿæˆ 64 ä½çš„ ID, ID çš„æ ¼å¼æ˜¯ 41 ä½çš„æ—¶é—´æˆ³ + 10 ä½çš„æˆªæ–­çš„ mac åœ°å€ + 12 ä½é€’å¢åºåˆ—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;id format =&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">timestamp | machineId|sequence
</span></span></span><span class="line"><span class="cl"><span class="s2">41        | 10       |12
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="snowflake-å®ç°"><span class="section-num">2.2</span> Snowflake å®ç°</h3>
<h4 id="ç”Ÿæˆæ—¶é—´æˆ³"><span class="section-num">2.2.1</span> ç”Ÿæˆæ—¶é—´æˆ³</h4>
<p>Java å†…ç½®äº†ç”Ÿæˆç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³çš„æ–¹æ³•ï¼Œéå¸¸ä¾¿åˆ©ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ç”Ÿæˆé€’å¢åºåˆ—"><span class="section-num">2.2.2</span> ç”Ÿæˆé€’å¢åºåˆ—</h4>
<p>12 bits çš„æœ€å¤§å€¼æ˜¯ 2**12=4096, æ‰€ä»¥ç”Ÿæˆé€’å¢åºåˆ—ä¹Ÿéå¸¸ç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sequenceMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4096</span><span class="p">;</span><span class="w"> </span><span class="c1">//2**12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">private</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0L</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">generateId</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//do something</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sequenceMax</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//do something</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è·å–-mac-åœ°å€"><span class="section-num">2.2.3</span> è·å– Mac åœ°å€</h4>
<p>æˆ‘ä»¬é€šè¿‡è·å–å½“å‰æœºå™¨çš„ IP åœ°å€ä»¥è·å–å¯¹åº”çš„ç‰©ç†åœ°å€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">protected</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getMachineId</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">InetAddress</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InetAddress</span><span class="p">.</span><span class="na">getLocalHost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">NetworkInterface</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NetworkInterface</span><span class="p">.</span><span class="na">getByInetAddress</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">network</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">mac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">network</span><span class="p">.</span><span class="na">getHardwareAddress</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">((</span><span class="n">0x000000FF</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">mac</span><span class="o">[</span><span class="n">mac</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                 </span><span class="p">(</span><span class="n">0x0000FF00</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">mac</span><span class="o">[</span><span class="n">mac</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">2</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">8</span><span class="p">)))</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">6</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SocketException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownHostException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åˆå› ä¸º Mac åœ°å€æ˜¯6 ä¸ªå­—èŠ‚ (48 bits)ï¼Œè€Œéœ€è¦çš„åªæ˜¯ 10 bit, æ‰€ä»¥éœ€è¦å–æœ€ä½ä½çš„ 2ä¸ªå­—èŠ‚ (16 bits)ï¼Œç„¶åå³ç§» 6 bits ä»¥è·å– 10 ä¸ª bits çš„ Macåœ°å€</p>
<h3 id="snowflake-å®Œæ•´ä»£ç "><span class="section-num">2.3</span> Snowflake å®Œæ•´ä»£ç </h3>
<p>ä¸‹é¢æ˜¯ Snowflake çš„ Java å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">IdGenerator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   id format  =&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   timestamp |datacenter | sequence</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//   41        |10         |  12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sequenceBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">12</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">machineIdBits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">10L</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">MaxMachineId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">1L</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">1L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">machineIdBits</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">machineIdShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sequenceBits</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">timestampLeftShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sequenceBits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">machineIdBits</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">lock</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">twepoch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1288834974657L</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">machineId</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sequenceMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4096</span><span class="p">;</span><span class="w"> </span><span class="c1">//2**12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">lastTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">1L</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0L</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="n">IdGenerator</span><span class="w">  </span><span class="n">instance</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">IdGenerator</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">IdGenerator</span><span class="w"> </span><span class="n">generator</span><span class="o">=</span><span class="n">instance</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">synchronized</span><span class="p">(</span><span class="n">lock</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">generator</span><span class="o">=</span><span class="n">instance</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">generator</span><span class="o">==</span><span class="kc">null</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">generator</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">IdGenerator</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">instance</span><span class="o">=</span><span class="n">generator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">generator</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">IdGenerator</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">machineId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getMachineId</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">machineId</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MaxMachineId</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">machineId</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Exception</span><span class="p">(</span><span class="s">&#34;machineId &gt; MaxMachineId&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="nf">generateLongId</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lastTimestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Exception</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                </span><span class="s">&#34;Clock moved backwards.  Refusing to generate id for &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                                                                                          </span><span class="n">lastTimestamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; milliseconds.&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastTimestamp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sequenceMax</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tillNextMillis</span><span class="p">(</span><span class="n">lastTimestamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">lastTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">timestamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">twepoch</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">timestampLeftShift</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="n">machineId</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">machineIdShift</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">sequence</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">tillNextMillis</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">lastTimestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lastTimestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getMachineId</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">InetAddress</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InetAddress</span><span class="p">.</span><span class="na">getLocalHost</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">NetworkInterface</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NetworkInterface</span><span class="p">.</span><span class="na">getByInetAddress</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kt">long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">network</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">mac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">network</span><span class="p">.</span><span class="na">getHardwareAddress</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="p">((</span><span class="n">0x000000FF</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">mac</span><span class="o">[</span><span class="n">mac</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">1</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                     </span><span class="p">(</span><span class="n">0x0000FF00</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(((</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">mac</span><span class="o">[</span><span class="n">mac</span><span class="p">.</span><span class="na">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">2</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">8</span><span class="p">)))</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">6</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SocketException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UnknownHostException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GetHardwareIdFailedException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ­£å¦‚æˆ‘æ‰€è¨€ï¼Œç®—æ³•å¹¶ä¸éš¾ï¼Œå°±æ˜¯åˆ†åˆ«è·å–æ—¶é—´æˆ³ï¼Œ mac åœ°å€ï¼Œå’Œé€’å¢åºåˆ—å·ï¼Œç„¶åç§»ä½å¾—åˆ° ID. ä½†æ˜¯åœ¨å…·ä½“çš„å®ç°ä¸­è¿˜æ˜¯æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ç»†èŠ‚çš„ã€‚</p>
<h4 id="çº¿ç¨‹åŒæ­¥"><span class="section-num">2.3.1</span> çº¿ç¨‹åŒæ­¥</h4>
<p>å› ä¸ºç®—æ³•ä¸­ä½¿ç”¨åˆ°é€’å¢çš„åºåˆ—å·æ¥ç”Ÿæˆ ID,è€Œåœ¨å®é™…çš„å¼€å‘æˆ–è€…ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå¯èƒ½ä¸æ­¢ä¸€ä¸ªçº¿ç¨‹åœ¨ä½¿ç”¨ IdGenerator è¿™ä¸ªç±»ï¼Œå¦‚æœè¿™æ ·å°±å¾ˆå®¹æ˜“å‡ºç°ä¸åŒçº¿ç¨‹çš„ç«äº‰é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼æ¥ç”Ÿæˆ ID, ä¸€æ–¹é¢æ›´ç¬¦åˆç”Ÿæˆå™¨çš„è®¾è®¡ï¼Œå¦ä¸€æ–¹é¢å› ä¸ºå¯¹ç”Ÿæˆ IDçš„æ–¹æ³•è¿›è¡Œäº†åŒæ­¥ï¼Œå°±ä¿è¯äº†ä¸ä¼šå‡ºç°ç«äº‰é—®é¢˜ã€‚</p>
<h4 id="åŒä¸€æ¯«ç§’ç”Ÿæˆå¤šä¸ª-id"><span class="section-num">2.3.2</span> åŒä¸€æ¯«ç§’ç”Ÿæˆå¤šä¸ª ID</h4>
<p>å› ä¸ºåºåˆ—å·é•¿åº¦æ˜¯ 12ä¸ª bit, é‚£ä¹ˆåºåˆ—å·æœ€å¤§å€¼å°±æ˜¯2**12=4096äº†ï¼Œæ­¤å¤–æ—¶é—´æˆ³æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çš„ï¼Œè¿™å°±æ˜¯æ„å‘³ç€ï¼Œå½“ä¸€æ¯«ç§’å†…ï¼Œäº§ç”Ÿè¶…è¿‡ 4096 ä¸ª ID çš„æ—¶å€™å°±ä¼šå‡ºç°é‡å¤çš„ID.</p>
<p>è¿™æ ·çš„æƒ…å†µå¹¶ä¸æ˜¯ä¸å¯èƒ½å‘ç”Ÿï¼Œæ‰€ä»¥è¦å¯¹æ­¤è¿›è¡Œå¤„ç†ï¼›æ‰€ä»¥åœ¨ <em>generateId()</em> å‡½æ•°ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastTimestamp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">sequenceMax</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sequence</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tillNextMillis</span><span class="p">(</span><span class="n">lastTimestamp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰ä»¥ä¸Šçš„ä¸€æ®µä»£ç ã€‚å½“ç°åœ¨çš„æ—¶é—´æˆ³ä¸ä¹‹å‰çš„æ—¶é—´æˆ³ä¸€è‡´ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€è¿˜æ˜¯åŒä¸€æ¯«ç§’ï¼Œå¦‚æœåºåˆ—å·ä¸º 0, å°±è¯´æ˜å·²ç»äº§ç”Ÿäº† 4096 ä¸ª IDäº†ï¼Œç»§ç»­äº§ç”Ÿ ID,å°±ä¼šå‡ºç°é‡å¤ ID, æ‰€ä»¥è¦ç­‰å¾…ä¸€æ¯«ç§’ï¼Œè¿™ä¸ªå°±æ˜¯ <em>tillNextMills()</em> å‡½æ•°çš„ä½œç”¨äº†ã€‚</p>
<h2 id="å°ç»“"><span class="section-num">3</span> å°ç»“</h2>
<p>ç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯åœ¨æ‰¾åˆ° Snowflake ç®—æ³•ä¹‹å‰ï¼Œæˆ‘å°è¯•äº†æŒºå¤šçš„ç®—æ³•ï¼Œä½†æ˜¯éƒ½æ˜¯å› ä¸ºä¸ç¬¦åˆè¦æ±‚è€Œè¢«ä¸€ä¸€å¦å†³ï¼Œ è€Œ Snowflake ç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯èƒœåœ¨å®ç”¨ã€‚</p>
<p>æœ€åé™„ä¸Šæˆ‘å†™çš„ snowflake ç®—æ³•çš„ Python å®ç°ï¼š <a href="https://github.com/ramsayleung/snowflake">Snowfloke</a></p>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
    <item>
      <title>çˆ¬è™«é«˜æ•ˆå»é‡ä¹‹å¸ƒéš†è¿‡æ»¤å™¨</title>
      <link>https://ramsayleung.github.io/zh/post/2017/bloom_filter/</link>
      <pubDate>Sun, 09 Apr 2017 00:00:00 +0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2017/bloom_filter/</guid>
      <description>an dscription about bloom filter</description>
      <content:encoded><![CDATA[<p>ç¬”è€…æœ€è¿‘æ€è€ƒå¦‚ä½•ç¼–å†™é«˜æ•ˆçš„çˆ¬è™«; è€Œåœ¨ç¼–å†™é«˜æ•ˆçˆ¬è™«çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå¿…éœ€è§£å†³çš„é—®é¢˜å°±æ˜¯ï¼š
url çš„å»é‡ï¼Œå³å¦‚ä½•åˆ¤åˆ« url æ˜¯å¦å·²ç»è¢«çˆ¬å–ï¼Œå¦‚æœè¢«çˆ¬å–ï¼Œé‚£å°±ä¸è¦é‡å¤çˆ¬å–ã€‚</p>
<p>ä¸€èˆ¬å¦‚æœéœ€è¦çˆ¬å–çš„ç½‘ç«™ä¸æ˜¯éå¸¸åºå¤§çš„è¯ï¼Œä½¿ç”¨Python å†…ç½®çš„ set å°±å¯ä»¥å®ç°å»é‡äº†ï¼Œä½†æ˜¯ä½¿ç”¨ set å†…å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼Œæ­¤å¤–å¯¹äºé‚£äº›ä¸åƒPython é‚£æ ·ç”¨ hash å®ç°çš„ set è€Œè¨€ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ log(N),å®åœ¨éš¾è¯´é«˜æ•ˆã€‚</p>
<h2 id="bloom-filter"><span class="section-num">1</span> Bloom Filter</h2>
<p>é‚£ä¹ˆå¦‚ä½•å®ç°é«˜æ•ˆçš„å»é‡å‘¢ï¼Ÿ ç¬”è€…æŸ¥é˜…èµ„æ–™ä¹‹åå¾—çŸ¥ï¼šä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ (Bloom Filter).</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºå¿«é€Ÿæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å¸ƒéš†è¿‡æ»¤å™¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆHashå‡½æ•°ï¼‰ã€‚</p>
<p>è€Œä¸€èˆ¬çš„åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆé‡Œé¢çš„åšæ³•æ˜¯ï¼šç”¨éœ€è¦åˆ¤æ–­çš„å…ƒç´ å’Œé›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¸€èˆ¬çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚é“¾è¡¨ï¼Œæ ‘ï¼Œéƒ½æ˜¯è¿™ä¹ˆå®ç°çš„ã€‚</p>
<p>ç¼ºç‚¹æ˜¯ï¼šéšç€é›†åˆå…ƒç´ çš„å¢å¤šï¼Œéœ€è¦æ¯”è¾ƒçš„å…ƒç´ ä¹Ÿå¢å¤šï¼Œæ£€ç´¢é€Ÿåº¦å°±è¶Šæ¥è¶Šæ…¢ã€‚</p>
<p>è€Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤é‡å¯ä»¥å®ç°å¸¸æ•°çº§çš„æ—¶é—´å¤æ‚åº¦(æ£€ç´¢æ—¶é—´ä¸éšå…ƒç´ å¢é•¿è€Œå¢åŠ ).é‚£ä¹ˆå¸ƒéš†è¿‡æ»¤å™¨åˆæ˜¯æ€æ ·å®ç°çš„å‘¢</p>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨å®ç°åŸç†"><span class="section-num">1.1</span> å¸ƒéš†è¿‡æ»¤å™¨å®ç°åŸç†</h3>
<p>ä¸€ä¸ªBloom Filteræ˜¯åŸºäºä¸€ä¸ªmä½çš„ä½å‘é‡ï¼ˆBit Vectorï¼‰ï¼Œè¿™äº›ä½å‘é‡çš„åˆå§‹å€¼ä¸º0, å¹¶ä¸”æœ‰ä¸€ç³»åˆ—çš„ hash å‡½æ•°ï¼Œhash å‡½æ•°å€¼åŸŸä¸º1-m.åœ¨ä¸‹é¢ä¾‹å­ä¸­ï¼Œæ˜¯15ä½çš„ä½å‘é‡ï¼Œåˆå§‹å€¼ä¸º0ä»¥ç©ºç™½è¡¨ç¤ºï¼Œä¸º1ä»¥é¢œè‰²å¡«å……</p>
<figure><a href="/ox-hugo/bit_vector.png">
    <img loading="lazy" src="/ox-hugo/bit_vector.png"/> </a>
</figure>

<p>ç°åœ¨æœ‰ä¸¤ä¸ªç®€å•çš„ hash å‡½æ•°ï¼šfnv,murmur.ç°åœ¨æˆ‘è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸² &ldquo;whatever&rdquo; ,ç„¶ååˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ª hash å‡½æ•°å¯¹ &ldquo;whatever&rdquo; è¿›è¡Œæ•£åˆ—è®¡ç®—å¹¶ä¸”æ˜ å°„åˆ°ä¸Šé¢çš„ä½å‘é‡ã€‚</p>
<figure><a href="/ox-hugo/whatever.png">
    <img loading="lazy" src="/ox-hugo/whatever.png"/> </a>
</figure>

<p>å¯çŸ¥ï¼Œä½¿ç”¨ fnv å‡½æ•°è®¡ç®—å‡ºçš„ hash å€¼æ˜¯11,ä½¿ç”¨ murmur å‡½æ•°è®¡ç®—å‡ºçš„ hash å€¼æ˜¯4. ç„¶åæ˜ å°„åˆ°ä½å‘é‡ä¸Šï¼š</p>
<figure><a href="/ox-hugo/bit_vector1.png">
    <img loading="lazy" src="/ox-hugo/bit_vector1.png"/> </a>
</figure>

<p>å¦‚æœä¸‹ä¸€æ¬¡ï¼Œç¬”è€…è¦åˆ¤æ–­ <strong>whatever</strong> æ˜¯å¦åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œåªéœ€ä½¿ç”¨ fnv å’Œ murmur ä¸¤ä¸ª hash å‡½æ•°å¯¹ <strong>whatever</strong> è¿›è¡Œæ•£åˆ—å€¼è®¡ç®—ï¼Œç„¶åä¸ä½å‘é‡åš &ldquo;ä¸è¿ç®—&rdquo;ï¼Œå¦‚æœç»“æœä¸º0, é‚£ä¹ˆè¯´æ˜ <strong>whatever</strong> æ˜¯ä¸åœ¨é›†åˆä¸­çš„ï¼Œå› ä¸ºåŒæ ·çš„å…ƒç´ ä½¿ç”¨åŒä¸€ä¸ª hash å‡½æ•°äº§ç”Ÿçš„å€¼æ¯æ¬¡éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸ç›¸åŒå°±è¯´æ˜ä¸æ˜¯åŒä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>ä½†æ˜¯å¦‚æœ &ldquo;ä¸è¿ç®—&rdquo; çš„ç»“æœä¸º1,æ˜¯å¦å¯ä»¥è¯´æ˜ <strong>whatever</strong> å°±åœ¨é›†åˆä¸­å‘¢ï¼Ÿå…¶å®ä¸Šæ˜¯ä¸èƒ½100% ç¡®å®šçš„ï¼Œå› ä¸º hash å‡½æ•°å­˜åœ¨æ•£åˆ—å†²çªç°è±¡ (å³ä¸¤ä¸ªæ•£åˆ—å€¼ç›¸åŒï¼Œä½†ä¸¤ä¸ªè¾“å…¥å€¼æ˜¯ä¸åŒçš„), æ‰€ä»¥å¸ƒéš†è¿‡æ»¤å™¨åªèƒ½è¯´&quot;æˆ‘å¯ä»¥è¯´è¿™ä¸ªå…ƒç´ æˆ‘åœ¨é›†åˆä¸­æ˜¯çœ‹è§è¿‡æ»´ï¼Œåªæ˜¯æˆ‘æœ‰ä¸€å®šçš„ä¸ç¡®å®šæ€§&quot;.</p>
<p>å½“ä½ åœ¨åˆ†é…çš„å†…å­˜è¶³å¤Ÿå¤§ä¹‹åï¼Œä¸ç¡®å®šæ€§ä¼šå˜å¾—å¾ˆå°å¾ˆå°ã€‚</p>
<p>ä½ å¯ä»¥çœ‹åˆ°å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥æœ‰æ•ˆåˆ©ç”¨å†…å­˜å®ç°å¸¸æ•°çº§çš„åˆ¤é‡ä»»åŠ¡ï¼Œä½†æ˜¯é±¼å’Œç†ŠæŒä¸å¯å¾—å…¼ï¼Œä»˜å‡ºçš„ä»£ä»·å°±æ˜¯ä¸€å®šçš„è¯¯åˆ¤ (æœºç‡å¾ˆå°),æ‰€ä»¥æœ¬è´¨ä¸Šï¼Œå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ &ldquo;æ¦‚ç‡æ•°æ®ç»“æ„ (probabilistic data structure)&rdquo;.</p>
<p>è¿™ä¸ªå°±æ˜¯å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬åŸç†ã€‚å½“ç„¶ï¼Œä½å‘é‡ä¸ä¼šåªæ˜¯15ä½ï¼Œhashå‡½æ•°ä¹Ÿä¸ä¼šä»…æ˜¯ä¸¤ä¸ªç®€å•çš„å‡½æ•°. è¿™åªæ˜¯ç®€åŒ–æèŠ‚ï¼Œä¸ºäº†æ¸…æ™°è§£è¿°åŸç†è€Œå·²ã€‚</p>
<h2 id="python-bloomfilter"><span class="section-num">2</span> Python BloomFilter</h2>
<p>ç®—æ³•éƒ½æ˜¯ä¸ºäº†å®é™…é—®é¢˜æœåŠ¡çš„ï¼Œåˆå›åˆ°çˆ¬è™«è¿™ä¸ªè¯é¢˜ä¸Šã€‚åœ¨äº†è§£å¸ƒéš†è¿‡æ»¤å™¨åŸç†ä¹‹åï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°è‡ªå·±çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½†æ˜¯æƒ³è¦å®ç°ä¸€ä¸ªé«˜æ•ˆå¥å£®çš„å¸ƒéš†è¿‡æ»¤å™¨å°±éœ€è¦æ¯”è¾ƒå¤šçš„åŠŸå¤«äº†ï¼Œå› ä¸ºéœ€è¦è€ƒè™‘çš„é—®é¢˜ç•¥å¤šã€‚</p>
<p>å¹¸å¥½ï¼Œå¾—ç›ŠPython å¼ºå¤§çš„ç¤¾åŒºï¼Œå·²ç»æœ‰<a href="https://axiak.github.io/pybloomfiltermmap/">Python BloomFilter</a> çš„åº“ã€‚ä¸€ä¸ªæ–‡æ¡£ä¸­çš„ç®€å•ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pybloomfilter</span> <span class="kn">import</span> <span class="n">BloomFilter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bf</span> <span class="o">=</span> <span class="n">BloomFilter</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;filter.bloom&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/usr/share/dict/words&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">bf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;apple&#39;</span> <span class="ow">in</span> <span class="n">bf</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“æœä¸º <strong>True</strong></p>
<h2 id="æ€»ç»“"><span class="section-num">3</span> æ€»ç»“</h2>
<p>åŸç†å°±è¯´å¾—å·®ä¸å¤šäº†ï¼Œè¦æƒ³å¯¹å¸ƒéš†è¿‡æ»¤å™¨æœ‰æ›´æ·±çš„è®¤è¯†ï¼Œè¿˜éœ€è¦æ›´å¤šçš„å®æˆ˜ã€‚å¤šå†™ï¼Œå¤šæ€è€ƒã€‚ Enjoy Python,Enjoy Crawler :)</p>
<h2 id="å‚è€ƒ"><span class="section-num">4</span> å‚è€ƒ</h2>
<ul>
<li><a href="https://llimllib.github.io/bloomfilter-tutorial/">https://llimllib.github.io/bloomfilter-tutorial/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Bloom_filter">https://en.wikipedia.org/wiki/Bloom_filter</a></li>
</ul>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
    <item>
      <title>å½’å¹¶æ’åºç®—æ³•æ”¹è¿›</title>
      <link>https://ramsayleung.github.io/zh/post/2017/merge-sort-improvment/</link>
      <pubDate>Wed, 01 Mar 2017 00:00:00 +0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2017/merge-sort-improvment/</guid>
      <description>An introduction about how to improve merge-sort algorithms</description>
      <content:encoded><![CDATA[<p>æœ€è¿‘ç¬”è€…åœ¨é˜…è¯»ã€Š<a href="http://algs4.cs.princeton.edu/home/">ç®—æ³•ã€‹</a>,é‡æ¸©ç»å…¸æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œæ¯•ç«Ÿä¸€ç›´ä»¥æ¥çš„è¯´æ³•æ˜¯ç¨‹åºå°±æ˜¯æ•°æ®ç»“æ„ï¼‹ç®—æ³•å½’å¹¶ç®—æ³•æ‰€éœ€çš„æ—¶é—´å’ŒN*logNæˆæ­£æ¯”ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å½’å¹¶ç®—æ³•å¤„ç†æ•°ç™¾ä¸‡ç”šè‡³æ›´å¤§è§„æ¨¡çš„æ•°æ®ã€‚</p>
<p>ä½†æ˜¯å½’å¹¶ç®—æ³•ä¹Ÿæ˜¯å­˜åœ¨ä¸è¶³ä¹‹å¤„çš„ï¼Œéœ€è¦é¢å¤–çš„ç©ºé—´æ¥å®Œæˆæ’åºï¼Œè€Œä¸”ç©ºé—´å’ŒNçš„ å¤§å°ä¹Ÿæ˜¯æˆæ­£æ¯”çš„</p>
<h2 id="ä¼˜åŒ–"><span class="section-num">1</span> ä¼˜åŒ–</h2>
<p>ã€Šç®—æ³•ã€‹ä¸­æœ‰æåˆ°å¯ä»¥é€šè¿‡ä¸€äº›ç»†è‡´çš„ä¿®æ”¹å®ç°å¤§å¹…åº¦ç¼©çŸ­å½’å¹¶æ’åºçš„è¿è¡Œæ—¶é—´</p>
<h3 id="å¯¹å°è§„æ¨¡å­æ•°ç»„ä½¿ç”¨æ’å…¥æ’åº"><span class="section-num">1.1</span> å¯¹å°è§„æ¨¡å­æ•°ç»„ä½¿ç”¨æ’å…¥æ’åº</h3>
<p>å› ä¸ºé€’å½’ä¼šä½¿å°è§„æ¨¡é—®é¢˜ä¸­çš„æ–¹æ³•è¢«é¢‘ç¹è°ƒç”¨ï¼Œæ‰€ä»¥æ”¹è¿›å¯¹å®ƒä»¬çš„å¤„ç†æ–¹æ³•å°±èƒ½æ”¹è¿›æ•´ä¸ªç®—æ³•ã€‚</p>
<p>å¯¹äºå°æ•°ç»„å¯ä»¥ä½¿ç”¨æ’å…¥æ’åºæˆ–è€…é€‰æ‹©æ’åºæ¥é¿å…é€’å½’è°ƒç”¨ã€‚<a href="https://github.com/samrayleung/AlgorithmsCode">å®Œæ•´ä»£ç </a></p>
<h4 id="æœªæ”¹è¿›å½’å¹¶æ’åº"><span class="section-num">1.1.1</span> æœªæ”¹è¿›å½’å¹¶æ’åº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">aux</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">hi</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">&lt;=</span><span class="n">lo</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">lo</span><span class="o">+</span><span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span><span class="cm">/*å°†å·¦åŠè¾¹æ’åº*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="n">1</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="cm">/*å°†å³åŠè¾¹æ’åº*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ”¹è¿›åå½’å¹¶æ’åº"><span class="section-num">1.1.2</span> æ”¹è¿›åå½’å¹¶æ’åº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">aux</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">hi</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">&lt;=</span><span class="n">lo</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="o">&lt;</span><span class="n">15</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">insertionSort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">hi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lo</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><figure>
    <img loading="lazy" src="http://algs4.cs.princeton.edu/22mergesort/images/mergesortTD-bars.png"
         alt="Figure 1: è½¨è¿¹å›¾å¦‚ä¸Šï¼š(å›¾æ¥æºäºã€Šç®—æ³•ã€‹)"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>è½¨è¿¹å›¾å¦‚ä¸Šï¼š(å›¾æ¥æºäºã€Šç®—æ³•ã€‹)</p>
        </figcaption>
</figure>

<p>ã€Šç®—æ³•ã€‹ ä¸­æåˆ°æ’å…¥æ’åºå¤„ç†å°è§„æ¨¡çš„å­æ•°ç»„(æ¯”å¦‚é•¿åº¦å°äº15) ä¸€èˆ¬å¯ä»¥å°†å½’å¹¶æ’åºçš„è¿è¡Œæ—¶é—´ç¼©çŸ­10%-15%. å®è·µå‡ºçœŸçŸ¥ï¼Œè¿˜æ˜¯è¦è‡ªå·±æ¥æµ‹è¯•ä¸€ä¸‹æ›´ä½³ã€‚</p>
<h4 id="æµ‹è¯•1"><span class="section-num">1.1.3</span> æµ‹è¯•1</h4>
<p>å¯¹100*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure><a href="/ox-hugo/100*1000-1.png">
    <img loading="lazy" src="/ox-hugo/100*1000-1.png"/> </a>
</figure>

<h4 id="æµ‹è¯•2"><span class="section-num">1.1.4</span> æµ‹è¯•2</h4>
<p>å¯¹1000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure><a href="/ox-hugo/1000*1000-1.png">
    <img loading="lazy" src="/ox-hugo/1000*1000-1.png"/> </a>
</figure>

<h4 id="æµ‹è¯•3"><span class="section-num">1.1.5</span> æµ‹è¯•3</h4>
<p>å¯¹10000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹</p>
<figure><a href="/ox-hugo/10000*1000-1.png">
    <img loading="lazy" src="/ox-hugo/10000*1000-1.png"/> </a>
</figure>

<h4 id="æµ‹è¯•4"><span class="section-num">1.1.6</span> æµ‹è¯•4</h4>
<p>å¯¹100000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹</p>
<figure><a href="/ox-hugo/1000000*1000-1.png">
    <img loading="lazy" src="/ox-hugo/1000000*1000-1.png"/> </a>
</figure>

<h4 id="æµ‹è¯•5"><span class="section-num">1.1.7</span> æµ‹è¯•5</h4>
<p>å¯¹500000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹</p>
<figure><a href="/ox-hugo/500000*1000-1.png">
    <img loading="lazy" src="/ox-hugo/500000*1000-1.png"/> </a>
</figure>

<h4 id="å°ç»“"><span class="section-num">1.1.8</span> å°ç»“</h4>
<p>ç”±äºç¯‡å¹…é—®é¢˜ï¼Œæˆ‘æ— æ³•å°†æ‰€æœ‰çš„æµ‹è¯•ç»“æœéƒ½å±•ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯ä»ä¸Šé¢çš„ç»“æœï¼Œå¯ä»¥çœ‹å‡ºå¯¹äºå°æ•°ç»„ï¼Œä½¿ç”¨æ’å…¥æ’åºçš„ç¡®å¯¹æ€§èƒ½æœ‰ä¸€å®šå¹…åº¦æé«˜(æœ€å¼€å§‹çš„æµ‹è¯•å¯èƒ½å› ä¸ºæ•°æ®é‡å¤ªå°æ‰€ä»¥ç»“æœè¯¯å·®è¾ƒå¤§ï¼Œä½†æ˜¯è¿™å¹¶ä¸å¦¨ç¢å¾—å‡ºä¸€ä¸ªæ¯”è¾ƒæ¥è¿‘çš„ç»“æœ).</p>
<p>ä½†æ˜¯éšç€æ•°æ®é‡çš„å¢å¤§æ”¹è¿›å½’å¹¶ç®—æ³•æ€§èƒ½ä¼¼ä¹å¼€å§‹ä¸‹é™ (æœªç»è¿‡ç²¾ç¡®æ•°æ®éªŒè¯)</p>
<h3 id="æµ‹è¯•æ•°ç»„æ˜¯å¦å·²ç»æœ‰åº"><span class="section-num">1.2</span> æµ‹è¯•æ•°ç»„æ˜¯å¦å·²ç»æœ‰åº</h3>
<p>å¯ä»¥æ·»åŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœ a[mid]å°äºç­‰äº a[mid+1],ä¾¿å¯è®¤ä¸ºæ•°ç»„å·²ç»æœ‰åºå¹¶è·³è¿‡ <code>merge</code> æ–¹æ³•ã€‚è¿™ä¸ªæ”¹åŠ¨ä¸å½±å“æ’åºçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯ä»»æ„æœ‰åºçš„å­æ•°ç»„ç®—æ³•çš„è¿è¡Œæ—¶é—´éƒ½å˜æˆçº¿æ€§çš„äº†</p>
<h4 id="æœªæ”¹è¿›å½’å¹¶æ’åº"><span class="section-num">1.2.1</span> æœªæ”¹è¿›å½’å¹¶æ’åº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">aux</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">hi</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">&lt;=</span><span class="n">lo</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="o">=</span><span class="n">lo</span><span class="o">+</span><span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">mid</span><span class="p">);</span><span class="cm">/*å°†å·¦åŠè¾¹æ’åº*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="n">1</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="cm">/*å°†å³åŠè¾¹æ’åº*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æ”¹è¿›åå½’å¹¶æ’åº"><span class="section-num">1.2.2</span> æ”¹è¿›åå½’å¹¶æ’åº</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">Comparable</span><span class="o">[]</span><span class="w"> </span><span class="n">aux</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">hi</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">&lt;=</span><span class="n">lo</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="o">&lt;</span><span class="n">15</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">insertionSort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kt">int</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">hi</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lo</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="w"> </span><span class="n">lo</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="p">(</span><span class="n">less</span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">mid</span><span class="o">+</span><span class="n">1</span><span class="o">]</span><span class="p">,</span><span class="n">a</span><span class="o">[</span><span class="n">mid</span><span class="o">]</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="n">merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">aux</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="w"> </span><span class="n">hi</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æµ‹è¯•1"><span class="section-num">1.2.3</span> æµ‹è¯•1</h4>
<p>å¯¹100*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š
<a href="/ox-hugo/100*1000-2.png"><img loading="lazy" src="/ox-hugo/100*1000-2.png" alt=""  />
</a></p>
<h4 id="æµ‹è¯•2"><span class="section-num">1.2.4</span> æµ‹è¯•2</h4>
<p>å¯¹1000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š
<a href="/ox-hugo/1000*1000-2.png"><img loading="lazy" src="/ox-hugo/1000*1000-2.png" alt=""  />
</a></p>
<h4 id="æµ‹è¯•3"><span class="section-num">1.2.5</span> æµ‹è¯•3</h4>
<p>å¯¹10000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š
<a href="/ox-hugo/10000*1000-2.png"><img loading="lazy" src="/ox-hugo/10000*1000-2.png" alt=""  />
</a></p>
<h4 id="æµ‹è¯•4"><span class="section-num">1.2.6</span> æµ‹è¯•4</h4>
<p>å¯¹100000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š
<a href="/ox-hugo/100000*1000-2.png"><img loading="lazy" src="/ox-hugo/100000*1000-2.png" alt=""  />
</a></p>
<h4 id="æµ‹è¯•5"><span class="section-num">1.2.7</span> æµ‹è¯•5</h4>
<p>å¯¹500000*1000 ä¸ªå­—ç¬¦è¿›è¡Œæ’åºï¼Œç»“æœå¦‚ä¸‹ï¼š
<a href="/ox-hugo/500000*1000-2.png"><img loading="lazy" src="/ox-hugo/500000*1000-2.png" alt=""  />
</a></p>
<h4 id="å°ç»“"><span class="section-num">1.2.8</span> å°ç»“</h4>
<p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåªæ˜¯æ·»åŠ äº†ä¸€ä¸ªåˆ¤æ–­æ•°ç»„æ˜¯å¦å·²ç»æœ‰åºçš„æ¡ä»¶ï¼Œç®—æ³•æ€§èƒ½å°±ä¼˜åŒ–äº† å¤§æ¦‚20%å·¦å³(æœªç»è¿‡ç²¾ç¡®æ•°æ®éªŒè¯), ä¸å¾—ä¸è¯´çœŸçš„ä»¤äººæƒŠè®¶ã€‚</p>
<p><strong><strong>æ³¨æ„</strong></strong>:
è¿è¡Œç»“æœè·Ÿæ“ä½œç³»ç»Ÿï¼Œç”µè„‘é…ç½®ï¼Œä»¥åŠè¿è¡Œæ¬¡æ•°éƒ½ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨çš„ä¹Ÿåªæ˜¯å¾ˆç²—ç•¥çš„æ•°æ®</p>
<h3 id="å‚è€ƒ"><span class="section-num">1.3</span> å‚è€ƒ</h3>
<p><a href="http://algs4.cs.princeton.edu/home/h">http://algs4.cs.princeton.edu/home/h</a></p>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>
