<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>javascript on è¿‡æ²³å’</title>
    <link>https://ramsayleung.github.io/zh/tags/javascript/</link>
    <description>Recent content in javascript on è¿‡æ²³å’</description>
    <image>
      <title>è¿‡æ²³å’</title>
      <url>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.120.4</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 Â·</copyright>
    <lastBuildDate>Thu, 09 Jan 2025 20:05:21 -0800</lastBuildDate>
    <atom:link href="https://ramsayleung.github.io/zh/tags/javascript/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>TamperMonkey userscriptåœ¨ Single Page Application è·³è½¬é“¾æ¥åä¸è¿è¡Œé—®é¢˜åˆ†æ</title>
      <link>https://ramsayleung.github.io/zh/post/2023/tampermonkey_userscript_not_invokved_in_spa/</link>
      <pubDate>Sat, 26 Aug 2023 09:29:00 -0700</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2023/tampermonkey_userscript_not_invokved_in_spa/</guid>
      <description>1 èƒŒæ™¯ æˆ‘ä¹ æƒ¯ä½¿ç”¨æµè§ˆå™¨åŒ¿åæ¨¡å¼æ¥æ‰“å¼€ Youtube è§†é¢‘ï¼Œé¿å… Youtube çš„æ¨èç®—æ³•ç»™æˆ‘æ€»æ˜¯æ¨èåŒä¸€ç±»çš„è§†é¢‘ã€‚ ä½†æœ‰ä¸ªé—®é¢˜: åŒ¿åæ¨¡å¼ä¸‹ï¼ŒYoutubeçš„æ’­æ”¾å™¨æ˜¯é»˜è®¤è‡ª</description>
      <content:encoded><![CDATA[<h2 id="èƒŒæ™¯"><span class="section-num">1</span> èƒŒæ™¯</h2>
<p>æˆ‘ä¹ æƒ¯ä½¿ç”¨æµè§ˆå™¨åŒ¿åæ¨¡å¼æ¥æ‰“å¼€ Youtube è§†é¢‘ï¼Œé¿å… Youtube çš„æ¨èç®—æ³•ç»™æˆ‘æ€»æ˜¯æ¨èåŒä¸€ç±»çš„è§†é¢‘ã€‚ <br/></p>
<p>ä½†æœ‰ä¸ªé—®é¢˜: åŒ¿åæ¨¡å¼ä¸‹ï¼ŒYoutubeçš„æ’­æ”¾å™¨æ˜¯é»˜è®¤è‡ªåŠ¨æ’­æ”¾çš„ã€‚ <br/></p>
<p>è™½ç„¶æˆ‘å¯ä»¥ç™»å½• Google è´¦å·å¹¶å…³é—­è‡ªåŠ¨æ’­æ”¾ï¼Œä½†æ˜¯æ¯æ¬¡æˆ‘ä½¿ç”¨åŒ¿åæ¨¡å¼æ¥æµè§ˆï¼Œå…³é—­çª—å£ä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œè®°å½•éƒ½ä¼šè¢«æ¸…é™¤äº†ï¼Œè‡ªåŠ¨æ’­æ”¾è®¾ç½®ä¹Ÿä¸ä¼šè¢«ä¿å­˜ã€‚ <br/></p>
<p>æ‰€ä»¥æˆ‘ä½¿ç”¨ TamperMonkey ç»™ Youtubeå†™äº†ä¸€ä¸ªå…³é—­è‡ªåŠ¨æ’­æ”¾çš„è„šæœ¬ï¼Œæ‰“å¼€ Youtube æ’­æ”¾å™¨æ—¶ï¼ŒæŠŠè‡ªåŠ¨æ’­æ”¾æŒ‰é’®ç»™å…³é—­æ‰ï¼Œé¿å…æˆ‘ä½¿ç”¨æµè§ˆå™¨çš„åŒ¿åçª—å£æ‰“å¼€ Youtube ä¹‹åï¼ŒYoutubeè‡ªåŠ¨æ’­æ”¾å¯¼è‡´ä¸€ç›´æœ‰å£°éŸ³ã€‚ <br/></p>
<p>è„šæœ¬é€»è¾‘å¾ˆç®€å•ï¼š <br/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// ==UserScript==
</span></span></span><span class="line"><span class="cl"><span class="c1">// @name         Disable YouTube Autoplay
</span></span></span><span class="line"><span class="cl"><span class="c1">// @namespace    http://tampermonkey.net/
</span></span></span><span class="line"><span class="cl"><span class="c1">// @version      0.1
</span></span></span><span class="line"><span class="cl"><span class="c1">// @description  Automatically turn off YouTube autoplay
</span></span></span><span class="line"><span class="cl"><span class="c1">// @author       ramsayliang
</span></span></span><span class="line"><span class="cl"><span class="c1">// @match        https://*.youtube.com/*
</span></span></span><span class="line"><span class="cl"><span class="c1">// @grant        none
</span></span></span><span class="line"><span class="cl"><span class="c1">// @icon         https://www.youtube.com/favicon.ico
</span></span></span><span class="line"><span class="cl"><span class="c1">// ==/UserScript==
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Function to disable autoplay
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">function</span> <span class="nx">disableAutoplay</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;disableAutoplay&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">autoplayToggle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;div[class=&#34;ytp-autonav-toggle-button&#34;]&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">autoplayToggle</span> <span class="o">&amp;&amp;</span> <span class="nx">autoplayToggle</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;aria-checked&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;true&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">autoplayToggle</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Disable YouTube Autoplay&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Before loading&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Run the function when the page loads
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Wait for a short delay to ensure the page fully loads
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// setTimeout(disableAutoplay, 8000);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Loading page..&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">disableAutoplay</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="é—®é¢˜"><span class="section-num">2</span> é—®é¢˜</h2>
<p>ä½†æ˜¯æˆ‘å‘ç°è¿™ä¸ªè„šæœ¬æ—¶çµä¸çµï¼Œç”šè‡³æœ‰ä¸€å¤©æ™šä¸Šï¼Œç¡ç€ä¹‹åè¢«è‡ªåŠ¨æ’­æ”¾çš„å£°éŸ³åµé†’äº†ã€‚ <br/></p>
<p>æˆ‘å°±åœ¨æ‰¾èƒ½ç¨³å®šå¤ç°è¿™ä¸ªé—®é¢˜çš„åœºæ™¯ï¼ŒèŠ±è´¹åŠä¸ªå°æ—¶ï¼Œç»ˆäºèƒ½ç¨³å®šå¤ç°é—®é¢˜äº†ã€‚ <br/></p>
<ol>
<li>æ‰“å¼€ Chrome çš„åŒ¿åæ¨¡å¼ <br/></li>
<li>æ‰“å¼€ Youtube é¦–é¡µ, åœ°å€æ˜¯: youtube.com, è„šæœ¬è¿è¡Œ. <br/></li>
<li>éšæ„ç‚¹å‡»ä¸€ä¸ªè§†é¢‘ï¼Œè¿›è¡Œæ’­æ”¾ï¼š<a href="https://www.youtube.com/watch?v=-pKGaxoVhok">https://www.youtube.com/watch?v=-pKGaxoVhok</a> ï¼Œè„šæœ¬å°±ä¸ä¼šè¿è¡Œäº†ã€‚ <br/></li>
<li>å¦‚æœæˆ‘åœ¨è§†é¢‘æ’­æ”¾é¡µåˆ·æ–°ï¼Œè„šæœ¬åˆä¼šé‡æ–°è¿è¡Œã€‚ <br/></li>
</ol>
<p>ä½†åˆ†æäº†1ä¸ªå°æ—¶ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œæˆ‘ç”šè‡³æ€€ç–‘æ˜¯ Tampermonkey æœ‰Bug(è™½ç„¶ä¸»è§‚æ„Ÿè§‰è¿™ä¸ªå¯èƒ½æ€§è¾ƒå°) <br/></p>
<h2 id="åˆ†æ"><span class="section-num">3</span> åˆ†æ</h2>
<p>ç»“åˆ Tampermonkey çš„è¡¨ç°ï¼Œæˆ‘è§‰å¾—å¯èƒ½æ˜¯ Tampermonkey çš„æ‰§è¡Œæœºåˆ¶æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯åˆ¤æ–­ youtube.com å’Œ youtube.com/watch?v=xxxx æ˜¯åŒä¸€ä¸ªé¡µé¢ï¼Œå°±ä¸ä¼šè¿è¡Œä¸¤æ¬¡ã€‚ <br/></p>
<p>åœ¨Stackoverflowä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°æœç„¶å¦‚æ­¤ï¼š <br/></p>
<ul>
<li><a href="https://stackoverflow.com/questions/65017670/tampermonkey-match-not-working-when-visit-target-link-through-redirection">https://stackoverflow.com/questions/65017670/tampermonkey-match-not-working-when-visit-target-link-through-redirection</a> <br/></li>
</ul>
<p>åŸæ¥è¿™ä¸ªæ˜¯feature, ä¸æ˜¯bug. <br/></p>
<p>å¯¹äº Single Page Application, Tampermonkey æ— æ³•åˆ¤æ–­é¡µé¢çš„ DOM æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯å¦è®¿é—®åˆ°æ–°çš„é¡µé¢äº†ï¼Œæ‰€ä»¥ä¸ä¼šé‡å¤æ‰§è¡Œã€‚ <br/></p>
<p>åˆ†æä¸‹æ¥ï¼Œä¹‹å‰è„šæœ¬èƒ½ç›´æ¥ç”Ÿæ•ˆçš„åŸå› æ˜¯, æˆ‘åœ¨Chromeæ­£å¸¸æ¨¡å¼ä¸‹æ‰“å¼€ Youtube é¦–é¡µ, å³é”®å¯¹æƒ³è¦çœ‹çš„è§†é¢‘ï¼Œç‚¹å‡»&quot;Open link in incognito window&quot;, å› ä¸ºé¡µé¢æ˜¯é¦–æ¬¡æ‰“å¼€ï¼Œæ‰€ä»¥å°±èƒ½æ­£å¸¸è¿è¡Œã€‚ <br/></p>
<p>
<figure>
    
    
    <input type="checkbox" id="zoomCheck-5ab73" hidden>
    <label for="zoomCheck-5ab73">
    
    
    <img class="zoomCheck" loading="lazy" src="/ox-hugo/youtube_open_link_in_incognito_window.png"/> 
    
    
    </label>
</figure>
 <br/></p>
<p>ä½†å½“é€šè¿‡Chrome åŒ¿åæ¨¡å¼æ‰“å¼€ Youtube é¦–é¡µï¼Œç„¶åå†ç‚¹å‡»è§†é¢‘æ’­æ”¾ï¼Œæ— æ³•è¿è¡Œè„šæœ¬ã€‚ <br/></p>
<p>å› ä¸ºåœ¨æ‰“å¼€é¦–é¡µçš„æ—¶å€™ï¼Œè„šæœ¬å·²ç»è¿è¡Œè¿‡äº†ï¼Œå½“ç‚¹å‡»è·³è½¬åˆ°æŒ‡å®šçš„è§†é¢‘æ—¶ï¼Œä¸” Youtube æ˜¯ä¸ª Single Page Application, å¯¹è„šæœ¬æ¥è¯´ï¼Œé¡µé¢å°±æ²¡æœ‰å‘ç”Ÿè¿‡å˜åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šå†è¿è¡Œã€‚ <br/></p>
<p>å¦‚æœæ‰‹åŠ¨åˆ·æ–°ï¼Œé¡µé¢é‡æ–°åŠ è½½ï¼Œè„šæœ¬å°±åˆä¼šè¢«åŠ è½½ã€‚ <br/></p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><span class="section-num">4</span> è§£å†³æ–¹æ¡ˆ</h2>
<p>æœ€åé€šè¿‡ <a href="https://stackoverflow.com/a/39508954">Stackoverflow</a> çš„å»ºè®®ï¼Œå¢åŠ ä¸€ä¸ªå¯¹ DOM äº‹ä»¶å˜åŒ–çš„ç›‘å¬æ¥è§£å†³ï¼š <br/></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// https://stackoverflow.com/questions/2844565/is-there-a-javascript-jquery-dom-change-listener/39508954#39508954
</span></span></span><span class="line"><span class="cl"><span class="c1">// Detect the url change for programmatic navigation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">lastUrl</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">url</span> <span class="o">!==</span> <span class="nx">lastUrl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">lastUrl</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">onUrlChange</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}).</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="p">{</span><span class="nx">subtree</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">childList</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// callback when url change
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">onUrlChange</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;URL changed!&#39;</span><span class="p">,</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">isYouTubeVideoURL</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">disableAutoplay</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚ <br/></p>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>
