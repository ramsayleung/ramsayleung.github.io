<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>test on è¿‡æ²³å’</title>
    <link>https://ramsayleung.github.io/zh/tags/test/</link>
    <description>Recent content in test on è¿‡æ²³å’</description>
    <image>
      <title>è¿‡æ²³å’</title>
      <url>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.120.4</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 Â·</copyright>
    <lastBuildDate>Fri, 25 Feb 2022 09:49:13 +0800</lastBuildDate>
    <atom:link href="https://ramsayleung.github.io/zh/tags/test/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>How to fool the Jacoco â—œâ—¡â€¾</title>
      <link>https://ramsayleung.github.io/zh/post/2019/%E5%A6%82%E4%BD%95%E5%88%B7pojo%E7%B1%BB%E7%9A%84%E5%8F%98%E6%9B%B4%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87/</link>
      <pubDate>Thu, 14 Mar 2019 11:14:00 +0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2019/%E5%A6%82%E4%BD%95%E5%88%B7pojo%E7%B1%BB%E7%9A%84%E5%8F%98%E6%9B%B4%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87/</guid>
      <description>åˆ·POJOç±»çš„å˜æ›´è¡Œè¦†ç›–ç‡ 1 åå°„å¤§æ³•å¥½ 1.1 èƒŒæ™¯ ä¼—æ‰€å‘¨çŸ¥ï¼Œèš‚èšå¯¹ä»£ç è´¨é‡è¦æ±‚å¾ˆé«˜ï¼Œè´¨é‡çº¢çº¿å…¶ä¸­ä¸€é¡¹æŒ‡æ ‡å°±æ˜¯å˜æ›´è¡Œè¦†ç›–ç‡ã€‚å¦‚æœä½ çš„å˜æ›´è¡Œè¦†ç›–ç‡æ²¡æœ‰</description>
      <content:encoded><![CDATA[<p>åˆ·POJOç±»çš„å˜æ›´è¡Œè¦†ç›–ç‡</p>
<h2 id="åå°„å¤§æ³•å¥½"><span class="section-num">1</span> åå°„å¤§æ³•å¥½</h2>
<h3 id="èƒŒæ™¯"><span class="section-num">1.1</span> èƒŒæ™¯</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œèš‚èšå¯¹ä»£ç è´¨é‡è¦æ±‚å¾ˆé«˜ï¼Œè´¨é‡çº¢çº¿å…¶ä¸­ä¸€é¡¹æŒ‡æ ‡å°±æ˜¯å˜æ›´è¡Œè¦†ç›–ç‡ã€‚å¦‚æœä½ çš„å˜æ›´è¡Œè¦†ç›–ç‡æ²¡æœ‰è¾¾åˆ°80%ï¼Œæµ‹è¯•åŒå­¦æ˜¯ä¸ä¼šå…è®¸ä½ ä¸Šæµ‹è¯•ç¯å¢ƒçš„ï¼ˆå¦‚æœå¯¹æ­¤æœ‰æ‰€ä¸æ»¡ï¼Œæµ‹è¯•åŒå­¦å°±ä¼šè¿‡æ¥æ¶ä½ )ã€‚
ä¸ºäº†æé«˜ä»£ç è´¨é‡ï¼Œè¿™é¡¹è¦æ±‚å€’æ˜¯æ— å¯åšéï¼Œå˜æ›´çš„ä»£ç é€»è¾‘éœ€è¦å……åˆ†çš„æµ‹è¯•ï¼›ä½†æ˜¯å¦‚æœæˆ‘æ–°å¢äº†ä¸€å †çš„POJOç±»ï¼Œåªæ˜¯ä¸ºäº†é€»è¾‘æ¨¡å‹ï¼Œå˜æ›´è¡Œä¹Ÿä¼šå˜å¾—éå¸¸å¯è§‚ã€‚ä¸ºäº†è¦†ç›–è¿™äº›POJOç±»çš„å˜æ›´ï¼Œä½ å…ä¸äº†ä¼šæµ‹è¯•ä¸€å †çš„Getter/Setter
æ–¹æ³•ï¼š</p>
<figure>
    <img loading="lazy" src="https://raw.githubusercontent.com/ramsayleung/images/master/20191104102036.png"
         alt="Figure 1: getter/setter"/> <figcaption>
            <p><span class="figure-number">Figure 1: </span>getter/setter</p>
        </figcaption>
</figure>

<p>(çº¢è‰²æ˜¯æŒ‡æ²¡æœ‰è¦†ç›–åˆ°çš„å˜æ›´è¡Œ)</p>
<h3 id="åå°„"><span class="section-num">1.2</span> åå°„</h3>
<p>å¦‚æœä¸ºäº†å˜æ›´è¡Œè¦†ç›–äº†ï¼Œæˆ‘è¦å†™ä¸Šä¸€å †çš„Getter/Setter æ–¹æ³•æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹ä¹Ÿåªæ˜¯å•çº¯è°ƒç”¨ä¸€ä¸‹æ–¹æ³•ï¼Œæœªå…è¿‡äºç—›è‹¦ï¼Œèƒ½å¦å·ä¸ªæ‡’ï¼Œè§£å†³è¦†ç›–ç‡é—®é¢˜ï¼Œä¹Ÿä¸éœ€æ‰‹å†™è¿™äº›æ²¡å•¥ç”¨çš„æµ‹è¯•ç”¨ä¾‹.</p>
<p>ä½†æ˜¯ä¸€æ—¶é—´æ²¡æœ‰æƒ³åˆ°è§£å†³æ–¹æ³•ï¼Œæˆ‘å°±ä¸€è¾¹å†™è¿™äº›æ²¡å•¥ç”¨çš„ç”¨ä¾‹ï¼Œä¸€è¾¹æ€è€ƒï¼Œçªç„¶å‘ç°äº†è§„å¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="nf">getXxxx</span><span class="p">(){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setXxxx</span><span class="p">(</span><span class="n">SomeType</span><span class="w"> </span><span class="n">Xxx</span><span class="p">){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="nf">getYyy</span><span class="p">(){}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setYyyy</span><span class="p">(</span><span class="n">SomeType</span><span class="w"> </span><span class="n">Yyyy</span><span class="p">){}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯çš„å‰ç¼€éƒ½æ˜¯ <code>set/get</code> (çœŸ.åºŸè¯)ï¼Œå¦‚æœæˆ‘èƒ½è·å–ä¸€ä¸ªPojoç±»æ‰€æœ‰çš„æ–¹æ³•ï¼Œç„¶åå¾ªç¯æ‰§è¡Œæ‰€æœ‰ä»¥<code>get/set</code>å¼€å¤´çš„æ–¹æ³•ï¼Œä¸å°±ä¸ç”¨æ‰‹åŠ¨å†™æ–¹æ³•äº†ä¹ˆ?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MerchantBusiModelTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">ModelUtils</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * getç±»å‹æ–¹æ³•çš„å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">GET_METHOD_PREFIX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;get&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * setç±»å‹æ–¹æ³•çš„å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SET_METHOD_PREFIX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;set&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MerchantBusiModel</span><span class="w"> </span><span class="n">merchantBusiModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MerchantBusiModel</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">merchantBusiModel</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredMethods</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="na">isPublic</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="n">GET_METHOD_PREFIX</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="n">method</span><span class="p">.</span><span class="na">getParameterCount</span><span class="p">()</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">merchantBusiModel</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•, method: {}.{}&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">merchantBusiModel</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getSimpleName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•å¼‚å¸¸, method: {}.{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">merchantBusiModel</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•å¼‚å¸¸, method: {}.{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">merchantBusiModel</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å¾ˆå¿«å°±æŠŠ<code>MerchantBusiModel</code>æ‰€æœ‰çš„getæ–¹æ³•æ‰§è¡Œäº†(set
æ–¹æ³•ä¹ŸåŒç†å•¦)ï¼Œè°ƒç”¨ç»“æœå¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632162,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getMcc]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632256,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getOutMerchantId]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632256,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getMerchantName]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632256,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getMerhantType]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632256,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getDealType]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632257,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getAlias]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632257,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getLegalPerson]
</span></span><span class="line"><span class="cl">19/03/14 10:46:32 WARN util.ModelUtils: (,N,20190314104632257,-,,,-,-,-,)[è°ƒç”¨æ–¹æ³•, method: MerchantBusiModel.getPrincipalCertType]
</span></span><span class="line"><span class="cl">çœç•¥ä¸€å¤§ç‰‡ç±»ä¼¼çš„è¾“å‡ºï¼Œçœç‚¹ç¯‡å¹…
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="org-dot-reflections-dot-reflections"><span class="section-num">1.3</span> org.reflections.Reflections</h3>
<p>é€šè¿‡åå°„ï¼Œå°±å¾ˆå®Œç¾åœ°è§£å†³äº†POJOç±»çš„å˜æ›´è¡Œè¦†ç›–ç‡é—®é¢˜äº†ï¼Œåæ­£POJOç±»éƒ½æ˜¯Getter/Setter æ–¹æ³•ï¼Œæˆ‘çš„åå°„æ–¹æ³•èƒ½æŠŠå®ƒä»¬å…¨è¦†ç›–ä¸Šå•¦ (à¹‘&gt;â—¡&lt;à¹‘) .</p>
<p>å¾ˆå¿«ï¼Œæˆ‘å°±é‡åˆ°äº†å¦å¤–çš„ä¸€ä¸ªé—®é¢˜:
åƒ<code>MerchantBusiModel</code>è¿™æ ·çš„Modelç±»æœ‰åå‡ äºŒåä¸ªï¼Œéš¾é“æ¯ä¸ªModelæˆ‘éƒ½éœ€è¦å†™ä¸€ä¸ª<code>XxxModelTest</code>çš„æµ‹è¯•ç±»ä¹ˆï¼Ÿä¹Ÿå®åœ¨æ˜¯å¤ªç—›è‹¦äº†ï¼Œä¹Ÿå¤ªä¸ä¼˜é›…äº†(å…¶å®æ˜¯æˆ‘æ‡’)ï¼Œèƒ½ä¸èƒ½è‡ªåŠ¨æŠŠæ‰€æœ‰çš„Modelç±»æ‰«å‡ºæ¥ï¼Œç„¶åå¾ªç¯æ‰§è¡Œæ¯ä¸ªModelçš„Getter/Setteræ–¹æ³•å‘¢ï¼Ÿ</p>
<p>å› ä¸ºè¿™äº›Modeléƒ½æ˜¯ç»§æ‰¿ä¸€ä¸ªç»Ÿä¸€çš„åŸºç±»<code>BaseBusiModel</code>, èƒ½å¦æŠŠè¿™ä¸ªåŸºç±»çš„æ‰€æœ‰å­ç±»æå‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥å¼€å¿ƒåœ°ç”¨åå°„è§£å†³é—®é¢˜äº†.</p>
<p>è°ƒç ”ä¸€ç•ªä¹‹åå‘ç°ï¼ŒJdk çš„åå°„æ–¹å¼ä¸æ”¯æŒéå†çˆ¶ç±»æ‰€æœ‰å­ç±»çš„æ–¹æ³•ï¼Œè¿™åšæ³•è¡Œä¸é€šé˜¿!!!</p>
<p>åœ¨æˆ‘éƒ½å‡ ä¹è¦æ”¾å¼ƒï¼Œè¦æ‰‹å†™æ‰€æœ‰ModelTestçš„æ—¶å€™ï¼Œæˆ‘åœ¨StackOverFlowä¸Šé¢æ‰¾åˆ°äº† <a href="https://github.com/ronmamo/reflections">reflections</a> è¿™ç¬¬ä¸‰æ–¹åŒ…ï¼Œå‘ç°è¿™ä¸ªåŒ…éå¸¸å¼ºå¤§(niubility), å¯ä»¥è·å–åŸºç±»çš„å­ç±»æˆ–è€…æ¥å£çš„å®ç°ç±»:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Reflections</span><span class="w"> </span><span class="n">reflections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Reflections</span><span class="p">(</span><span class="s">&#34;my.project&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SomeType</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">subTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflections</span><span class="p">.</span><span class="na">getSubTypesOf</span><span class="p">(</span><span class="n">SomeType</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç®€ç›´äº†ã€‚åœ¨è¿™â€ç‰›åŒ…â€çš„å¸®åŠ©ä¸‹ï¼ŒæˆåŠŸå®ç°äº†æ‰«ææŸä¸ªpackageä¸‹é¢æ‰€æœ‰åŸºç±»çš„å®ç°ç±»çš„æ–¹æ³•, æˆ‘çš„ç”¨ä¾‹æœ‰æ•‘äº†:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ModelTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">ConvertorTest</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PACKAGE_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;xxx.xxx.core.service.v1.busimodel&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// modelæ‰€æœ‰çš„åŒ…</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Reflections</span><span class="w"> </span><span class="n">reflections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Reflections</span><span class="p">(</span><span class="n">PACKAGE_NAME</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Class</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BaseBusiModel</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="o">=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="n">reflections</span><span class="p">.</span><span class="na">getSubTypesOf</span><span class="p">(</span><span class="n">BaseBusiModel</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">BaseBusiModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clazz</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">classes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="na">isAbstract</span><span class="p">(</span><span class="n">clazz</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">continue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="n">BaseBusiModel</span><span class="w"> </span><span class="n">modelInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">modelInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clazz</span><span class="p">.</span><span class="na">newInstance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•IllegalAccessExceptionå¼‚å¸¸, clazz: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				</span><span class="n">clazz</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InstantiationException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•InstantiationExceptionnå¼‚å¸¸, clazz: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				</span><span class="n">clazz</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="n">ModelUtils</span><span class="p">.</span><span class="na">invokeGetAndSetMethod</span><span class="p">(</span><span class="n">modelInstance</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>ModelUtils.invokeGetAndSetMethod(modelInstance);</code> è¿™ä¸ªé™æ€æ–¹æ³•å°±æ˜¯ä¸Šä¸€èŠ‚åå°„æ–¹æ³•çš„å®Œæ•´å¯ç”¨ç‰ˆ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ModelUtils</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">LOGGER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">ModelUtils</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * getç±»å‹æ–¹æ³•çš„å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">GET_METHOD_PREFIX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;get&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * getç±»å‹æ–¹æ³•çš„å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SET_METHOD_PREFIX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;set&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * è°ƒç”¨clazz å¯¹è±¡çš„æ‰€æœ‰get, setæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param clazz
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invokeGetAndSetMethod</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">clazz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">invokeMethodWithPrefix</span><span class="p">(</span><span class="n">GET_METHOD_PREFIX</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">invokeMethodWithPrefix</span><span class="p">(</span><span class="n">SET_METHOD_PREFIX</span><span class="p">,</span><span class="w"> </span><span class="n">clazz</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * é€šè¿‡æ–¹æ³•å‰ç¼€è°ƒç”¨æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param prefix
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param instance
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">invokeMethodWithPrefix</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">prefix</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">Method</span><span class="o">[]</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getDeclaredMethods</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Method</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="na">isPublic</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="na">getModifiers</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">startsWith</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="n">Object</span><span class="o">[]</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[</span><span class="n">method</span><span class="p">.</span><span class="na">getParameterCount</span><span class="p">()</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">method</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•å¼‚å¸¸, method: {}.{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">instance</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="n">LoggerUtil</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;è°ƒç”¨æ–¹æ³•å¼‚å¸¸, method: {}.{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				    </span><span class="n">instance</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ€»ç»“"><span class="section-num">1.4</span> æ€»ç»“</h3>
<ol>
<li>Reflections åŒ…æ˜¯çœŸçš„å¼ºï¼Œæœ‰ç©ºè¦å»çœ‹ä¸€ä¸‹æºç </li>
<li>æ‡’æƒ°æ˜¯ç¨‹åºå‘˜çš„ç¬¬ä¸€ç”Ÿäº§åŠ›, è¿™è¯çœŸä¸æ˜¯æˆ‘ç¼–çš„ï¼Œæ˜¯Perl è¯­è¨€ä¹‹çˆ¶ Larry
Wall è¯´çš„</li>
<li>åŠ äº†å…¶ä»–ä¸¤ä¸ªç±»ä¼¼åŠŸèƒ½çš„åå°„æµ‹è¯•ç±»ï¼Œæˆ‘çš„å˜æ›´è¡Œè¦†ç›–ç‡æš´å¢30%
(å¯ä»¥çœ‹å‡ºæˆ‘è¿™æ¬¡çš„å˜æ›´ä¸»è¦æ˜¯æ–°å¢æ¨¡å‹å’Œå·¥å…·ç±»ï¼Œè¿™æ ·åå°„æ‰èƒ½è°ƒç”¨è§„å¾‹æ€§ä»£ç )</li>
<li>Javaå¤§æ³•å¥½ï¼ŒJavaä¸–ç•Œé‚£ä¹ˆå¤§ï¼Œè¿˜éœ€è¦æˆ‘å¥½å¥½æ¢ç´¢.</li>
</ol>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Spock ä¸€ä¸ªä¼˜é›…çš„Groovy/Javaæµ‹è¯•æ¡†æ¶</title>
      <link>https://ramsayleung.github.io/zh/post/2017/spock/</link>
      <pubDate>Tue, 11 Apr 2017 00:00:00 +0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2017/spock/</guid>
      <description>an introduction about spock</description>
      <content:encoded><![CDATA[<p>å› ä¸ºéœ€è¦ç¼–å†™ RESTful api æµ‹è¯•çš„ç¼˜æ•…ï¼Œé‡æ‹¾äº† Spock è¿™ä¸ªé€‚ç”¨äº Groovy/Java çš„æµ‹è¯•
æ¡†æ¶ï¼Œé¡ºä¾¿æŠŠä»¥å‰å†™çš„ä¸€ç¯‡æ—§æ–‡æ•´ç†äº†ä¸€ä¸‹ï¼Œæƒå½“é‡æ¸©ã€‚</p>
<h2 id="å…³äº-spock"><span class="section-num">1</span> å…³äº Spock</h2>
<p>Spock æ˜¯ä¸€ä¸ªé€‚ç”¨äº Java(Groovy) çš„ä¸€ä¸ªä¼˜é›…å¹¶ä¸”å…¨é¢çš„æµ‹è¯•æ¡†æ¶, è¯´ Spock å…¨é¢ï¼Œæ˜¯
å› ä¸º Spock é›†æˆäº†ç°æœ‰çš„ Java æµ‹è¯•åº“ï¼›è‡³äºä¸ºä»€ä¹ˆèµç¾ Spock ä¼˜é›…ï¼Œé˜…è¯»å®Œå…¨æ–‡ä½ å°±ä¼š
æœ‰ä½“ä¼šçš„äº†</p>
<figure>
    <img loading="lazy" src="http://ww3.sinaimg.cn/large/cd613764jw1f71jlmu3hpj20i70eemy7.jpg"/> 
</figure>

<p>å› ä¸ºåŸºäº Groovy, ä½¿å¾— Spock å¯ä»¥æ›´å®¹æ˜“åœ°å†™å‡ºè¡¨è¾¾èƒ½åŠ›æ›´å¼ºçš„æµ‹è¯•ç”¨ä¾‹ã€‚åˆå› ä¸ºå®ƒå†…ç½®
äº† Junit Runner, æ‰€ä»¥ Spock å…¼å®¹å¤§éƒ¨åˆ†çš„ IDEï¼Œæµ‹è¯•å·¥å…·ï¼Œå’ŒæŒç»­é›†æˆæœåŠ¡å™¨ã€‚æ¥ä¸‹æ¥
å°±ä»‹ç»ä¸€ä¸‹ Spock çš„ç‰¹æ€§</p>
<h2 id="spock-ç‰¹æ€§"><span class="section-num">2</span> Spock ç‰¹æ€§</h2>
<ol>
<li>å†…ç½®æ”¯æŒ mocking stubbingï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ¨¡æ‹Ÿå¤æ‚çš„ç±»çš„è¡Œä¸º</li>
<li>Spock å®ç°äº† BDD èŒƒå¼(behavior-driven development)</li>
<li>ä¸ç°æœ‰çš„ Build å·¥å…·é›†æˆï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•åç«¯ä»£ç ï¼ŒWeb é¡µé¢ç­‰ç­‰</li>
<li>å…¼å®¹æ€§å¼ºï¼Œå†…ç½® Junit Runner, å¯ä»¥åƒè¿è¡Œ Junit é‚£æ ·è¿è¡Œ Spockï¼Œç”šè‡³å¯ä»¥åœ¨åŒä¸€ä¸ªé¡¹
ç›®é‡Œé¢åŒæ—¶ä½¿ç”¨ä¸¤ç§æµ‹è¯•æ¡†æ¶</li>
<li>å–é•¿è¡¥çŸ­ï¼Œå¸æ”¶äº†ç°æœ‰æ¡†æ¶çš„ä¼˜ç‚¹ï¼Œå¹¶åŠ ä»¥æ”¹è¿›</li>
<li>Spock ä»£ç é£æ ¼ç®€çŸ­ï¼Œæ˜“è¯»ï¼Œè¡¨è¾¾æ€§å¼ºï¼Œæ‰©å±•æ€§å¼ºï¼Œè¿˜æœ‰æ›´æ¸…æ™°æ˜¾ç¤º bug</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆæ˜¯-spock"><span class="section-num">3</span> ä¸ºä»€ä¹ˆæ˜¯ Spock</h2>
<p>Spock ä¼¼ä¹æœ‰å¾ˆå¤šä¸é”™çš„ç‰¹æ€§ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆæœ‰ Junit è¿™ä¸ªé‚£ä¹ˆå¼ºå¤§çš„æµ‹è¯•æ¡†æ¶, è¿˜è¦å»
ä½¿ç”¨ Spock å‘¢? ç”šè‡³å¯ä»¥ç”¨ Spock æ¥ä»£æ›¿ Junit å‘¢? ä¸‹é¢å°±ç”¨ä¸€äº›ç®€å•çš„ä¾‹å­æ¥è¯ é‡Š
ä¸€ä¸‹Spock çš„å¼ºå¤§. ä»¥ä¸€ä¸ªç®€å•çš„åŠ æ³•ä¸ºä¾‹ï¼š</p>
<figure>
    <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764jw1f71jm5dserj20ek04kmxc.jpg"/> 
</figure>

<p>Junit çš„æµ‹è¯•ç”¨ä¾‹</p>
<figure>
    <img loading="lazy" src="http://ww4.sinaimg.cn/large/cd613764jw1f71jmipwsmj20hy07xabc.jpg"/> 
</figure>

<p>Spock çš„æµ‹è¯•ç”¨ä¾‹</p>
<figure>
    <img loading="lazy" src="http://ww2.sinaimg.cn/large/cd613764gw1f71jn4vlzoj20nn09vmym.jpg"/> 
</figure>

<p>æ˜¯å¦è§‰å¾—è€³ç›®ä¸€æ–°å‘¢? å› ä¸º Spock æ”¯æŒä»¥ç±»äººç±»è¯­è¨€çš„å½¢å¼æ¥å®šä¹‰æ–¹æ³•å, æ‰€ä»¥å¯¹æ¯”
Junit çš„æµ‹è¯•ç”¨ä¾‹, ä½ ä¼šå‘ç° Spock çš„æµ‹è¯•ç”¨ä¾‹, åªéœ€å‡½æ•°å, å°±å¯ä»¥æ¸…æ™°äº†è§£è¿™ä¸ªæµ‹
è¯•çš„ç”¨é€”</p>
<p>æ¥ä¸‹æ¥, å†å†™ä¸€ä¸ªä¹˜æ³•çš„ç±», ç„¶åäººä¸ºåœ°åŠ å…¥ä¸€ä¸ª Bug, å†çœ‹çœ‹ Junit å’Œ Spock çš„è¡¨ç°</p>
<figure>
    <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764gw1f71jnieycnj20lz047dfz.jpg"/> 
</figure>

<p>å¦‚æœæµ‹è¯• fail, ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢?</p>
<figure>
    <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764gw1f71jnxh6wtj20sq0gpdic.jpg"/> 
</figure>

<figure>
    <img loading="lazy" src="http://ww2.sinaimg.cn/large/cd613764jw1f71job6us9j20p308iq42.jpg"/> 
</figure>

<p>æ˜¾è€Œæ˜“è§ï¼ŒJunit åªæ˜¯æ˜¾ç¤ºäº†ç»“æœä¸ç­‰ï¼Œå´æ²¡åŠæ³•ç©¶ç«Ÿåˆ¤æ–­æ˜¯åŠ æ³•è¿˜æ˜¯ä¹˜æ³•å‡ºç°äº† bugï¼Œ
ä½†æ˜¯ Spock å°±å¾ˆæ¸…æ™°åœ°ç»™å‡ºäº†ç­”æ¡ˆã€‚ä¸éš¾çœ‹å‡º Spock çš„è¯­æ³•æ›´åŠ ç®€æ´, ä¼˜é›…; æ­¤å¤–, å¾—
ç›Šäº Spock ç‹¬ç‰¹çš„å‘½åæ–¹å¼ï¼Œåªéœ€æŸ¥çœ‹å‡½æ•°åå­—ä¾¿å¯ä»¥äº†è§£æµ‹è¯•ç”¨ä¾‹çš„ç›®çš„ï¼Œæ— éœ€é¢å¤–
çš„æ³¨é‡Šã€‚è€Œè¿™åªæ˜¯ Spock å’Œ Junit çš„ä¸€éƒ¨åˆ†å·®å¼‚ï¼Œå…¶ä»–çš„å·®å¼‚ï¼Œæ¥ä¸‹æ¥ä¼šç»§ç»­è¯´æ˜ã€‚</p>
<h2 id="spock-è¯­æ³•"><span class="section-num">4</span> Spock è¯­æ³•</h2>
<h3 id="specification"><span class="section-num">4.1</span> Specification</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">MyFirstSpecification</span><span class="w"> </span><span class="n">extend</span><span class="w"> </span><span class="n">Specification</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//fields</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//fixture methods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//feature methods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//helper methods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Specification æ˜¯æŒ‡ä¸€ä¸ªç»§æ‰¿äº <strong>spock.lang.Specification</strong> çš„ä¸€ä¸ª Groovy ç±». è€Œ
Specification çš„åå­—ä¸€èˆ¬æ˜¯è·Ÿç³»ç»Ÿæˆ–è€…ä¸šåŠ¡é€»è¾‘æœ‰å…³çš„ç»„åˆè¯ï¼Œä¾‹å¦‚ä¹‹å‰çš„AdderSpec</p>
<h3 id="fields"><span class="section-num">4.2</span> Fields</h3>
<p>å®ä¾‹åŒ–ä¸€ä¸ªç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassUnderSpecification</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="kt">def</span> <span class="n">coll</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Collaborator</span><span class="o">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="feature-methods"><span class="section-num">4.3</span> Feature Methods</h3>
<p>Feature Methods æŒ‡å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹æ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;pushing an element on the stack&#34;</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// blocks go here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="fixture-methods"><span class="section-num">4.4</span> Fixture Methods</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{}</span>          <span class="c1">// run before every feature method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">def</span> <span class="nf">cleanup</span><span class="o">()</span> <span class="o">{}</span>        <span class="c1">// run after every feature method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">def</span> <span class="nf">setupSpec</span><span class="o">()</span> <span class="o">{}</span>     <span class="c1">// run before the first feature method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">def</span> <span class="nf">cleanupSpec</span><span class="o">()</span> <span class="o">{}</span>   <span class="c1">// run after the last feature method
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å…³äº Fixture Methods çš„ä½œç”¨ï¼Œç¬”è€…å¼•ç”¨ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£çš„ä¸€æ®µè¯</p>
<blockquote>
<p>Fixture methods are responsible for setting up and cleaning up the environment in
which feature methods are run. Usually itâ€™s a good idea to use a fresh fixture for
every feature method, which is what the setup() and cleanup() methods are for.
All fixture methods are optional.</p>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ <strong>Fixture methodr</strong> æ˜¯è¿›è¡Œåˆå§‹åŒ–æˆ–è€…æ”¶å°¾å·¥ä½œçš„ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ Spock
çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ Spock å’Œ Junit è¿›è¡Œæ¯”è¾ƒï¼Œ(å›¾æˆªè‡ªå®˜ç½‘)</p>
<figure>
    <img loading="lazy" src="http://ww4.sinaimg.cn/large/cd613764jw1f71josjimij20sl0g7jsr.jpg"/> 
</figure>

<p>ä»¥ä¸Šå°±æ˜¯ Spock çš„åŸºæœ¬ç”¨æ³•ï¼Œ ä¹Ÿåªèƒ½è¯´æ˜¯ä¸­è§„ä¸­çŸ©ï¼Œéš¾è¨€æƒŠè‰³ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ä»‹ç»çš„
å°±æ˜¯ Spock <strong>killer</strong> çº§åˆ«çš„ç‰¹æ€§äº†</p>
<h3 id="blocks"><span class="section-num">4.5</span> Blocks</h3>
<p>å…³äº Blocks çš„ç”¨æ³•ï¼Œ è¿™é‡Œå¼•ç”¨å®˜ç½‘çš„ä¸€æ®µè¯</p>
<blockquote>
<p>Spock has built-in support for implementing each of the conceptual phases of a
feature method. To this end, feature methods are structured into so-called blocks.
Blocks start with a label, and extend to the beginning of the next block, or the
end of the method. There are six kinds of blocks: setup, when, then, expect,
cleanup, and where blocks</p>
</blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ è¿™äº›å†…ç½®çš„åŠŸèƒ½å¼ºå¤§çš„ blocks, å°±æ˜¯å¸®åŠ©å¼€å‘è€…ç¼–å†™å•å…ƒæµ‹è¯•çš„è¯­æ³•ç³–</p>
<figure>
    <img loading="lazy" src="http://ww2.sinaimg.cn/large/cd613764jw1f71jpaxv52j20uv095q40.jpg"/> 
</figure>

<p>ä¸‹é¢å°±äº†è§£ä¸€ä¸‹ä¸åŒ Block çš„åŠŸèƒ½</p>
<h4 id="the-given-block"><span class="section-num">4.5.1</span> The <strong>given</strong>: block</h4>
<p><strong>given</strong>: åº”è¯¥åŒ…å«æ‰€æœ‰çš„åˆå§‹åŒ–æ¡ä»¶æˆ–è€…åˆå§‹åŒ–ç±»ï¼Œä¾‹å¦‚ä½ å¯ä»¥æŠŠè¦æµ‹è¯•çš„ç±»çš„å®ä¾‹åŒ–æ”¾åœ¨
<strong>given</strong>. æ€»è€Œè¨€ä¹‹ï¼Œ <strong>given</strong> å°±æ˜¯æ”¾ç½®æ‰€æœ‰å•å…ƒæµ‹è¯•å¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œçš„åœ°æ–¹</p>
<h4 id="the-setup-block"><span class="section-num">4.5.2</span> The <strong>setup</strong>: block</h4>
<p><strong>setup</strong>: ç¬”è€…ä¸ªäººç†è§£åŠŸèƒ½è·Ÿ <strong>given</strong> å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥åˆå§‹åŒ–çš„æ—¶å€™å¯ä»¥äºŒé€‰ä¸€(ç¬”è€…
ä¸ªäººæ¨èç”¨ givenï¼Œå› ä¸ºè¿™æ ·æ›´ç¬¦åˆ BDD èŒƒå¼)</p>
<h4 id="the-when-blcok"><span class="section-num">4.5.3</span> The <strong>when</strong>: blcok</h4>
<p><strong>when</strong>: æ˜¯ Spock æµ‹è¯•ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œæ”¾ç½®çš„å°±æ˜¯ä½ è¦æµ‹è¯•çš„ä»£ç ï¼Œå’Œä½ å¦‚
ä½•æµ‹è¯•çš„ç”¨ä¾‹ï¼Œè¿™é‡Œçš„æµ‹è¯•ä»£ç åº”è¯¥å°½å¯èƒ½åœ°çŸ­ã€‚æœ‰ç»éªŒçš„ Spock ç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹
<strong>when</strong>: block å°±äº†è§£æµ‹è¯•æµç¨‹äº†</p>
<h4 id="the-then-block"><span class="section-num">4.5.4</span> The <strong>then</strong>: block</h4>
<p><strong>then</strong>: block åŒ…å«éšå¼çš„æ–­è¨€, è¡¥å……ä¸€ä¸‹ï¼ŒSpock æ˜¯æ²¡æœ‰ assert è¿™ä¸ªæ–­è¨€å‡½æ•°çš„ï¼Œ
Spock ä½¿ç”¨çš„æ˜¯ assertion, ç¬”è€…ä¸ªäººç†è§£æˆè¿™æ˜¯ä¸€ç§éšå¼çš„æ–­è¨€ã€‚æ¦‚æ‹¬æ¥è¯´, <strong>then</strong>
å°±æ˜¯æ”¾ç½®ä½ é¢„æœŸæµ‹è¯•ç»“æœçš„åœ°æ–¹ã€‚</p>
<p>ç°åœ¨å·²ç»æŠŠ given-when-then ç²—ç•¥åœ°è§£é‡Šäº†ä¸€ä¸‹, ç°åœ¨å°±é€šè¿‡ä»£ç é˜è¿°å…·ä½“çš„ç”¨æ³•.
é¦–å…ˆç¡®å®šä¸€ä¸‹éœ€æ±‚; å‡è®¾ç°åœ¨è¦æµ‹è¯•ä¸€ä¸ªé€šè¿‡ç½‘ç«™æ¥é”€å”®ç”µè„‘çš„ç”µå•†å¹³å°, å¦‚ä¸‹å›¾ (å›¾
æˆªè‡ª java_test_with_spock ä¸€ä¹¦)</p>
<figure>
    <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764gw1f71jyfgad2j20t90alq3n.jpg"/> 
</figure>

<p>ç„¶é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦, ä»¥å±•ç¤º Spock çš„ç”¨æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Product</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">price</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Basket</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduct</span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">addProduct</span><span class="p">(</span><span class="n">product</span><span class="p">,</span><span class="n">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addProduct</span><span class="p">(</span><span class="n">Product</span><span class="w"> </span><span class="n">product</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">times</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">//some code about business</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getCurrentWeight</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">//</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getProductTypesCount</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="c1">//</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åç¼–å†™ Spock çš„æµ‹è¯•ç”¨ä¾‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;A basket with one product has equal weight&#34;</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">given:</span> <span class="s2">&#34;an empty basket and a Tv&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">tv</span><span class="o">=</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;bravia&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">1200</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">18</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Basket</span> <span class="n">basket</span><span class="o">=</span><span class="k">new</span> <span class="n">Basket</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">when:</span><span class="s2">&#34;user wants to buy the TV&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span><span class="o">(</span><span class="n">tv</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">then:</span><span class="s2">&#34;basket weight is equal to the TV&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">currentWeight</span><span class="o">==</span><span class="n">tv</span><span class="o">.</span><span class="na">weight</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å¯¹ Spock æœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†äº†ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ given-when-then è¿™ &ldquo;ä¸‰æ¿æ–§&rdquo; æ¥å†™
ä¸€äº›é€»è¾‘ä¸æ˜¯éå¸¸å¤æ‚çš„æµ‹è¯•ç”¨ä¾‹äº†ã€‚</p>
<h4 id="the-and-block"><span class="section-num">4.5.5</span> The <strong>and</strong>: block</h4>
<p><strong>and</strong>: å®ƒçš„ç”¨æ³•æœ‰ç‚¹åƒè¯­æ³•ç³–ï¼Œå®ƒè‡ªå·±æœ¬èº«æ˜¯æ²¡æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œå®ƒåªæ˜¯æ‹¿æ¥æ‰©å±•å…¶ä»–çš„
åŠŸèƒ½çš„. ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ç”¨æ³•:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;A basket with one product has equal weight&#34;</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">given:</span> <span class="s2">&#34;an empty basket &#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Basket</span> <span class="n">basket</span><span class="o">=</span><span class="k">new</span> <span class="n">Basket</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">and:</span> <span class="s2">&#34;several products&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">tv</span><span class="o">=</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;bravia&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">1200</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">18</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">camera</span><span class="o">=</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;panasonic&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">350</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">hifi</span><span class="o">=</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;jvc&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">600</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">5</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">when:</span><span class="s2">&#34;user wants to buy the TV abd the camera and the hifi&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span><span class="o">(</span><span class="n">tv</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span><span class="o">(</span><span class="n">camera</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span><span class="o">(</span><span class="n">hifi</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">then:</span><span class="s2">&#34;basket weight is equal to all product weight&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">currentWeight</span><span class="o">==(</span><span class="n">tv</span><span class="o">.</span><span class="na">weight</span><span class="o">+</span><span class="n">camera</span><span class="o">.</span><span class="na">weight</span><span class="o">+</span><span class="n">hifi</span><span class="o">.</span><span class="na">weight</span><span class="err">ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œgiven å’Œ and éƒ½ç”¨æ¥è¿›è¡Œç±»åˆå§‹åŒ–ï¼Œåªæ˜¯æ ¹æ® Basket å’Œ
Product ç±»å‹è¿›è¡Œäº†ç»†åˆ†ã€‚å¦‚ä¸‹å›¾</p>
<figure>
    <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764jw1f71jq4hwjlj20wt0e10uv.jpg"/> 
</figure>

<p>ä½¿ç”¨ <strong>and</strong> block å¯ä»¥ä»£ç ç»“æ„æ›´ç®€æ´ä¼˜é›…. æ­¤å¤–, å¦‚æœ <strong>and</strong> æ˜¯ç´§è·Ÿåœ¨ <strong>when</strong> å
é¢, é‚£ä¹ˆ <strong>and</strong> å°±æ®æœ‰å’Œ <strong>when</strong> block ä¸€æ ·çš„åŠŸèƒ½ï¼Œä¾æ­¤ç±»æ¨</p>
<h4 id="the-expect-block"><span class="section-num">4.5.6</span> The <strong>expect</strong>: block</h4>
<p><strong>expect</strong> æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„ç‰¹æ€§ï¼Œå®ƒç”¨å¾ˆå¤šç§ç”¨æ³•ï¼Œæœ€å¸¸ç”¨çš„ç”¨æ³•å°±æ˜¯æŠŠ
given-when-then éƒ½ç»“åˆèµ·æ¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;An empty basket has no weight&#34;</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">expect:</span><span class="s2">&#34;zero weight when nothing is added&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nf">Basket</span><span class="o">().</span><span class="na">currentWeight</span><span class="o">==</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…æ˜¯ä»¥ä¸‹è¿™ç§å½¢å¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;An empty basket has no weight(alternative)&#34;</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">given:</span><span class="s2">&#34;an empty basket&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Basket</span> <span class="n">basket</span><span class="o">=</span><span class="k">new</span> <span class="n">Basket</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">expect:</span><span class="s2">&#34;that the weight is 0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">currentWeight</span><span class="o">==</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆæˆ–è€…ç”¨ <strong>expect</strong> æå‰è¿›è¡Œæ¡ä»¶åˆ¤æ–­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kt">def</span> <span class="s2">&#34;A basket with two products weights as their sum (precondition)&#34;</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">given:</span> <span class="s2">&#34;an empty basket, a TV and a camera&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">tv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;bravia&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">1200</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">18</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="nl">name:</span><span class="s2">&#34;panasonic&#34;</span><span class="o">,</span><span class="nl">price:</span><span class="mi">350</span><span class="o">,</span><span class="nl">weight:</span><span class="mi">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Basket</span> <span class="n">basket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Basket</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">expect:</span><span class="s2">&#34;that nothing should be inside&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">currentWeight</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">productTypesCount</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* expect: block performs
</span></span></span><span class="line"><span class="cl"><span class="cm">     intermediate assertions*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">when:</span> <span class="s2">&#34;user wants to buy the TV and the camera&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span> <span class="n">tv</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">addProduct</span> <span class="n">camera</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nl">then:</span> <span class="s2">&#34;basket weight is equal to both camera and tv&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">basket</span><span class="o">.</span><span class="na">currentWeight</span> <span class="o">==</span> <span class="o">(</span><span class="n">tv</span><span class="o">.</span><span class="na">weight</span> <span class="o">+</span> <span class="n">camera</span><span class="o">.</span><span class="na">weight</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* then: block examines
</span></span></span><span class="line"><span class="cl"><span class="cm">     the final result*/</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢é‚£ä¸ªä¾‹å­æ˜¯åœ¨æ·»åŠ äº§å“ä¹‹å‰æ£€æŸ¥åˆå§‹åŒ–æ¡ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œèƒ½æ›´å®¹æ˜“çœ‹å‡ºæ˜¯å“ªé‡Œæµ‹è¯• fail</p>
<h4 id="the-clean-block"><span class="section-num">4.5.7</span> The <strong>clean</strong>: block</h4>
<p>clean å°±ç›¸å½“äºåœ¨æ‰€æœ‰çš„æµ‹è¯•ç»“æŸä»¥åæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œå¦‚æœåœ¨æµ‹è¯•ä¸­æ–°å»ºäº† IO æµï¼Œ
å°±å¯ä»¥åœ¨ clean é‡Œé¢å…³é—­ IO æµï¼Œé‚£æ ·å°±å¯ä»¥ä¿è¯ä»£ç çš„æ­£ç¡®æ€§äº†</p>
<h3 id="spock-killer-future"><span class="section-num">4.6</span> Spock killer future</h3>
<p>ç¡®å®šéœ€æ±‚:ï¼ˆä¾‹å­æ¥è‡ª Java_test_with_spock ä¸€ä¹¦ï¼‰ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ ¸ååº”å †ï¼Œè¿™ä¸ªååº”
å †çš„ç³»ç»Ÿç»„æˆï¼š</p>
<ul>
<li>
<p>å¤šä¸ªçƒŸé›¾æ„Ÿåº”å™¨(è¾“å…¥)</p>
</li>
<li>
<p>3 ä¸ªè¾å°„æ„Ÿåº”å™¨(è¾“å…¥)</p>
</li>
<li>
<p>ç°åœ¨çš„å‹åŠ›å€¼(è¾“å…¥</p>
</li>
<li>
<p>æŠ¥è­¦å™¨(è¾“å‡º)</p>
</li>
<li>
<p>ç–æ•£å‘½ä»¤(è¾“å‡º)</p>
</li>
<li>
<p>é€šçŸ¥æ“ä½œå‘˜å…³é—­ååº”å †(è¾“å‡º)
ç³»ç»Ÿå¦‚å›¾</p>
<figure>
        <img loading="lazy" src="http://ww1.sinaimg.cn/large/cd613764jw1f71jsj8fqqj20vt0jlmzt.jpg"/> 
    </figure>

<p>ç³»ç»Ÿç›¸å…³è®¾å®š:</p>
</li>
<li>
<p>å¦‚æœå‹åŠ›å€¼è¶…è¿‡ 150ï¼ŒæŠ¥è­¦å™¨æŠ¥è­¦</p>
</li>
<li>
<p>å¦‚æœ 2 ä¸ªæˆ–è€…æ›´å¤šçš„çƒŸé›¾æ„Ÿåº”å™¨è¢«è§¦å‘ï¼Œé‚£ä¹ˆæŠ¥è­¦å™¨æŠ¥è­¦ï¼Œé€šçŸ¥æ“ä½œå‘˜å…³é—­ååº”å †</p>
</li>
<li>
<p>å¦‚æœè¾å°„å€¼è¶…è¿‡ 100ï¼Œè­¦æŠ¥å™¨æŠ¥è­¦ï¼Œé€šçŸ¥æ“ä½œå‘˜å…³é—­ååº”å †ï¼Œå¹¶é©¬ä¸Šç–æ•£äººç¾¤</p>
</li>
</ul>
<p>è¾“å…¥è¾“å‡ºå¯¹åº”å…³ç³»</p>
<figure>
    <img loading="lazy" src="http://ww4.sinaimg.cn/large/cd613764jw1f71jtabh47j20tm0k976p.jpg"/> 
</figure>

<p>ç°åœ¨ï¼Œå‡å¦‚ç”¨ Junit æ¥å†™æµ‹è¯•ç”¨ä¾‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RunWith</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NuclearReactorTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">triggeredFireSensors</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">radiationDataReadings</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">expectedAlarmStatus</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">expectedShutdownCommand</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedMinutesToEvacuate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">NuclearReactorTest</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pressure</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">triggeredFireSensors</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">radiationDataReadings</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">expectedAlarmStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">			      </span><span class="kt">boolean</span><span class="w"> </span><span class="n">expectedShutdownCommand</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expectedMinutesToEvacuate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">triggeredFireSensors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">triggeredFireSensors</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">radiationDataReadings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">radiationDataReadings</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">expectedAlarmStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expectedAlarmStatus</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">expectedShutdownCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expectedShutdownCommand</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">this</span><span class="p">.</span><span class="na">expectedMinutesToEvacuate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expectedMinutesToEvacuate</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">nuclearReactorScenario</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NuclearReactorMonitor</span><span class="w"> </span><span class="n">nuclearReactorMonitor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NuclearReactorMonitor</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">nuclearReactorMonitor</span><span class="p">.</span><span class="na">feedFireSensorData</span><span class="p">(</span><span class="n">triggeredFireSensors</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">nuclearReactorMonitor</span><span class="p">.</span><span class="na">feedRadiationSensorData</span><span class="p">(</span><span class="n">radiationDataReadings</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">nuclearReactorMonitor</span><span class="p">.</span><span class="na">feedPressureInBar</span><span class="p">(</span><span class="n">pressure</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">NuclearReactorStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nuclearReactorMonitor</span><span class="p">.</span><span class="na">getCurrentStatus</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&#34;Expected no alarm&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">expectedAlarmStatus</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		     </span><span class="n">status</span><span class="p">.</span><span class="na">isAlarmActive</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&#34;No notifications&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">expectedShutdownCommand</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		     </span><span class="n">status</span><span class="p">.</span><span class="na">isShutDownNeeded</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">assertEquals</span><span class="p">(</span><span class="s">&#34;No notifications&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">expectedMinutesToEvacuate</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		     </span><span class="n">status</span><span class="p">.</span><span class="na">getEvacuationMinutes</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Parameters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="nf">data</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">return</span><span class="w"> </span><span class="n">Arrays</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Object</span><span class="o">[][]</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">150</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">150</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">150</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Float</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">150</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">110</span><span class="p">.</span><span class="na">4f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">150</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">45</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">47</span><span class="p">.</span><span class="na">7f</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">155</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">170</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="n">3</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">180</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">110</span><span class="p">.</span><span class="na">4f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">500</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">110</span><span class="p">.</span><span class="na">4f</span><span class="p">,</span><span class="w"> </span><span class="n">300f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">30</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">110</span><span class="p">.</span><span class="na">4f</span><span class="p">,</span><span class="w"> </span><span class="n">1000f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">155</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">,</span><span class="w"> </span><span class="n">0</span><span class="p">.</span><span class="na">0f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="o">-</span><span class="n">1</span><span class="w"> </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		    </span><span class="p">{</span><span class="w"> </span><span class="n">170</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">45</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">10</span><span class="p">.</span><span class="na">3f</span><span class="p">,</span><span class="w"> </span><span class="n">47</span><span class="p">.</span><span class="na">7f</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		      </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">3</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å„ç§è¾“å…¥è¾“å‡ºæ•°æ®ä»¥åŠ getter setter è€¦åˆåœ¨ä¸€èµ·ï¼Œä»£ç å˜å¾—éš¾è¯»èµ·æ¥. æ­¤å¤–ï¼Œé™¤äº†å¯
è¯»æ€§ï¼Œ è¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜ï¼Œå‡å¦‚éœ€æ±‚è¦å¢åŠ ä¸€ä¸ªè¾“å…¥æˆ–è€…å¢åŠ ä¸€ä¸ªè¾“å‡ºå‘¢ï¼Œ å°±åªèƒ½æ”¹
å˜æ•°æ®ç»“æ„ï¼Œ è¿™æ ·çš„ä»£ç çœŸçš„éš¾ä»¥ç»´æŠ¤ã€‚ä¸çŸ¥é“ Spock çš„è¡¨ç°åˆå¦‚ä½•å‘¢ï¼Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">NuclearReactorSpec</span> <span class="kd">extends</span> <span class="n">spock</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Specification</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">def</span> <span class="s2">&#34;Complete test of all nuclear scenarios&#34;</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nl">given:</span> <span class="s2">&#34;a nuclear reactor and sensor data&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">NuclearReactorMonitor</span> <span class="n">nuclearReactorMonitor</span> <span class="o">=</span><span class="k">new</span> <span class="n">NuclearReactorMonitor</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nl">when:</span> <span class="s2">&#34;we examine the sensor data&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">nuclearReactorMonitor</span><span class="o">.</span><span class="na">feedFireSensorData</span><span class="o">(</span><span class="n">fireSensors</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">nuclearReactorMonitor</span><span class="o">.</span><span class="na">feedRadiationSensorData</span><span class="o">(</span><span class="n">radiation</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">nuclearReactorMonitor</span><span class="o">.</span><span class="na">feedPressureInBar</span><span class="o">(</span><span class="n">pressure</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">NuclearReactorStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">nuclearReactorMonitor</span><span class="o">.</span><span class="na">getCurrentStatus</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nl">then:</span> <span class="s2">&#34;we act according to safety requirements&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">status</span><span class="o">.</span><span class="na">alarmActive</span> <span class="o">==</span> <span class="n">alarm</span>
</span></span><span class="line"><span class="cl">	<span class="n">status</span><span class="o">.</span><span class="na">shutDownNeeded</span> <span class="o">==</span> <span class="n">shutDown</span>
</span></span><span class="line"><span class="cl">	<span class="n">status</span><span class="o">.</span><span class="na">evacuationMinutes</span> <span class="o">==</span> <span class="n">evacuation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nl">where:</span> <span class="s2">&#34;possible nuclear incidents are:&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="n">pressure</span> <span class="o">|</span> <span class="n">fireSensors</span> <span class="o">|</span> <span class="n">radiation</span>             <span class="o">||</span> <span class="n">alarm</span> <span class="o">|</span> <span class="n">shutDown</span> <span class="o">|</span> <span class="n">evacuation</span>
</span></span><span class="line"><span class="cl">	<span class="mi">150</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[]</span>                    <span class="o">||</span> <span class="kc">false</span> <span class="o">|</span> <span class="kc">false</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">150</span>      <span class="o">|</span> <span class="mi">1</span>           <span class="o">|</span> <span class="o">[]</span>                    <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">false</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">150</span>      <span class="o">|</span> <span class="mi">3</span>           <span class="o">|</span> <span class="o">[]</span>                    <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">150</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">110.4f</span> <span class="o">,</span><span class="mf">0.3f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>  <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">150</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">45.3f</span> <span class="o">,</span><span class="mf">10.3f</span><span class="o">,</span> <span class="mf">47.7f</span><span class="o">]</span> <span class="o">||</span> <span class="kc">false</span> <span class="o">|</span> <span class="kc">false</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">155</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">0.0f</span> <span class="o">,</span><span class="mf">0.0f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>    <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">false</span>    <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">170</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">0.0f</span> <span class="o">,</span><span class="mf">0.0f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>    <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">	<span class="mi">180</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">110.4f</span> <span class="o">,</span><span class="mf">0.3f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>  <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">500</span>      <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">110.4f</span> <span class="o">,</span><span class="mi">300</span><span class="n">f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>  <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">30</span>       <span class="o">|</span> <span class="mi">0</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">110.4f</span> <span class="o">,</span><span class="mi">1000</span><span class="n">f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span> <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">155</span>      <span class="o">|</span> <span class="mi">4</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">0.0f</span> <span class="o">,</span><span class="mf">0.0f</span><span class="o">,</span> <span class="mf">0.0f</span><span class="o">]</span>    <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">	<span class="mi">170</span>      <span class="o">|</span> <span class="mi">1</span>           <span class="o">|</span> <span class="o">[</span><span class="mf">45.3f</span> <span class="o">,</span><span class="mf">10.3f</span><span class="o">,</span> <span class="mf">47.7f</span><span class="o">]</span> <span class="o">||</span> <span class="kc">true</span>  <span class="o">|</span> <span class="kc">true</span>     <span class="o">|</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†ä¸Šé¢æåŠçš„ given-when-then èŒƒå¼å¤–ï¼Œè¿˜å¤šäº†ä¸€ä¸ªä¹‹å‰æ²¡è§è¿‡çš„ where blockã€‚ç°
åœ¨å°±æ¥è®¤è¯†ä¸€ä¸‹ Spock çš„ killer ç‰¹æ€§. å¯ä»¥çœ‹åˆ° Spock çš„è¾“å…¥è¾“å‡ºå‚æ•°éƒ½ä¿å­˜åœ¨ç±»
ä¼¼è¡¨æ ¼çš„æ•°æ®ç»“æ„ï¼Œå…¶å®è¿™æ˜¯ Spock çš„ Parameterized testsï¼Œè€Œåœ¨ <strong>||</strong> ç¬¦å·å·¦è¾¹çš„
æ˜¯è¾“å…¥ï¼Œå³è¾¹çš„è¾“å‡ºï¼Œæ¯ä¸€åˆ—å¼€å§‹éƒ½æ˜¯è¯¥å‚æ•°çš„å±æ€§åï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆä¾¿æ·åœ°åœ¨ <strong>then</strong>
åˆ¤æ–­è¾“å‡ºç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸç»“æœ. è€Œæ•°æ®æ·»åŠ æˆ–è€…å‡å°‘è¾“å…¥å‚æ•°æˆ–è€…è¾“å‡ºç»“æœçš„æ“ä½œï¼Œ
åªéœ€åœ¨ <strong>where</strong> block é‡Œé¢å¯¹åº”åœ°æ·»åŠ æˆ–è€…å‡å°‘å…·ä½“çš„å‚æ•°ï¼Œæ•´ä¸ªæ“ä½œä¸€ç›®äº†ç„¶. å‚æ•°
çš„æ–°å¢æˆ–è€…ç§»é™¤ä¹Ÿå¾ˆå®¹æ˜“åœ°å®ç°</p>
<h2 id="ç»“è¯­"><span class="section-num">5</span> ç»“è¯­</h2>
<p>ç¬”è€…åœ¨é¡¹ç›®ä¸­æ­£æ˜¯ä½¿ç”¨ Spock ç¼–å†™æµ‹è¯•ï¼Œ æˆ–è®¸å¯¹æ¯” Junit, Spock åœ¨æµè¡Œåº¦æ–¹é¢è¿˜éš¾è€Œ
æœ›å…¶é¡¹èƒŒ, ä½†æ˜¯ç»¼åˆå¤šæ–¹è€ƒè™‘ï¼ŒSpock çœŸçš„å€¼å¾—ä¸€è¯•ï¼Œå…¼ä¹‹ Groovy è¯­è¨€çš„è¯­æ³•åŠ æˆï¼Œå°±
æœ‰ä¸€ç§åœ¨ä½¿ç”¨è„šæœ¬ç¼–å†™ Java çš„æ„Ÿè§‰ (å¥½å§ï¼Œç¬”è€…çŸ¥é“ Groovy å°±æ˜¯åŸºäº jvm çš„è„šæœ¬)ï¼Œ
æ— éœ€å†ä¸º Java å•°å—¦çš„è¯­æ³•è€Œçƒ¦æ¼ã€‚æ­¤å¤– Spockè¿˜æœ‰å¾ˆå¤šå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å†…ç½®çš„
Mocking Stubbing (Junit éœ€è¦ç¬¬ä¸‰æ–¹åº“æ”¯æŒ), è¿˜æœ‰æ”¯æŒä¼ä¸šçº§åº”ç”¨ï¼ŒSpring, Spring
boot, å’Œ Restful service æµ‹è¯•ç­‰ã€‚æ›´å¤šçš„ç”¨æ³•ï¼Œå°±è¦æŸ¥é˜…å®˜æ–¹æ–‡æ¡£äº†</p>
<h2 id="å‚è€ƒ"><span class="section-num">6</span> å‚è€ƒ</h2>
<ul>
<li><a href="https://www.amazon.com/Java-Testing-Spock-Konstantinos-Kapelonis/dp/1617292532">Java Testing with Spock</a></li>
<li><a href="http://spockframework.org/spock/docs/1.1-rc-3/index.html">Spock Framework Reference Documentation</a></li>
</ul>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>
