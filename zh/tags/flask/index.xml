<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Flask on è¿‡æ²³å’</title>
    <link>https://ramsayleung.github.io/zh/tags/flask/</link>
    <description>Recent content in Flask on è¿‡æ²³å’</description>
    <image>
      <title>è¿‡æ²³å’</title>
      <url>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- 0.146.7</generator>
    <language>zh</language>
    <copyright>See this site&amp;rsquo;s source code here, licensed under GPLv3 Â·</copyright>
    <lastBuildDate>Mon, 30 Dec 2024 22:32:24 -0800</lastBuildDate>
    <atom:link href="https://ramsayleung.github.io/zh/tags/flask/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>flaskç‰›åˆ€å°è¯•ä¹‹å¾®ä¿¡å…¬ä¼—å·å¼€å‘</title>
      <link>https://ramsayleung.github.io/zh/post/2017/weixin_flask/</link>
      <pubDate>Thu, 23 Feb 2017 00:00:00 -0800</pubDate>
      <guid>https://ramsayleung.github.io/zh/post/2017/weixin_flask/</guid>
      <description>An flask project</description>
      <content:encoded><![CDATA[<p><a href="http://flask.pocoo.org/">flask</a> æ˜¯ä¸€ä¸ªè½»é‡çº§çš„python æ¡†æ¶(å®˜ç½‘ç§°ä¸ºå¾®å‹æ¡†æ¶),å¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼Œä¹‹å‰å› ä¸ºç¬”è€…è·Ÿæœ‹å‹å¼€å‘å°ç¨‹åºçš„æ—¶å€™ä½¿ç”¨è¿‡ flask,è¿‡åå°±é—å¿˜äº†ã€‚</p>
<p>ä¸ºäº†é‡æ‹¾flask, ç¬”è€…å†³å®šå†™ç‚¹å°ä¸œè¥¿ï¼Œä¹‹å‰å¼€å‘å°ç¨‹åºï¼Œä¸å¦‚ç°åœ¨å†ç©ç©å…¬ä¼—å·å¼€å‘</p>
<h2 id="éªŒè¯æœåŠ¡å™¨"><span class="section-num">1</span> éªŒè¯æœåŠ¡å™¨</h2>
<p>å¼€å‘å…¬ä¼—å·ä¹‹å‰ï¼Œè¦å…ˆéªŒè¯æœåŠ¡å™¨çš„æœ‰æ•ˆæ€§ï¼Œå®˜ç½‘æœ‰è¯¦ç»†çš„è¯´æ˜ï¼š<a href="https://mp.weixin.qq.com/wiki/8/f9a0b8382e0b77d87b3bcc1ce6fbc104.html">å…¬ä¼—å¼€å‘å¹³å°æ–‡æ¡£</a></p>
<table>
  <thead>
      <tr>
          <th>å‚æ•°</th>
          <th>æè¿°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>signature</td>
          <td>å¾®ä¿¡åŠ å¯†ç­¾åï¼Œsignatureç»“åˆäº†å¼€å‘è€…å¡«å†™çš„tokenå‚æ•°å’Œè¯·æ±‚ä¸­çš„timestampå‚æ•°ã€nonceå‚æ•°ã€‚</td>
      </tr>
      <tr>
          <td>timestamp</td>
          <td>æ—¶é—´æˆ³</td>
      </tr>
      <tr>
          <td>nonce</td>
          <td>éšæœºæ•°</td>
      </tr>
      <tr>
          <td>echostr</td>
          <td>éšæœºå­—ç¬¦ä¸²</td>
      </tr>
  </tbody>
</table>
<p>æ ¡éªŒæµç¨‹ï¼š
åŠ å¯†/æ ¡éªŒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†tokenã€timestampã€nonceä¸‰ä¸ªå‚æ•°è¿›è¡Œå­—å…¸åºæ’åº</li>
<li>å°†ä¸‰ä¸ªå‚æ•°å­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œsha1åŠ å¯†</li>
<li>å¼€å‘è€…è·å¾—åŠ å¯†åçš„å­—ç¬¦ä¸²å¯ä¸signatureå¯¹æ¯”ï¼Œæ ‡è¯†è¯¥è¯·æ±‚æ¥æºäºå¾®ä¿¡</li>
</ol>
<p>æµç¨‹å¹¶ä¸å¤æ‚ï¼Œå®˜ç½‘ç»™å‡ºäº†ä»£ç ç¤ºä¾‹ï¼Œåªä¸è¿‡æ˜¯PHPçš„ï¼Œæ¢æˆpython ä¹Ÿæ˜¯å¾ˆå®¹æ˜“æ»´ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">wechat</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">==</span><span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">token</span><span class="o">=</span><span class="s1">&#39;your token&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span>
</span></span><span class="line"><span class="cl">            <span class="n">signature</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;signature&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">nonce</span> <span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonce&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">echostr</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;echostr&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">=</span><span class="p">[</span><span class="n">timestamp</span><span class="p">,</span><span class="n">nonce</span><span class="p">,</span><span class="n">token</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">==</span><span class="n">signature</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">echostr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">rec</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">xml_rec</span><span class="o">=</span><span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">tou</span> <span class="o">=</span> <span class="n">xml_rec</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ToUserName&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">            <span class="n">fromu</span> <span class="o">=</span> <span class="n">xml_rec</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;FromUserName&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">            <span class="n">content</span> <span class="o">=</span> <span class="n">xml_rec</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Content&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">            <span class="n">xml_rep</span> <span class="o">=</span> <span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">xml</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">ToUserName</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="o">%</span><span class="n">s</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">ToUserName</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">FromUserName</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="o">%</span><span class="n">s</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">FromUserName</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">CreateTime</span><span class="o">&gt;%</span><span class="n">s</span><span class="o">&lt;/</span><span class="n">CreateTime</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">MsgType</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="n">text</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">MsgType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">Content</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="o">%</span><span class="n">s</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">Content</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">FuncFlag</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">FuncFlag</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">xml</span><span class="o">&gt;</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·æœåŠ¡å™¨å°±æ ¡éªŒæˆåŠŸäº†ï¼Œå°±å¯ä»¥ç¼–å†™ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘äº†</p>
<h2 id="æ­Œè¯æŸ¥è¯¢"><span class="section-num">2</span> æ­Œè¯æŸ¥è¯¢</h2>
<p>ç¬”è€…è‡ªå·±å¹³æ—¶æ˜¯æ‰“å¼€éŸ³ä¹æ’­æ”¾å™¨ï¼Œæˆ´ä¸Šè€³æœºï¼Œå°±å¼€å§‹æ’­æ”¾éŸ³ä¹ï¼›æ‰€ä»¥ç»å¸¸å‡ºç°ç¬”è€…å¬åˆ°æŸé¦–æ­Œæ›²è§‰å¾—æ—‹å¾‹éå¸¸ç†Ÿæ‚‰ï¼Œä½†æ˜¯å°±æ— æ³•æƒ³èµ·æ­Œåçš„æƒ…å†µï¼Œè¿™ç§æ„Ÿè§‰å®åœ¨ä¸å¥½ï¼Œæ‰€ä»¥ç¬”è€…è§‰å¾—å¯ä»¥ç¼–å†™ä¸€ä¸ªé€šè¿‡æ­Œè¯æŸ¥è¯¢æ­Œæ›²ï¼Œå¹¶è¿”å›æ‰€æœ‰æ­Œè¯çš„åŠŸèƒ½ã€‚</p>
<p>æ€è·¯å¤§æ¦‚æ˜¯ç¼–å†™çˆ¬è™«ï¼Œé€šè¿‡æ­Œè¯è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå¯¹è¿”å›çš„html é¡µé¢è¿›è¡Œæ£€ç´¢å’Œä¿¡æ¯æå–ã€‚å‰©ä¸‹çš„äº‹å°±æ˜¯çˆ¬è™«å’Œè§£æé¡µé¢äº†ï¼Œç¬”è€…æ˜¯ä½¿ç”¨<a href="http://www.xiami.com/">è™¾ç±³</a> è¿›è¡Œæ­Œè¯æŸ¥è¯¢çš„ï¼Œä½¿ç”¨ request å‘é€ http è¯·æ±‚ï¼Œä½¿ç”¨ lxmlè¿›è¡Œè§£æï¼Œå…¶ä»–å°±ä¸ä¸€ä¸€ç»†è¡¨äº†</p>
<h2 id="å•è¯æŸ¥è¯¢"><span class="section-num">3</span> å•è¯æŸ¥è¯¢</h2>
<p>æœ‰æ—¶å€™ï¼Œç¬”è€…åœ¨å¾®ä¿¡éœ€è¦æŸ¥è¯¢å•è¯ï¼Œä½†æ˜¯åˆä¸æƒ³é€€å‡ºå¾®ä¿¡ï¼Œæ‰€ä»¥å°±æ‰“ç®—ç”¨å…¬ä¼—å·æ¥æŸ¥å•è¯å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯æœåŠ¡è·å–ç”¨æˆ·å‘ç»™å¾®ä¿¡å…¬ä¼—å·çš„æ•°æ®ï¼Œå†å»è¯·æ±‚æœ‰é“ä¹‹ç±»è¯å…¸çš„api,å†æŠŠç»“æœè¿”å›ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è½¬å‘ç»™ç”¨æˆ·</p>
<h2 id="ç”µå½±æŸ¥è¯¢"><span class="section-num">4</span> ç”µå½±æŸ¥è¯¢</h2>
<p>æœ‰æ—¶æ— èŠæƒ³å»çœ‹ç”µå½±ï¼Œä½†æ˜¯ä¸çŸ¥é“çœ‹ä»€ä¹ˆç”µå½±ï¼Œå› ä¸ºé€‰æ‹©å¤ªå¤šï¼Œè´¨é‡å‚å·®ä¸é½çš„ç‰‡å¤ªå¤šäº†æ‰€ä»¥ç¬”è€…ä¼šå…ˆå»è±†ç“£çœ‹ä¸€ä¸‹æ–°ä¸Šå½±çš„ç”µå½±ï¼Œçœ‹ä¸€ä¸‹è¯„åˆ†ï¼Œç„¶åå†å†³å®šçœ‹ä»€ä¹ˆç”µå½±ã€‚æ‰€ä»¥ï¼Œç¬”è€…å¯ä»¥æŠŠè¿™ä¸ªåŠŸèƒ½æ¬åˆ°å…¬ä¼—å·æ¥ã€‚å¦‚ä½•å®ç°å‘¢ï¼Ÿè¿˜æ˜¯çˆ¬è™«</p>
<h2 id="æ€»ç»“"><span class="section-num">5</span> æ€»ç»“</h2>
<p>æ„Ÿè§‰è¿™æ¬¡å¼€å‘å…¬ä¼—å·ï¼Œç¬”è€…å°±æ˜¯ç”¨ flask ç¼–å†™ restful api, ç„¶ååšçš„å…¶ä»–äº‹æƒ…å°±æ˜¯ç¼–å†™çˆ¬è™«ã€‚</p>
<p><a href="https://github.com/ramsayleung/SamrayJustForFun">é¡¹ç›®githubåœ°å€</a></p>
<div center class="qr-container">
<img src="/ox-hugo/qrcode_gh_e06d750e626f_1.jpg" alt="qrcode_gh_e06d750e626f_1.jpg" width="160px" height="160px" center="t" class="qr-container" />
å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>
