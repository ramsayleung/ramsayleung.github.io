<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>自由庄园</title>
    <link>https://ramsayleung.github.io/zh/</link>
    <description>Recent content on 自由庄园</description>
    <image>
      <title>自由庄园</title>
      <url>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://ramsayleung.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>See this site&#39;s source code [here](https://github.com/ramsayleung/ramsayleung.github.io), licensed under GPLv3 ·</copyright>
    <lastBuildDate>Sat, 12 Oct 2024 18:22:00 -0700</lastBuildDate><atom:link href="https://ramsayleung.github.io/zh/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>区块链的完整性校验方案: Merkle Tree</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C%E6%96%B9%E6%A1%88_merkle_tree/</link>
      <pubDate>Sat, 12 Oct 2024 18:22:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C%E6%96%B9%E6%A1%88_merkle_tree/</guid>
      <description>1 前言 最近通过 Solidity-103 课程在学习 Solidity, 看到第36课 Merkle Tree 的时候着实头疼, 即使我已经了解 Merkle Tree 这数据结构，但是课程还是看得不明所以。 所以写下这篇文章，梳理我</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<p>最近通过 <a href="https://www.wtf.academy/docs/solidity-103">Solidity-103</a> 课程在学习 Solidity, 看到<a href="https://www.wtf.academy/docs/solidity-103/MerkleTree/">第36课</a> Merkle Tree 的时候着实头疼, 即使我已经了解 Merkle Tree 这数据结构，但是课程还是看得不明所以。 <br/></p>
<p>所以写下这篇文章，梳理我所理解的 Merkle Tree 及其用途，既加深自己的理解，又践行了<a href="https://ramsayleung.github.io/zh/post/2022/feynman_technique/">费曼学习法</a> <br/></p>
<h2 id="区块链与交易"><span class="section-num">2</span> 区块链与交易</h2>
<p>关于区块链的资料有非常多，我也不赘述了. <br/></p>
<p>简单理解，区块链是由一个一个区块构成的有序链表，每一个区块都记录了一系列交易，并且，每个区块都指向前一个区块，从而形成一个链条。区块链听起来很高级，其实就是个单链表。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/blockchain.jpg"/> 
</figure>
 <br/></p>
<p>每个区块都会保存对应的交易信息，也会包含元数据信息在头部，包括前一个区块的 hash, 包含的交易数，merkle tree 的根节点 hash,时间戳等信息. <br/>
<img loading="lazy" src="/ox-hugo/block_detail.jpg" alt=""  />
 <br/></p>
<p>我们总说区块链是不可窜改，那么它究竟是怎么不可窜改的? <br/></p>
<p>如果用户想要验证某个区块的某笔交易是否被窜改，他要怎么做？ <br/>
最简单的方式自然是把整个区块的交易都下载下来，平均每个区块有1M的数据，验证起来肯定很费时间. <br/></p>
<p>是否有一个验证方案，可以使用很小的数据集就完成验证? <br/></p>
<p>有的，那就是 Merkle Tree. <br/></p>
<h2 id="merkle-tree"><span class="section-num">3</span> Merkle Tree</h2>
<p>那什么是 Merkle Tree? <br/></p>
<p>假如我们有8笔交易被包含在区块中, 每笔交易都可以通过 hash 函数计算出一个 hash 值: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/8transactions.jpg"/> 
</figure>
 <br/></p>
<p>哈希值也可以看做数据，所以可以把 <code>h1</code> 和 <code>h2</code> 拼起来， <code>h3</code> 和 <code>h4</code> 拼起来, 依此类推，再计算出哈希值 <code>b1</code> 和 <code>b2</code> <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/merkle_tree_layer_two.jpg"/> 
</figure>
 <br/></p>
<p>递归计算下去，直到计算结果只有一个 hash 值，这个就是所谓的 merkle root, 而 h1-h8 就是所谓的 <code>leaf node</code>, 两者之间的就是 <code>non-leaf node</code>. <br/></p>
<p>交易数量恰好是偶数能这么算，如果是奇数，那要怎么算呢？这个时侯，只需要把最后一个 hash 值复制一份，也能算出最终的 merkle root： <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/odd_leaf_merkle_tree.jpg"/> 
</figure>
 <br/></p>
<h2 id="merkle-tree-validation"><span class="section-num">4</span> Merkle tree validation</h2>
<p>现在有了 Merkle Tree, 如果我们要验证区块中的交易是否被修改，要怎么算呢？ <br/></p>
<p>最简单粗暴的方式肯定是把区块所有的交易下载下来，从头重组整棵 Merkle Tree, 8笔交易计算起来还可以，如果是几千笔呢？几百万笔呢？甚至几亿笔交易呢？ <br/></p>
<p>重组 Merkle Tree 的时间复杂度是 O(N), 如果是1亿笔交易，这意味着你要计算1亿次，太慢了。 <br/></p>
<p>但是，如果我们利用 Merkle Tree 的特性，从数学的角度，我们只需要少量的Merkle Proof(你可以理解成需要提供的验证数据集), 就可以完成验证. <br/></p>
<p>回到上文的 Merkle Tree, 假如我们要验证 <code>tx2</code> 是否被窜改，我们需要有 Merkle Tree Root 和 Merkle Proof: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/merkle_proof.jpg"/> 
</figure>
 <br/></p>
<p>假设现在我们有 <code>tx2</code> 的交易数据，我们只需要 Merkle Proof 提供3个hash 值(图中的绿色部分)，然后我们只计算4次（橙色部分），就会算出 Merkle Root Tree 的值，用来和区块头部的 Merkle root 值进行比对。 <br/></p>
<p>通过 Merkle Proof 提供的数据集，我们就可以把下载8笔交易，计算15次hash，优化成只需3个 hash 值，以及计算4次hash，时间复杂度从O(N)降低成O(logN). <br/></p>
<p>这个比对似乎不明显，但是以1亿交易为例的话，log(1_000_000_000) ~= 27, 也就是只需要 Merkle Proof 提供27个 hash 值即可, 巨大的性能提升. <br/></p>
<h2 id="区块链的不可窜改性"><span class="section-num">5</span> 区块链的不可窜改性</h2>
<p>通过Merkle tree root可以保证交易的不可窜改性，而区块 hash 又能保证区块头部的元数据不被窜改. <br/></p>
<p>因为每个区块都有区块 hash, 区块hash是通过计算头部元数据信息计算出来的: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/block_hash.jpg"/> 
</figure>
 <br/></p>
<p>只要修改了其中一个元数据值，那么 block hash 就会发生变化，而区块链就是一个单链表，通过后一个区块通过 <code>prev_hash</code> 指向前一个区块，如果 block hash 发生变化，那么后一个区块就无法正确指向前一个区块了，这个链就断了. <br/></p>
<p>如果一个恶意的攻击者修改了一个区块中的某个交易，那么Merkle Hash验证就不会通过。 <br/></p>
<p>所以，他只能重新计算Merkle Hash，然后把区块头的Merkle Hash也修改了。 <br/></p>
<p>这时，我们就会发现，这个区块本身的Block Hash就变了，所以，下一个区块指向它的链接就断掉了, 他就要把后续所有区块全部重新计算并且伪造出来，才能够修改整个区块链； <br/></p>
<p>而要修改后续所有区块，这个攻击者必须掌握全网51%以上的算力才行。 <br/></p>
<p>理论上可行，但是实操难度非常非常非常大. <br/></p>
<h2 id="merkle-tree-版本管理中的应用"><span class="section-num">6</span> Merkle Tree 版本管理中的应用</h2>
<p>除去区块链，Merkle Tree还被应用于类似 Git 和 Mercurial 这样的版本管理系统中，以Git为例, 假如我们Git项目内有4个文件: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/git_merkle_tree.jpg"/> 
</figure>
 <br/></p>
<p>当你push 代码到远程分支或者从远程分支 pull 代码的时候，Git就计算你的Merkle Tree Root 的值, 比较远程分支的Merkle Tree Root和本地分支的Merkle Tree Root 是否相同: <br/></p>
<p>如果相同，那就不用更新了；如果不同的话它就会检查左节点或者右节点，并且递归下去， <br/>
直到找到是哪些文件发生了修改，只通过网络传输修改部分的内容, 以提高传输效率. <br/></p>
<p>不过Git实际用的是Merkle Tree的变体，并不是直接使用Merkle Tree. <br/></p>
<p>除些之外, Merkle Tree 还在 Cassandra, DynamoDB 这样的NoSQL数据库中被用于检查不同节点数据的一致性, 细节可以看下这个 <a href="https://stackoverflow.com/questions/5486304/explain-merkle-trees-for-use-in-eventual-consistency">Stackoverflow 问题</a>。 <br/></p>
<h2 id="参考"><span class="section-num">7</span> 参考</h2>
<ul>
<li><a href="https://alexromanov.github.io/2022/06/19/bchain-test-7-merkle-tree/">Blockchain for Test Engineers: Merkle Trees</a> <br/></li>
<li><a href="https://medium.com/geekculture/understanding-merkle-trees-f48732772199">Understanding Merkle Trees</a> <br/></li>
<li><a href="https://stackoverflow.com/questions/5486304/explain-merkle-trees-for-use-in-eventual-consistency">Explain Merkle Trees for use in Eventual Consistency</a> <br/></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>测试技能进阶(一): 软件质量认知</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%80_%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F%E8%AE%A4%E7%9F%A5/</link>
      <pubDate>Sat, 12 Oct 2024 10:30:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E6%B5%8B%E8%AF%95%E6%8A%80%E8%83%BD%E8%BF%9B%E9%98%B6%E4%B8%80_%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F%E8%AE%A4%E7%9F%A5/</guid>
      <description>1 前言 最近几个月都在赶个非常重要项目，基本每天或每几天都要提交CR，而因为每个CR都要附上对应的 test case, 所以这段时间写了非常多的 test case, 又在坐我旁边</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<p>最近几个月都在赶个非常重要项目，基本每天或每几天都要提交CR，而因为每个CR都要附上对应的 test case, 所以这段时间写了非常多的 test case, 又在坐我旁边的 Principle Engineer 巨佬身上学到了很多有用的测试技巧，所以就想写个系列文章总结和分享我所学到的新技能。 <br/></p>
<h2 id="why"><span class="section-num">2</span> Why</h2>
<p>有个很著名的思考方式，叫黄金圈法则, 简而言之，就是对于某件事找到Why，How，What： <br/></p>
<p>我为什么要做，我怎么做，做这件事的结果是什么？ <br/></p>
<p>所以我就先来聊聊为什么要写测试case，或者说为什么是软件开发写测试case，后续的文章再来聊聊How. <br/></p>
<h2 id="软件质量文化"><span class="section-num">3</span> 软件质量文化</h2>
<p>关于软件工程师来写测试 case, 最有名的应该是Google，他们就是推崇由软件工程师来写测试case，而他们的测试文化已经成为谷歌的工程文化的重要组成部分。 <br/></p>
<p>Google的工程师也前后写了两本书来布道他们的测试文化/工程文化, 也非常推荐阅读: <br/></p>
<ul>
<li><a href="https://book.douban.com/subject/25742200/">Google软件测试之道</a> <br/></li>
<li><a href="https://book.douban.com/subject/35838155/">Google软件工程</a> <br/></li>
</ul>
<p>毕业以后待过几家大公司，这几家公司的文化各有不同，但就我所供职过的部门而言，对于测试，他们都有着相同的观点： <br/>
不应该也不会有所谓的测试工程师，每个软件开发都应该为自己的代码编写测试，并保证质量. <br/></p>
<p>其中微信支付基本就是在践行《Google软件测试之道》的理念，推广微信支付自己的测试文化，强调测试左称，面向测试设计等等。 <br/></p>
<p>Amazon 内部的测试文化也是和Google 相当类似，只是远没有Google出名. <br/></p>
<p>不知道是因为Amazon的测试文化是受Google所影响, 讲究先来后到, 主客分明; 还是Amazon的开源项目或者技术影响力没有Google高，导致Amazon 工程文化没有Google出名，又或是因为Amazon工程师在血汗工厂打工，忙着赶需求，没有时间写书布道, 所以不为人所知呢. <br/></p>
<p>这种文化背后，是对软件开发与质量测试密不可分的认知： <br/></p>
<h3 id="职责"><span class="section-num">3.1</span> 职责</h3>
<p>首先，每个工程师，都应该为他们的代码编写测试用例， <br/>
这个工作本身就是研发流程的一部分，而质量保障又是软件开发生命周期非常关键的一步， <br/>
如果写出来的功能充满问题，这样的功能再多，开发得再快又有什么意义呢。 <br/></p>
<h3 id="ci-cd"><span class="section-num">3.2</span> CI/CD</h3>
<p>所以我现在所在S3部门而言，要求每个CR都要有对应的测试用例来保证CR代码的质量，因为代码合并到主干之后， <br/>
就会被 Continuous Deployment 自动部署上线，所以要求每个提到的CR都是 production-ready的 <br/></p>
<p>软件工程师自己编写测试配合CI/CD就可以更早更快地发现问题，并且由软件工程师快速完成修复, 降低反馈周期, 提高开发效率. <br/></p>
<h3 id="成本"><span class="section-num">3.3</span> 成本</h3>
<p>其次，沟通是有成本的，如果存在测试工程师，软件工程师就要给测试工程师交待清楚业务功能是什么， <br/>
这次的改动要测什么功能，预期结果是什么，沟通成本就相当高，你可能还需要通过文档或者工单将测试内容呈现给测试工程师。 <br/></p>
<p>如果软件工程师都能把这些东西解释清楚，那为什么不自己把测试用例写完呢, 何必劳心劳力去写工单呢？ <br/></p>
<h3 id="面向测试设计"><span class="section-num">3.4</span> 面向测试设计</h3>
<p>虽然Test-Driven Development(TDD)的开发理念不一定所有人都认同, 但是让软件开发工程师来编写测试用例，能让软件工程师有测试先行，设计测试友好接口的认知, 反过来又会对其接口设计能力有新的要求. <br/></p>
<h3 id="敏捷开发"><span class="section-num">3.5</span> 敏捷开发</h3>
<p>总结下来，让软件工程师对质量负责，自己编写测试用例, 是确保团队能敏捷开发(move fast), 又能确保软件质量的关键手段 <br/></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>悼念我家的狗</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E6%82%BC%E5%BF%B5%E6%88%91%E5%AE%B6%E7%9A%84%E7%8B%97/</link>
      <pubDate>Wed, 02 Oct 2024 11:54:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E6%82%BC%E5%BF%B5%E6%88%91%E5%AE%B6%E7%9A%84%E7%8B%97/</guid>
      <description>1 缘起 老家是在广东农村，现在还会有养狗看家护院的习俗，虽然看家的作用有多大尚且未知，但是终归是聊胜于无，半是护院，半是陪伴。 一般是有其他养狗</description>
      <content:encoded><![CDATA[<h2 id="缘起"><span class="section-num">1</span> 缘起</h2>
<p>老家是在广东农村，现在还会有养狗看家护院的习俗，虽然看家的作用有多大尚且未知，但是终归是聊胜于无，半是护院，半是陪伴。 <br/></p>
<p>一般是有其他养狗人家的狗产崽之后，然后拿回来家里开始养，所以养的自然是不会是宠物狗，是所谓的土狗，戏称为「田园犬」. <br/></p>
<p>也不会有专门的狗粮，而是给它们喂米粮，或是和人吃一样的米饭，或是专门去买稍次一些的米，煮给它们吃。 <br/></p>
<h2 id="经过"><span class="section-num">2</span> 经过</h2>
<p>昨天和妈妈视频聊天，闲谈间就聊到了我家的狗子，妈妈说现在不用煮多少米给它们吃了，我问为什么? <br/></p>
<p>毕竟我记得家里一只狗一顿都差不多要吃半斤米饭. <br/></p>
<p>妈妈说，有两只狗被人偷狗不成，被毒死了, 一只是不到一年大的狗，另外一只是养了好多年的白色母狗. <br/></p>
<p>在凌晨时段，偷狗贼来我家附近偷狗, 狗声大作，我爸出去查看，灯光和声音吓走了贼人, 他没来得及带走狗. <br/></p>
<p>我爸前去查看狗的状况，母狗很快就瘫软在地，不一会就生机全无了; 另外一只狗不见踪影，我妈一直在寻觅，几天后, 对狗仍抱有希望的我妈在附近找到了尸体. <br/></p>
<h2 id="印记"><span class="section-num">3</span> 印记</h2>
<h3 id="贪吃"><span class="section-num">3.1</span> 贪吃</h3>
<p>常年离家的我对那只一年大的狗，脑海没有留下太多印象, 没有过太多交集，而另外一只白色母狗， <br/>
我已经记不清养了多久年，大概是我大学时期就已经在我家了，它给我留下最大的特点就是贪吃。 <br/></p>
<p>农村的土狗都贪吃嘛，因为总是吃不饱，这有什么新奇的? <br/></p>
<p>不过我家的狗一般都有一日两餐，我妈有时候还会把去村宴打包回来的饭菜给它们吃，所以我家的狗终究还是能落个饱腹的, 妈妈甚至有时会责怪它们吃腻了，给它们米饭都不吃了。 <br/></p>
<p>而这白色的母狗贪吃的最大特点就是爱吃零食，尤其喜欢吃甜食，听起来有点难而置信，一只狗会喜欢吃甜食. <br/></p>
<p>但是事实的确如此, 无论零食还是水果，它都喜欢。 <br/></p>
<p>屋子旁边有棵十几年树龄的龙眼树，前些年收成好的时候，树上都挂满龙眼，核小肉实还很甘甜，甚至品质比水果摊的还要好. <br/></p>
<p>家人夏天收获龙眼的时候，有时朋友也会过来，大家就坐在屋旁围坐着吃刚摘下来的龙眼， <br/>
它也喜欢过来湊热闹，家人就会开玩笑地帮忙把壳剥了，把果肉放在地上，它究竟就上来吃，还知道把核吐出来, 大家才开始知道它真的吃水果。 <br/></p>
<p>它甚至还知道怎么吃小块甘蔗, 把汁水在嘴里吮吸完之后，还会把渣吐出来。 <br/></p>
<p>以前在深圳打工的时候，妈妈和我聊天的时候还会聊到这只贪吃的狗，说它又凑过来想要吃的. <br/></p>
<p>电话那头的我自然是不信的, 只会觉得这是妈妈和我聊天的谈资. <br/></p>
<h3 id="饼干"><span class="section-num">3.2</span> 饼干</h3>
<p>我家这边的吃席习俗，比如红白事或者是生日宴，客人带些饼干水果作为贺礼， <br/>
主人家一般会把散席前给客人人手一袋礼品作为回礼，里面基本会有饼干, 坚果, 花生. <br/></p>
<p>因为我爸人缘比较好，总会有朋友邀请他参加村宴，所以他总能带些回礼回家，被妈妈放在蓝罐曲奇的铁皮盒子. <br/>
只是他们都不是很喜欢吃这些零食，这些饼干就在敞开的曲奇盒子放着，静静地在茶桌上躺着。 <br/></p>
<p>当我回家，百无聊赖的时候，就会拿起一两包盒中的饼干，就着电视中播着的抗日神剧，消磨着闲暇的时光. <br/></p>
<p>白色的母狗它就会湊过, 也不叫，也不闹，也不会像宠物狗那样把爪子搭到我身上， <br/>
只是用它的大眼睛静静地看着我，我被它看得有点不好意思，想起妈妈给我说起过的，关于它贪吃的事，寻思着它不会也想吃饼干嘛？ <br/></p>
<p>我试探着把一块饼干抽出来，放在地上，它走过去，朝着饼干低下头, 嗅了嗅，又抬头看了下正在吃饼干的我，然后我看它把饼干叼到一边，叼着饼干时, 就抬起头把饼干向嘴里送. <br/></p>
<p>原来妈妈说得是真的，它是真的贪吃. <br/></p>
<h3 id="花生"><span class="section-num">3.3</span> 花生</h3>
<p>我很喜欢吃花生，尤其是农家的盐水花生，就着电视剧或者视频，可以一两个小时不停嘴。 <br/></p>
<p>妈妈知道我有这么个小嗜好，就会去市场上买些花生回来，只用盐水煮熟，不加其他香料， 然后晒干，等我回家的时候可以吃，或者在我回深圳时，让我装一大包带回去。 <br/></p>
<p>有一次在家，我照例在桌上剥着花生吃，然后它又走过来，看着我，我在想，花生你也吃么？ <br/></p>
<p>就把一枚花生剥开，里面有两粒仁，我吃了一粒，然后把另外一粒放在凳子上，它走过来, 把头侧转, 贴着凳子，伸出舌头一卷，就把花生卷走了. <br/></p>
<p>从此之后，我吃花生总是喊上它，我来剥花生，我和它一起吃；有一粒花生仁，我自己吃；有两粒花生仁，我和它一人一粒; 有三粒仁，我吃两个粒, 它吃一粒，毕竟我动手剥花生了. <br/></p>
<p>后面发现，它不但吃花生，连月饼也吃，去年中秋的时候，家人分食月饼时，也给了它一小块. <br/></p>
<p>当你吃东西，它也想吃的时候, 它不会吵，也不会闹，就是静静地看着你; <br/></p>
<p>而当你东西吃完，开始收拾时，跟它说，没有了，吃完啦。 <br/></p>
<p>它也不会缠着你不走, 期望索求更多，而是会静静地走开。 <br/></p>
<p>所以我有时候看到它，我会在想，我不知道我人生追求的是什么，但是它肯定是追求好吃的, 和去码头整点薯条的海鸥是一样的，简单又容易满足。 <br/></p>
<h2 id="现实"><span class="section-num">4</span> 现实</h2>
<p>它虽然贪吃，但是也非常谨慎，并不是谁给的东西都吃，我姐姐给它的食物，它就基本不吃，可能是我姐姐曾经呵斥过它. <br/></p>
<p>即使我给它东西吃，它也要见我吃过，它才会下嘴. <br/></p>
<p>谨慎如它，陌生人给的东西，它自然是不会吃的. <br/></p>
<p>自我有记忆起，家里就一直有养狗，挥之不去的就是觊觎将狗换成钱财的偷狗贼. <br/></p>
<p>之前偷狗的方式大概是两种，一种是强行虏走, 一般两人作案，一人驾车，一人在后座带有绳套，当狗靠近吠叫时，后座之人将绳索套在狗上，另一人快速驾车逃离, 但如果狗不靠近就难以成行. <br/></p>
<p>另外一种就是投铒，就是把抹有迷药的熟肉投给狗，如果狗不慎吃了就会被带走, 如果狗不吃就自然无法上钩 <br/></p>
<p>随着时代发展，现在出现新的偷狗方式，用类似弓弩射毒针，然后再捡尸体, 即使谨慎如它，也难以幸免. <br/></p>
<p>虽然这已经不知道是我家失去的第几只狗了，但是我还是难忍悲伤. <br/></p>
<p>我才意识到，因为家里的狗总是在身边，父母也不像养宠物那样有给它们起名的习惯，只是以特征代称，它甚至没有名字. <br/></p>
<p>想起之前有人描述悲伤的感觉, 亲朋离去的那一瞬间通常不会使人感到悲伤，而真正会让你感到悲痛的是打开冰箱的那半盒牛奶、 <br/>
那窗台上随风微曳的绿萝、那安静折叠在床上的绒被，还有那深夜里洗衣机传来的阵阵喧哗。 <br/></p>
<p>想来，当我再回到家中，看着敞开的饼干盒，我一定会止不住想起那个在树下和它吃饼干的午后. <br/></p>
<p>谨以此文悼念它吧. <br/></p>
<p><video width="320" height="240" controls><source src="/ox-hugo/my_family_dog1.mp4" type="video/mp4">
Your browser does not support the video tag.</video></p>
<p><video width="320" height="240" controls><source src="/ox-hugo/my_family_dog2.mp4" type="video/mp4">
Your browser does not support the video tag.</video></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>我和「异端邪教」摩门教的交集</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E5%BC%82%E7%AB%AF%E6%91%A9%E9%97%A8%E6%95%99%E7%9A%84%E4%BA%A4%E9%9B%86/</link>
      <pubDate>Sat, 28 Sep 2024 09:52:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E5%BC%82%E7%AB%AF%E6%91%A9%E9%97%A8%E6%95%99%E7%9A%84%E4%BA%A4%E9%9B%86/</guid>
      <description>1 周处除三害 前段时间，看了部很有后劲的好电影，名为《周处除三害》，电影里面不少情节都在脑海余音绕梁，久久不散。 大概情节是通缉犯陈桂林在逃亡藏</description>
      <content:encoded><![CDATA[<h2 id="周处除三害"><span class="section-num">1</span> 周处除三害</h2>
<p>前段时间，看了部很有后劲的好电影，名为《周处除三害》，电影里面不少情节都在脑海余音绕梁，久久不散。 <br/></p>
<p>大概情节是通缉犯陈桂林在逃亡藏匿中失去最后一个亲人，同时得知自己只有不到三个月的生命。 <br/></p>
<p>万念俱灰的他原打算投案自首，可是当发现他在三大通缉犯中仅仅排名第三时，内心突然躁动起来。 <br/></p>
<p>在此之后，他决定仿效古时候周处除三害的故事，临终之际要在江湖上留下他的传奇名号, 于是踏上追杀榜二和榜一大哥的征途。 <br/></p>
<p>榜二大哥是个凶残，狡诈的香港黑帮老大，陈桂林历经艰险，自损八百，身负重伤，才除掉了榜二大哥。 <br/></p>
<p>榜二都这么难处理，观众自然会觉得榜一大哥肯定就是更难的BOSS, 没想到陈桂林在追踪榜一大哥的过程中，误入一间偏僻的教会。 <br/></p>
<p>在这间教会里，陈病情加剧，在教会尊者的开悟下，他放下执念，打算了却余生，没想到病情却因此好转。 <br/></p>
<p>电影画面也越发清新亮丽，预示着即将迎来 Happy ending。 <br/></p>
<p>然而，在机缘巧合之下，陈偶然发现整个教会都是个骗局，为人开悟的尊者竟然是榜一大哥，整个教会都沦为被洗脑的邪教组织。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/loss_everything.jpg"/> 
</figure>
 <br/></p>
<p>于是陈便在教会的圣歌声中，对冥顽不灵的教徒大开杀戒，最后向警方自首。 <br/></p>
<h2 id="缘起"><span class="section-num">2</span> 缘起</h2>
<p>我像往常一样，下午戴着耳机，听着播客，去附近的公园跑步, 我大抵是记不清当时听的是哪个播客了。 <br/></p>
<p>迎面走来两个穿着衬衫，西装裤，打着领带，学生打扮的年轻白人, 向我打招呼。 <br/></p>
<p>我还以为他们是问路，戴着耳机听不清，摘下耳机就再问了一下，然后就交谈了起来。 <br/></p>
<p>他们问我是哪里来的，我觉得有点突兀，但还是答道： <br/></p>
<p>I&rsquo;m orignally from China, 毕竟也没啥好隐瞒的. <br/></p>
<p>他们就开始用略生疏，但流畅的中文和我聊天，我相当惊讶，这两个看起来只有20岁的年轻金发碧眼的白人小哥，还会说中文， <br/>
难免好奇，就走到旁边的椅子坐下，和他们聊了起来。 <br/></p>
<p>反正就当成口语聊天，我是不介意和别人聊天的，然后出现了他们和我说中文，我和他们说英文的奇怪画面。 <br/></p>
<p>可能他们中文不如我英文流利，他们更习惯用英文，后面他们就切换回英文，更顺滑地聊了起来。 <br/></p>
<p>他们介绍自己是传教士(missioner), 1年多前刚刚高中毕业，从美国犹他州来这里是传教的，传教满两年就会回去继续上大学。 <br/></p>
<p>难怪他们这么年经，才高中毕业嘛，这就是美国学生所谓的 gap year，高中毕业之后可以先不去上大学，先玩个1-2年，只是眼前这两位年轻人是用来传教了，难免心生敬意。 <br/></p>
<p>他们还透露，他们未来一个想当科学家，一个想当飞行员，因为飞行员英文(pilot) 和海盗(pirate) 发音非常近，我听到了 pilot 之后愣了一下，然后笑了起来，可能那位说想当飞行员的小哥担心我误会了，还用中文说了飞行员。 <br/></p>
<p>话题后面就回到我好奇的为什么他们会中文的事情上，他们说是因为抽到了来温哥华传教，温哥华华人很多，所以就学了中文。 <br/></p>
<p>看着他们清澈的眼神，想着两年不到的时间，为了传教，就可以把中文学习到能流畅交流的程度，真的是虔诚又好学阿。 <br/></p>
<p>既然他们是传教士，话题自然会绕到宗教上， <br/>
他们就邀请我去周日的洗礼和圣餐去，想来无事，并且对新鲜事物好奇，加之对这两位年轻帅气的白人小哥很有好感，就欣然答应，并交换了手机号码。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/the_sacrament.jpg"/> 
</figure>
 <br/></p>
<h2 id="圣餐"><span class="section-num">3</span> 圣餐</h2>
<p>在周日九点半去到教堂，教堂外面看起来不大，远没有想象上的宏大，坐落在一片民居之中 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/church1.jpg"/> 
</figure>
  <br/></p>
<p>我因为不熟悉，加之在周围逛了下，到的时候已经过了9点半了，给其中一位小哥发消息也没有见到回复，只好进去教堂里面自己四处逛。 <br/></p>
<p>可能是我的目光过于好奇，暴露了我是第一次来的事实，就有个黑人小姐姐过来和我聊起来，问我要去哪个组(group/room)，我也不知道阿。 <br/></p>
<p>只好描述了一下其中一位小哥的特征，黑人小姐姐就把我领到个全是华人的房间，听口音，是台湾人，香港人和大陆同胞都有。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/church2.jpg"/> 
</figure>
 <br/></p>
<p>当时在进行的活动类似是倾诉分享环节，听起来是每个月一次，每个人分享自己的对经文学习或最近生活经历，前后大概有10个教众上台分享了。 <br/></p>
<p>每个分享的结尾都以房间内所有教众的「阿门」结束，台下坐着的我还是没有习惯口称上帝，难免有种「配合你演出的我演视而不见」的感觉 <br/></p>
<p>其中有两位教众分享，说着说着都哽咽起来了，这场面难免让我想起《周处除三害》的画面，我表情肃穆，内心却在笑。 <br/></p>
<p>在一位年轻女教众的钢琴伴奏下，众人齐唱圣歌《愿主差遣》（I’ll Go Where You Want Me to Go），历时一小时的分享结束。 <br/></p>
<p>虽然教众唱的是《愿主差遣》，但是我脑海里面响起的却是《周处除三害》陈桂林教堂屠杀时教众唱的《新造的人》， <br/>
这电影画画真的是刻在我脑子了。 <br/></p>
<p>分享会结束后，部分教众离去，剩下的教众参加接下来的经文学习，我见无事，便继续留下了。 <br/></p>
<p>经文课上，大家拿出来的是《摩尔门经》，慢着，我虽然对基督教不是非常熟悉，但是也知道你们读的是《圣经》，这是啥经，你们这是啥教。 <br/></p>
<p>然后牧师开始讲经文的类似排比句的写作手法，大概是通过反复强调相似的句型，来加深读者的印象并传递宗教教义。 <br/></p>
<p>话虽如此，但是你拿本翻译成中文的经书，讲原版《摩尔门经》的修辞结构，你没意识到有哪里不对劲么？ <br/></p>
<p>万一译者水平不够，或者没有意识到这种词法，没有翻译过来，那中文翻译不就没有这种词法了嘛。 <br/></p>
<p>这看起来太草台班子了，加之《周处除三害》中邪教的影响，我还是走为上着，便借口有约，离开了。 <br/></p>
<h2 id="摩门教"><span class="section-num">4</span> 摩门教</h2>
<p>我本来对宗教不感兴趣，只对人感兴趣。 <br/></p>
<p>回来之后，我去查了维基百科，这个以《摩尔门经》为经书的宗教，名为是摩门教，是个被主流基督教徒认为是「异端邪教」(cult)的教会。 <br/></p>
<p>摩门教(Mormons), 除了相信受普遍基督教和天主教所相信及承认的圣经以外，他们也相信《摩尔门经》是神所启示另外的经文。 <br/></p>
<p>概括来说，摩门教就是个基督教和美洲文明融合，本土化的宗教。 <br/></p>
<p>了解宗教的朋友可能会问，耶稣和基督教不是起源于中东-耶路撒冷嘛，和美洲有什么关系？ <br/></p>
<p>摩门教的先知美国人约瑟·斯密说《摩尔门经》是翻译自金页片，该页片纪录了公元前约600年到公元420年间在古代美洲大陆中一古代文明事迹。 <br/></p>
<p>这位约瑟·斯密说，1820年，他在纽约的树林中，看到天父和耶稣降落，后面还被复活的古代美洲先知摩罗乃拜访，告知其「金页片」的下落。 <br/></p>
<p>约瑟·斯密取出「金页片」，进行了翻译，在翻译完成后，摩罗乃就收回了「金页片」，所以现在已没有了金页片的原件了&hellip; <br/></p>
<p>都19世纪了，还搞先知降临。 <br/></p>
<p>按照他们的教义规定，他们禁止喝酒、抽烟、喝茶、喝咖啡以及婚前性行为，听起来相当保守和原教旨主义嘛. <br/></p>
<p>但是摩门教推崇多重婚姻（一夫多妻制）: <br/>
约瑟·斯密称在他研究旧约圣经时希望得知神为什么容许先知亚伯拉罕，摩西，大卫和所罗门拥有许多妻子， <br/>
而后约瑟·斯密称他得到神的回复说那是因为祂吩咐他们. <br/></p>
<p>因为一夫多妻制，摩门教还被美国法院定义成邪教，即使「宗教自由」和「宪法保护」的辨护都打不动， <br/>
被法院解散了教会的法人组织，指示要把教会所有财产都收归政府所有。 <br/></p>
<p>直到当时的摩门教领袖官方声明禁止多重婚姻，才和政府和解。 <br/></p>
<p>也难怪摩门教会被基督徒认为是「邪教」. <br/></p>
<p><strong><strong>如果有摩门教的教徒看到我这篇文章，对我将摩门教称为「邪教」有所不满, 我只是引用基督徒的主流观点和美国最高法院的判决，有气请往他们撒</strong></strong> <br/></p>
<h3 id="伏笔回收"><span class="section-num">4.1</span> 伏笔回收</h3>
<p>摩门教的大本营就是美国犹他州，前面的两个年轻传教士就是犹他州来的。 <br/></p>
<p>当初摩门教在美国被认为是「邪教」，所以传教士们便到欧洲传教. <br/></p>
<p>结果，在欧洲的传教士们成功地吸引了大批大批的新信徒，这些人里有很多都跟随者传教士们，漂洋过海地来到了美国，迅速壮大着摩门教的队伍。 <br/></p>
<p>于是，摩门教便形成了一个传统：大多数美国的摩门教信徒都会学习一门外语，去其他国家传教两年，而且这样的异国传教，大多都是自费的 <br/></p>
<p>这下好了，都对应上了，世界线都回收了。 <br/></p>
<h2 id="后续"><span class="section-num">5</span> 后续</h2>
<p>了解摩门教之后，我对其就完全失去兴趣了。 <br/></p>
<p>从某种角度来说，这个教会和当初洪秀全在太平天国建立的「拜上帝教」并没有什么本质的差别，都是基督教本土化后的产物，新瓶装旧酒。 <br/></p>
<p>只是没有想到，这位传教士就这么纠缠上我了，前面提到我和他交换了手机，接下来一个月的时间，不停给我发消息，打电话，真的是缠上了: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/missinor_message.jpg"/> 
</figure>
  <br/></p>
<p>还好他不知道我的更多信息，如果他知道我的住址，估计要上门来敲门了。 <br/></p>
<p>感谢陈桂林，敲起了我对邪教的警钟。 <br/></p>
<p>一首《新造的人》, 继续给大家敲钟. <br/></p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/KBmNvThjE9Q" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

]]></content:encoded>
    </item>
    
    <item>
      <title>使用Rust的Iterator优雅解决FizzBuzz问题</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E4%BD%BF%E7%94%A8rust%E7%9A%84iterator%E8%A7%A3%E5%86%B3fizzbuzz%E9%97%AE%E9%A2%98/</link>
      <pubDate>Wed, 18 Sep 2024 22:46:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E4%BD%BF%E7%94%A8rust%E7%9A%84iterator%E8%A7%A3%E5%86%B3fizzbuzz%E9%97%AE%E9%A2%98/</guid>
      <description>1 前言 按照维基百科的说法，FizzBuzz问题 是一个简单但是常见的面试编程问题（可能以前常见，现在都是考Leetcode了,这种连Easy 都</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<p>按照维基百科的说法，<a href="https://en.wikipedia.org/wiki/Fizz_buzz">FizzBuzz问题</a> 是一个简单但是常见的面试编程问题（可能以前常见，现在都是考Leetcode了,这种连Easy 都不算了），这个问题的要求如下： <br/></p>
<ol>
<li>写一个程序，输出从1到100的数字 <br/></li>
<li>对于3的倍数，不输出数字，而是输出 &ldquo;Fizz&rdquo; <br/></li>
<li>对于5的倍数，不输出数字，而是输出 &ldquo;Buzz&rdquo; <br/></li>
<li>对于即是3的倍数又是5的倍数的数字（即15的倍数），打印 &ldquo;FizzBuzz&rdquo; <br/></li>
</ol>
<h2 id="常规解法"><span class="section-num">2</span> 常规解法</h2>
<p>问题非常简单，刚学编程的学生都可以写出符合要求的代码，下面是 Rust 的常规解法： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;FizzBuzz&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Fizz&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Buzz&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{i}&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>这个没有什么太多可说的，就是直接按需求翻译代码了。 <br/></p>
<h2 id="iterator-解法"><span class="section-num">3</span> Iterator 解法</h2>
<p>如果现在给 FizzBuzz 问题再加一个限制，不能使用乘法，除法，或者取模操作，那么又要怎么实现呢？ <br/></p>
<p>Rust 标准库中的各式 <code>Iterator</code> 可以算是Rust零开销抽象(Zero Cost Abstraction)与表达能力的最佳体现了。 <br/></p>
<p>最近在读 Programming Rust, 2nd edition, 里面就有使用各种 Iterator 组合，不使用除法或者取模操作来解决 FizzBuzz 问题的实现, 可以说是把 <code>iterator</code> 玩得非常花了： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="p">{</span><span class="n">once</span><span class="p">,</span><span class="w"> </span><span class="n">repeat</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fizzes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repeat</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">).</span><span class="n">take</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">chain</span><span class="p">(</span><span class="n">once</span><span class="p">(</span><span class="s">&#34;fizz&#34;</span><span class="p">)).</span><span class="n">cycle</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">buzzes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">repeat</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">).</span><span class="n">take</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">chain</span><span class="p">(</span><span class="n">once</span><span class="p">(</span><span class="s">&#34;buzz&#34;</span><span class="p">)).</span><span class="n">cycle</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fizzes_buzzes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fizzes</span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">buzzes</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">fizz_buzz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="p">).</span><span class="n">zip</span><span class="p">(</span><span class="n">fizzes_buzzes</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">tuple</span><span class="o">|</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">fizz</span><span class="p">,</span><span class="w"> </span><span class="n">buzz</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;{}{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fizz</span><span class="p">,</span><span class="w"> </span><span class="n">buzz</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">});</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fizz_buzz</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{line}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>看起来是否不知道所云呢? 现在可以把每个 <code>iterator</code> 的作用逐一拆解。 <br/></p>
<h3 id="repeat-plus-take"><span class="section-num">3.1</span> repeat + take</h3>
<p><code>repeat</code> 的作用就是无限重复某个传入的元素, 例如 <code>repeat(4)</code> 就是生成无限个数字4, <code>repeat(&quot;&quot;)</code> 就是生成无限个空白字符. <br/></p>
<p>虽然 <code>repeat</code> 能生成无限个指定的元素，但是我只想要若干个元素，怎么整呢？ <code>take</code> 就可以满足这个要求，所以 <code>repeat(4).take(4)</code> 就是生成4个数字4的意思，而 <code>repeat(&quot;&quot;).take(2)</code> 就是生成2个空字符 <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// that last example was too many fours. Let&#39;s only have four fours.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">four_fours</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter</span>::<span class="n">repeat</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">four_fours</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">four_fours</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">four_fours</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="n">four_fours</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// ... and now we&#39;re done
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">four_fours</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></div><h3 id="once"><span class="section-num">3.2</span> once</h3>
<p>有生成无限个元素的 <code>iterator</code>, 自然就有只生成一个元素的 <code>iterator</code>, 那就是 <code>once()</code>, 这个 <code>iterator</code> 只会返回一个指定的元素。 <br/></p>
<p>所以 <code>once(&quot;fizz&quot;)</code> 就是创建一个只会返回一个 <code>&quot;fizz&quot;</code> 的 <code>iterator</code> : <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// one is the loneliest number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter</span>::<span class="n">once</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">one</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// just one, that&#39;s all we get
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">.</span><span class="n">next</span><span class="p">());</span><span class="w">
</span></span></span></code></pre></div><h3 id="chain"><span class="section-num">3.3</span> chain</h3>
<p>顾名思义，就是把两个 iterator 像链子一样串起来, 合并成一个 iterator: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">chain</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h3 id="circle"><span class="section-num">3.4</span> circle</h3>
<p><code>circle</code> 就比较有趣了，它的作用是无限循环一个 <code>iterator</code>, <code>repeat</code> 循环一个元素，而 <code>circle</code> 是循环一个 iterator: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">dirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#34;North&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;East&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;South&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;West&#34;</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">spin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dirs</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">cycle</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;North&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;East&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;South&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;West&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;North&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">spin</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="s">&#34;East&#34;</span><span class="p">));</span><span class="w">
</span></span></span></code></pre></div><p>把4个 iterator 组合起来的 <code>repeat(&quot;&quot;).take(2).chain(once(&quot;fizz&quot;)).cycle();</code> 表达式的意思就是: 返回一个 iterator, 这个 iterator 无限循环: <code>&quot;&quot; &quot;&quot; &quot;fizz&quot; &quot;&quot; &quot;&quot; &quot;fizz&quot; ...</code> <br/></p>
<h3 id="zip"><span class="section-num">3.5</span> zip</h3>
<p><code>zip</code> iterator 的含义就是 &ldquo;zips up&rdquo;, 翻译过来就是拉上拉链，它的作用就是把两个 <code>iterator</code> 像拉链一样拉起来，返回一个 iterator，用代码来解释会更直观: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="kd">let</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">zip</span><span class="p">(</span><span class="n">a2</span><span class="p">.</span><span class="n">iter</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">4</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">5</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="mi">6</span><span class="p">)));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p><code>zip</code> 就是把 <code>a1</code> 和 <code>a2</code> 两个iterator 「拉起来」了，每次返回一对的元素. 所以 <code>fizzes.zip(buzzes)</code> ，就是合并了两个 iterator : <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// fizzes: &#34;&#34; &#34;&#34; &#34;fizz&#34; &#34;&#34; &#34;&#34; &#34;fizz&#34; &#34;&#34; &#34;&#34; &#34;fizz&#34; ..
</span></span></span><span class="line"><span class="cl"><span class="c1">// buzzes: &#34;&#34; &#34;&#34; &#34;&#34; &#34;&#34; &#34;buzz&#34; &#34;&#34; &#34;&#34; &#34;&#34; &#34;&#34; &#34;buzz&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">// fizzes_buzzes: (&#34;&#34; &#34;&#34;) (&#34;&#34; &#34;&#34;) (&#34;fizz&#34; &#34;&#34;) (&#34;&#34; &#34;&#34;) (&#34;&#34; &#34;buzz&#34;) ...
</span></span></span></code></pre></div><p>而 <code>(1..=100).zip(fizzes_buzzes)</code> 就是创建一个包含三个元素的 tuple： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// (1..=100): 1 2 3 4 5 6 7 ...
</span></span></span><span class="line"><span class="cl"><span class="c1">// fizzes_buzzes: (&#34;&#34; &#34;&#34;) (&#34;&#34; &#34;&#34;) (&#34;fizz&#34; &#34;&#34;) (&#34;&#34; &#34;&#34;) (&#34;&#34; &#34;buzz&#34;) ...
</span></span></span><span class="line"><span class="cl"><span class="c1">// (1..=100).zip(fizzes_buzzes): (1 (&#34;&#34; &#34;&#34;)) (2 (&#34;&#34; &#34;&#34;)) (3 (&#34;fizz&#34; &#34;&#34;)) (4 (&#34;&#34; &#34;&#34;)) (5 (&#34;&#34; &#34;buzz&#34;)) ..
</span></span></span></code></pre></div><h3 id="map"><span class="section-num">3.6</span> map</h3>
<p><code>map</code> 这个 iterator 在其他语言也有相同的实现，入参是一个闭包函数，然后把每个元素作为入参，调用闭包函数，在新的迭代返回函数的调用结果. <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">tuple</span><span class="o">|</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">fizz</span><span class="p">,</span><span class="w"> </span><span class="n">buzz</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&#34;{}{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">fizz</span><span class="p">,</span><span class="w"> </span><span class="n">buzz</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">})</span><span class="w">
</span></span></span></code></pre></div><p>最核心的是Rust的 pattern matching, 用来匹配不同的值, <code>(i, (&quot;&quot;, &quot;&quot;))</code> 就是匹配所有 fizz 和 buzz为 <code>(&quot;&quot;, &quot;&quot;)</code> 的值，什么情况下 <code>fizz</code> 和 <code>buzz</code> 会都为 &quot;&quot; 呢，无法整除3以及无法整除5的时候，那么就直接返回数字 <code>i</code>; <br/></p>
<p><code>(_, (fizz,buzz))</code>, <code>_</code> 就是通配符，就是匹配掉所有其他的情况，无论是 fizz = &ldquo;&rdquo;, fizz = &ldquo;fizz&rdquo;, buzz = &quot;&quot; 或者 buzz = &ldquo;buzz&rdquo;, 都把返回 <code>&quot;{fizz}{buzz}&quot;</code>, 也就是 <code>(_, (fizz,buzz))</code> 匹配了4种情况. <br/></p>
<p><code>map</code> 迭代器返回的是一个 String, 最后再加 String 打印出来. <br/></p>
<p>同样是解决问题，这个版本的解法肯定是看起来「高大上」得多，说不定能让面试官眼前一亮，又或者是把自己绕晕。 <br/></p>
<h2 id="zero-cost-abstraction"><span class="section-num">4</span> Zero Cost Abstraction</h2>
<p>所谓的是零开销抽象（Zero Cost Abstraction），用C++之父的话来解释就是: <br/></p>
<blockquote>
<p>In general, C++ implementations obey the zero-overhead principle: What you don’t use, you don’t pay for. And further: What you do use, you couldn’t hand code any better. <br/></p>
</blockquote>
<p>概括来说，就是使用 Iterator 写出来的代码，和你自己 for-loop 手写是性能是一样的，并不会有额外的抽象开销。 <br/></p>
<p>换个角度讲，你手写的代码也没法实现得比 Iterator 更快，表达力还可能没有那么强。 <br/></p>
<p>如果看上面的 Iterator 实现觉得着实难以理解，我们可以再来一版兼具优雅与简洁的实现： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;FizzBuzz&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Fizz&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Buzz&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="reference"><span class="section-num">5</span> Reference</h2>
<ul>
<li>Programming Rust, 2nd edition <br/></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>Rust模拟C&#43;&#43;的函数重载</title>
      <link>https://ramsayleung.github.io/zh/post/2024/rust%E6%A8%A1%E6%8B%9Fc&#43;&#43;%E7%9A%84%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/</link>
      <pubDate>Fri, 30 Aug 2024 22:23:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/rust%E6%A8%A1%E6%8B%9Fc&#43;&#43;%E7%9A%84%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD/</guid>
      <description>1 函数重载(function overloading) 所谓的函数重载，指的是某些语言支持创建函数名相同，但函数签名不同的多个函数，所谓的函数签名，既指参数类型，也指</description>
      <content:encoded><![CDATA[<h2 id="函数重载--function-overloading"><span class="section-num">1</span> 函数重载(function overloading)</h2>
<p>所谓的函数重载，指的是某些语言支持创建函数名相同，但函数签名不同的多个函数，所谓的函数签名，既指参数类型，也指参数的数量。 <br/></p>
<p>如C++，Java都是支持函数重载的，而Rust是不支持函数重载的, 个人猜测可能是Rust最初的设计者认为函数重载可能会导致增加代码理解难度，尤其是在C++里面，隐式类型转换叠加函数重载，可能看代码都看不出实际调用的是哪个版本的函数。 <br/></p>
<h2 id="rust版本的函数重载"><span class="section-num">2</span> Rust版本的函数重载</h2>
<p>但是我个人觉得函数重载在大部分情况下都是很方便，也不需要为相同的函数想不同的名字，毕竟命名是编程最难的问题之一。 <br/>
今天重读 Programming Rust, 2nd Edition关于 <code>Into</code> 这个trait 的功能的时候，突然意识到，可以使用 <code>Into</code> 模拟出部分的函数重载功能。 <br/></p>
<p>为什么说是「部分」呢，因为前文提到，所谓的函数重载是指多个同名但函数签名不一样的函数，而Rust能模拟的就是参数类型不一样，但是参数数量一致的重载函数。 <br/></p>
<p>假设我们想实现自己的 <code>ping</code> 命名, 入参可以是 <a href="https://doc.rust-lang.org/std/net/struct.Ipv4Addr.html"><code>Ipv4Addr</code></a> 这个 struct, ipv4的地址也可以使用2进制来表示, 又或者可以使用 u32 来表示，毕竟只有32位。 <br/></p>
<p>如果用 C++, 我们可以写3个重载函数，入参分别是, <code>Ipv4Addr</code>, <code>bitset</code> 和 <code>uint32</code>. 在 Rust, 我们也实现类似的函数： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">net</span>::<span class="n">Ipv4Addr</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">ping</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">(</span><span class="n">address</span>: <span class="nc">A</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">std</span>::<span class="n">io</span>::<span class="nb">Result</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">A</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="n">Ipv4Addr</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ipv4_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="p">.</span><span class="n">into</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>需要注意的是，上面函数的入参并不是 <code>Ipv4Addr</code>, 而是 <code>Into&lt;Ipv4Addr&gt;</code> ，这就是意味着，所有实现了 <code>Into&lt;Ipv4Addr&gt;</code> 这个 trait 的类型都可以是 <code>ping</code> 的入参，而恰好 <code>u32</code> 和 <code>[u8; 4]</code> 都实现了 <code>Into&lt;Ipv4Addr&gt;</code> ，所以下面的调用都是编译通过的： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{:?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ping</span><span class="p">(</span><span class="n">Ipv4Addr</span>::<span class="n">new</span><span class="p">(</span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="mi">141</span><span class="p">)));</span><span class="w"> </span><span class="c1">// pass an Ipv4Addr
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{:?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ping</span><span class="p">([</span><span class="mi">66</span><span class="p">,</span><span class="w"> </span><span class="mi">146</span><span class="p">,</span><span class="w"> </span><span class="mi">219</span><span class="p">,</span><span class="w"> </span><span class="mi">98</span><span class="p">]));</span><span class="w">             </span><span class="c1">// pass a [u8; 4]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;{:?}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">ping</span><span class="p">(</span><span class="mh">0xd076eb94_</span><span class="k">u32</span><span class="p">));</span><span class="w">                 </span><span class="c1">// pass a u32
</span></span></span></code></pre></div><p>当然，如果你实现了 <code>impl From&lt;u32&gt; for Ipv4Addr</code>, Rust 编译器也会贴心地帮你把反向的 <code>Into&lt;Ipv4Addr&gt;</code> 也实现掉。 <br/></p>
<h2 id="限制"><span class="section-num">3</span> 限制</h2>
<p>看完上面的函数实现，有经验的朋友可能就会发现了，Rust版本的函数重载限制比C++的要多。 <br/></p>
<p>在C++版本的函数重载中： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">func1</span><span class="p">(</span><span class="n">Type1</span> <span class="n">foo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">func1</span><span class="p">(</span><span class="n">Type2</span> <span class="n">bar</span><span class="p">);</span>
</span></span></code></pre></div><p>参数类型 <code>Type1</code> 和 <code>Type2</code> 并不需要存在任何关系，但是在 Rust 版本中，需要两个类型之间支持相互转换，所以可以理解成 Rust 的「函数重载」本质就是通过显示类型转换来实现的。 <br/></p>
<p>毕竟 Rust 设计初衷之一就是支持强类型，就函数重载而言，终归聊胜于无啦。 <br/></p>
<h2 id="参考"><span class="section-num">4</span> 参考</h2>
<ul>
<li><a href="https://www.oreilly.com/library/view/programming-rust-2nd/9781492052586/">Programming Rust, 2nd Edition</a> <br/></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>《走出戈壁》：从沙漠苦力到常青藤教授</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E8%B5%B0%E5%87%BA%E6%88%88%E5%A3%81/</link>
      <pubDate>Sun, 25 Aug 2024 11:24:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E8%B5%B0%E5%87%BA%E6%88%88%E5%A3%81/</guid>
      <description>1 前言 六月份的时候，读到了一篇名为《运气与努力》1的文章，是由 LeanCloud的创始人江宏博士写的，文章以一本书开篇，引出他关于运气与努力</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<p>六月份的时候，读到了一篇名为《<a href="https://1byte.io/articles/luck/">运气与努力</a>》<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>的文章，是由 LeanCloud的创始人江宏博士写的，文章以一本书开篇，引出他关于运气与努力的思考:(文章写得相当真诚，充满洞见，也推荐大家阅读下) <br/></p>
<blockquote>
<p>很多人意识不到运气的重要性，而错把成功归功于自己的才能和努力， <br/>
却没有意识到好运在其中的重要性。忽视了这一点就难以保持谦虚，难以不断学习。 <br/></p>
<p>明白了运气的重要性，就知道不是人人生而能得到平等的机会的， <br/>
在遇到处境不如自己的人，不能假设这种差别是聪明或努力程度的不同造成的，应该知道善待弱者。 <br/></p>
</blockquote>
<p>而文章开篇提到的书名为(Out of the Gobi: My story of China and America)《走出戈壁：我的中美故事》, 作者单伟建在读完小学之后，就被文革的知青下乡运动感召，「自愿」下放到内蒙古生产建设兵团做了六年的苦力。 <br/></p>
<p>文革后，没拿到小学毕业证的他进入了首都经济贸易大学，之后在旧金山大学获得了 MBA， <br/>
在 UC Berkeley 取得博士学位，后来在 University of Pennsylvania 任教。 <br/></p>
<p>现在他是亚洲最大的私募基金之一 PAG Group 的主席和 CEO，而他当时在UC Berkeley的导师，现在也成为了美国财政部的部长，即Janet Yellen (珍妮特·耶伦), 她为本书作了序。 <br/></p>
<p>对于这样传奇的人生经历，我自然也是希望一读究竟。 <br/></p>
<h2 id="不以物喜-不以已悲"><span class="section-num">2</span> 不以物喜，不以已悲</h2>
<p>不少自传或者回亿类的书籍看起来，难免会有一种自吹自擂的感觉，这也是人之常情。 <br/></p>
<p>只是在本书的作者却是用一种云淡风轻，略带些幽默的口吻来描写在戈壁滩的艰苦生活，以至于那样痛苦的生活， <br/>
在作者笔下，都显得不那么痛苦了。 <br/></p>
<p>可能正如同样被下放到戈壁滩的民航机长老易教诲作者那般，“前面的路还很长，所有快乐的事情都会结束，所有的悲伤也是如此” <br/></p>
<p>书中有很多动人的经历，我印象比较深的是以下的几个故事： <br/></p>
<h2 id="戈壁生活"><span class="section-num">3</span> 戈壁生活</h2>
<h3 id="理想与现实"><span class="section-num">3.1</span> 理想与现实</h3>
<p>知识青年下乡，响应号召，接受贫下中农再教育；参加建设兵团，为国戌边，建设国家。 <br/></p>
<p>这个是他们离家时的理想与目标，但实际的情况却与他们幻想得天差地别； <br/></p>
<p>一群年轻人秋天去国营农场里收土豆，挖了无数的土豆，但是却没有人来运土豆，他们也只能眼睁睁地看着被挖出来的土豆被冻烂， <br/>
不停地收获土豆，却又不停地看着收获好的土豆被冻烂在地里，循环往复，直到不再有挖土豆的念头。 <br/></p>
<p>兵团领导人希望可以把戈壁变成沃野，思路就是通过挖掘人工运河，把河里的水引到戈壁进行灌溉， <br/>
甚至有一天，作者他们被告知必须连夜赶工完成运河，以赶上最后限期，在完成之前，他们不能离开。 <br/></p>
<p>就这样，这群年轻人连续在运河上工作了31个小时，终于完成了人工运河的建设。 <br/></p>
<p>一周后，他们被告知，运河的路线被误算了，他们建造的那部分太高了，水无法流过，那部分必须被放弃，另建一条新路线。 <br/></p>
<p>军队建议兵团对改善贫困农村没有任何帮忙，事实上，他们只是让事情变成更糟糕，他们每天消耗的粮食是生产的三到四倍， <br/>
他们工作越努力，浪费的资源就越多。 <br/></p>
<p>兵团只是想给他们找些事情做，不让他们闲下来。 <br/></p>
<h3 id="努力-智慧与运气"><span class="section-num">3.2</span> 努力，智慧与运气</h3>
<p>在这样的折腾下，六年时间，难免会让把人的志气给磨没，变得随大流，磨洋工。 <br/></p>
<p>农场上大多数人都不去田里工作，但他还在每天工作， 作者的心态是「干什么事都要干好，否则闲着也是浪费时间，而且争强好胜，虽然身体瘦弱，但不甘人后，如此而已。」 <br/></p>
<p>作者抓住一切能学习的机会，阅读能读到的各种书籍，向同样被流放的前民航机长学习英语，背诵药品的英文名字， <br/>
希望有一天能重新回到城市，能回到大学校园。 <br/></p>
<p>1971年，大学逐渐恢复了上课，但是那时的入学资格却不是考试，而是「群众推荐」制度，即由同龄人选举产生。 <br/></p>
<p>而作者不但没有被推举上，反而因为谈及外语，巴黎纽约这些外国城市，反而被人举报，渴望「资本主义生活方式」，并被众人被声讨。 <br/></p>
<p>这不仅让作者失去了被推举上大学的机会，还留下了个坏名声，但是作者并没有沉沦，他反而反思自己为何会成为众矢之的。 <br/></p>
<p>他分析下来是自己太与众不同，别人下棋他看书，他不屑于追求这些无用的东西，但人终究是群体性动物，太与众不同只会被人疏远。 <br/></p>
<p>所以他决定要融入这个集体，获得大家的好感，而不是作为一个孤僻的书呆子。 <br/></p>
<p>在观察到大家都喜欢篮球和排球运动，但却缺乏熟悉排球规则的裁判时， <br/></p>
<p>他让父亲寄书过来学着当排球裁判，让更多其他连的人认识他，让自己变成不可或缺，同时更加努力地工作，赢得众人的尊重。 <br/>
（能站在旁观者角度冷静分析问题，并利用现有条件进行解决，真的是充满智慧又难能可贵） <br/></p>
<p>终于，在第二年的入学资格「群众推荐」中，他得票第二，但是却因为与连队领导关系不佳， <br/>
他被以「年纪太轻（21岁），不能上大学」为由，把他从名单中删除。 <br/></p>
<p>得知消息的那一天晚上，作者深一脚浅一脚地走出营房，来到空旷的地方，边走边流泪，当再也不会没有人听到他的声音后， <br/>
他放眼大哭，在黑暗中撕心裂肺地喊叫，在沮丧和悲伤中喊得声嘶力竭。 <br/></p>
<p>那天晚上后，作者收拾心情，告诫自己生活必须继续，总会有未来的。 <br/>
他发誓不会让自己失望，他已经经历这么多了，但他绝对不会在绝望中迷失自我，放弃就是对自己犯下罪行。 <br/></p>
<p>如果大环境一直很糟糕，自己要在戈壁待一辈子而没有出头之日，他没有谁可怨； <br/>
但是如果将来发生变化，因为自己没有准备好而失去了改变命运的机会，他只能怪自己。 <br/></p>
<p>所以他在逆境中也一直在为将来准备。 <br/></p>
<p>终于，在第三年，在11人竞选9个名额的竞争中，作者作为最后一名修补人选， <br/>
在名单中的两名正式候选人先后被除名后，递补入选，获得了首都经济贸易大学的入学资格. <br/></p>
<h2 id="自助者天助之"><span class="section-num">4</span> 自助者天助之</h2>
<p>作者在毕业后成为首经贸的教师，后来得到亚洲基金会赞助前往旧金山大学一年的访学机会。 <br/></p>
<p>到校后，在与教授们交流后，他决定攻读该校的MBA 课程并争取拿到学位，但苦于没有学费，他决定先抓住机会学习知识，知识先于学历，再看能否找机会凑到学费。 <br/></p>
<p>第一学期各门课程优异，但是学费还是没有着落，在各种方法尝试未果后将要放弃时， <br/>
他的导师给他带来了一个好消息：一个匿名人士愿意资助他的学费，于是他得而注册并开始MBA课程。 <br/></p>
<p>待他学业小有所成时，他导师告知他，那位匿名赞助人希望与他在某个高档餐厅共进晚餐，相见一面。 <br/></p>
<p>当导师夫妇身着正装出现在餐厅时，他才猛然意识到，他们原来就是自己的资助人，他的感激之情，无以言表。 <br/></p>
<p>如果不是作者在学习过程所表现出来的专注，付出与努力，相信也没有那么容易可以打动到导师，这也许是所谓的「自助者天助之」吧。 <br/></p>
<p>多年之后，待他事业有所成时，他以导师与自己名字，联名捐赠了一个奖学金，以帮助更多学子追求梦想。 <br/></p>
<h2 id="洞察规则的智慧"><span class="section-num">5</span> 洞察规则的智慧</h2>
<p>在旧金山大学获得MBA 课程硕士需要2年时间，在学费问题得而解决之后， <br/>
作者面临的问题就是访学项目只是一年，要获得学位，他就需要亚洲基金会批准延长他的项目，并且获得首都经济贸易大学的批准。 <br/></p>
<p>也就是攻读硕士学位不在项目原有计划之内，他当时已经是首都经济贸易大学的教师，再延期一年属于「节外生枝」。 <br/></p>
<p>基金会领导安迪表示他要给经贸学院的领导写一封信，征求北京的意见。 <br/></p>
<p>作者表示，你不能这么写，安迪问为什么。 <br/></p>
<p>作者回答到，如果你征求北京方面的意见，他们就要研究是否批准。 <br/></p>
<p>只有两个可能——批准或者不予批准。批准了当然好，但是如果不予批准，我怎么办？ <br/></p>
<p>安迪问作者还有更好的办法吗？ <br/></p>
<p>作者表示，你就给北京发个贺电，说我学习成绩优异，校方决定给我奖学金，只需延期一个学期，就可以获得硕士学位， <br/>
对于这样的成绩，亚基会向外贸学院表示祝贺，其他的都不必说。 <br/></p>
<p>安迪写了一封信，信中对作者大加赞扬，但小心地将大部分奉承留给了经贸学院。 <br/></p>
<p>两周后，学院回复，只有四个字——‘非常感谢’。 <br/></p>
<p>作者心花怒放。 <br/></p>
<p>读到此处，真的为作者深谙体制的规则和处理事情的智慧所折服。 <br/></p>
<p>正如他所料，谁能拒绝别人的道贺呢？ <br/></p>
<p>更何况是来自曾经的敌人，美帝国主义的夸奖，这足以让学院领导扬眉吐气。 <br/></p>
<h2 id="总结"><span class="section-num">6</span> 总结</h2>
<p>在单伟建回到母校旧金山大学<a href="https://www.youtube.com/watch?v=R0Niw73cyIo&amp;t=4304s">演讲</a>时<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>，当循例被主持人问到能给学生们什么建议时，他说在任何领域，成功的三个重要要素是： <br/></p>
<ol>
<li>终身学习；如果他在戈壁没有坚持学习，那么他不可能在失学十年后，在中国重新开放时，能抓住来之不易的机会，自然就没有后来的一切 <br/></li>
<li>好的判断力；好的判断比毅力更加重要，做正确的事情远比正确地做事重要，方向对了，努力才有意义。而没有人生来就有好的判断力，这个就源于经验，知识，就需要不断地学习才能获取到，又呼应上「终身学习」了 <br/></li>
<li>运气；正如单伟建的观点与罗翔老师的类似，「运气并非成就，是命运之手把我托举到所不配有的高度，让人飘然，让人晕眩，最终，让人诚惶诚恐」，意识到运气的重要，才能让人谦卑。 <br/></li>
</ol>
<p>对于终身学习这条建议，我自已也有些许浅薄体会，一年半前，我写了一篇文章: <a href="https://ramsayleung.github.io/zh/post/2023/rspotify_%E4%B8%80%E4%B8%AA%E7%94%A8%E7%88%B1%E5%8F%91%E7%94%B5%E4%BA%94%E5%B9%B4%E7%9A%84%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">《RSpotify: 一个用爱发电五年的开源项目》</a>, 分享自己学习了六年Rust，并且维护一个开源项目的经历。 <br/></p>
<p>在我大学的最后一年，我选择了学习Rust这个新兴的编程语言，距离当时它发布1.0稳定版本也仅仅过了2年， <br/>
我既不觉得我未来的工作会因此受益，也不会获取什么额外的报酬，毕竟这东西太小众了，国内也不会有公司会用，大厂不是用Java就是用C++。 <br/></p>
<p>我只是觉得好玩，再兼之大四没有课，总要学点新东西。 <br/>
就这样，一学就是六七年，维护这个用Rust的开源项目也五年了，除了不时的Github Issue, 也没有其他的收益。 <br/></p>
<p>在今年七月，我又被换到了一个新的组，创下了一个个人职业新纪录，在一年三个月内，待了4个组。 <br/></p>
<p>新组还是在AWS S3, 而新组领导对Rust相当狂热，因为Rust的特点几乎完美契合S3的要求， <br/>
媲美C的高性能，内存安全，强类型，高并发，所以大老板非常想要在新服务使用Rust, 美中不足的就是Rust学习曲线陡峭，懂Rust的人不多。 <br/></p>
<p>而我刚好就是懂Rust又会Java的那个，毕竟都学这么久了，就这样我无缝对接到新组，在新的核心服务上开始写Rust，达成了通过写Rust养活自己的成就。 <br/></p>
<p>像单伟建那样，在戈壁那样艰苦的环境坚持学习，在困境中保持乐观，在苦厄中坚持成长 <br/>
，穷且益坚，实现从小学文凭苦力到常青藤教授的成就，绝大部分人自然难以望其项背。 <br/></p>
<p>但是，如果把终身学习理解成投资的定投，只需要持续学习，无论每天，每周或者每月学多么微小的知识，在时间的复利作用下， <br/>
终有一天，都会有带来质的提升。 <br/></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://1byte.io/articles/luck/">https://1byte.io/articles/luck/</a>  <br/>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.youtube.com/watch?v=R0Niw73cyIo&amp;t=4304s">https://www.youtube.com/watch?v=R0Niw73cyIo&amp;t=4304s</a>  <br/>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>夏日捕蟹记</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E5%A4%8F%E6%97%A5%E6%8D%95%E8%9F%B9%E8%AE%B0/</link>
      <pubDate>Thu, 18 Jul 2024 20:34:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E5%A4%8F%E6%97%A5%E6%8D%95%E8%9F%B9%E8%AE%B0/</guid>
      <description>1 前言 在2023年经历了冬天各种漫长风雪雨雾后， 终于明白为什么加拿大本地人在夏天全都跑到户外玩了，因为夏天不玩，冬天来了就只能待在室内看雨看</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<p>在2023年经历了冬天各种漫长风雪雨雾后， <br/>
终于明白为什么加拿大本地人在夏天全都跑到户外玩了，因为夏天不玩，冬天来了就只能待在室内看雨看雪了。 <br/></p>
<p>六月过后，夏天终于来了。 <br/></p>
<h2 id="抓螃蟹"><span class="section-num">2</span> 抓螃蟹</h2>
<p>周末闲来无事待在家中看视频，朋友分享了他和家人合家去海边抓螃蟹的照片，说螃蟹很好抓，看到螃蟹图片我都惊呆了，怎么个头这么大。 <br/></p>
<p>他说明天还去玩，并约我同行，反正周末没事，同去同去。 <br/></p>
<p>去捕螃蟹的地方驱车大概需要20分钟，叫 Boundary Bay Regional Park，翻译过来叫边境海湾区域公园，因为就在美加边境，再向南几公里就是美国了。 <br/></p>
<p>所以我都和朋友开玩笑说，可能我们捕的是美国游过来的蟹，或者我们向南游几公里，就到美国了。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/boundary_bay_regional_park.jpg"/> 
</figure>
 <br/></p>
<p>我们去到的时候是中午，海滩还是退潮的，从岸边走到大海边还需要步行十多分钟，大概有一公里的路程: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/boundary_bay_regional_park2.jpg"/> 
</figure>
 <br/></p>
<p>光着脚，向海滩深处走去，能看到远处的雪山和海岸，退潮之后形成的水滩在太阳的照耀下也不会冷冰刺骨，脚踩下去，非常凉爽，暑意全消。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/boundary_bay_regional_park3.jpg"/> 
</figure>
 <br/></p>
<p>我和舍友因为是初次捕蟹，只带了一个水桶和一把小尺子。 <br/></p>
<p>水桶自然是为了装战利品，而带尺子的原因是因为加拿大这边有规定，只有大于16.5CM的公蟹才能带走， <br/>
所以来捕蟹的人基本都会带上尺子来量下尺寸是否够大。 <br/></p>
<p>看到朋友才发现我们的装备实在简陋，除了必备的桶和尺子之外， <br/>
朋友还穿上渔民专用的水裤，因为他说虽然气温能到30多度，但是海水大概只有10来度，非常冷冰，不穿水裤顶不住。 <br/></p>
<p>更有趣的是，朋友还带了多支羽毛球拍，说是拨海草捕蟹的神器，见我们两人两手空空，朋友便各分了我们一支球拍。 <br/></p>
<p>没想到，还没有走到海滩深处，就看到了一只大螃蟹在浅水滩中晒太阳，我兴奋地过去把它抓起来，可以说不费吹灰之力： <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/dungeness_crab1.jpg"/> 
</figure>
  <br/></p>
<p>只是朋友拿他的尺子过来了量了下，说不够16.5cm, 没法带走，不过我们可以把它带到大海深处再放回去. <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_with_ruler.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_in_bucket.jpg"/> 
</figure>
 <br/></p>
<p>来到大海深处，发现长满海草，朋友说蟹就藏在海草下面, 可以用羽毛球拍拨开海草来找蟹，原来羽毛球拍是这么用的。 <br/></p>
<p>在海草丛中摸索不一会就又抓到一只蟹了，非常兴奋地又拍起照来，只是把尺子拿过来量下，又不够大，原来能抓到的都是个头不够大的。 <br/></p>
<p>就这样扒拉了半个小时，不停地抓到蟹，拍照，又放回去。 <br/></p>
<p>期间还遇到了一只水母，原来水母真的是透明的，在阳光的照耀下非常漂亮，只是我不敢碰它，担心它蛰我。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/jellyfish.jpg"/> 
</figure>
 <br/></p>
<p>就这样不停地在海草丛中来回走到，突然感觉脚下踩到了什么东西，脚感和踩在沙子完全不一样，有种厚实感。 <br/>
用球拍拨开海草，定睛一看，原来是只藏在沙里的大螃蟹，赶紧招呼舍友一起过来挖，挖出来一看，这个头肯定足够大，晚餐有了。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/61115989019969294682.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_ruler.jpg"/> 
</figure>
 <br/></p>
<p>好事成双，不一会，我又踩到了一只大螃蟹上，我们又抓到了一只大螃蟹: <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/6111598901996929469.jpg"/> 
</figure>
 <br/></p>
<p>舍友不一会也挖到了一只大螃蟹。 <br/></p>
<p>原以为的抓螃蟹，最后变成在沙里挖螃蟹。 <br/></p>
<p>而让我们感觉非常可惜的是，是错过了两只个头超大的大螃蟹，个头约有整个球拍那么大。 <br/></p>
<p>只是它们不是把自己埋在沙里，或者是躲在海草丛里，而是在海草边闲逛，见我们向它们走过去，就横着径直向海的深处走去。 <br/></p>
<p>提着短裤，手机在口袋的我，着实没有勇气一往无前地追随它们的脚步把它们抓回来。 <br/></p>
<h2 id="回程"><span class="section-num">3</span> 回程</h2>
<p>从中午12点一直抓到下午2点多开始涨潮，大概总共抓到了十多只螃蟹，因为尺寸和数量的限定，我们最终只带走了3只螃蟹。 <br/></p>
<p>按照BC省的规定，每人最多可以可以带走2只螃蟹，并且需要花费6加元在政府官网购买一个tidal finish licence. <br/></p>
<p>只是从我们到海边，到我们离开，也并没有任何人检查你抓的螃蟹是否小于指定尺寸, 或者是否超过指定数量，或者没有购买 licence 就带走，只是大家都在遵守规定，我们也同样遵守规定。 <br/></p>
<p>在购买完tidal finish licence 之后，政府还会给你发一封邮件，让你自行申报你抓到了什么渔获。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/reporting_your_finishing_activity.jpg"/> 
</figure>
 <br/></p>
<p>在涨潮回岸边的时候，我算是见识到本地人夏天到户外游玩的心情是有多么强烈了， <br/>
在一群年青的女孩子穿泳衣走过海边之后，后面紧跟着一位腿上打着石膏，双手撑着拐杖，穿着泳衣的年轻女生。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/girl_to_beach.jpg"/> 
</figure>
 <br/></p>
<p>虽然我不知道打着石膏怎么下海玩，但是隔着几十米，我都能感受到她强烈的，不甘人后的游玩之心。 <br/></p>
<h2 id="晚餐"><span class="section-num">4</span> 晚餐</h2>
<p>就这样，我们花费了12加元，收获了三只净重超过一斤的大螃蟹，这种螃蟹是BC省的特产，叫 Dungeness crab, 把战利品拿回家时，还不知道怎么烹饪，只好在 Youtube 上面搜索了一下 Dungeness crab 的烹饪教程，上面的视频大多就是水煮螃蟹，着实提不起啥兴趣。 <br/></p>
<p>身为广东人，那就来个粤菜的姜葱炒蟹，由我这个天桥底炒粉的程序员来处理，耗时一小时，从上案板，到上餐桌： <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking1.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking2.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking3.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking4.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking5.jpg"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/crab_cooking6.jpg"/> 
</figure>
 <br/></p>
<p>吃到家乡的味道了。 <br/></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>寒冬怎么过</title>
      <link>https://ramsayleung.github.io/zh/post/2024/%E5%AF%92%E5%86%AC%E6%80%8E%E4%B9%88%E8%BF%87/</link>
      <pubDate>Sun, 21 Apr 2024 18:30:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/%E5%AF%92%E5%86%AC%E6%80%8E%E4%B9%88%E8%BF%87/</guid>
      <description>1 前言 一个人的命运啊，当然要靠自我奋斗，但是也要考虑到历史的进程。—— 长者 在22年开始，经济下行的阴云就一直笼罩在每个人头上，无论国内国外，</description>
      <content:encoded><![CDATA[<h2 id="前言"><span class="section-num">1</span> 前言</h2>
<blockquote>
<p>一个人的命运啊，当然要靠自我奋斗，但是也要考虑到历史的进程。—— 长者 <br/></p>
</blockquote>
<p>在22年开始，经济下行的阴云就一直笼罩在每个人头上，无论国内国外，耳边听到的都是毕业，layoff的故事，并且裁员现在也还在<a href="https://layoffs.fyi/">持续进行中</a> <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> <br/></p>
<p>与光景好的时候，各种跳槽拿大包的蒸蒸日上的氛围相比，着实是云泥之别。 <br/></p>
<p>最近这段时间, 我自己也因为各种遭遇，稍显消沉。 <br/></p>
<p>所以就写了这篇文章，既为渡己，也为宽慰有同样遭遇和心情的朋友。 <br/></p>
<h2 id="我所经历的寒冬"><span class="section-num">2</span> 我所经历的寒冬</h2>
<p>从2022年到2024年 <br/></p>
<h3 id="微信"><span class="section-num">2.1</span> 微信</h3>
<p>我自己个人职场遭遇比较坎坷，22年以前的经历在之前的文章《<a href="https://ramsayleung.github.io/zh/post/2023/%E8%BF%99%E4%BA%9B%E5%B9%B4%E8%B5%B0%E8%BF%87%E7%9A%84%E8%B7%AF_%E4%BB%8E%E5%B9%BF%E5%B7%9E%E5%88%B0%E6%B8%A9%E5%93%A5%E5%8D%8E/">这些年走过的路：从广州到温哥华</a>》写过， <br/>
就不多赘述，就只说下自己经历过的寒冬和最近的种种遭遇。 <br/></p>
<p>我在2020年加入了微信支付的委托代扣，当时的委托代扣还和付款码，收银台合称「基础支付」， <br/>
虽然交易量不及付款码和收银台，但是也是属于同一个量级的。 <br/></p>
<p>在2022年初的时候，当时整个腾讯里面都是铺天盖地的「降本增效」的「谣言」，要过冬。 <br/></p>
<p>因为每年都说要过冬，所以我一直以为是在做预期管理，又是不想发太多年终奖，就没有太当一回事。 <br/></p>
<p>到后来，腾讯的内部论坛开始逐渐出现各种「毕业论文」(被毕业同事们写的离别感言)，然后毕业论文越来越多，有铺天盖地之势。 <br/></p>
<p>我开始意识到，大规模的裁员真的在发生，有些业务线直接被砍，比如腾讯体育； <br/>
有些是整个业务线被砍成一个中心，比如腾讯新闻（具体细节记不清了）。 <br/></p>
<p>因为微信事业群人本来就不多，而且我们业务很核心，组里人也不多，算上老板也才只有10个人，所以我一直觉得这一刀不会砍得我们头上。 <br/></p>
<p>腾讯午餐+午休大概有2个小时，我之前一般是在这段时间去健身房锻炼， <br/>
然后运动完再去吃饭，回来工位的时候，同事一般都趴在座位或午休床上休息。 <br/></p>
<p>某天，我如往常般吃完饭回工位，却看到旁边位置的两位同事没有如往常般休息， <br/>
而是在窃窃私语。可能是今天有啥事情，不想大声说话影响其他同事休息吧，我并不在意。 <br/></p>
<p>只是后面连续好几天，我都没有发现旁边的同事来上班，我就问另外一位同事，这位同事是休假了么？好像没有听到他提起。 <br/></p>
<p>同事稍显惊讶，你不知道么？他被毕业了。 <br/></p>
<p>我当时真的被这个消息惊呆了，着实没有想到裁员这样的事发生了，并切实在旁边的同事身上。 <br/></p>
<p>我后面了解到，无论是什么组，都有10%的毕业指标，第一次感受到寒冬的凛冽。 <br/></p>
<h3 id="aws"><span class="section-num">2.2</span> AWS</h3>
<p>在各种机缘巧合之下，我在2022年年中拿到了AWS Canada的 Offer, 招聘的组是在AWS上面做CDN, 因为办签证等各种事情，我一直是等到2023年初才能入职。 <br/></p>
<p>但是，在2023年初，AWS也开始向国内大厂学习，开始了裁员潮，很不幸的是，我的offer也受到影响，岗位被撤回了。 <br/></p>
<p>但幸运的是，我只是岗位被撤回了，Offer没有被撤回，然后就被搬到一个为AWS 服务做碳排放工具的组。 <br/></p>
<p>这个组完全没有营收，各种事情在我看来都非常离谱，具体的离谱事我在《<a href="https://ramsayleung.github.io/zh/post/2024/%E7%99%BB%E9%99%86%E5%8A%A0%E6%8B%BF%E5%A4%A7%E4%B8%80%E5%B9%B4%E7%9A%84%E4%BD%93%E4%BC%9A/">登陆加拿大一年后的体会</a>》也介绍过了. <br/></p>
<p>鉴于我以往的经历，我觉得这样的组在当前环境非常危险，说不定哪天组就没有了或者我人也没了，所以我就决定内部转组。 <br/>
（4个月过后再看，这个组的确快要没了） <br/></p>
<p>我还特意和转组的manager聊他们的营收和2024年的目标，最后挑了一个在大力招人，营收很可观的，在AWS上做Kafka的组。 <br/></p>
<p>在当前环境下，如果有很多HeadCount招人，起码能说明是个很被重视的组。 <br/></p>
<p>然而，在我加入这个组1个半月后，有一天，我们的总监突然出现在团队的会议上，说有个组织变动的决定要宣布，你们组全部人都合并到S3去。 <br/></p>
<p>会议室上，大家面面相觑，这又是哪一出，Kafka和S3是同一个东西嘛？ <br/></p>
<p>决定就是决定，并没有商量的余地。 <br/></p>
<p>经过一个月时间的交接，我们手上所有的东西都交接给其他团队， <br/>
我就这样成为了S3的一员，我又开创了一年经历3个团队的新纪录（如果算上入职前的招聘团队，那就是4个团队了） <br/></p>
<p>我可以自我安慰道，总不会连S3都要裁吧，S3起码是个暂时安全的好去处，我也不需要向其他人解释我在做什么业务，S3是什么了。 <br/></p>
<p>只是相处下来，人nice, 技术又好，管理风格又放权透明的Kafka组 manager 也因为种种原因最后决定不加入 S3, 让我惋惜了好久，好不容易遇上个好 manager, 只叹缘分不够. <br/></p>
<h2 id="凛冬将至"><span class="section-num">3</span> 凛冬将至</h2>
<h3 id="寒冬的征兆"><span class="section-num">3.1</span> 寒冬的征兆</h3>
<p>作为经历了各种寒冬毕业潮的「老毕业员」了，我可以分享下自己的个人经验，来说下寒冬来临的征兆。 <br/></p>
<h4 id="停止招聘"><span class="section-num">3.1.1</span> 停止招聘</h4>
<p>公司停止招聘是一个非常重要的信号，这个意味着业务要停止扩张，起码对前景不看好。 <br/></p>
<p>这个直观的数据，可以直接从官网或者各种的招聘网站看到。 <br/></p>
<h4 id="谣言纷纷"><span class="section-num">3.1.2</span> 谣言纷纷</h4>
<p>各种小道消息，谣言开始疯传。 <br/></p>
<p>谣言着实是遥遥领先的预言，大部分都会成真。 <br/></p>
<p>因为很多的小道消息，就是HR和财务团队放出来的，给员工提前做预期管理。 <br/></p>
<p>真的要裁你，约谈的时候，你就不至于毫无心理准备，HR团队就免去了很多的麻烦，和你说「内网或者脉脉上面早就有人提起过了」。 <br/></p>
<h4 id="领导离职"><span class="section-num">3.1.3</span> 领导离职</h4>
<p>各种中层领导，GM或者总监开始突然离职, 这个时候就要开始注意了。 <br/></p>
<p>因为他们的位置比你高，知道的消息比你多，可能是收到暗示，先行跑路， <br/></p>
<p>或者是领导离职，底下员工就更容易拿捏了，毕竟能出头的人都没了。 <br/></p>
<h3 id="引-雷-位"><span class="section-num">3.2</span> 引「雷」位</h3>
<p>要预测什么位置容易被雷，首先要理解企业裁员背后的逻辑: <br/></p>
<h4 id="业务裁撤"><span class="section-num">3.2.1</span> 业务裁撤</h4>
<p>环境好的时候，多养些不赚钱的创新业务，好向投资人讲故事，拉升股价，对企业而已，是无伤大雅。 <br/></p>
<p>但是在寒冬来临的时候，企业要做的就是所谓的「降本增效」。 <br/></p>
<p>企业裁员是为了缩减成本，提高利润率，所以如果你所在的业务不赚钱，那么你就很危险了。 <br/></p>
<p>很多时候，并不是要把你这个人给裁掉，而是说这个业务要舍弃了，对应的岗位没有了，在这个岗位上的人被顺便抹掉了。 <br/></p>
<p>所以如果你所在的业务不赚钱，就要早做准备。 <br/></p>
<p>总是有程序员说，要写让人看不懂的代码，这样就有job security, 不会被裁。 <br/></p>
<p>有不少朋友是把段子当真，但当真的要裁撤业务线的时候，你的领导，你领导的领导都可能被裁掉，谁又会去看你的代码呢。 <br/></p>
<h4 id="摊大饼"><span class="section-num">3.2.2</span> 摊大饼</h4>
<p>还有另外一种裁员方式就是「摊大饼」，就是搞指标摊派，比如每个组要裁10%的人。 <br/></p>
<p>HR可能就会给每个组的人拉数据，比照薪资，绩效，工作年限等因素，然后就拉出一串清单给 manager, 如果 manager 没有强烈反对的话，一般就是名单上的人了。 <br/></p>
<p>manager 大概率就顺水推舟了，毕竟一个人出去了，另外一个人就要进去，谁都不愿作这个恶人。 <br/></p>
<p>如果你在同一级别待了比较久，那么你就比较危险，一个是会被认为没有快速晋升，潜力不足； <br/>
另外一个在同一级别待久了，薪资在同一级别就显得很高，对公司而言，性价比就下降了。 <br/></p>
<p>所以升职比加薪重要，只加薪不升职就比较危险。 <br/></p>
<p>如果绩效不好，那么就很容易被顺便雷了，道理就不言自明了。 <br/></p>
<p>工作年限短的，也容易被雷，因为对业务熟悉程度不够，裁了对业务影响也不大；另外年限短，赔偿也少。 <br/></p>
<h2 id="过冬准备"><span class="section-num">4</span> 过冬准备</h2>
<h3 id="锻炼身体"><span class="section-num">4.1</span> 锻炼身体</h3>
<p>身体是一切的本钱，没有一个好的身体，其他一切都是空谈。 <br/></p>
<p>所以要好好运动，健康生活。 <br/></p>
<p>运动还可以产生足够的多巴胺，可以让你感觉心情愉悦，降低焦虑感。 <br/></p>
<p>穿上鞋子，出去跑个步吧。 <br/></p>
<h3 id="持续学习"><span class="section-num">4.2</span> 持续学习</h3>
<blockquote>
<p>沉舟侧畔千帆过 枯树前头万木春 <br/></p>
</blockquote>
<p>总有人问，在现在这个环境下，学习是否还有用？ <br/></p>
<p>在我看来，学习无论在什么时候，都非常有用，所以要持续学习，终身学习。 <br/></p>
<p>机会只会留给有准备的人，如果在市场下行的时候不做好准备，那么市场上调的时候，又怎么能抓住机会，拿到好的 Offer 呢。 <br/></p>
<p>所以在寒冬时候学习，既是一个「无本抄底，低位建仓」的机会，也是一个降低焦虑感的手段。 <br/></p>
<p>如果你一直担心被裁员，那么只要你持续地在学习，持续地在刷题，那么被裁员了，也有信心可以再找一个新工作。 <br/></p>
<p>总不成天天在摸鱼打混，离职就能找到新工作吧。 <br/></p>
<p>你的信心是来源于你的行动的。 <br/></p>
<h3 id="去杠杆-减少债务"><span class="section-num">4.3</span> 去杠杆, 减少债务</h3>
<p>对于裁员焦虑的很大一部分原因是担心失去工作后，失去收入来源。 <br/></p>
<p>每个人的账务状况和收入状况都不一样，没有办法给出具体的建议。 <br/></p>
<p>但是思路和企业是一样的，是「降本增效」。 <br/></p>
<p>减少不必要的开销，降低债务水平，例如手上有余钱的可以考虑提前还房贷，而不是再去投资。 <br/></p>
<p>你投资的收益还不一定能跑赢房贷利率。 <br/></p>
<p>有应急资金，手中有粮，心中不慌。 <br/></p>
<p>因为各种毕业潮，导致「独立开发」或者「副业」的概念在程序员间兴起，大家都希望有自己的小生意，希望有稳定的「睡后收入」。 <br/></p>
<p>希望肯定是这样希望，但是不要在失业焦虑和急功近利的情况下去开展副业，因为那样很容易受挫后变成沮丧，进而变成更加消极。 <br/></p>
<p>先把主业给干好，有余力的时候，再多思考下，再看下是否有机会，不要因小失大。 <br/></p>
<p>不要用战术上的冒进去掩盖战略上的懒惰。 <br/></p>
<h3 id="no-loyalty"><span class="section-num">4.4</span> No Loyalty</h3>
<p>摆正心态。 <br/></p>
<p>对于企业而言，裁员只是他们的经营手段之一。 <br/></p>
<p>不需要为被裁员而去愤恨，抱怨一家公司, 毕竟「交绝无恶声，去臣无怨词」 <br/></p>
<p>也无需去拟人化一家公司，公司并不是人，而是由各种各样的人组成的一个集体。 <br/></p>
<p>不要抱有“我为你付出了这么久，加班这么多，你怎么可以这样对我，没有功劳也有苦劳阿” <br/></p>
<p>只要把补偿给到位，就不要和公司有太多无谓的纠缠。 <br/></p>
<p>同样，也不要对公司有所谓的 loyalty 的想法，只要尽好员工的职责，对得起公司的发的薪水，有足够的责任心就够了。 <br/></p>
<p>如果以后有好的职业发展机会，应该从自身发展的角度来考虑问题。 <br/></p>
<p>毕竟公司裁你没有考虑你是否刚结婚还是在还房贷，你离开公司自然也不需要考虑会对公司有什么影响。 <br/></p>
<p>换位思考，fair enough. <br/></p>
<h3 id="be-happy"><span class="section-num">4.5</span> Be Happy</h3>
<p>因为最近到报税季，需要处理跨国税务的问题，公司给指派了一位 Deloitte 的会计师，上周在咨询完税务问题之后，就和会计师在会议软件上聊起天来。 <br/></p>
<p>看名字，听声音，还有不时爽朗的笑声，我以为会计师是位白人的小姐姐。 <br/></p>
<p>没想到聊下来才知道，原因这位声音年轻的小姐姐，年龄已经和我母亲相仿，女儿都已经大学毕业了。 <br/></p>
<p>这位大姐姐就和分享了她的背景，北美和亚洲各地多年的工作经历，我顺便聊起自己的经历，最近我面临各种 re-org, 还有我知道的各种tech company 的 layoff, 以及我的其他见闻。 <br/></p>
<p>大姐姐也对此也表示认同，并且分享了她的见解，并安慰起我来，后面还提起她的女儿也和在同一家公司工作，不过在西雅图。 <br/></p>
<p>就这样我们不知不觉地聊了大概45分钟左右，最后挂断之前，大姐姐和我说： <br/></p>
<blockquote>
<p>Just be happy and control what you can control. <br/></p>
</blockquote>
<p>如果感觉消沉，多和朋友或家人聊天。 <br/></p>
<p>也把她的话赠给大家, <strong>Be Happy</strong> <br/></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://layoffs.fyi">https://layoffs.fyi</a>  <br/>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
    <item>
      <title>100 Days of SwiftUI</title>
      <link>https://ramsayleung.github.io/zh/post/2024/100_days_of_swiftui/</link>
      <pubDate>Tue, 09 Apr 2024 19:04:00 -0700</pubDate>
      
      <guid>https://ramsayleung.github.io/zh/post/2024/100_days_of_swiftui/</guid>
      <description>1 缘起 我花了半年多的时间，在闲暇时间，学习了苹果的Swift语言和SwiftUI框架，想体验下IOS开发，再看下有没有机会通过写软件来做点副</description>
      <content:encoded><![CDATA[<h2 id="缘起"><span class="section-num">1</span> 缘起</h2>
<p>我花了半年多的时间，在闲暇时间，学习了苹果的Swift语言和SwiftUI框架，想体验下IOS开发，再看下有没有机会通过写软件来做点副业。 <br/></p>
<p>先花了大概3个月时间，通过阅读 <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/guidedtour/">The Swift Programming Language</a> 这本官方电子书<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>来学习Swift这门语言，又花了接近4个月的时候来学习 <a href="https://www.hackingwithswift.com/100/swiftui">100 Days of SwiftUI</a> 这门课程<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>，每天花费1到2小时来学习一课，总共100课，所以顾名思义叫 100 Days of SwiftUI, 课程非常新且好，讲师功力深厚，课讲得深入浅出，娓娓道来。 <br/></p>
<p>每完成一课，就在Twitter上发一条推文，今天刚好把第100天的推文发了. <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/tweet_day_100.png"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/tweet_day_99.png"/> 
</figure>
 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/tweet_day_96.png"/> 
</figure>
 <br/></p>
<p>今天是结课之日，我通过了结课的考试，总分100分，考了91分，喜提课程证书一枚. <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/100_days_of_swiftui_certificate.jpg"/> 
</figure>
 <br/></p>
<p>在整个课程中，我写了19个IOS App(虽说大部分是功能简单的App), 源码也基本放在<a href="https://github.com/ramsayleung?tab=repositories&amp;q=&amp;type=&amp;language=swift&amp;sort="> GitHub</a> <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>上了，不过所有的App都没有上架App Store，因为我还没有给苹果交税(99美刀的开发者注册费). <br/></p>
<p>经过这100节课和19个APP的训练，我自觉已经掌握了使用Swift和SwiftUI的基础开发技能，算是个入门的IOS开发了, 现在我可以说自己是前端，后端，数据开发，IOS开发都搞过的全栈(<del>干</del>)工程师了（不是） <br/></p>
<p>但是在苹果对SwiftUI开发思路做出改变之前，我SwiftUI之旅可能就先到此为止了，原因下文再谈 <br/></p>
<h2 id="swift-初体验"><span class="section-num">2</span> Swift 初体验</h2>
<p>Swift 是由LLVM之父 <a href="https://en.wikipedia.org/wiki/Chris_Lattner">Chris Lattner</a> <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>在2010开始开发，在2014年的WWDC苹果开发者大会正式推出的一门编程语言。 <br/></p>
<p>按照官方的说法，Swift从 Objective-C, Rust, Haskell, Ruby, Python, C#身上都有不同程度的借鉴和学习。 <br/></p>
<p>因为我对上面提到的语言多少有涉猎，所以学习Swift起来基本没有什么困难, <code>Optional</code>, <code>Error Handling</code>, <code>Result</code>, <code>Generic</code>, <code>Enumerations</code>, <code>Protocol</code> 这些概念都和Rust的大同小异。 <br/></p>
<p>又是由LLVM之父来操刀，所以语言本身也设计得很优雅. <br/></p>
<p>让我眼前一亮的可能是借鉴自 <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods">C# Extension Methods</a> <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>的 <code>extension</code> 功能 , 可以对已有的 class, enum 或者是 protocol 类型增加新的函数，也就是在不修改源码的情况下，扩展已有的功能. <br/></p>
<p>例如，以下的代码就可以扩展内置的 <code>Double</code> 类型, 实现以米为单位，进行千米, 厘米，毫米，公尺的转换: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">extension</span> <span class="nc">Double</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">km</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">self</span> <span class="o">*</span> <span class="mf">1_000.0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">m</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">self</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">cm</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">self</span> <span class="o">/</span> <span class="mf">100.0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">mm</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">self</span> <span class="o">/</span> <span class="mf">1_000.0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">ft</span><span class="p">:</span> <span class="nb">Double</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">self</span> <span class="o">/</span> <span class="mf">3.28084</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">oneInch</span> <span class="p">=</span> <span class="mf">25.4</span><span class="p">.</span><span class="n">mm</span>
</span></span><span class="line"><span class="cl"><span class="bp">print</span><span class="p">(</span><span class="s">&#34;One inch is </span><span class="si">\(</span><span class="n">oneInch</span><span class="si">)</span><span class="s"> meters&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Prints &#34;One inch is 0.0254 meters&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nv">threeFeet</span> <span class="p">=</span> <span class="mf">3.</span><span class="n">ft</span>
</span></span><span class="line"><span class="cl"><span class="bp">print</span><span class="p">(</span><span class="s">&#34;Three feet is </span><span class="si">\(</span><span class="n">threeFeet</span><span class="si">)</span><span class="s"> meters&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Prints &#34;Three feet is 0.914399970739201 meters&#34;</span>
</span></span></code></pre></div><p>总体而言, Swift是一门吸收了众多PL理论的现代编程语言, 官方说支持Linux，Windows，MacOS等多个平台，不过我估计大多是在MacOS上用来写IOS和Mac应用 <br/></p>
<h2 id="swiftui"><span class="section-num">3</span> SwiftUI</h2>
<p>SwiftUI 使用的声明式语法，让开发者写页面布局和效果变得简洁清晰, 例如通过 <code>VStack</code>, <code>HStack</code>, <code>ZStack</code> 就可以实现X轴，Y轴，和Z轴方向的布局 <br/></p>
<p>例如下面这个就是通过 <code>ZStack</code> 几行代码实现的叠加效果: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">colors</span><span class="p">:</span> <span class="p">[</span><span class="n">Color</span><span class="p">]</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="p">[.</span><span class="n">red</span><span class="p">,</span> <span class="p">.</span><span class="n">orange</span><span class="p">,</span> <span class="p">.</span><span class="n">yellow</span><span class="p">,</span> <span class="p">.</span><span class="n">green</span><span class="p">,</span> <span class="p">.</span><span class="n">blue</span><span class="p">,</span> <span class="p">.</span><span class="n">purple</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ZStack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ForEach</span><span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="n">colors</span><span class="p">.</span><span class="bp">count</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Rectangle</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">fill</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="nv">$0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">y</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">10.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><figure>
    <img loading="lazy" src="/ox-hugo/zstack_rectangle.png"/> 
</figure>
 <br/></p>
<p>除了声明式语法之外，SwiftUI让人赏心悦目的就是动画。好的动画在App里面绝对能起到画龙点睛的作用，而SwiftUI的内置动画已经非常强大了，下面就是使用内置动画实现的动画效果: <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">struct</span> <span class="nc">ContentView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">dragAmount</span> <span class="p">=</span> <span class="n">CGSize</span><span class="p">.</span><span class="n">zero</span>
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">enable</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">letters</span> <span class="p">=</span> <span class="s">&#34;Hello, World&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HStack</span><span class="p">(</span><span class="n">spacing</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ForEach</span><span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="n">letters</span><span class="p">.</span><span class="bp">count</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="err">\</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">index</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">                <span class="n">Text</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="n">letters</span><span class="p">[</span><span class="n">letters</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">letters</span><span class="p">.</span><span class="n">startIndex</span><span class="p">,</span> <span class="n">offsetBy</span><span class="p">:</span> <span class="n">index</span><span class="p">)]))</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">font</span><span class="p">(.</span><span class="n">title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">enable</span> <span class="p">?</span> <span class="p">.</span><span class="n">green</span> <span class="p">:</span> <span class="p">.</span><span class="n">blue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">offset</span><span class="p">(</span><span class="n">dragAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">animation</span><span class="p">(.</span><span class="n">linear</span><span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="nb">Double</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">),</span> <span class="n">value</span><span class="p">:</span> <span class="n">dragAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}.</span><span class="n">gesture</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">DragGesture</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">onChanged</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">dragAmount</span> <span class="p">=</span> <span class="nv">$0</span><span class="p">.</span><span class="n">translation</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">onEnded</span> <span class="p">{</span> <span class="kc">_</span> <span class="k">in</span>
</span></span><span class="line"><span class="cl">                    <span class="n">dragAmount</span> <span class="p">=</span> <span class="n">CGSize</span><span class="p">.</span><span class="n">zero</span>
</span></span><span class="line"><span class="cl">                    <span class="n">enable</span><span class="p">.</span><span class="n">toggle</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><figure>
    <img loading="lazy" src="/ox-hugo/drag_animation.gif"/> 
</figure>
 <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl">  <span class="kd">struct</span> <span class="nc">HeartBeatView</span><span class="p">:</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">@</span><span class="n">State</span> <span class="kd">private</span> <span class="kd">var</span> <span class="nv">animationAmount</span> <span class="p">=</span> <span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="n">View</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Button</span><span class="p">(</span><span class="s">&#34;SOS&#34;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">background</span><span class="p">(.</span><span class="n">red</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">foregroundColor</span><span class="p">(.</span><span class="n">white</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">clipShape</span><span class="p">(</span><span class="n">Circle</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">overlay</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">Circle</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">stroke</span><span class="p">(.</span><span class="n">red</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">scaleEffect</span><span class="p">(</span><span class="n">animationAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">opacity</span><span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">animationAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">.</span><span class="n">animation</span><span class="p">(.</span><span class="n">easeOut</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">.</span><span class="n">repeatForever</span><span class="p">(</span><span class="n">autoreverses</span><span class="p">:</span> <span class="kc">false</span><span class="p">),</span> <span class="n">value</span><span class="p">:</span> <span class="n">animationAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">onAppear</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">animationAmount</span> <span class="p">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><figure>
    <img loading="lazy" src="/ox-hugo/hearbeat.gif"/> 
</figure>
 <br/></p>
<p>而Xcode 15新增的预览功能也很好用，可以让开发者不需要启动iPhone模拟器就能预览页面效果，节省了非常多的等待时间。 <br/></p>
<p><figure>
    <img loading="lazy" src="/ox-hugo/xcode_preview.png"/> 
</figure>
 <br/></p>
<h2 id="问题"><span class="section-num">4</span> 问题</h2>
<p>听起来好像很美好: IDE新功能好用，编程语言优雅, UI框架简洁好用; 但是苹果的开发思路却有问题： 苹果开发的SwiftUI不向后兼容老版本的IOS。 <br/></p>
<p>SwiftUI大部分功能都是只支持IOS16及以后的版本，而苹果新出来的数据持久框架 <code>SwiftData</code> 甚至只支持IOS17, <br/>
更离谱的是，SwiftUI的 BugFix 也只支持高版本IOS, 这就意味着用户不升级IOS版本，甚至SwiftUI的bug开发者都没法修复。 <br/></p>
<p>我自己的手机也只更新到IOS16，所以我时常会遇到我自己写的App没法运行到我自己手机上的情况。 <br/></p>
<p>不支持旧版本的IOS就让一大批的开发者和公司都没有动力去使用SwiftUI: <br/></p>
<p>对于开发新应用的开发者而言，只支持IOS17就意味着会流失一大群使用IOS16及以下版本的用户， <br/>
而对于拥有存量用户的公司而言，更没有动力去使用SwiftUI，用了之后，旧版本IOS的用户可能直接无法打开应用。 <br/></p>
<p>因此SwiftUI就陷入了一个尴尬的境地，东西做得好，但是不会有人用; <br/></p>
<p>没有人自然就不用有人分享，宣传这门技术，自然就导致相关的学习资料非常匮乏, 进一步加深了初学者的学习难度; <br/></p>
<p>开发遇到问题连懂的人都不用，官方文档写了又约等于没有写, 直接劝退初学者，恶性循环。 <br/></p>
<p>又因为接受SwiftUI的开发者还不多，苹果版本迭代起来更加肆无忌惮，新版本又引入一堆的Breaking change，导致开发者更新版本非常痛苦. <br/></p>
<p>另外一个问题就是SwiftUI与苹果现有框架整合得不够好，如 <code>CoreImage</code> 框架，顾名思义是用来作图片处理. <br/></p>
<p>但之前是使用Objective-C写的，通过SwiftUI来调用，就会变成相当恶心，需要把Swift的数据结构传换成Objective-C来处理, 如： <br/></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-swift" data-lang="swift"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">applyProcess</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">outputImage</span> <span class="p">=</span> <span class="n">currentFilter</span><span class="p">.</span><span class="n">outputImage</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">cgImage</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">createCGImage</span><span class="p">(</span><span class="n">outputImage</span><span class="p">,</span> <span class="n">from</span><span class="p">:</span> <span class="n">outputImage</span><span class="p">.</span><span class="n">extent</span><span class="p">)</span> <span class="k">else</span><span class="p">{</span><span class="k">return</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nv">uiImage</span> <span class="p">=</span> <span class="n">UIImage</span><span class="p">(</span><span class="n">cgImage</span><span class="p">:</span> <span class="n">cgImage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">processedImage</span> <span class="p">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">uiImage</span><span class="p">:</span> <span class="n">uiImage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">loadImage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Task</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">imageData</span> <span class="p">=</span> <span class="k">try</span> <span class="n">await</span> <span class="n">selectedItem</span><span class="p">?.</span><span class="n">loadTransferable</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="n">Data</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">inputImage</span> <span class="p">=</span> <span class="n">UIImage</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">imageData</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nv">beginImage</span> <span class="p">=</span> <span class="n">CIImage</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">inputImage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">currentFilter</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">beginImage</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="n">kCIInputImageKey</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">applyProcess</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>把 <code>CoreImage</code> 框架的 <code>CIImage</code> 转成 <code>CoreGraphics</code> 框架的 <code>CGImage</code>, 然后再把 <code>CGImage</code> 转换成 <code>UIKit</code> 框架 <code>UIImage</code>, 然后再转换回SwiftUI 内置的 <code>Image</code> 类型, 可谓是相当麻烦了. <br/></p>
<p>但是对比SwiftUI只支持高版本的问题，Objective-C和Swift的互操作问题也只能算是恶心，但是起码有解决方法，对于前者，开发者是完全没法自行解决. <br/></p>
<h2 id="总结"><span class="section-num">5</span> 总结</h2>
<p>过了一把野生IOS开发的瘾，但是除非是苹果愿意让SwiftUI支持低版本的IOS， <br/>
不然我是没有太大意愿继续使用SwiftUI来开发IOS了，受众比较有限了。 <br/></p>
<p>想要支持低版本的IOS，就只能走UIKit和Objective-C这条历史老路，我对此着实是望而生畏，有空还是学习点其他有趣的东西。 <br/></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/guidedtour/">https://docs.swift.org/swift-book/documentation/the-swift-programming-language/guidedtour/</a> <br/>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p><a href="https://www.hackingwithswift.com/100/swiftui">https://www.hackingwithswift.com/100/swiftui</a> <br/>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://github.com/ramsayleung?tab=repositories&amp;q=&amp;type=&amp;language=swift&amp;sort">https://github.com/ramsayleung?tab=repositories&amp;q=&amp;type=&amp;language=swift&amp;sort</a>= <br/>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p><a href="https://en.wikipedia.org/wiki/Chris_Lattner">https://en.wikipedia.org/wiki/Chris_Lattner</a>  <br/>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods">https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/extension-methods</a>  <br/>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
